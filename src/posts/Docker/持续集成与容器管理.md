# æŒç»­é›†æˆä¸å®¹å™¨ç®¡ç†  

å­¦ä¹ ç›®æ ‡ï¼š

- æŒæ¡DockerMavenæ’ä»¶çš„ä½¿ç”¨
- æŒæ¡æŒç»­é›†æˆå·¥å…·Jenkinsçš„å®‰è£…ä¸ä½¿ç”¨
- æŒæ¡å®¹å™¨ç®¡ç†å·¥å…·Rancherçš„å®‰è£…ä¸ä½¿ç”¨
- æŒæ¡æ—¶é—´åºåˆ—æ•°æ®åº“influxDBçš„å®‰è£…ä¸ä½¿ç”¨
- æŒæ¡å®¹å™¨ç›‘æ§å·¥å…·cAdvisorçš„å®‰è£…ä¸ä½¿ç”¨
- æŒæ¡å›¾è¡¨å·¥å…·Grafanaçš„ä½¿ç”¨


# 1 DockerMavenæ’ä»¶

å¾®æœåŠ¡éƒ¨ç½²æœ‰ä¸¤ç§æ–¹æ³•ï¼š

ï¼ˆ1ï¼‰æ‰‹åŠ¨éƒ¨ç½²ï¼šé¦–å…ˆåŸºäºæºç æ‰“åŒ…ç”ŸæˆjaråŒ…ï¼ˆæˆ–waråŒ…ï¼‰,å°†jaråŒ…ï¼ˆæˆ–waråŒ…ï¼‰ä¸Šä¼ è‡³è™šæ‹Ÿæœºå¹¶æ‹·è´è‡³JDKå®¹å™¨ã€‚

ï¼ˆ2ï¼‰é€šè¿‡Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²ã€‚

å¯¹äºæ•°é‡ä¼—å¤šçš„å¾®æœåŠ¡ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ— ç–‘æ˜¯éå¸¸éº»çƒ¦çš„åšæ³•ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå­¦ä¹ å¦‚ä½•è‡ªåŠ¨éƒ¨ç½²ï¼Œè¿™ä¹Ÿæ˜¯ä¼ä¸šå®é™…å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨çš„æ–¹æ³•ã€‚

Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼š

ï¼ˆ1ï¼‰ä¿®æ”¹å®¿ä¸»æœºçš„dockeré…ç½®ï¼Œè®©å…¶å¯ä»¥è¿œç¨‹è®¿é—®

```
vi /lib/systemd/system/docker.service
```

å…¶ä¸­ExecStart=åæ·»åŠ é…ç½®`-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock`

ä¿®æ”¹åå¦‚ä¸‹ï¼š

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613013.png)

ï¼ˆ2ï¼‰åˆ·æ–°é…ç½®ï¼Œé‡å¯æœåŠ¡

```
systemctl daemon-reload
systemctl restart docker
docker start registry
```

ï¼ˆ3ï¼‰åœ¨å·¥ç¨‹pom.xml å¢åŠ é…ç½®

```xml
     <build>
        <finalName>app</finalName>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
            <!-- dockerçš„mavenæ’ä»¶ï¼Œå®˜ç½‘ï¼šhttps://github.com/spotify/docker-maven-plugin -->
            <plugin>
                <groupId>com.spotify</groupId>
                <artifactId>docker-maven-plugin</artifactId>
                <version>0.4.13</version>
                <configuration>
               <./assetsName>192.168.184.141:5000/${project.artifactId}:${project.version}</./assetsName>
                    <base./assets>jdk1.8</base./assets>
                    <entryPoint>["java", "-jar", "/${project.build.finalName}.jar"]</entryPoint>
                    <resources>
                        <resource>
                            <targetPath>/</targetPath>
                            <directory>${project.build.directory}</directory>
                            <include>${project.build.finalName}.jar</include>
                        </resource>
                    </resources>
                    <dockerHost>http://192.168.184.141:2375</dockerHost>
                </configuration>
            </plugin>
        </plugins>
    </build>
```

ä»¥ä¸Šé…ç½®ä¼šè‡ªåŠ¨ç”ŸæˆDockerfile

```
FROM jdk1.8
ADD app.jar /
ENTRYPOINT ["java","-jar","/app.jar"]
```

ï¼ˆ5ï¼‰åœ¨windowsçš„å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œè¿›å…¥å·¥ç¨‹tensquare_parentæ‰€åœ¨çš„ç›®å½•

```
mvn install
```

è¿›å…¥tensquare_base æ‰€åœ¨çš„ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œæ‰“åŒ…å’Œä¸Šä¼ é•œåƒ

```
mvn docker:build  -Dpush./assets
```

æ‰§è¡Œåï¼Œä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼Œä»£ç æ­£åœ¨ä¸Šä¼ 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613395.png)

ï¼ˆ6ï¼‰è¿›å…¥å®¿ä¸»æœº , æŸ¥çœ‹é•œåƒ

```
docker ./assetss
```

```
REPOSITORY                              TAG                 ./assets ID            CREATED             SIZE
192.168.184.135:5000/tensquare_base   1.0-SNAPSHOT        83efa6b4478c        10 minutes ago      687.9 MB
192.168.184.135:5000/jdk1.8             latest              507438a0158f        6 hours ago         584 MB
jdk1.8                                  latest              507438a0158f        6 hours ago         584 MB
```

è¾“å‡ºå¦‚ä¸Šå†…å®¹ï¼Œè¡¨ç¤ºå¾®æœåŠ¡å·²ç»åšæˆé•œåƒ

æµè§ˆå™¨è®¿é—®  http://192.168.184.141:5000/v2/_catalog  ï¼Œè¾“å‡º

```
{"repositories":["tensquare_base"]}
```

æµè§ˆå™¨è®¿é—®  http://192.168.184.141:5000/v2/_catalog  ï¼Œè¾“å‡º

```
{"repositories":["tensquare_base"]}
```

ï¼ˆ7ï¼‰ å¯åŠ¨å®¹å™¨ï¼š

```
docker run -di --name=base -p 9001:9001 192.168.184.141:5000/tensquare_base:1.0-SNAPSHOT 
```

# 2 æŒç»­é›†æˆå·¥å…·-Jenkins

## 2.1 ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ

â€‹	æŒç»­é›†æˆ   Continuous integration ï¼Œç®€ç§°CI	

â€‹	éšç€è½¯ä»¶å¼€å‘å¤æ‚åº¦çš„ä¸æ–­æé«˜ï¼Œå›¢é˜Ÿå¼€å‘æˆå‘˜é—´å¦‚ä½•æ›´å¥½åœ°ååŒå·¥ä½œä»¥ç¡®ä¿è½¯ä»¶å¼€å‘çš„è´¨é‡å·²ç»æ…¢æ…¢æˆä¸ºå¼€å‘è¿‡ç¨‹ä¸­ä¸å¯å›é¿çš„é—®é¢˜ã€‚å°¤å…¶æ˜¯è¿‘äº›å¹´æ¥ï¼Œæ•æ·ï¼ˆAgileï¼‰ åœ¨è½¯ä»¶å·¥ç¨‹é¢†åŸŸè¶Šæ¥è¶Šçº¢ç«ï¼Œå¦‚ä½•èƒ½å†ä¸æ–­å˜åŒ–çš„éœ€æ±‚ä¸­å¿«é€Ÿé€‚åº”å’Œä¿è¯è½¯ä»¶çš„è´¨é‡ä¹Ÿæ˜¾å¾—å°¤å…¶çš„é‡è¦ã€‚

â€‹	æŒç»­é›†æˆæ­£æ˜¯é’ˆå¯¹è¿™ä¸€ç±»é—®é¢˜çš„ä¸€ç§è½¯ä»¶å¼€å‘å®è·µã€‚å®ƒå€¡å¯¼å›¢é˜Ÿå¼€å‘æˆå‘˜å¿…é¡»ç»å¸¸é›†æˆä»–ä»¬çš„å·¥ä½œï¼Œç”šè‡³æ¯å¤©éƒ½å¯èƒ½å‘ç”Ÿå¤šæ¬¡é›†æˆã€‚è€Œæ¯æ¬¡çš„é›†æˆéƒ½æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºæ¥éªŒè¯ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç¼–è¯‘ã€å‘å¸ƒå’Œæµ‹è¯•ï¼Œä»è€Œå°½å¿«åœ°å‘ç°é›†æˆé”™è¯¯ï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿæ›´å¿«çš„å¼€å‘å†…èšçš„è½¯ä»¶ã€‚

æŒç»­é›†æˆå…·æœ‰çš„ç‰¹ç‚¹ï¼š

- å®ƒæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å‘¨æœŸæ€§çš„é›†æˆæµ‹è¯•è¿‡ç¨‹ï¼Œä»æ£€å‡ºä»£ç ã€ç¼–è¯‘æ„å»ºã€è¿è¡Œæµ‹è¯•ã€ç»“æœè®°å½•ã€æµ‹è¯•ç»Ÿè®¡ç­‰éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›
- éœ€è¦æœ‰ä¸“é—¨çš„é›†æˆæœåŠ¡å™¨æ¥æ‰§è¡Œé›†æˆæ„å»ºï¼›
- éœ€è¦æœ‰ä»£ç æ‰˜ç®¡å·¥å…·æ”¯æŒï¼Œæˆ‘ä»¬ä¸‹ä¸€å°èŠ‚å°†ä»‹ç»Gitä»¥åŠå¯è§†åŒ–ç•Œé¢Gogsçš„ä½¿ç”¨


æŒç»­é›†æˆçš„ä½œç”¨ï¼š

- ä¿è¯å›¢é˜Ÿå¼€å‘äººå‘˜æäº¤ä»£ç çš„è´¨é‡ï¼Œå‡è½»äº†è½¯ä»¶å‘å¸ƒæ—¶çš„å‹åŠ›ï¼›
- æŒç»­é›†æˆä¸­çš„ä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€å¤ªå¤šçš„äººå·¥å¹²é¢„ï¼Œæœ‰åˆ©äºå‡å°‘é‡å¤è¿‡ç¨‹ä»¥èŠ‚çœæ—¶é—´ã€è´¹ç”¨å’Œå·¥ä½œé‡ï¼›


## 2.2 Jenkinsç®€ä»‹

â€‹	Jenkinsï¼ŒåŸåHudsonï¼Œ2011å¹´æ”¹ä¸ºç°åœ¨çš„åå­—ï¼Œå®ƒ æ˜¯ä¸€ä¸ªå¼€æºçš„å®ç°æŒç»­é›†æˆçš„è½¯ä»¶å·¥å…·ã€‚å®˜æ–¹ç½‘ç«™ï¼š[http://jenkins-ci.org/](http://jenkins-ci.org/)ã€‚

â€‹	Jenkins èƒ½å®æ–½ç›‘æ§é›†æˆä¸­å­˜åœ¨çš„é”™è¯¯ï¼Œæä¾›è¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶å’Œæé†’åŠŸèƒ½ï¼Œè¿˜èƒ½ç”¨å›¾è¡¨çš„å½¢å¼å½¢è±¡åœ°å±•ç¤ºé¡¹ç›®æ„å»ºçš„è¶‹åŠ¿å’Œç¨³å®šæ€§ã€‚

â€‹	ç‰¹ç‚¹ï¼š

- æ˜“å®‰è£…ï¼šä»…ä»…ä¸€ä¸ªÂ java -jar jenkins.warï¼Œä»å®˜ç½‘ä¸‹è½½è¯¥æ–‡ä»¶åï¼Œç›´æ¥è¿è¡Œï¼Œæ— éœ€é¢å¤–çš„å®‰è£…ï¼Œæ›´æ— éœ€å®‰è£…æ•°æ®åº“ï¼›
- æ˜“é…ç½®ï¼šæä¾›å‹å¥½çš„GUIé…ç½®ç•Œé¢ï¼›
- å˜æ›´æ”¯æŒï¼šJenkinsèƒ½ä»ä»£ç ä»“åº“ï¼ˆSubversion/CVSï¼‰ä¸­è·å–å¹¶äº§ç”Ÿä»£ç æ›´æ–°åˆ—è¡¨å¹¶è¾“å‡ºåˆ°ç¼–è¯‘è¾“å‡ºä¿¡æ¯ä¸­ï¼›
- æ”¯æŒæ°¸ä¹…é“¾æ¥ï¼šç”¨æˆ·æ˜¯é€šè¿‡webæ¥è®¿é—®Jenkinsçš„ï¼Œè€Œè¿™äº›webé¡µé¢çš„é“¾æ¥åœ°å€éƒ½æ˜¯æ°¸ä¹…é“¾æ¥åœ°å€ï¼Œå› æ­¤ï¼Œä½ å¯ä»¥åœ¨å„ç§æ–‡æ¡£ä¸­ç›´æ¥ä½¿ç”¨è¯¥é“¾æ¥ï¼›
- é›†æˆE-Mail/RSS/IMï¼šå½“å®Œæˆä¸€æ¬¡é›†æˆæ—¶ï¼Œå¯é€šè¿‡è¿™äº›å·¥å…·å®æ—¶å‘Šè¯‰ä½ é›†æˆç»“æœï¼ˆæ®æˆ‘æ‰€çŸ¥ï¼Œæ„å»ºä¸€æ¬¡é›†æˆéœ€è¦èŠ±è´¹ä¸€å®šæ—¶é—´ï¼Œæœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å°±å¯ä»¥åœ¨ç­‰å¾…ç»“æœè¿‡ç¨‹ä¸­ï¼Œå¹²åˆ«çš„äº‹æƒ…ï¼‰ï¼›
- JUnit/TestNGæµ‹è¯•æŠ¥å‘Šï¼šä¹Ÿå°±æ˜¯ç”¨ä»¥å›¾è¡¨ç­‰å½¢å¼æä¾›è¯¦ç»†çš„æµ‹è¯•æŠ¥è¡¨åŠŸèƒ½ï¼›
- æ”¯æŒåˆ†å¸ƒå¼æ„å»ºï¼šJenkinså¯ä»¥æŠŠé›†æˆæ„å»ºç­‰å·¥ä½œåˆ†å‘åˆ°å¤šå°è®¡ç®—æœºä¸­å®Œæˆï¼›
- æ–‡ä»¶æŒ‡çº¹ä¿¡æ¯ï¼šJenkinsä¼šä¿å­˜å“ªæ¬¡é›†æˆæ„å»ºäº§ç”Ÿäº†å“ªäº›jarsæ–‡ä»¶ï¼Œå“ªä¸€æ¬¡é›†æˆæ„å»ºä½¿ç”¨äº†å“ªä¸ªç‰ˆæœ¬çš„jarsæ–‡ä»¶ç­‰æ„å»ºè®°å½•ï¼›
- æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶ï¼šä½¿å¾— Jenkins å˜å¾—è¶Šæ¥è¶Šå¼ºå¤§


## 2.3 Jenkinså®‰è£…

### 2.3.1 JDKå®‰è£…

ï¼ˆ1ï¼‰å°†jdk-8u171-linux-x64.rpmä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰

ï¼ˆ2ï¼‰æ‰§è¡Œå®‰è£…å‘½ä»¤

```
rpm -ivh jdk-8u171-linux-x64.rpm
```

RPMæ–¹å¼å®‰è£…JDKï¼Œå…¶æ ¹ç›®å½•ä¸ºï¼š/usr/java/jdk1.8.0_171-amd64

### 2.3.2 Jenkinså®‰è£…ä¸å¯åŠ¨ 

ï¼ˆ1ï¼‰ä¸‹è½½jenkins

```
wget https://pkg.jenkins.io/redhat/jenkins-2.83-1.1.noarch.rpm
```

æˆ–å°†jenkins-2.83-1.1.noarch.rpmä¸Šä¼ è‡³æœåŠ¡å™¨

ï¼ˆ2ï¼‰å®‰è£…jenkins

```
rpm -ivh jenkins-2.83-1.1.noarch.rpm
```

ï¼ˆ3ï¼‰é…ç½®jenkins

```
vi /etc/sysconfig/jenkins
```

ä¿®æ”¹ç”¨æˆ·å’Œç«¯å£

```
JENKINS_USER="root"
JENKINS_PORT="8888"
```

ï¼ˆ4ï¼‰å¯åŠ¨æœåŠ¡

```
systemctl start jenkins
```

ï¼ˆ5ï¼‰è®¿é—®é“¾æ¥ http://192.168.184.135:8888

ä»/var/lib/jenkins/secrets/initialAdminPasswordä¸­è·å–åˆå§‹å¯†ç ä¸² 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613733.png)

ï¼ˆ6ï¼‰å®‰è£…æ’ä»¶  

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613461.png)

 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614510.png)

ï¼ˆ7ï¼‰æ–°å»ºç”¨æˆ·

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613286.png)

å®Œæˆå®‰è£…è¿›å…¥ä¸»ç•Œé¢

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111613840.png)

## 2.4 Jenkinsæ’ä»¶å®‰è£…

æˆ‘ä»¬ä»¥å®‰è£…mavenæ’ä»¶ä¸ºä¾‹ï¼Œæ¼”ç¤ºæ’ä»¶çš„å®‰è£…

ï¼ˆ1ï¼‰ç‚¹å‡»å·¦ä¾§çš„â€œç³»ç»Ÿç®¡ç†â€èœå• ,ç„¶åç‚¹å‡»

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614282.png)

ï¼ˆ2ï¼‰é€‰æ‹©â€œå¯é€‰æ’ä»¶â€é€‰é¡¹å¡ï¼Œæœç´¢mavenï¼Œåœ¨åˆ—è¡¨ä¸­é€‰æ‹©Maven Integration  ï¼Œç‚¹å‡»â€œç›´æ¥å®‰è£…â€æŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614229.png)

çœ‹åˆ°å¦‚ä¸‹å›¾æ—¶ï¼Œè¡¨ç¤ºå·²ç»å®Œæˆ

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614206.png)



## 2.5 å…¨å±€å·¥å…·é…ç½®

### 2.5.1 å®‰è£…Mavenä¸æœ¬åœ°ä»“åº“

ï¼ˆ1ï¼‰å°†Mavenå‹ç¼©åŒ…ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰

ï¼ˆ2ï¼‰è§£å‹

```
tar zxvf apache-maven-3.5.4-bin.tar.gz
```

ï¼ˆ3ï¼‰ç§»åŠ¨ç›®å½•

```
mv apache-maven-3.5.4 /usr/local/maven
```

ï¼ˆ4ï¼‰ç¼–è¾‘setting.xmlé…ç½®æ–‡ä»¶`vi /usr/local/maven/conf/settings.xml `ï¼Œé…ç½®æœ¬åœ°ä»“åº“ç›®å½•,å†…å®¹å¦‚ä¸‹

```
<localRepository>/usr/local/repository</localRepository>
```

ï¼ˆ5ï¼‰å°†å¼€å‘ç¯å¢ƒçš„æœ¬åœ°ä»“åº“ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰å¹¶ç§»åŠ¨åˆ°/usr/local/repository   ã€‚

```
mv reponsitory_boot /usr/local/repository
```

æ‰§è¡Œæ­¤æ­¥æ˜¯ä¸ºäº†ä»¥ååœ¨æ‰“åŒ…çš„æ—¶å€™ä¸å¿…é‡æ–°ä¸‹è½½ï¼Œç¼©çŸ­æ‰“åŒ…çš„æ—¶é—´ã€‚

### 2.5.2 å…¨å±€å·¥å…·é…ç½®

é€‰æ‹©ç³»ç»Ÿç®¡ç†ï¼Œå…¨å±€å·¥å…·é…ç½®

ï¼ˆ1ï¼‰JDKé…ç½®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614778.png)

è®¾ç½®javahomeä¸º /usr/java/jdk1.8.0_171-amd64

ï¼ˆ2ï¼‰Gité…ç½®   ï¼ˆæœ¬åœ°å·²ç»å®‰è£…äº†Gitè½¯ä»¶ï¼‰

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614681.png)

ï¼ˆ3ï¼‰Mavené…ç½®



![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111614746.png)



## 2.6 ä»£ç ä¸Šä¼ è‡³GitæœåŠ¡å™¨

### 2.6.1 Gogsæ­å»ºä¸é…ç½® 

Gogs æ˜¯ä¸€æ¬¾ææ˜“æ­å»ºçš„è‡ªåŠ© Git æœåŠ¡ã€‚

Gogs çš„ç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ªæœ€ç®€å•ã€æœ€å¿«é€Ÿå’Œæœ€è½»æ¾çš„æ–¹å¼æ­å»ºè‡ªåŠ© Git æœåŠ¡ã€‚ä½¿ç”¨ Go è¯­è¨€å¼€å‘ä½¿å¾— Gogs èƒ½å¤Ÿé€šè¿‡ç‹¬ç«‹çš„äºŒè¿›åˆ¶åˆ†å‘ï¼Œå¹¶ä¸”æ”¯æŒ Go è¯­è¨€æ”¯æŒçš„Â **æ‰€æœ‰å¹³å°**ï¼ŒåŒ…æ‹¬ Linuxã€Mac OS Xã€Windows ä»¥åŠ ARM å¹³å°ã€‚

åœ°å€ï¼šhttps://gitee.com/Unknown/gogs

ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ

```
docker pull gogs/gogs
```

ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨

```
docker run -di --name=gogs -p 10022:22 -p 3000:3000 -v /var/gogsdata:/data gogs/gogs
```

ï¼ˆ3ï¼‰å‡è®¾æˆ‘çš„centosè™šæ‹ŸæœºIPä¸º192.168.184.141   åœ¨åœ°å€æ è¾“å…¥http://192.168.184.141:3000  ä¼šè¿›å…¥é¦–æ¬¡è¿è¡Œå®‰è£…ç¨‹åºé¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ç§æ•°æ®åº“ä½œä¸ºgogsæ•°æ®çš„å­˜å‚¨ï¼Œæœ€ç®€å•çš„æ˜¯é€‰æ‹©SQLite3ã€‚å¦‚æœå¯¹äºè§„æ¨¡è¾ƒå¤§çš„å…¬å¸ï¼Œå¯ä»¥é€‰æ‹©MySQLÂ Â 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615931.png)

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615136.png)Â 

ç‚¹å‡»â€œç«‹å³å®‰è£…â€

è¿™é‡Œçš„åŸŸåè¦è®¾ç½®ä¸ºcentosçš„IPåœ°å€,å®‰è£…åæ˜¾ç¤ºä¸»ç•Œé¢

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615423.png)

ï¼ˆ4ï¼‰æ³¨å†Œ

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615416.png)

ï¼ˆ5ï¼‰ç™»å½•

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615863.png)

ï¼ˆ6ï¼‰åˆ›å»ºä»“åº“Â ![åˆ›å»ºä»“åº“](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615002.png)

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111615866.png)



### 2.6.2 æäº¤ä»£ç 

æ­¥éª¤ï¼š

ï¼ˆ1ï¼‰åœ¨æœ¬åœ°å®‰è£…git(Windowsç‰ˆæœ¬)

ï¼ˆ2ï¼‰åœ¨IDEAä¸­é€‰æ‹©èœå• :  File -- settings ,  åœ¨çª—å£ä¸­é€‰æ‹©Version Control --  Git

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111616402.png)

ï¼ˆ3ï¼‰é€‰æ‹©èœå•VCS  --> Enable Version Control Integration... 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111616002.png)

é€‰æ‹©Git

ï¼ˆ4ï¼‰è®¾ç½®è¿œç¨‹åœ°å€:  å³é”®ç‚¹å‡»å·¥ç¨‹é€‰æ‹©èœå•    Git --> Repository   -->Remotes...

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111616250.png)

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111616856.png)

ï¼ˆ5ï¼‰å³é”®ç‚¹å‡»å·¥ç¨‹é€‰æ‹©èœå•    Git --> Add

ï¼ˆ6ï¼‰å³é”®ç‚¹å‡»å·¥ç¨‹é€‰æ‹©èœå•    Git --> Commit Directory...

ï¼ˆ7ï¼‰å³é”®ç‚¹å‡»å·¥ç¨‹é€‰æ‹©èœå•    Git --> Repository   --> Push ...



## 2.7 ä»»åŠ¡çš„åˆ›å»ºä¸æ‰§è¡Œ 

ï¼ˆ1ï¼‰å›åˆ°é¦–é¡µï¼Œç‚¹å‡»æ–°å»ºæŒ‰é’® .å¦‚ä¸‹å›¾ï¼Œè¾“å…¥åç§°ï¼Œé€‰æ‹©åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œç‚¹å‡»OK

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619339.png)

ï¼ˆ2ï¼‰æºç ç®¡ç†ï¼Œé€‰æ‹©Git

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619397.png)

ï¼ˆ3ï¼‰Build

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619438.png)

å‘½ä»¤:

```
clean package docker:build -Dpush./assets
```

ç”¨äºæ¸…é™¤ã€æ‰“åŒ…ï¼Œæ„å»ºdockeré•œåƒ

æœ€åç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®

ï¼ˆ4ï¼‰æ‰§è¡Œä»»åŠ¡



# 3 å®¹å™¨ç®¡ç†å·¥å…·Rancher 

## 3.1 ä»€ä¹ˆæ˜¯Rancher 

â€‹     Rancheræ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§å…¨æ ˆåŒ–å®¹å™¨éƒ¨ç½²åŠç®¡ç†å¹³å°ã€‚Rancherä¸ºå®¹å™¨æä¾›ä¸€æ½å­åŸºç¡€æ¶æ„æœåŠ¡ï¼šCNIå…¼å®¹çš„ç½‘ç»œæœåŠ¡ã€å­˜å‚¨æœåŠ¡ã€ä¸»æœºç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€é˜²æŠ¤å¢™â€¦â€¦Rancherè®©ä¸Šè¿°æœåŠ¡è·¨è¶Šå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€è™šæ‹Ÿæœºã€ç‰©ç†æœºç¯å¢ƒè¿è¡Œï¼ŒçœŸæ­£å®ç°ä¸€é”®å¼åº”ç”¨éƒ¨ç½²å’Œç®¡ç†ã€‚

â€‹      https://www.cnrancher.com/

## 3.2 Rancherå®‰è£… 

ï¼ˆ1ï¼‰ä¸‹è½½Rancher é•œåƒ

```
docker pull rancher/server
```

ï¼ˆ2ï¼‰åˆ›å»ºRancherå®¹å™¨

```
docker run -di --name=rancher -p 9090:8080 rancher/server
```



ï¼ˆ3ï¼‰åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š http://192.168.184.136:9090  å³å¯çœ‹åˆ°é«˜ç«¯å¤§æ°”çš„æ¬¢è¿é¡µ

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619480.png)

ç‚¹å‡»Got It  è¿›å…¥ä¸»ç•Œé¢

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619518.png)

ï¼ˆ4ï¼‰åˆ‡æ¢è‡³ä¸­æ–‡ç•Œé¢

ç‚¹å‡»å³ä¸‹è§’çš„English åœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©ä¸­æ–‡

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619570.png)

åˆ‡æ¢åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°äº²åˆ‡çš„ä¸­æ–‡ç•Œé¢å•¦~  

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619608.png)



## 3.3 Rancheråˆå§‹åŒ–

### 3.3.1  æ·»åŠ ç¯å¢ƒ 

Rancher æ”¯æŒå°†èµ„æºåˆ†ç»„å½’å±åˆ°å¤šä¸ª**ç¯å¢ƒ**ã€‚ æ¯ä¸ªç¯å¢ƒå…·æœ‰è‡ªå·±ç‹¬ç«‹çš„åŸºç¡€æ¶æ„èµ„æºåŠæœåŠ¡ï¼Œå¹¶ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·ã€å›¢é˜Ÿæˆ–ç»„ç»‡æ‰€ç®¡ç†ã€‚

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºç‹¬ç«‹çš„â€œå¼€å‘â€ã€â€œæµ‹è¯•â€åŠâ€œç”Ÿäº§â€ç¯å¢ƒä»¥ç¡®ä¿ç¯å¢ƒä¹‹é—´çš„å®‰å…¨éš”ç¦»ï¼Œå°†â€œå¼€å‘â€ç¯å¢ƒçš„è®¿é—®æƒé™èµ‹äºˆå…¨éƒ¨äººå‘˜ï¼Œä½†é™åˆ¶â€œç”Ÿäº§â€ç¯å¢ƒçš„è®¿é—®æƒé™ç»™ä¸€ä¸ªå°çš„å›¢é˜Ÿã€‚

ï¼ˆ1ï¼‰é€‰æ‹©â€œDefault -->ç¯å¢ƒç®¡ç†â€ èœå•

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619639.png)

ï¼ˆ2ï¼‰å¡«å†™åç§°ï¼Œç‚¹å‡»â€œåˆ›å»ºâ€æŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619678.png)

ï¼ˆ3ï¼‰æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼Œæ·»åŠ åæ¬¡æ–¹æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619710.png)

ï¼ˆ4ï¼‰ä½ å¯ä»¥é€šè¿‡ç‚¹å‡»logoå³ä¾§çš„èœå•åœ¨å„ç§ç¯å¢ƒä¸‹åˆ‡æ¢

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619749.png)



### 3.3.2 æ·»åŠ ä¸»æœº  

ï¼ˆ1ï¼‰é€‰æ‹©åŸºç¡€æ¶æ„-->ä¸»æœº èœå•ï¼Œç‚¹å‡»æ·»åŠ ä¸»æœº

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619788.png)

ï¼ˆ2ï¼‰æ‹·è´è„šæœ¬

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619821.png)

ï¼ˆ3ï¼‰åœ¨æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰ä¸Šè¿è¡Œè„šæœ¬

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619855.png)

ï¼ˆ4ï¼‰ç‚¹å‡»å…³é—­æŒ‰é’®åï¼Œä¼šçœ‹åˆ°ç•Œé¢ä¸­æ˜¾ç¤ºæ­¤ä¸»æœºã€‚æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç†ä¸»æœºçš„æ¯ä¸ªå®¹å™¨çš„å¼€å¯å’Œå…³é—­

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619890.png)

### 3.3.3 æ·»åŠ åº”ç”¨ 

ç‚¹å‡»åº”ç”¨-->å…¨éƒ¨(æˆ–ç”¨æˆ·)  ï¼Œç‚¹å‡»â€œæ·»åŠ åº”ç”¨â€æŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619929.png)

å¡«å†™åç§°å’Œæè¿°

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619962.png)

ç‚¹å‡»â€œåˆ›å»ºâ€æŒ‰é’®ï¼Œåˆ—è¡¨ä¸­å¢åŠ äº†æ–°å¢çš„åº”ç”¨

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619998.png)



## 3.4 åº”ç”¨éƒ¨ç½²  

### 3.4.1 MySQLéƒ¨ç½² 

é•œåƒï¼šcentos/mysql-57-centos7   å¢åŠ æ•°æ®åº“æœåŠ¡

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619033.png)

æ³¨æ„ï¼šæ·»åŠ ç¯å¢ƒå˜é‡  MYSQL_ROOT_PASSWORD=123456 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619066.png)

ç‚¹å‡»åˆ›å»ºæŒ‰é’®ï¼Œå®Œæˆåˆ›å»º    ä¸Šè¿°æ“ä½œç›¸å½“äºä»¥ä¸‹dockerå‘½ä»¤

```
docker run -di --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 centos/mysql-57-centos7
```

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619100.png)

å®ŒæˆåæœåŠ¡åˆ—è¡¨ä¸­å­˜åœ¨å¹¶ä¸”çŠ¶æ€ä¸ºæ¿€æ´»    ä½¿ç”¨SQLyogæµ‹è¯•é“¾æ¥ï¼Œæ‰§è¡Œå»ºè¡¨è¯­å¥

### 3.4.2 RabbitMQéƒ¨ç½² 

é•œåƒï¼šrabbitmq:management     ç«¯å£æ˜ å°„5671   5672  4369    15671  15672  25672

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619131.png)

æµè§ˆå™¨è®¿é—®   http://192.168.184.136:15672/

### 3.4.3 Rediséƒ¨ç½² 

è¿›å…¥åº”ç”¨ï¼Œç‚¹å‡»æ·»åŠ æœåŠ¡ï¼Œåç§°redis ï¼Œé•œåƒredis ï¼Œç«¯å£æ˜ å°„6379 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619168.png)

åˆ›å»ºåä½¿ç”¨å®¢æˆ·ç«¯æµ‹è¯•é“¾æ¥

```
redis-cli -h 192.168.184.144
```

æµ‹è¯•æˆåŠŸ

### 3.4.4 å¾®æœåŠ¡éƒ¨ç½²

ï¼ˆ1ï¼‰æ­å»ºç§æœ‰ä»“åº“

å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨

```
docker run -di --name=registry -p 5000:5000 registry
```

æ‰“å¼€æµè§ˆå™¨ è¾“å…¥åœ°å€http://192.168.184.144:5000/v2/_catalogçœ‹åˆ°`{"repositories":[]}` è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸå¹¶ä¸”å†…å®¹ä¸ºç©º

ä¿®æ”¹daemon.json

```
vi /etc/docker/daemon.json
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜é€€å‡ºã€‚

```json
{"insecure-registries":["192.168.184.144:5000"]} 
```

ï¼ˆ2ï¼‰ä¿®æ”¹dockeré…ç½®ï¼Œå…è®¸è¿œç¨‹è®¿é—®

```
vi /lib/systemd/system/docker.service
```

å…¶ä¸­ExecStart=åæ·»åŠ é…ç½®`-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock`

 ä¿®æ”¹ååˆ·æ–°é…ç½®ï¼Œå†²æ´—æœåŠ¡

```
systemctl daemon-reload
systemctl restart docker
docker start registry
```

ï¼ˆ3ï¼‰ä¿®æ”¹å¾®æœåŠ¡å·¥ç¨‹ï¼Œæ·»åŠ DockerMavenæ’ä»¶

ï¼ˆ4ï¼‰è¿æ¥mysqlæ•°æ®åº“ï¼Œæ‰§è¡Œå»ºåº“è„šæœ¬

ï¼ˆ5ï¼‰æ·»åŠ æœåŠ¡base-service   é•œåƒ192.168.184.144:5000/tensquare_base:1.0-SNAPSHOT    ç«¯å£æ˜ å°„9001

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619209.png)

ï¼ˆ6ï¼‰æµ‹è¯•å¾®æœåŠ¡  æµè§ˆå™¨æ‰“å¼€ç½‘å€  http://192.168.184.144:9001/label   çœ‹æ˜¯å¦å¯ä»¥çœ‹åˆ°æ ‡ç­¾åˆ—è¡¨

## 3.6 æ‰©å®¹ä¸ç¼©å®¹ 

### 3.6.1 æ‰©å®¹ 

ï¼ˆ1ï¼‰åœ¨Rancherå°†åˆ›å»ºçš„base-serviceï¼ˆåŸºç¡€ä¿¡æ¯å¾®æœåŠ¡ï¼‰åˆ é™¤

ï¼ˆ2ï¼‰é‡æ–°åˆ›å»ºbase-service ï¼Œä¸è®¾ç½®ç«¯å£æ˜ å°„

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619245.png)

ï¼ˆ3ï¼‰åœ¨é€‰æ‹©èœå•API  -->WebHooks  ï¼Œç‚¹å‡»â€œæ·»åŠ æ¥æ”¶å™¨â€æŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619283.png)

ï¼ˆ4ï¼‰å¡«å†™åç§°ç­‰ä¿¡æ¯ï¼Œé€‰æ‹©è¦æ‰©å®¹çš„æœåŠ¡ï¼Œç‚¹å‡»åˆ›å»ºæŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619324.png)

ï¼ˆ5ï¼‰æ¥æ”¶å™¨åˆ—è¡¨ä¸­æ–°å¢äº†ä¸€æ¡è®°å½•  ï¼Œç‚¹å‡»è§¦å‘åœ°å€å°†åœ°å€å¤åˆ¶åˆ°å‰ªåˆ‡æ¿

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619360.png)

ï¼ˆ6ï¼‰ä½¿ç”¨postmanæµ‹è¯•ï¼š

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619400.png)

æµ‹è¯•åï¼Œå‘ç°å®¹å™¨ç”±åŸæ¥çš„1ä¸ªå˜ä¸ºäº†3ä¸ª

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619453.png)

### 3.6.2 ç¼©å®¹ 

åˆšæ‰æˆ‘ä»¬å®ç°äº†æ‰©å®¹ï¼Œé‚£ä¹ˆå¦‚ä½•å‡å°‘å®¹å™¨æ•°é‡å‘¢ï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•å¦‚ä½•ç¼©å®¹

ï¼ˆ1ï¼‰æ·»åŠ æ¥æ”¶å™¨  ,é€‰æ‹©ç¼©å®¹ï¼Œæ­¥é•¿ä¸º1è¡¨ç¤ºæ¯æ¬¡é€’å‡1ä¸ª ï¼Œç‚¹å‡»åˆ›å»ºæŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619486.png)

ï¼ˆ2ï¼‰åˆ›å»ºæˆåŠŸåï¼Œå¤åˆ¶è§¦å‘åœ°å€

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619528.png)

ï¼ˆ3ï¼‰ä½¿ç”¨postmanæµ‹è¯•

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619563.png)



# 4 influxDB 

## 4.1 ä»€ä¹ˆæ˜¯influxDB 

â€‹	influxDBæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚cAdvisorä»…ä»…æ˜¾ç¤ºå®æ—¶ä¿¡æ¯ï¼Œä½†æ˜¯ä¸å­˜å‚¨ç›‘è§†æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æä¾›æ—¶åºæ•°æ®åº“ç”¨äºå­˜å‚¨cAdvisorç»„ä»¶æ‰€æä¾›çš„ç›‘æ§ä¿¡æ¯ï¼Œä»¥ä¾¿æ˜¾ç¤ºé™¤å®æ—¶ä¿¡æ¯ä¹‹å¤–çš„æ—¶åºæ•°æ®ã€‚

## 4.2 influxDBå®‰è£… 

ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ

```
docker pull tutum/influxdb
```

ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨

```
docker run -di \
   -p 8083:8083 \
   -p 8086:8086 \
   --expose 8090 \
   --expose 8099 \
   --name influxsrv \
   tutum/influxdb
```

ç«¯å£æ¦‚è¿°ï¼š  8083ç«¯å£:webè®¿é—®ç«¯å£     8086:æ•°æ®å†™å…¥ç«¯å£

æ‰“å¼€æµè§ˆå™¨   [http://192.168.184.144:8083/](http://192.168.184.144:8083)

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619604.png)

## 4.3 influxDBå¸¸ç”¨æ“ä½œ

### 4.3.1 åˆ›å»ºæ•°æ®åº“

```
CREATE DATABASE "cadvisor"
```

å›è½¦åˆ›å»ºæ•°æ®åº“

```
SHOW DATABASES
```

æŸ¥çœ‹æ•°æ®åº“

### 4.3.2 åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ

åˆ›å»ºç”¨æˆ·

```
CREATE USER "cadvisor" WITH PASSWORD 'cadvisor' WITH ALL PRIVILEGES
```

æŸ¥çœ‹ç”¨æˆ·

```
SHOW USRES
```

ç”¨æˆ·æˆæƒ

```
grant all privileges on cadvisor to cadvisor
grant WRITE on cadvisor to cadvisor
grant READ on cadvisor to cadvisor
```

### 4.3.3 æŸ¥çœ‹é‡‡é›†çš„æ•°æ®

åˆ‡æ¢åˆ°cadvisoræ•°æ®åº“ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é‡‡é›†çš„æ•°æ®

```
SHOW MEASUREMENTS
```

ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰æ•°æ®ï¼Œå¦‚æœæƒ³é‡‡é›†ç³»ç»Ÿçš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨**Cadvisor**è½¯ä»¶æ¥å®ç°

# 5 cAdvisor

## 5.1 ä»€ä¹ˆæ˜¯cAdvisor

â€‹	Googleå¼€æºçš„ç”¨äºç›‘æ§åŸºç¡€è®¾æ–½åº”ç”¨çš„å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç›‘æ§å·¥å…·ï¼Œä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥é€šè¿‡è¿è¡Œåœ¨Dockerä¸»æœºä¸Šçš„å®¹å™¨æ¥ç›‘æ§Dockerå®¹å™¨ï¼Œè€Œä¸”å¯ä»¥ç›‘æ§Dockerä¸»æœºã€‚æ›´å¤šè¯¦ç»†æ“ä½œå’Œé…ç½®é€‰é¡¹å¯ä»¥æŸ¥çœ‹Githubä¸Šçš„cAdvisoré¡¹ç›®æ–‡æ¡£ã€‚

## 5.2 cAdvisorå®‰è£…

ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ

```
docker pull google/cadvisor
```

ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨

```
docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --detach=true --link influxsrv:influxsrv --name=cadvisor google/cadvisor -storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxsrv:8086
```

WEBå‰ç«¯è®¿é—®åœ°å€

http://192.168.184.144:8080/containers/

æ€§èƒ½æŒ‡æ ‡å«ä¹‰å‚ç…§å¦‚ä¸‹åœ°å€

[https://blog.csdn.net/ZHANG_H_A/article/details/53097084](https://blog.csdn.net/ZHANG_H_A/article/details/53097084)

å†æ¬¡æŸ¥çœ‹influxDBï¼Œå‘ç°å·²ç»æœ‰å¾ˆå¤šæ•°æ®è¢«é‡‡é›†è¿›å»äº†ã€‚

# 6 Grafana

## 6.1 ä»€ä¹ˆæ˜¯Grafana

â€‹	Grafanaæ˜¯ä¸€ä¸ªå¯è§†åŒ–é¢æ¿ï¼ˆDashboardï¼‰ï¼Œæœ‰ç€éå¸¸æ¼‚äº®çš„å›¾è¡¨å’Œå¸ƒå±€å±•ç¤ºï¼ŒåŠŸèƒ½é½å…¨çš„åº¦é‡ä»ªè¡¨ç›˜å’Œå›¾å½¢ç¼–è¾‘å™¨ã€‚æ”¯æŒGraphiteã€zabbixã€InfluxDBã€Prometheuså’ŒOpenTSDBä½œä¸ºæ•°æ®æºã€‚
Grafanaä¸»è¦ç‰¹æ€§ï¼šçµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹ï¼›å¯ä»¥æ··åˆå¤šç§é£æ ¼ï¼›æ”¯æŒç™½å¤©å’Œå¤œé—´æ¨¡å¼ï¼›å¤šä¸ªæ•°æ®æºã€‚

## 6.2 Grafanaå®‰è£…

ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ

```
docker pull grafana/grafana
```

ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨

```
docker run -d -p 3001:3000  -e INFLUXDB_HOST=influxsrv -e INFLUXDB_PORT=8086 -e INFLUXDB_NAME=cadvisor -e INFLUXDB_USER=cadvisor -e INFLUXDB_PASS=cadvisor --link influxsrv:influxsrv --name grafana grafana/grafana
```

ï¼ˆ3ï¼‰è®¿é—®

```
http://192.168.184.144:3001
```

ç”¨æˆ·åå¯†ç å‡ä¸ºadmin

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619631.png)

ï¼ˆ4ï¼‰ç™»å½•åæç¤ºä½ ä¿®æ”¹å¯†ç 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619682.png)

ï¼ˆ5ï¼‰ä¹‹åè¿›å…¥ä¸»é¡µé¢

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619728.png)

## 6.3 Grafanaçš„ä½¿ç”¨

### 6.3.1 æ·»åŠ æ•°æ®æº

ï¼ˆ1ï¼‰ç‚¹å‡»è®¾ç½®ï¼ŒDataSource 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619776.png)

ï¼ˆ2ï¼‰ç‚¹å‡»æ·»åŠ data source

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619826.png)

ï¼ˆ3ï¼‰ä¸ºæ•°æ®æºèµ·ä¸ªåç§°ï¼ŒæŒ‡å®šç±»å‹ã€åœ°å€ã€ä»¥åŠè¿æ¥çš„æ•°æ®åº“åã€ç”¨æˆ·åå’Œå¯†ç 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619873.png)

ç‚¹å‡»ä¿å­˜ã€‚æ•°æ®æºå»ºç«‹æˆåŠŸ

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619928.png)



### 6.3.2 æ·»åŠ ä»ªè¡¨ç›˜

ï¼ˆ1ï¼‰é€‰æ‹©Dashboards --Manager  

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619982.png)

ï¼ˆ2ï¼‰ç‚¹å‡»â€œæ·»åŠ â€æŒ‰é’®

ï¼ˆ3ï¼‰ç‚¹å‡»Graph  å›¾æ ‡

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619027.png)

ï¼ˆ4ï¼‰å‡ºç°ä¸‹é¢å›¾è¡¨çš„ç•Œé¢ ï¼Œç‚¹å‡»Panel Title  é€‰æ‹©Edit (ç¼–è¾‘)

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619063.png)

ï¼ˆ5ï¼‰å®šä¹‰æ ‡é¢˜ç­‰åŸºç¡€ä¿¡æ¯

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619109.png)

ï¼ˆ6ï¼‰è®¾ç½®æŸ¥è¯¢çš„ä¿¡æ¯ä¸ºå†…å­˜ï¼ŒæŒ‡å®šå®¹å™¨åç§°

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619166.png)

ï¼ˆ7ï¼‰æŒ‡å®šyè½´çš„å•ä½ ä¸ºM

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619200.png)

ï¼ˆ8ï¼‰ä¿å­˜

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619241.png)

å¡«å†™åç§°

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619282.png)

### 6.4.3 é¢„è­¦é€šçŸ¥è®¾ç½®

ï¼ˆ1ï¼‰é€‰æ‹©èœå•  alerting--> Notification channels

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619325.png)

ï¼ˆ2ï¼‰ç‚¹å‡»Add channel æŒ‰é’®

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619370.png)

ï¼ˆ3ï¼‰å¡«å†™åç§°ï¼Œé€‰æ‹©ç±»å‹ä¸ºwebhook  ,å¡«å†™é’©å­åœ°å€

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619415.png)

è¿™ä¸ªé’©å­åœ°å€æ˜¯ä¹‹å‰å¯¹baseå¾®æœåŠ¡æ‰©å®¹çš„åœ°å€

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619463.png)

ï¼ˆ4ï¼‰ç‚¹å‡»SendTest  æµ‹è¯•  è§‚å¯ŸåŸºç¡€å¾®æœåŠ¡æ˜¯å¦å¢åŠ å®¹å™¨

ï¼ˆ5ï¼‰ç‚¹å‡»saveä¿å­˜

ï¼ˆ6ï¼‰æŒ‰ç…§åŒæ ·çš„æ–¹æ³•æ·»åŠ ç¼©å®¹åœ°å€

### 6.4.4 ä»ªè¡¨ç›˜é¢„è­¦è®¾ç½® 

ï¼ˆ1ï¼‰å†æ¬¡æ‰“å¼€åˆšåˆšç¼–è¾‘çš„ä»ªè¡¨ç›˜

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619510.png)

ï¼ˆ2ï¼‰ç‚¹å‡» Create Alert 

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619542.png)

è®¾ç½®é¢„è­¦çº¿

ï¼ˆ3ï¼‰é€‰æ‹©é€šçŸ¥

![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619590.png)



![](https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202410111619632.png)

ä¿å­˜æ›´æ”¹
