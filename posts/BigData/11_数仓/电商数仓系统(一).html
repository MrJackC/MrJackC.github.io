<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mrjackc.github.io/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%B8%80).html"><meta property="og:site_name" content="mrjasonâ€™s Blog"><meta property="og:title" content="ç”µå•†æ•°ä»“ç³»ç»Ÿ"><meta property="og:description" content="ç”µå•†æ•°ä»“ç³»ç»Ÿ ä¸€ã€æ•°ä»“åˆ†å±‚ 1.1 æ•°ä»“ç®€ä»‹ 1.2 æ•°æ®é›†å¸‚ ![image-20200704202534114](https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704202541.png) 1.3 æ•°ä»“å‘½åè§„èŒƒ å‘½åè§„èŒƒå®ç°è§åçŸ¥æ„ 1.3.1 è¡¨å‘½å 1.3.2 è„šæœ¬å‘½å 1.3..."><meta property="og:type" content="article"><meta property="og:image" content="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704202541.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-28T01:58:08.000Z"><meta property="article:author" content="MrJason"><meta property="article:modified_time" content="2024-10-28T01:58:08.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ç”µå•†æ•°ä»“ç³»ç»Ÿ","image":["https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704202541.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704210258.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704212135.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704215543.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704220209.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704220318.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705003729.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705000547.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705001804.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705001104.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705014315.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705014404.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705100448.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705221707.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200705221841.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200706001851.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200706002328.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200706005338.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200706025314.png","https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200706025419.png"],"dateModified":"2024-10-28T01:58:08.000Z","author":[{"@type":"Person","name":"MrJason","url":"https://mrjackc.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://mrjackc.github.io/rss.xml" title="mrjasonâ€™s Blog RSS Feed"><title>ç”µå•†æ•°ä»“ç³»ç»Ÿ | mrjasonâ€™s Blog</title><meta name="description" content="ç”µå•†æ•°ä»“ç³»ç»Ÿ ä¸€ã€æ•°ä»“åˆ†å±‚ 1.1 æ•°ä»“ç®€ä»‹ 1.2 æ•°æ®é›†å¸‚ ![image-20200704202534114](https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic GO/20200704202541.png) 1.3 æ•°ä»“å‘½åè§„èŒƒ å‘½åè§„èŒƒå®ç°è§åçŸ¥æ„ 1.3.1 è¡¨å‘½å 1.3.2 è„šæœ¬å‘½å 1.3...">
    <link rel="preload" href="/assets/style-D5zIXRKB.css" as="style"><link rel="stylesheet" href="/assets/style-D5zIXRKB.css">
    <link rel="modulepreload" href="/assets/app-BOcQBfH9.js"><link rel="modulepreload" href="/assets/ç”µå•†æ•°ä»“ç³»ç»Ÿ(ä¸€).html-BxdN7MgR.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">mrjasonâ€™s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="å¯¼èˆª"><!--[--><span class="font-icon icon iconfont icon-discover" style=""></span><!--]-->å¯¼èˆª<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç¬”è®°åˆ†ç±»"><!--[--><span class="font-icon icon iconfont icon-edit" style=""></span>ç¬”è®°åˆ†ç±»<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">ä»£ç ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Computer-Basics/" aria-label="è®¡ç®—æœºåŸºç¡€"><!--[--><span class="font-icon icon iconfont icon-windows" style=""></span><!--]-->è®¡ç®—æœºåŸºç¡€<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Data-Structure/" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><!--[--><span class="font-icon icon iconfont icon-calculate" style=""></span><!--]-->æ•°æ®ç»“æ„ä¸ç®—æ³•<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Web/" aria-label="å‰ç«¯ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->å‰ç«¯ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Python/" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->Python<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Database/" aria-label="æ•°æ®åº“"><!--[--><span class="font-icon icon iconfont icon-table" style=""></span><!--]-->æ•°æ®åº“<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Docker/" aria-label="Docker"><!--[--><span class="font-icon icon iconfont icon-expansion" style=""></span><!--]-->Docker<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Git/" aria-label="Git"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->Git<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Redis/" aria-label="Redis"><!--[--><span class="font-icon icon iconfont icon-lock" style=""></span><!--]-->Redis<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/MiddleWare/" aria-label="ä¸­é—´ä»¶"><!--[--><span class="font-icon icon iconfont icon-process" style=""></span><!--]-->ä¸­é—´ä»¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/posts/BigData/" aria-label="å¤§æ•°æ®"><!--[--><span class="font-icon icon iconfont icon-hot" style=""></span><!--]-->å¤§æ•°æ®<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Architect/" aria-label="æ¶æ„å¸ˆ"><!--[--><span class="font-icon icon iconfont icon-study" style=""></span><!--]-->æ¶æ„å¸ˆ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Daily-Thoughts/" aria-label="æ—¥å¸¸æ€è€ƒ"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->æ—¥å¸¸æ€è€ƒ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Development-Tools/" aria-label="å¼€å‘å·¥å…·"><!--[--><span class="font-icon icon iconfont icon-tool" style=""></span><!--]-->å¼€å‘å·¥å…·<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">åšå®¢ç›¸å…³</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/" aria-label="åšå®¢ç›¸å…³"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span><!--]-->åšå®¢ç›¸å…³<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/posts/Java/" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/collect.html" aria-label="æ”¶è—"><!--[--><span class="font-icon icon iconfont icon-hk-shoucang1" style=""></span><!--]-->æ”¶è—<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/news/" aria-label="è¯´è¯´"><!--[--><span class="font-icon icon iconfont icon-news" style=""></span><!--]-->è¯´è¯´<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="ç•™è¨€æ¿"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->ç•™è¨€æ¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->å‹é“¾<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å…³äº"><!--[--><span class="font-icon icon iconfont icon-info" style=""></span>å…³äº<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/intro.html" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-people" style=""></span><!--]-->å…³äºæˆ‘<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="å…³äºæœ¬ç«™"><!--[--><span class="font-icon icon iconfont icon-info" style=""></span><!--]-->å…³äºæœ¬ç«™<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/MrjackC/mrjackc.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="å¼€å¾€" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/BigData/" aria-label="01 å¤§æ•°æ®ç”Ÿæ€åœˆ"><!---->01 å¤§æ•°æ®ç”Ÿæ€åœˆ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 Hiveæ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">04 Flumeæ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">04 æ¥å…¥å±‚</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 Zookeeperæ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 æ•°æ®å¤„ç†å±‚</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">06 Kafkaæ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">07 Scalaæ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">08 Spark</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">10 Hbase</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">11 æ•°ä»“</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/Hive%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0.html" aria-label="Hiveè‡ªå®šä¹‰å‡½æ•°"><!---->Hiveè‡ªå®šä¹‰å‡½æ•°<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E9%A1%B9%E7%9B%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85.html" aria-label="æ•°ä»“é¡¹ç›®è¡¥å……"><!---->æ•°ä»“é¡¹ç›®è¡¥å……<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%B8%80).html" aria-label="ç”µå•†æ•°ä»“ç³»ç»Ÿ"><!---->ç”µå•†æ•°ä»“ç³»ç»Ÿ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%BA%8C).html" aria-label="ç”µå•†æ•°ä»“ç³»ç»Ÿ(äºŒ)"><!---->ç”µå•†æ•°ä»“ç³»ç»Ÿ(äºŒ)<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ç”µå•†æ•°ä»“ç³»ç»Ÿ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mrjackc.github.io" target="_blank" rel="noopener noreferrer">MrJason</a></span><span property="author" content="MrJason"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-28T01:58:08.000Z"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%B8%80).html" data-page-key="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%B8%80).html">...</span></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 86 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT86M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€æ•°ä»“åˆ†å±‚">ä¸€ã€æ•°ä»“åˆ†å±‚</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-æ•°ä»“ç®€ä»‹">1.1 æ•°ä»“ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-æ•°æ®é›†å¸‚">1.2 æ•°æ®é›†å¸‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-æ•°ä»“å‘½åè§„èŒƒ">1.3 æ•°ä»“å‘½åè§„èŒƒ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€æ•°ä»“ç†è®º">äºŒã€æ•°ä»“ç†è®º</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-å…³ç³»å»ºæ¨¡">2.1 å…³ç³»å»ºæ¨¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-èŒƒå¼ç†è®º">2.2 èŒƒå¼ç†è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-å…³ç³»å»ºæ¨¡ä¸ç»´åº¦å»ºæ¨¡">2.3 å…³ç³»å»ºæ¨¡ä¸ç»´åº¦å»ºæ¨¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-ç»´åº¦å»ºæ¨¡">2.4 ç»´åº¦å»ºæ¨¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-5-äº‹å®è¡¨å’Œç»´åº¦è¡¨-é‡ç‚¹">2.5 äº‹å®è¡¨å’Œç»´åº¦è¡¨ï¼ˆé‡ç‚¹ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-6-æ•°æ®ä»“åº“å»ºæ¨¡-ç»å¯¹çš„é‡ç‚¹">2.6 æ•°æ®ä»“åº“å»ºæ¨¡ï¼ˆç»å¯¹çš„é‡ç‚¹ï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€æ•°ä»“æ­å»º-odså±‚">ä¸‰ã€æ•°ä»“æ­å»º ---ODSå±‚</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-hiveç¯å¢ƒå‡†å¤‡">3.1 Hiveç¯å¢ƒå‡†å¤‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-odså±‚-ç”¨æˆ·è¡Œä¸ºæ•°æ®">3.2 ODSå±‚(ç”¨æˆ·è¡Œä¸ºæ•°æ®)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-odså±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥">3.3 ODSå±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€dwdå±‚-é‡ç‚¹">å››ã€DWDå±‚(é‡ç‚¹)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-dwdå±‚æ•°æ®è¯´æ˜">4.1 DWDå±‚æ•°æ®è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-dwdç”¨æˆ·è¡Œä¸ºæ—¥å¿—è§£æ">4.2 DWDç”¨æˆ·è¡Œä¸ºæ—¥å¿—è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-dwdä¸šåŠ¡æ•°æ®">4.3 DWDä¸šåŠ¡æ•°æ®</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="ç”µå•†æ•°ä»“ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#ç”µå•†æ•°ä»“ç³»ç»Ÿ"><span>ç”µå•†æ•°ä»“ç³»ç»Ÿ</span></a></h1><hr><h2 id="ä¸€ã€æ•°ä»“åˆ†å±‚" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ•°ä»“åˆ†å±‚"><span>ä¸€ã€æ•°ä»“åˆ†å±‚</span></a></h2><h3 id="_1-1-æ•°ä»“ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-1-æ•°ä»“ç®€ä»‹"><span>1.1 æ•°ä»“ç®€ä»‹</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--1. æ•°æ®ä»“åº“å’Œæ•°æ®åº“çš„åŒºåˆ«</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®ä»“åº“ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            aã€æ•°æ®é‡ç‰¹åˆ«çš„å¤§ï¼ŒTB-PBçº§åˆ«</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            bã€ä¼šä¿ç•™å†å²æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            cã€ä¸€èˆ¬ä½¿ç”¨OLAPåˆ†æï¼Œ(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> analytical processing) è”æœºåˆ†æå¤„ç†(èšåˆæ“ä½œ) ï¼Œå¤šç»´åˆ†æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            dã€ä¼šæœ‰é‡å¤çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®åº“ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            aã€æ•°æ®é‡ï¼šGB-TB</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            bã€ä¸ä¿ç•™å†å²æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            cã€ä¸€èˆ¬ä½¿ç”¨OLTP(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> processing) è”æœºäº‹ç‰©å¤„ç†(å¢åˆ æ”¹æŸ¥)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            dã€ä¼ ç»Ÿçš„æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å¦‚ä½•åˆ›å»ºæ•°æ®ä»“åº“ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€å¦‚ä½•åˆ›å»ºè¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œåˆ†å±‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®ä»“åº“å„å±‚çš„ä»‹ç»</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          æ•°ä»“ä¸€å…±åˆ†æˆ5å±‚ï¼Œæ¯å±‚çš„ä½œç”¨å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬ä¸€å±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;odsï¼Œoperation data storeï¼Œå­˜æ”¾åŸå§‹æ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œå°†hdfsä¸Šçš„æ•°æ®åŸå°ä¸åŠ¨çš„å­˜å‚¨åˆ°odså±‚ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬äºŒå±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dwdï¼Œdata warehouse detail ï¼Œæ˜ç»†æ•°æ®å±‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œå¯¹odså±‚çš„æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œå¦‚å»é™¤ç©ºå€¼ï¼Œè„æ•°æ®ã€è„±æ•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                ï¼ˆç”¨äºä¿æŠ¤ç”¨æˆ·çš„éšç§ï¼‰ï¼Œç»´åº¦é€€åŒ–ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬ä¸‰å±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dws ï¼š data warehouse serviceï¼Œæ•°æ®æœåŠ¡å±‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œä»¥dwdä¸ºåŸºç¡€ï¼ŒæŒ‰å¤©ç»Ÿè®¡ï¼Œè¿›è¡Œè½»åº¦çš„æ±‡æ€»</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬å››å±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dwtï¼šdata warehouse topicï¼Œæ•°æ®ä¸»é¢˜å±‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œä»¥dwså±‚ä¸ºåŸºç¡€ï¼ŒæŒ‰ä¸»é¢˜è¿›è¡Œæ±‡æ€»ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬äº”å±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;adsï¼Œapplication data service,æ•°æ®åº”ç”¨å±‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œä»¥dwtä¸ºåŸºç¡€ï¼Œä¸ºå„ç§æŠ¥è¡¨æä¾›æ•°æ®ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          å„å±‚å…·ä½“çš„å®ç°æ–¹å¼ã€ä½œç”¨åœ¨åç»­è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°ä»“ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ†å±‚ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">          1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å°†å¤æ‚çš„é—®é¢˜ç®€å•åŒ–ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              aã€å¤æ‚ä»»åŠ¡åˆ†è§£æˆå¤šå±‚æ¥å®ç°ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              bã€æ¯ä¸€å±‚å¤„ç†ä¸€äº›ç®€å•çš„ä»»åŠ¡ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              cã€æ–¹ä¾¿å®šä½é—®é¢˜ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">           2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å‡å°‘é‡å¤å¼€å‘</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">               aã€ä¸­é—´å±‚çš„æ•°æ®ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨åˆ°ä¸åŒçš„éœ€æ±‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">               bã€å¦‚æœè®¡ç®—å‡ºé”™ï¼Œä¸éœ€è¦é‡å¤´å¼€å§‹è®¡ç®—</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">           3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. éš”ç¦»åŸå§‹æ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-æ•°æ®é›†å¸‚" tabindex="-1"><a class="header-anchor" href="#_1-2-æ•°æ®é›†å¸‚"><span>1.2 æ•°æ®é›†å¸‚</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>æ•°ä»“æ˜¯é¢å¯¹ä¼ä¸šçº§åˆ«ï¼Œè€Œæ•°æ®é›†å¸‚æ˜¯é¢å‘ä¼ä¸šä¸­çš„æŸä¸€ä¸ªéƒ¨é—¨ã€‚</span></span></code></pre></div><p>![image-20200704202534114](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704202541.png)</p><h3 id="_1-3-æ•°ä»“å‘½åè§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_1-3-æ•°ä»“å‘½åè§„èŒƒ"><span>1.3 æ•°ä»“å‘½åè§„èŒƒ</span></a></h3><blockquote><p>å‘½åè§„èŒƒå®ç°<mark>è§åçŸ¥æ„</mark></p></blockquote><h4 id="_1-3-1-è¡¨å‘½å" tabindex="-1"><a class="header-anchor" href="#_1-3-1-è¡¨å‘½å"><span>1.3.1 è¡¨å‘½å</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. åŸåˆ™ï¼šé€šè¿‡è¡¨åçŸ¥é“æ•°æ®ä½äºæ•°ä»“å“ªä¸€å±‚ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. è§„èŒƒ:</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€odså±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ods_è¡¨å&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€dwdå±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dwd_fact/dim_è¡¨å&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --factï¼šäº‹å®è¡¨ï¼Œdimï¼šç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€dwså±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dws_è¡¨å&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€dwtå±‚: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dwt_è¡¨å&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€adså±‚ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ads_è¡¨å&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€ä¸´æ—¶è¡¨ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;xxx_tmp&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€ç”¨æˆ·è¡Œä¸ºè¡¨ï¼Œ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä»¥logä¸ºåç¼€&#39;</span></span></code></pre></div><h4 id="_1-3-2-è„šæœ¬å‘½å" tabindex="-1"><a class="header-anchor" href="#_1-3-2-è„šæœ¬å‘½å"><span>1.3.2 è„šæœ¬å‘½å</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è§„åˆ™ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   æ•°æ®æº_to_ç›®çš„åœ°_log/</span><span style="color:#D19A66;--shiki-dark:#D19A66;">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   aã€ç”¨æˆ·è¡Œä¸ºè„šæœ¬ä½¿ç”¨</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;log&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ä¸ºåç¼€ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   bã€ä¸šåŠ¡æ•°æ®è„šæœ¬ä½¿ç”¨</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;db&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ä¸ºåç¼€</span></span></code></pre></div><h4 id="_1-3-3-è¡¨å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#_1-3-3-è¡¨å­—æ®µ"><span>1.3.3 è¡¨å­—æ®µ</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°é‡ç±»å‹ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é‡‘é¢ç±»å‹ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰ï¼Œ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å°æ•°ç±»å‹ï¼Œä¿ç•™ä¸¤ä½å°æ•°&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å­—ç¬¦ä¸²(å¦‚åå­—ï¼Œæè¿°ä¿¡æ¯ç­‰)ç±»å‹ï¼šstring</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸»é”®å¤–é”®ç±»å‹ï¼šstring</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ—¶é—´æˆ³ç±»å‹ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span></span></code></pre></div><h2 id="äºŒã€æ•°ä»“ç†è®º" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ•°ä»“ç†è®º"><span>äºŒã€æ•°ä»“ç†è®º</span></a></h2><h3 id="_2-1-å…³ç³»å»ºæ¨¡" tabindex="-1"><a class="header-anchor" href="#_2-1-å…³ç³»å»ºæ¨¡"><span>2.1 å…³ç³»å»ºæ¨¡</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   è®¾è®¡å…³ç³»å‹æ•°æ®åº“æ—¶ï¼Œéµå®ˆä¸€å®šçš„è§„èŒƒè¦æ±‚ï¼Œç›®çš„åœ¨äºé™ä½æ•°æ®çš„å†—ä½™ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. é—®é¢˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   é—®é¢˜1ï¼šä¸ºä»€ä¹ˆè¦é™ä½æ•°æ®å†—ä½™ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   é—®é¢˜2ï¼šå…³ç³»å‹æ•°æ®åº“çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   é—®é¢˜3ï¼šå…³ç³»å‹æ•°æ®åº“çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   é—®é¢˜4ï¼šä»€ä¹ˆè§„èŒƒè¦æ±‚ï¼Ÿ</span></span></code></pre></div><ul><li>é—®é¢˜è§£æ</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é—®é¢˜1ï¼šä¸ºä»€ä¹ˆè¦é™ä½æ•°æ®å†—ä½™ï¼Ÿ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åœ¨2000å¹´å¼€å§‹çš„æ—¶å€™ï¼Œç£ç›˜ä»·æ ¼å¾ˆæ˜‚è´µï¼Œä¸ºäº†å‡å°‘ç£ç›˜çš„å­˜å‚¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»¥å‰æ²¡æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œéƒ½æ˜¯å•æœºï¼Œåªèƒ½å¢åŠ ç£ç›˜çš„æ–¹å¼è¿›è¡Œæ‰©å®¹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é—®é¢˜2 ï¼šå…³ç³»å‹æ•°æ®åº“çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼Œéœ€è¦ä¿®æ”¹å¤šä¸ªè¡¨ï¼Œå¾ˆéš¾ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºæ•°æ®è§£è€¦åˆæ€§å¾ˆé«˜ï¼Œæ‰€ä»¥è·å–æ•°æ®æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡joinæ‹¼æ¥å¾—åˆ°æœ€åçš„ç»“æœã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é—®é¢˜3ï¼š å…³ç³»å‹æ•°æ®åº“çš„ç‰¹ç‚¹ï¼Œè§ä¸‹å›¾</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®è¾ƒä¸ºæ¾æ•£ã€é›¶ç¢ï¼Œç‰©ç†è¡¨æ•°é‡å¤šï¼Œè€Œæ•°æ®å†—ä½™ç¨‹åº¦ä½ã€‚</span></span></code></pre></div><p>![image-20200704205647836](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704210258.png)</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é—®é¢˜4ï¼š éœ€è¦éµå®ˆçš„è§„èŒƒ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   èŒƒå¼ç†è®ºï¼Œä»€ä¹ˆæ˜¯èŒƒå¼ç†è®ºå‘¢ï¼Ÿè§ä¸‹å°èŠ‚åˆ†æã€‚</span></span></code></pre></div><h3 id="_2-2-èŒƒå¼ç†è®º" tabindex="-1"><a class="header-anchor" href="#_2-2-èŒƒå¼ç†è®º"><span>2.2 èŒƒå¼ç†è®º</span></a></h3><blockquote><p>åœ¨å­¦ä¹ èŒƒå¼ç†è®ºä¹‹å‰ï¼Œå…ˆè¯´è¯´å‡½æ•°çš„ä¾èµ–ï¼Œå› ä¸ºèŒƒå¼ç†è®ºå’Œå‡½æ•°çš„ä¾èµ–æœ‰å…³ç³»ã€‚</p></blockquote><h4 id="_2-2-1-å‡½æ•°çš„ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_2-2-1-å‡½æ•°çš„ä¾èµ–"><span>2.2.1 å‡½æ•°çš„ä¾èµ–</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å‡½æ•°ä¾èµ–çš„åˆ†ç±»</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å®Œå…¨å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. éƒ¨åˆ†å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¼ é€’å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å„ç§å‡½æ•°ä¾èµ–æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä½¿ç”¨é«˜ä¸­çš„å‡½æ•°è¿›è¡Œç±»æ¯”</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å®Œå…¨å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         aã€å‡½æ•°ï¼šz </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f(x,y)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         bã€è¯´æ˜ï¼šzå®Œå…¨ä¾èµ–äºxå’Œyï¼Œåªæœ‰çŸ¥é“xå’Œyçš„å€¼ï¼Œæ‰èƒ½æ±‚å‡ºz</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. éƒ¨åˆ†å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         aã€å‡½æ•°ï¼šz </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f(x,y) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> x + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         bã€è¯´æ˜ï¼šåªé€šè¿‡xå°±å¯ä»¥å¾—åˆ°zçš„å€¼ï¼Œå¯ä»¥ä¸éœ€è¦y</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¼ é€’å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€å‡½æ•°ï¼šy </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f(x) , z </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f(y) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€è¯´æ˜ï¼šé€šè¿‡xå¾—åˆ°yï¼Œé€šè¿‡yçš„å€¼ï¼Œå¾—åˆ°zï¼Œä½†æ˜¯é€šè¿‡zä¸èƒ½å¾—åˆ°x</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¦‚ä¸Š3ä¸ªå‡½æ•°ä¾èµ–å…³ç³»ä½“ç°å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å®Œå…¨å‡½æ•°ä¾èµ–ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å­¦å·å’Œè¯¾åæ˜¯ä¸»é”®&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         é€šè¿‡{å­¦å· ã€ è¯¾å} ï¼Œå¾—åˆ°å”¯ä¸€çš„åˆ†æ•°ï¼Œåˆ™</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ†æ•°å®Œå…¨ä¾èµ–äºå­¦å·å’Œè¯¾å&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å­¦å·å’Œè¯¾åæ˜¯ä¸»é”®&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         é€šè¿‡{å­¦å·ï¼Œè¯¾å} å¾—åˆ°å”¯ä¸€çš„å§“åï¼Œä½†æ˜¯ä¸éœ€è¦è¯¾åä¹Ÿå¯ä»¥ï¼Œåˆ™</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å§“åéƒ¨åˆ†ä¾èµ–äºå­¦å·å’Œè¯¾å&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¼ é€’å‡½æ•°ä¾èµ–ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         é€šè¿‡å­¦å·ï¼Œå¯ä»¥æ‰¾åˆ°å­¦å·æ‰€åœ¨çš„ç³»åã€‚é€šè¿‡ç³»åï¼Œæ‰¾åˆ°ç³»ä¸»ä»»ï¼Œåˆ™</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç³»ä¸»ä»»ä¼ é€’ä¾èµ–äºå­¦å·&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20200704212135573](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704212135.png)</p><h4 id="_2-2-2-èŒƒå¼ç†è®º" tabindex="-1"><a class="header-anchor" href="#_2-2-2-èŒƒå¼ç†è®º"><span>2.2.2 èŒƒå¼ç†è®º</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. èŒƒå¼åˆ†ç±»ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ç›®å‰ä¸šç•ŒèŒƒå¼æœ‰ï¼šç¬¬ä¸€èŒƒå¼(1NF)ã€ç¬¬äºŒèŒƒå¼(2NF)ã€ç¬¬ä¸‰èŒƒå¼(3NF)ã€å·´æ–¯-ç§‘å¾·èŒƒå¼(BCNF)ã€ç¬¬å››èŒƒå¼(4NF)ã€ç¬¬äº”èŒƒå¼(5NF)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. åœ¨è¡Œä¸šå†…ï¼Œç›®å‰å¤§éƒ½æ˜¯éµå®ˆä¸‰èŒƒå¼</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;ç¬¬ä¸€èŒƒå¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå±æ€§ä¸å¯åˆ‡å‰²</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              å¦‚æœæ•°æ®è¡¨çš„è®¾è®¡ä¸æ»¡è¶³è¿™ä¸ªåŸºæœ¬è¦æ±‚ï¼Œé‚£ä¹ˆæ“ä½œä¸€å®šæ˜¯ä¸ä¼šæˆåŠŸçš„ã€‚</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;ç¬¬äºŒèŒƒå¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸èƒ½å‡ºç°éƒ¨åˆ†å‡½æ•°ä¾èµ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡åˆ†è¡¨çš„æ–¹å¼ï¼Œå»é™¤éƒ¨åˆ†ä¾èµ–</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;ç¬¬ä¸‰èŒƒå¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸èƒ½å‡ºç°ä¼ é€’å‡½æ•°ä¾èµ–</span></span></code></pre></div><h3 id="_2-3-å…³ç³»å»ºæ¨¡ä¸ç»´åº¦å»ºæ¨¡" tabindex="-1"><a class="header-anchor" href="#_2-3-å…³ç³»å»ºæ¨¡ä¸ç»´åº¦å»ºæ¨¡"><span>2.3 å…³ç³»å»ºæ¨¡ä¸ç»´åº¦å»ºæ¨¡</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å»ºæ¨¡å°±æ˜¯åˆ›å»ºè¡¨&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å…³ç³»å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡çš„åŒºåˆ«ï¼š</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;å…³ç³»å»ºæ¨¡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        aã€å…³ç³»å»ºæ¨¡ä¾èµ–äºèŒƒå¼åŸç†</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸»è¦æ˜¯ä¸‰èŒƒå¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">è®¾è®¡åŸåˆ™ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        bã€ä¾§é‡æ•°æ®çš„äº‹åŠ¡æ€§ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        cã€ä¸€å¼ è¡¨çš„æ•°æ®è¾¾åˆ°äº†500Gä»¥ä¸Šä»¥åï¼Œæ•ˆç‡æ¯”è¾ƒä½ </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--&#39;è¡Œä¸šçš„æ ‡å‡†&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;ç»´åº¦å»ºæ¨¡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    	aã€é¡¾åæ€ä¹‰ï¼ŒæŒ‰ç…§ç»´åº¦å»ºæ¨¡çš„æ€æƒ³è¿›è¡Œè®¾è®¡è¡¨ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    	bã€å¤šè§’åº¦è¿›è¡Œåˆ†æï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    	cã€è¡¨ç»“æ„æ˜¯ï¼šä¸­é—´ä¸€ä¸ªäº‹å®è¡¨ï¼Œå‘¨å›´æ˜¯ç»´åº¦è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</span></span></code></pre></div><p>![image-20200704215542880](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704215543.png)</p><h3 id="_2-4-ç»´åº¦å»ºæ¨¡" tabindex="-1"><a class="header-anchor" href="#_2-4-ç»´åº¦å»ºæ¨¡"><span>2.4 ç»´åº¦å»ºæ¨¡</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç»´åº¦å»ºæ¨¡æ˜¯ç”±kimballåˆ›å»º&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ç»´åº¦å»ºæ¨¡çš„æ¨¡å‹åˆ†ç±»ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€æ˜Ÿå‹æ¨¡å‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€é›ªèŠ±æ¨¡å‹ï¼šä¸€å¼ äº‹å®è¡¨, å¤šä¸ªå¤šå±‚ç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€æ˜Ÿåº§æ¨¡å‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å„ç§æ¨¡å‹åŒºåˆ«ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€æ˜Ÿå‹æ¨¡å‹:ä¸€å¼ äº‹å®è¡¨, å¤šä¸ªä¸€å±‚ç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€é›ªèŠ±æ¨¡å‹:ä¸€å¼ äº‹å®è¡¨, å¤šä¸ªå¤šå±‚ç»´åº¦è¡¨ï¼Œæ¯”è¾ƒé è¿‘ç¬¬ä¸‰èŒƒå¼</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€æ˜Ÿåº§æ¨¡å‹:åŸºäºå¤šä¸ªäº‹å®è¡¨ï¼Œå¤šä¸ªäº‹å®è¡¨ä¹‹é—´æœ‰å…±åŒçš„ç»´åº¦è¡¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. ç»´åº¦å»ºæ¨¡æ¨¡å‹çš„é€‰æ‹©ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŸåˆ™&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå–å†³äºæ€§èƒ½æ›´ä¼˜è¿˜æ˜¯çµæ´»æ›´ä¼˜ã€‚æ˜Ÿå‹æ¨¡å‹æ€§èƒ½æ›´ä¼˜ï¼Œé›ªèŠ±æ¨¡å‹çµæ´»æ›´ä¼˜ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€‰æ‹©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå½“å‰æ˜¯æ›´å€¾å‘äºç»´åº¦æ›´å°‘çš„æ¨¡å‹ï¼Œå°¤å…¶æ˜¯åœ¨hadoopçš„ä½“ç³»ä¸­ï¼Œå‡å°‘joinå°±æ˜¯å‡å°‘shuffle</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€å…³ç³»å‹æ•°æ®åº“å¯ä»¥ä¾é å¼ºå¤§çš„ä¸»é”®æ¥ä¼˜åŒ–æ•ˆç‡ã€‚  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. ç»´åº¦å»ºæ¨¡çš„ä¼˜åŠ¿</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€è¡¨ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“ä¸Šæ‰‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€å­˜åœ¨æ•°æ®çš„å†—ä½™ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€ä½¿ç”¨äºå¤šç»´åˆ†æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 5. ä¸åŒæ¨¡å‹çš„å›¾ç¤º</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20200704220209108](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704220209.png)</p><p>![image-20200704220318444](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200704220318.png)</p><h3 id="_2-5-äº‹å®è¡¨å’Œç»´åº¦è¡¨-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-5-äº‹å®è¡¨å’Œç»´åº¦è¡¨-é‡ç‚¹"><span>2.5 äº‹å®è¡¨å’Œç»´åº¦è¡¨ï¼ˆé‡ç‚¹ï¼‰</span></a></h3><h4 id="_2-5-1-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_2-5-1-ç®€ä»‹"><span>2.5.1 ç®€ä»‹</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å¦‚ä½•ç†è§£ç»´åº¦è¡¨å’Œäº‹å®è¡¨ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ ¹æ®ä¸šåŠ¡æ¥çš„ï¼Œä¸€ä¸ªä¸šåŠ¡å»ºæˆäº‹å®è¡¨ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä»¥ç”µå•†ä¸ºä¾‹ï¼šæ”¶è—ã€è¯„è®ºã€åŠ è´­ç‰©è½¦ã€ä¸‹å•ã€æ”¯ä»˜ã€é¢†ç”¨ä¼˜æƒ åˆ¸ã€é€€æ¬¾ç­‰ä¸šåŠ¡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç»´åº¦è¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå¯¹äº‹å®è¡¨çš„æè¿°ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä»¥ç”µå•†ä¸ºä¾‹ï¼šæ—¶é—´ã€åœ°ç‚¹ã€ç”¨æˆ·ã€å•†å“ã€æ´»åŠ¨ã€ä¼˜æƒ åˆ¸</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ä¸¾ä¾‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   äº‹å®è¡¨ï¼šæ”¯ä»˜ä¸šåŠ¡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   æè¿°ï¼š2020å¹´06æœˆ26å· å¼ ä¸‰   åœ¨åŒ—äº¬  å‚åŠ 618æ´»åŠ¨  ä¹°äº† 1å°è‹¹æœæ‰‹æœº</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">           &#39;æ—¶é—´&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;ç”¨æˆ·&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;">  &#39;åœ°ç‚¹&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;æ´»åŠ¨&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;å•†å“&#39;</span></span></code></pre></div><h4 id="_2-5-2-ç»´åº¦è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-5-2-ç»´åº¦è¡¨"><span>2.5.2 ç»´åº¦è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ç»´åº¦è¡¨æ˜¯ä¸ºäº‹å®è¡¨æœåŠ¡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ç‰¹å¾ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€ç»´åº¦è¡¨çš„èŒƒå›´å¾ˆå®½ï¼Œå…·æœ‰å¤šä¸ªå±æ€§ï¼Œåˆ—æ¯”è¾ƒå®½</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€ä¸äº‹å®è¡¨æ¯”ï¼Œè¡Œæ•°æ¯”è¾ƒå°‘ï¼Œ</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 10ä¸‡æ¡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€å†…å®¹ç›¸å¯¹æ¯”è¾ƒå›ºå®šï¼šå¦‚ç¼–ç è¡¨ï¼Œåœ°åŒºè¡¨</span></span></code></pre></div><h4 id="_2-5-3-äº‹å®è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-5-3-äº‹å®è¡¨"><span>2.5.3 äº‹å®è¡¨</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. äº‹å®è¡¨ä¸­çš„æ¯è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªä¸šåŠ¡äº‹ä»¶ï¼Œå¦‚ä¸‹å•æ“ä½œã€æ”¯ä»˜ã€é€€æ¬¾ã€è¯„ä»·ç­‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ç‰¹å¾ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€æ•°æ®é‡å¤§</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€å†…å®¹ç›¸å¯¹çª„ï¼Œåˆ—æ•°é‡è¾ƒå°‘,è¡Œæ•°é‡å¾ˆå¤§</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€ç»å¸¸æ€§å˜åŒ–ï¼Œæ¯å¤©éƒ½ä¼šæœ‰æ–°å¢å¾ˆå¤šæ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. ç»“æ„ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ç”±</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ1ä¸ªåŠä»¥ä¸Šï¼‰ + ä¸</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç»´åº¦è¡¨å…³è”çš„å¤–é”®å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ2ä¸ªåŠä»¥ä¸Šï¼‰ + å†—ä½™å­—æ®µ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. åº¦é‡å€¼</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¯åŠ &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä½¿ç”¨ä»»æ„ç»´åº¦å‡å¯åŠ </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŠå¯åŠ &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šè¯¥åº¦é‡å€¼åªèƒ½åœ¨æŸäº›ç»´åº¦å¯åŠ </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         å¦‚: åœ°ç‚¹ç»´åº¦å¯ä»¥åŠ , ä½†æ˜¯åœ¨æ—¶é—´ç»´åº¦æ²¡æ„ä¹‰</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸å¯åŠ &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåœ¨ä»»ä½•çš„ç»´åº¦éƒ½ä¸å¯åŠ </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         å¦‚: æ¯”ç‡ </span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">% </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">%</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            100</span><span style="color:#D19A66;--shiki-dark:#D19A66;">		10</span><span style="color:#D19A66;--shiki-dark:#D19A66;">		10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">%</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            90</span><span style="color:#D19A66;--shiki-dark:#D19A66;">		10</span><span style="color:#D19A66;--shiki-dark:#D19A66;">		1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/</span><span style="color:#D19A66;--shiki-dark:#D19A66;">9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		è¿™ç±»åº¦é‡å€¼çš„å¤„ç†æ–¹å¼ï¼šå˜æˆå¯åŠ , æŠŠåº¦é‡æ‹†åˆ†, åˆ†å­åˆ†æ¯è¿›è¡Œæ‹†åˆ†å˜æˆå¯åŠ </span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-4-äº‹å®è¡¨çš„åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_2-5-4-äº‹å®è¡¨çš„åˆ†ç±»"><span>2.5.4 äº‹å®è¡¨çš„åˆ†ç±»</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. äº‹å®è¡¨çš„åˆ†ç±»ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€äº‹åŠ¡å‹äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€å‘¨æœŸæ€§å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€ç´¯ç§¯æ€§å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. äº‹åŠ¡å‹äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ•°æ®æ›´æ–°æ–¹å¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¢é‡æ›´æ–°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œåªå¢åŠ æ–°çš„æ•°æ®ï¼Œä¸ä¼šå¯¹æ—§çš„æ•°æ®ç±»å‹è¿›è¡Œæ›´æ”¹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº”ç”¨åœºæ™¯&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåªæœ‰æ–°å¢çš„æ•°æ®ï¼Œæ—§æ•°æ®ä¸ä¼šå˜æ›´çš„äº‹å®è¡¨é‡‡ç”¨è¿™ç§ç±»å‹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ•°æ®æ›´æ–°æ–¹å¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å…¨é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œæ¯å¤©ä¸€ä¸ªå¿«ç…§</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº”ç”¨åœºæ™¯&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåªå…³å¿ƒæœ€ç»ˆçš„ä¸€ä¸ªç»“æœï¼Œä¸å…³å¿ƒä¸­é—´çš„ä¸šåŠ¡æ“ä½œè¿‡ç¨‹ï¼Œå¦‚æ”¶è—è¡¨å’ŒåŠ è´­è¡¨ï¼Œåªå…³å¿ƒç”¨æˆ·è´­ç‰©è½¦ä¸­äº§å“ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         è€Œä¸å…³å¿ƒç”¨æˆ·åŠ å…¥è´­ç‰©çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚ä¸ŠåˆåŠ äº†ä¸€ä¸ªäº§å“åˆ°è´­ç‰©è½¦ä¸­ï¼Œä¸‹åˆåˆå°†è¿™ä¸ªäº§å“ä»è´­ç‰©è½¦åˆ é™¤ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒè¿™ä¸ªè¿‡ç¨‹ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ•°æ®æ›´æ–°æ–¹å¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ–°å¢åŠå˜åŒ–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº”ç”¨åœºæ™¯&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€æ¡æ•°æ®ä¸€æ¬¡å†™ä¸å®Œï¼Œéœ€è¦å¤šæ¬¡æ‰èƒ½å†™å®Œï¼Œå¦‚è®¢å•äº‹å®è¡¨ï¼Œè®¢å•çš„çŠ¶æ€ï¼Œæœ‰ä»ä¸‹å•åˆ°æœ€åç»“æŸè®¢å•ä¸€å…±æœ‰6ä¸ªçŠ¶æ€ã€‚</span></span></code></pre></div><h3 id="_2-6-æ•°æ®ä»“åº“å»ºæ¨¡-ç»å¯¹çš„é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-6-æ•°æ®ä»“åº“å»ºæ¨¡-ç»å¯¹çš„é‡ç‚¹"><span>2.6 æ•°æ®ä»“åº“å»ºæ¨¡ï¼ˆç»å¯¹çš„é‡ç‚¹ï¼‰</span></a></h3><blockquote><p>æ•°æ®ä»“åº“å»ºæ¨¡ä¸»è¦æ˜¯æŒ‡dwdå±‚</p></blockquote><h4 id="_2-6-1-odså±‚" tabindex="-1"><a class="header-anchor" href="#_2-6-1-odså±‚"><span>2.6.1 ODSå±‚</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®å’Œhdfsä¸Šæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¸åšä»»ä½•çš„ä¿®æ”¹ï¼Œèµ·åˆ°æ•°æ®å¤‡ä»½ä½œç”¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®é‡‡ç”¨lzoå‹ç¼©ï¼Œéœ€è¦ç´¢å¼•æ–‡ä»¶ï¼Œmysqlå¯¼å…¥hdfsæ—¶ï¼Œè‡ªå¸¦ç´¢å¼•æ–‡ä»¶ï¼Œlogæ–‡ä»¶ä¸å¸¦ç´¢å¼•æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨odså±‚éœ€è¦è‡ªå·±åŠ ç´¢å¼•ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆ›å»ºåˆ†åŒºè¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŒæ­¥ç­–ç•¥ä¸mysqlå’Œlogæ•°æ®å­˜å‚¨åˆ°HDFSçš„åŒæ­¥ç­–ç•¥ä¿æŒä¸€è‡´&#39;</span></span></code></pre></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. åŸå§‹æ•°æ®é‡‡é›†åˆ°HDFSä¸Šçš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿåˆæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;logæ–‡ä»¶&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€æ¯å¤©ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œflumeé‡‡é›†ä»¥åçš„æ•°æ®å°±ç›´æ¥å‘é€åˆ°HDFSä¸Šï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å®ç°æ¯å¤©ä¸€ä¸ªæ–‡ä»¶å¤¹çš„æ–¹æ³•&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå¦‚ä¸‹ä¸ºæœ€åä¸€ä¸ªflumeçš„é…ç½®æ–‡ä»¶ï¼Œæ¯å¤©çš„æ•°æ®ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ä¼šè¢«æ”¾è¿›ä¸€ä¸ªå½“å¤©æ—¥æœŸçš„æ–‡ä»¶å¤¹ä¸­ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        --a1.sinks.k1.hdfs.path = /origin_data/gmall/log/topic_log/%Y-%m-%d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‹ç¼©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ–‡ä»¶å¤¹ä¸­çš„æ•°æ®é‡‡ç”¨lzoå‹ç¼©ï¼Œ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŒæ—¶æ²¡æœ‰ç´¢å¼•æ–‡ä»¶&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      dã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå½“å¤©äº§ç”Ÿçš„æ—¥å¿—æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dbä¸šåŠ¡æ•°æ®&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       aã€å¯¹äºmysqlä¸­çš„æ¯ä¸€å¼ è¡¨ï¼Œæ¯å¤©å¯¼ä¸€æ¬¡ï¼Œæ•°æ®å°±ä¼šåˆ›å»ºä¸€ä¸ªlzoå‹ç¼© + lzoç´¢å¼•çš„æ–‡ä»¶å¤¹,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é™¤ç‰¹æ®Šè¡¨ï¼Œçœä»½è¡¨ã€åœ°åŒºè¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       bã€åŒä¸€å¼ è¡¨ï¼Œæ¯å¤©å¯¼çš„æ•°æ®ä¼šè¿›å…¥å½“å¤©çš„æ–‡ä»¶å¤¹çš„æ–¹æ³•ï¼šåœ¨sqoopå¯¼æ•°æ®çš„è„šæœ¬ä¸­ï¼š</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          --target-dir /origin_data/gmall/db/$1/$do_date </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å½“å¤©çš„æ–‡ä»¶ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯ä»€ä¹ˆ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡sqoopå°†mysqlå¯¼å…¥åˆ°hdfsä¸­ï¼Œæ ¹æ®åŒæ­¥ç­–ç•¥çš„ä¸åŒï¼Œå½“å¤©æ–‡ä»¶å¤¹ä¸­å­˜å‚¨çš„æ•°æ®ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä»¥2020-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">06</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-25å¯¼å…¥ä¸ºä¾‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å…¨é‡åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2020</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">06</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œmysqlä¸­æ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ–°å¢åŠå˜åŒ–ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä»Šå¤©mysqlä¸­æ–°å¢å’Œå˜åŒ–äº†çš„å…¨éƒ¨æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ–°å¢åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä»Šå¤©mysqlæ–°å¢çš„å…¨éƒ¨æ•°æ®  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       dã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯å¼ è¡¨çš„åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">åŠ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŒæ­¥ç­–ç•¥é€‰æ‹©åŸåˆ™&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">è§ä¸‹å›¾æ‰€ç¤ºã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705003729.png)</p><p>![image-20200705000547089](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705000547.png)</p><p>![image-20200705001804478](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705001804.png)</p><ul><li>msqlæ•°æ®çš„åŒæ­¥ç­–ç•¥</li></ul><p>![image-20200705001104331](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705001104.png)</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. odså±‚æ•°æ®å’ŒHDFSçš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œé‚£ä¹ˆå…·ä½“çš„æ•°æ®å†…å®¹æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;odså±‚çš„è¡¨å±äºåˆ†åŒºè¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- åˆ›å»ºè¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. logæ•°æ®ï¼šåˆ›å»ºä¸€ä¸ªå­—æ®µä¸ºlineï¼Œåˆ†åŒºå­—æ®µä¸ºdt</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. dbæ•°æ®ï¼šå­—æ®µå’Œmysqlçš„å­—æ®µä¿æŒä¸€è‡´,åˆ†åŒºå­—æ®µä¸ºdt</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   -- ods_logåŠ è½½æ•°æ®ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   load</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inpath </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/origin_data/gmall/log/topic_log/$do_date&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> into</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;$APP&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.ods_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$do_date&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   -- ods_dbåŠ è½½æ•°æ®ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   load</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inpath </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/origin_data/$APP/db/order_detail/$do_date&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> OVERWRITE </span><span style="color:#C678DD;--shiki-dark:#C678DD;">into</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ${APP}.ods_order_detail </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$do_date&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h4 id="_2-6-2-dwd-å±‚-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-6-2-dwd-å±‚-é‡ç‚¹"><span>2.6.2 DWD å±‚ (é‡ç‚¹)</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼šDWDå±‚æ˜¯æ•°ä»“ç»´åº¦å»ºæ¨¡æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯é‡‡ç”¨æ˜Ÿå‹æ¨¡å‹ï¼Œç”±äºå­˜åœ¨å¤šä¸ªäº‹å®è¡¨ï¼Œå…¶å®ä¹Ÿå°±å½¢æˆäº†æ˜Ÿåº§æ¨¡å‹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºæ¨¡çš„4ä¸ªæ­¥éª¤ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹ -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> å£°æ˜ç²’åº¦ -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ç¡®å®šç»´åº¦  -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ç¡®è®¤äº‹å®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹ï¼š --ç¡®å®šäº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹ï¼šç¡®å®šäº‹å®è¡¨ï¼Œæ¯ä¸€ä¸ªä¸šåŠ¡åˆ›å»ºä¸€ä¸ªäº‹å®è¡¨ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. å£°æ˜ç²’åº¦ï¼š -- å£°æ˜äº‹å®è¡¨çš„ç²’åº¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å£°æ˜ç²’åº¦ï¼Œå…¶å®æ˜¯å£°æ˜äº‹å®è¡¨çš„ç²’åº¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»€ä¹ˆæ˜¯ç²’åº¦ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         aã€æ˜¯ä¸€ä¸ªå½¢å®¹è¯ï¼Œè¡¨ç¤ºè¡¨ä¸­çš„ä¸€è¡Œæ•°æ®ä¿å­˜æ•°æ®ç»†åŒ–ç¨‹åº¦æˆ–ç»¼åˆç¨‹åº¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å£°æ˜ç²’åº¦çš„è¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°å’Œä¸šåŠ¡ç›¸å…³çš„æ‰€æœ‰è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬äºŒæ­¥ï¼šç¡®å®šè¿™äº›ç›¸å…³è¡¨æ¯ä¸€è¡Œçš„ç²’åº¦</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç¬¬ä¸‰æ­¥ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€‰æ‹©ç²’åº¦æœ€ç»†&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„è¡¨ä½œä¸ºäº‹å®è¡¨ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ€ä¹ˆç®—æ˜¯æœ€ç»†çš„å‘¢ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         å¤–é”®è¶Šå¤šï¼Œç²’åº¦è¶Šç»†ï¼›å¤–é”®è¶Šå°‘ï¼Œç²’åº¦è¶Šç»†ã€‚</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--äº‹å®è¡¨çš„ç»´åº¦è¶Šå¤šï¼Œå¤–é”®è¶Šå¤šã€‚</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">         &#39;å…¸å‹çš„ç²’åº¦å£°æ˜å¦‚ä¸‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           è®¢å•è¯¦æƒ…è¡¨ä¸­ï¼Œæ¯è¡Œæ•°æ®å¯¹åº”ä¸€ä¸ªè®¢å•ä¸­çš„ä¸€ä¸ªå•†å“é¡¹ï¼Œç²’åº¦ä¸ºå•†å“</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           è®¢å•è¡¨ä¸­ï¼Œæ¯è¡Œæ•°æ®å¯¹åº”ä¸€ä¸ªè®¢å•ã€‚ç²’åº¦ä¸ºè®¢å•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           æ­¤æ—¶ä¸‹å•ä¸šåŠ¡ä¸­ï¼Œå•†å“ä¸ºæœ€ç»†ç²’åº¦ã€‚       </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸ºä»€ä¹ˆè¦é€‰æ‹©ç²’åº¦æœ€ç»†çš„è¡¨ä½œä¸ºäº‹å®è¡¨å‘¢ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         äº‹å®è¡¨å­˜å‚¨æ˜ç»†æ•°æ®ï¼Œä¸å­˜å‚¨èšåˆæ•°æ®ï¼Œè€Œéœ€æ±‚ä¸€èˆ¬éƒ½éœ€è¦å¯¹æ•°æ®è¿›è¡Œèšåˆçš„è¿ç®—ï¼Œè¿™æ ·å°±å¯ä»¥åº”å¯¹å„ç§éœ€æ±‚ã€‚   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. ç¡®å®šç»´åº¦ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ç¡®å®šæ¯ä¸€å¼ äº‹å®è¡¨çš„ç»´åº¦ï¼Œå¤–é”®ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. ç¡®å®šäº‹å®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æŒ‡ç¡®å®šäº‹å®è¡¨çš„åº¦é‡å€¼ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœ‹å®Œä¸Šé¢çš„æ­¥éª¤ï¼Œæ˜¯ä¸æ˜¯è¿˜æ˜¯æœ‰äº›æ¨¡ç³Šå‘¢ï¼Ÿæ²¡å…³ç³»ï¼Œåé¢å’±ä»¬å»ºDWDè¡¨çš„æ—¶å€™ï¼Œè¯¦ç»†è®²è¿°æˆ‘ä»¬çš„è¡¨æ˜¯æ€ä¹ˆå»ºçš„&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 7. å…³äºäº‹å®è¡¨å‡ ä¸ªåŸåˆ™ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ¯ä¸€ä¸ªä¸šåŠ¡éƒ½éœ€è¦å»ºä¸€ä¸ªäº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸€ä¸ªäº‹å®è¡¨ä¸­çš„ç²’åº¦è¦ä¸€è‡´</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åº¦é‡å€¼çš„å•ä½è¦ä¸€è‡´</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä½¿ç”¨ç»´åº¦å†—ä½™ï¼Œæ¥å‡å°‘joinçš„æ¬¡æ•°</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. nullå€¼ï¼Œå¦‚æœæ˜¯æ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨0æ¥ä»£æ›¿</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-3-dws-dwt" tabindex="-1"><a class="header-anchor" href="#_2-6-3-dws-dwt"><span>2.6.3 DWS&amp;DWT</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. dwså±‚å’Œdwtå±‚çš„è¡¨ï¼Œéƒ½æ˜¯å®½è¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. dwså±‚å®½è¡¨å¦‚ä½•å»ºï¼Ÿç«™åœ¨ç»´åº¦çš„è§’åº¦çœ‹å¾…äº‹å®è¡¨çš„åº¦é‡å€¼ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€æ¯ä¸€ä¸ªç»´åº¦å»ºä¸€ä¸ªå®½è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€å®½è¡¨çš„å­—æ®µï¼šç»´åº¦å­—æ®µ + æ‰¾åˆ°å’Œè¿™ä¸ªç»´åº¦è¡¨ç›¸å…³çš„æ‰€æœ‰äº‹å®è¡¨ï¼Œäº‹å®è¡¨çš„æ‰€æœ‰åº¦é‡å€¼ä½œä¸ºå®½è¡¨çš„å­—æ®µï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    éƒ¨åˆ†çš„å­—æ®µï¼Œç”±äºæˆ‘ä»¬æœ€ç»ˆæ˜¯ä¸ºå®¢æˆ·çš„éœ€æ±‚æœåŠ¡ï¼Œèƒ½å†™ä¸Šå°±å°½é‡å†™ä¸Šã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. dwsï¼šç»Ÿè®¡å½“å¤©çš„è¡Œä¸ºæ•°æ®ï¼Œåˆ†åŒºè¡¨ï¼ŒæŒ‰å¤©è¿›è¡Œåˆ†åŒº</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. dwtï¼šç»Ÿè®¡ç´¯è®¡è¡Œä¸ºï¼Œç«™åœ¨ç»´åº¦çš„è§’åº¦ï¼Œæ¥çœ‹äº‹å®è¡¨ï¼Œçœ‹äº‹å®è¡¨çš„å¼€å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´ï¼Œæ€»ç´¯ç§¯çš„åº¦é‡å€¼ï¼Œä¸€æ®µæ—¶é—´å†…çš„åº¦é‡å€¼ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          å¦‚ç»Ÿè®¡ç´¯è®¡7å¤©çš„ä¸‹å•é‡ï¼Œä¸æ˜¯åˆ†åŒºè¡¨ã€‚å±äºå…¨é‡è¡¨ã€‚</span></span></code></pre></div><p>![image-20200705014315138](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705014315.png)</p><p>![image-20200705014403933](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705014404.png)</p><h4 id="_2-6-4-ads" tabindex="-1"><a class="header-anchor" href="#_2-6-4-ads"><span>2.6.4 ADS</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ADSå±‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">å¯¹ç”µå•†ç³»ç»Ÿå„å¤§ä¸»é¢˜æŒ‡æ ‡è¿›è¡Œåˆ†æ</span></span></code></pre></div><p>![image-20200630230723674](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705100448.png)</p><h2 id="ä¸‰ã€æ•°ä»“æ­å»º-odså±‚" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ•°ä»“æ­å»º-odså±‚"><span>ä¸‰ã€æ•°ä»“æ­å»º ---ODSå±‚</span></a></h2><h3 id="_3-1-hiveç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_3-1-hiveç¯å¢ƒå‡†å¤‡"><span>3.1 Hiveç¯å¢ƒå‡†å¤‡</span></a></h3><h4 id="_3-1-1-hiveçš„ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-1-1-hiveçš„ä»‹ç»"><span>3.1.1 hiveçš„ä»‹ç»</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. Hiveçš„å¼•æ“</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€ mrï¼šè®¡ç®—å‘¨ã€æœˆã€å­£åº¦ã€å¹´çš„æŒ‡æ ‡æ—¶ä½¿ç”¨mrè®¡ç®—å¼•æ“</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€ tezï¼šç”¨äºæµ‹è¯•ä½¿ç”¨ï¼Œå®Œå…¨åŸºäºå†…å­˜</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€ sparkï¼šåŸºäºå†…å­˜å’Œç£ç›˜ï¼Œç”¨äºè®¡ç®—æ—¥æŒ‡æ ‡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. hive on spark åŠ spark on hive çš„åŒºåˆ«</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€hive </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sparkï¼šè¡¨ç¤ºhiveä½¿ç”¨sparkçš„å¼•æ“</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€spark </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> hiveï¼šå¯ä»¥ç†è§£ä¸ºsparkSql</span></span></code></pre></div><h4 id="_3-1-2-hive-on-spark-çš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-1-2-hive-on-spark-çš„é…ç½®"><span>3.1.2 Hive on Spark çš„é…ç½®</span></a></h4><ol><li>è§£å‹spark-2.4.5-bin-without-hive.tgzï¼Œå¹¶æ”¹å</li></ol><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ tar -zxf /opt/software/spark-2.4.5-bin-without-hive.tgz -C /opt/module</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ mv /opt/module/spark-2.4.5-bin-without-hive       /opt/module/spark</span></span></code></pre></div><ol start="2"><li>é…ç½®SPARK_HOMEç¯å¢ƒå˜é‡</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ sudo vim /etc/profile.d/my_env.sh</span></span></code></pre></div><ul><li>å¢åŠ å¦‚ä¸‹å†…å®¹</li></ul><div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">export SPARK_HOME=/opt/module/spark</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">export PATH=$PATH:$SPARK_HOME/bin</span></span></code></pre></div><ul><li>ä½¿å…¶ç”Ÿæ•ˆ</li></ul><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ source /etc/profile.d/my_env.sh</span></span></code></pre></div><ol start="3"><li>é…ç½®sparkè¿è¡Œç¯å¢ƒ</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ mv /opt/module/spark/conf/spark-env.sh.template /opt/module/spark/conf/spark-env.sh</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ vim /opt/module/spark/conf/spark-env.sh</span></span></code></pre></div><ul><li>æ·»åŠ å¦‚ä¸‹å†…å®¹</li></ul><div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">export SPARK_DIST_CLASSPATH=$(hadoop classpath)</span></span></code></pre></div><ol start="4"><li>æ–°å»ºsparké…ç½®æ–‡ä»¶</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ vim /opt/module/hive/conf/spark-defaults.conf</span></span></code></pre></div><ul><li>æ·»åŠ å¦‚ä¸‹å†…å®¹</li></ul><div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">spark.master                               yarn</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">spark.eventLog.enabled                     true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">spark.eventLog.dir                         hdfs://hadoop102:8020/spark-history</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">spark.executor.memory                      1g</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">spark.driver.memory					   	 1g</span></span></code></pre></div><ol start="5"><li>åœ¨HDFSåˆ›å»ºå¦‚ä¸‹è·¯å¾„</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ hadoop fs -mkdir /spark-history</span></span></code></pre></div><ol start="6"><li>ä¸Šä¼ Sparkä¾èµ–åˆ°HDFS</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ hadoop fs -mkdir /spark-jars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 software]$ hadoop fs -put /opt/module/spark/jars/* /spark-jars</span></span></code></pre></div><ol start="7"><li>ä¿®æ”¹hive-site.xml</li></ol><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!--Sparkä¾èµ–ä½ç½®--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spark.yarn.jars&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;hdfs://hadoop102:8020/spark-jars/*&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!--Hiveæ‰§è¡Œå¼•æ“--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;hive.execution.engine&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spark&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!--Hiveå’Œsparkè¿æ¥è¶…æ—¶æ—¶é—´--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;hive.spark.client.connect.timeout&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;10000ms&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„ï¼šhive.spark.client.connect.timeoutçš„é»˜è®¤å€¼æ˜¯1000msï¼Œå¦‚æœæ‰§è¡Œhiveçš„insertè¯­å¥æ—¶ï¼ŒæŠ›å¦‚ä¸‹å¼‚å¸¸ï¼Œå¯ä»¥è°ƒå¤§è¯¥å‚æ•°åˆ°10000ms</p><p>FAILED: SemanticException Failed to get a spark session: org.apache.hadoop.hive.ql.metadata.HiveException: Failed to create Spark client for Spark session d9e0224c-3d14-4bf4-95bc-ee3ec56df48e</p></blockquote><h4 id="_3-1-3-hive-on-sparkæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-1-3-hive-on-sparkæµ‹è¯•"><span>3.1.3 Hive on sparkæµ‹è¯•</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#1ï¼‰å¯åŠ¨hiveå®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 hive]$ bin/hive</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#2ï¼‰åˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default)&gt; create external table student(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">id</span><span style="color:#98C379;--shiki-dark:#98C379;"> int,</span><span style="color:#98C379;--shiki-dark:#98C379;"> name</span><span style="color:#98C379;--shiki-dark:#98C379;"> string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) location </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/student&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#3ï¼‰é€šè¿‡insertæµ‹è¯•æ•ˆæœ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default)&gt; insert into table student values(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;abc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#4ï¼‰å¦‚æœæ’å…¥æ•°æ®è¿‡ç¨‹/tmp/atguigu/hive.logæ–‡ä»¶ä¸­æŠ›å¦‚ä¸‹å¼‚å¸¸</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Caused</span><span style="color:#98C379;--shiki-dark:#98C379;"> by:</span><span style="color:#98C379;--shiki-dark:#98C379;"> javax.security.sasl.SaslException:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Server</span><span style="color:#98C379;--shiki-dark:#98C379;"> closed</span><span style="color:#98C379;--shiki-dark:#98C379;"> before</span><span style="color:#98C379;--shiki-dark:#98C379;"> SASL</span><span style="color:#98C379;--shiki-dark:#98C379;"> negotiation</span><span style="color:#98C379;--shiki-dark:#98C379;"> finished.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#5ï¼‰ä¿®æ”¹/opt/module/hadoop-3.1.3/etc/hadoop/capacity-scheduler.xmlä¸­amå¯åŠ¨çš„æœ€å¤§èµ„æºé…ç½®ã€‚åˆ†å‘ã€å¹¶é‡æ–°å¯åŠ¨resourcemanager</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 hadoop]$ vim capacity-scheduler.xml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;property&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">yarn.scheduler.capacity.maximum-am-resource-percent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/name&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/value&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/property&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-å¢åŠ hiveé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_3-1-4-å¢åŠ hiveé˜Ÿåˆ—"><span>3.1.4 å¢åŠ Hiveé˜Ÿåˆ—</span></a></h4><ol><li>ä¿®æ”¹å®¹é‡è°ƒåº¦å™¨é…ç½®æ–‡ä»¶</li></ol><blockquote><p>é»˜è®¤Yarnçš„é…ç½®ä¸‹ï¼Œå®¹é‡è°ƒåº¦å™¨åªæœ‰ä¸€æ¡Defaulté˜Ÿåˆ—ã€‚åœ¨capacity-scheduler.xmlä¸­å¯ä»¥é…ç½®å¤šæ¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li>ä¿®æ”¹ä»¥ä¸‹å±æ€§ï¼Œå¢åŠ hiveé˜Ÿåˆ—ã€‚</li></ul><div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.queues&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;default,hive&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      The queues at the this level (root is the root queue).</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.default.capacity&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;50&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      defaulté˜Ÿåˆ—çš„å®¹é‡ä¸º50%</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><ul><li>åŒæ—¶ä¸ºæ–°åŠ é˜Ÿåˆ—æ·»åŠ å¿…è¦å±æ€§ï¼š</li></ul><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.capacity&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;50&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      hiveé˜Ÿåˆ—çš„å®¹é‡ä¸º50%</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.user-limit-factor&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;1&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä¸€ä¸ªç”¨æˆ·æœ€å¤šèƒ½å¤Ÿè·å–è¯¥é˜Ÿåˆ—èµ„æºå®¹é‡çš„æ¯”ä¾‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.maximum-capacity&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;80&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      hiveé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.state&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;RUNNING&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.acl_submit_applications&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;*&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      è®¿é—®æ§åˆ¶ï¼Œæ§åˆ¶è°å¯ä»¥å°†ä»»åŠ¡æäº¤åˆ°è¯¥é˜Ÿåˆ—</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.acl_administer_queue&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;*&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      è®¿é—®æ§åˆ¶ï¼Œæ§åˆ¶è°å¯ä»¥ç®¡ç†(åŒ…æ‹¬æäº¤å’Œå–æ¶ˆ)è¯¥é˜Ÿåˆ—çš„ä»»åŠ¡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.acl_application_max_priority&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;*&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      è®¿é—®æ§åˆ¶ï¼Œæ§åˆ¶ç”¨æˆ·å¯ä»¥æäº¤åˆ°è¯¥é˜Ÿåˆ—çš„ä»»åŠ¡çš„æœ€å¤§ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.maximum-application-lifetime&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;-1&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      hiveé˜Ÿåˆ—ä¸­ä»»åŠ¡çš„æœ€å¤§ç”Ÿå‘½æ—¶é•¿</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yarn.scheduler.capacity.root.hive.default-application-lifetime&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;-1&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      hiveé˜Ÿåˆ—ä¸­ä»»åŠ¡çš„é»˜è®¤ç”Ÿå‘½æ—¶é•¿</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">property</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>åˆ†å‘é…ç½®æ–‡ä»¶</li></ol><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[atguigu@hadoop102 ~]$ xsync /opt/module/hadoop-3.1.3/etc/hadoop/capacity-scheduler.xml</span></span></code></pre></div><ol start="3"><li>é‡å¯Hadoopé›†ç¾¤</li></ol><h4 id="_3-1-5-åˆ›å»ºæ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_3-1-5-åˆ›å»ºæ•°æ®åº“"><span>3.1.5 åˆ›å»ºæ•°æ®åº“</span></a></h4><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1ï¼‰å¯åŠ¨hive</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 hive]$ bin/hive</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2ï¼‰æ˜¾ç¤ºæ•°æ®åº“</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default)&gt; show databases;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3ï¼‰åˆ›å»ºæ•°æ®åº“</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default)&gt; create database gmall;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4ï¼‰ä½¿ç”¨æ•°æ®åº“</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default)&gt; use gmall;</span></span></code></pre></div><h3 id="_3-2-odså±‚-ç”¨æˆ·è¡Œä¸ºæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_3-2-odså±‚-ç”¨æˆ·è¡Œä¸ºæ•°æ®"><span>3.2 ODSå±‚(ç”¨æˆ·è¡Œä¸ºæ•°æ®)</span></a></h3><h4 id="_3-2-1-è¡Œä¸ºæ•°æ®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_3-2-1-è¡Œä¸ºæ•°æ®è¯´æ˜"><span>3.2.1 è¡Œä¸ºæ•°æ®è¯´æ˜</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ç”¨æˆ·è¡Œä¸ºæ•°æ®åœ¨odsåˆ›å»ºè¡¨çš„è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç»´åº¦å»ºæ¨¡ä¸æ¶‰åŠåˆ°ç”¨æˆ·è¡Œä¸ºæ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸€è¡Œç”¨æˆ·è¡Œä¸ºæ•°æ®ä»£è¡¨ï¼šç”¨æˆ·åœ¨è¯¥é¡µé¢çš„æ‰€æœ‰æ“ä½œï¼Œä»¥é¡µé¢ä¸ºå•ä½</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åœ¨hdfsä¸Šçš„ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡ç”¨äº†lzoå‹ç¼©ï¼Œæ‰€ä»¥hiveè¯»å–æ•°æ®æ—¶ï¼Œéœ€è¦é‡‡ç”¨æŒ‡å®šæ–‡ä»¶çš„è¾“å…¥æ ¼å¼ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºhiveçš„æ•°æ®æœ€ç»ˆéƒ½æ˜¯å­˜å‚¨åœ¨HDFSï¼Œæ‰€ä»¥ä¹ŸæŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„æ ¼å¼ï¼Œæ¥é™ä½æ•°æ®çš„å­˜å‚¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. odså±‚çš„æ•°æ®ï¼Œé‡‡ç”¨åˆ†åŒºè¡¨ï¼Œä»¥æ—¥æœŸä¸ºåˆ†åŒºå­—æ®µï¼Œä¸€å¤©ä¸€ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©æœ€æ–°æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å»ºè¡¨æ—¶ï¼Œå°†ä¸€è¡Œæ•°æ®ä½œä¸ºä¸€åˆ—å­˜å‚¨åˆ°odså±‚çš„è¡¨ä¸­ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åŠ è½½æ•°æ®ï¼Œå¦‚æœæ˜¯åŠ è½½hdfsä¸Šçš„æ•°æ®åˆ°hiveè¡¨ï¼Œå…¶å®æ˜¯å®ç°æ•°æ®çš„å‰ªåˆ‡ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é˜Ÿåˆ—çš„åˆ‡æ¢ï¼Œç‰¹å®šçš„ä¸šåŠ¡ä½¿ç”¨ç‰¹å®šçš„é˜Ÿåˆ—</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. hiveä½¿ç”¨sparkå¼•æ“ï¼Œèµ„æºè°ƒåº¦è¿˜æ˜¯ä½¿ç”¨yarnï¼Œé»˜è®¤çš„è°ƒåº¦å™¨æ˜¯å®¹é‡è°ƒåº¦å™¨ï¼Œcapacity</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è„šæœ¬æ‰§è¡Œæ—¶é—´,ä¼ä¸šå¼€å‘ä¸­ä¸€èˆ¬åœ¨æ¯æ—¥å‡Œæ™¨30åˆ†~1ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ—¥å¿—æ•°æ®æ—¶é—´è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">       &#39;é—®é¢˜&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåœ¨å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå‰ä¸€å¤©çš„æ•°æ®æœ‰å¯èƒ½è¿›å…¥åˆ°ç¬¬äºŒå¤©ä¸­ï¼Œ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">       &#39;åŸå› &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ•°æ®é‡‡é›†è¿‡ç¨‹æœ‰å…³ï¼Œæ—¥å¿—æ•°æ®é‡‡é›†åˆ°HDFSä¸Šçš„è¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       æ—¥å¿—æ•°æ®ï¼ˆæ—¶é—´æˆ³ï¼‰ -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> æ—¥å¿—æœåŠ¡å™¨ -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flume1 -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> kafka -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flume2 -</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> HDFS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       flume2é‡‡é›†æ•°æ®æ—¶ï¼Œä½¿ç”¨kafka sourceï¼Œè¿™ä¸ªsourceä¼šç»™eventåŠ ä¸Šæ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´é»˜è®¤æ˜¯ç³»ç»Ÿæ—¶é—´ï¼Œkafkaä¼šç»™eventçš„header</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       åŠ ä¸Šæ—¶é—´æˆ³,ç”±äºæ•°æ®ä¼ é€’åˆ°ç¬¬äºŒä¸ªflumeéœ€è¦æ—¶é—´ï¼Œå¦‚æœåœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­å‡ºç°äº†æ•…éšœï¼Œé‚£ä¹ˆåœ¨flume2ä¸­ï¼Œeventçš„headerçš„æ—¶é—´å¯èƒ½</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       å°±æ˜¯ç¬¬äºŒå¤©çš„ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">       &#39;å¤„ç†æªæ–½&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šè‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼Œé€šè¿‡è·å–æ—¥å¿—æ•°æ®çš„æ—¶é—´æˆ³ä½œä¸ºeventçš„headerï¼Œå°±å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. å…³äºç´¢å¼•æ–‡ä»¶çš„è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      hiveä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨HDFSä¸Šï¼Œå¦‚æœé‡‡ç”¨äº†åˆ—å¼å­˜å‚¨+ lzoï¼Œä¸éœ€è¦åˆ›å»ºç´¢å¼•æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡ç”¨åˆ—å¼å­˜å‚¨ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      é‚£ä¹ˆéœ€è¦ç»™å®ƒlzoæ–‡ä»¶å»ºç´¢å¼•ã€‚ç”±äºodså±‚çš„æ•°æ®æ²¡æœ‰é‡‡ç”¨åˆ—å¼å­˜å‚¨ï¼Œæ‰€ä»¥éœ€è¦å»ºç´¢å¼•æ–‡ä»¶ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;hdfsä¸Šçš„logæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå› ä¸ºhdfsä¸Šçš„logæ•°æ®æ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥odsæ–‡ä»¶è¯»å–logæ—¥å¿—æ•°æ®æ—¶ï¼Œä¹Ÿæ²¡æœ‰ç´¢å¼•æ–‡ä»¶ï¼Œæ‰€ä»¥å³ä½¿lzopæ”¯æŒåˆ‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ç‰‡,æ²¡æœ‰ç´¢å¼•æ–‡ä»¶ä¹Ÿä¸èƒ½å®ç°åˆ‡ç‰‡ï¼Œå› æ­¤éœ€è¦å•ç‹¬ç»™odsçš„ods_logæ•°æ®å»ºç´¢å¼•ï¼Œ ç”±äºæˆ‘ä»¬é€šè¿‡flumeé‡‡é›†åˆ°HDFSä¸Šçš„æ•°æ®ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ä¸€ä¸ªæ–‡ä»¶çš„å¤§å°ä¸ä¼šè¶…ï¼Œä½†æ˜¯è¿˜æ˜¯åŠ ä¸Šã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;hdfsä¸Šçš„mysqlæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šmysqlçš„æ•°æ®é€šè¿‡sqoopå¯¼å…¥åˆ°hdfsæ—¶ï¼Œè‡ªå¸¦ç´¢å¼•æ–‡ä»¶ï¼Œæ‰€ä»¥odsä»hdfsä¸Šè¯»å–mysqlæ–‡ä»¶æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         åˆ™ä¸éœ€è¦å†å•ç‹¬å»ºç´¢å¼•æ–‡ä»¶ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-åˆ›å»ºå¹¶åŠ è½½æ—¥å¿—è¡¨-ods-log" tabindex="-1"><a class="header-anchor" href="#_3-2-2-åˆ›å»ºå¹¶åŠ è½½æ—¥å¿—è¡¨-ods-log"><span>3.2.2 åˆ›å»ºå¹¶åŠ è½½æ—¥å¿—è¡¨ï¼šods_log</span></a></h4><ol><li>åˆ›å»ºæ”¯æŒlzoå‹ç¼©çš„åˆ†åŒºè¡¨</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive (gmall)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log (</span><span style="color:#98C379;--shiki-dark:#98C379;">`line`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_log&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ol start="2"><li>åŠ è½½æ•°æ®</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive (gmall)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">load</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inpath </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/origin_data/gmall/log/topic_log/2020-06-25&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> into</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><ol start="3"><li>æŸ¥çœ‹æ˜¯å¦åŠ è½½æˆåŠŸ</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive (gmall)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">limit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ol start="4"><li>ä¸ºlzoå‹ç¼©æ–‡ä»¶åˆ›å»ºç´¢å¼•</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer -Dmapreduce.job.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">queuename</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">hive</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> /warehouse/gmall/ods/ods_log/dt</span><span style="color:#98C379;--shiki-dark:#98C379;">=2020-06-25</span></span></code></pre></div><h4 id="_3-2-3-å•å¼•å·å’ŒåŒå¼•å·" tabindex="-1"><a class="header-anchor" href="#_3-2-3-å•å¼•å·å’ŒåŒå¼•å·"><span>3.2.3 å•å¼•å·å’ŒåŒå¼•å·</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. åœ¨shellä¸­ï¼Œ å•å¼•å·å’ŒåŒå¼•å·çš„åŒºåˆ«ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       aã€å…±åŒç‚¹ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       bã€ä¸åŒç‚¹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">             1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¦‚æœæœ€å¤–å±‚æ˜¯</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŒå¼•å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œåˆ™å†…éƒ¨çš„å˜é‡å€¼æˆ–è¿ç®—</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼šæ‰§è¡Œ&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">             2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¦‚æœæœ€å¤–å±‚æ˜¯</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•å¼•å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œåˆ™å†…éƒ¨çš„å˜é‡å€¼æˆ–è¿ç®—</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸ä¼šæ‰§è¡Œ&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">             3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åå¼•å·ï¼šè¡¨ç¤ºæ‰§è¡Œå‘½ä»¤</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ä¾‹å­ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      abc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      --åŒå¼•å·çš„è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;a$abc&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  =&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;a&#39;$abc&#39;&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  =&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;10&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      --å•å¼•å·çš„è¯´æ˜</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a$abc&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    =&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a$abc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&quot;$abc&quot;&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  =&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">b</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;$abc&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-4-odså±‚åŠ è½½logæ•°æ®è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_3-2-4-odså±‚åŠ è½½logæ•°æ®è„šæœ¬"><span>3.2.4 ODSå±‚åŠ è½½logæ•°æ®è„šæœ¬</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è„šæ­¥éœ€è¦è€ƒè™‘å¯¼å…¥å“ªä¸€å¤©çš„æ•°æ®ï¼Œåœ¨å®é™…å¼€å‘ä¸­ä¸€å…±æœ‰ä¸¤ç§æƒ…å†µï¼š</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">             &#39;æƒ…å†µ1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå¯¼å…¥å‰ä¸€å¤©çš„æ•°æ® </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--é»˜è®¤æƒ…å†µæ˜¯å¯¼å…¥å‰ä¸€å¤©çš„æ•°æ®</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">             &#39;æƒ…å†µ2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå¯¼å…¥æŒ‡å®šæ—¥æœŸçš„æ•°æ® </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å½“å‰å‡ å¤©çš„æ•°æ®å¯¼å…¥å¼‚å¸¸æ—¶ï¼Œéœ€è¦é‡æ–°å¯¼æŒ‡å®šæŸä¸€å¤©çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. hive å‘½ä»¤ç”¨æ³•ï¼šå¦‚ä¸‹ä¸¤ç§æ–¹å¼éƒ½ä¸ç”¨è¿›å…¥hiveçš„å®¢æˆ·ç«¯å°±å¯ä»¥æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              a. hive -e + </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;sql&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ï¼šè¡¨ç¤ºæ‰§è¡Œsqlè¯­å¥ï¼Œ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¿™ä¸ªåŒå¼•å·ä¸èƒ½çœç•¥&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              b. hive -f + æŒ‡å®šæ–‡ä»¶ä¸­çš„sqlè¯­å¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å…³äºdateè¯´æ˜</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">              date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> + %F </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">è·å–dateçš„å¹´æœˆæ—¥ï¼Œæ ¼å¼ä¸ºï¼š</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2020</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">06</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">27</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">              date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -d </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;-1 day&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> +%F </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">è¿”å›dateæ—¥æœŸçš„å‰ä¸€å¤©ï¼Œ</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2020</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">06</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">26</span></span></code></pre></div><ul><li>æ—¥æœŸçš„ä½¿ç”¨æ¡ˆä¾‹</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ date</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Sat</span><span style="color:#98C379;--shiki-dark:#98C379;"> Jun</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 27</span><span style="color:#98C379;--shiki-dark:#98C379;"> 16:36:29</span><span style="color:#98C379;--shiki-dark:#98C379;"> CST</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2020</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ date +%F</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2020-06-27</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ date -d </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;-1 day&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> +%F</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2020-06-26</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ date -d </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;yesterday&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> +%F</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2020-06-26</span></span></code></pre></div><ol><li>åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬ï¼Œ<code>æ³¨æ„è„šæœ¬çš„åå­—</code>,éœ€è¦ç¬¦åˆå‘½åè§„èŒƒ</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ vim hdfs_to_ods_log.sh</span></span></code></pre></div><ol start="2"><li>ç¼–è¾‘è„šæœ¬å†…å®¹</li></ol><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®šä¹‰å˜é‡æ–¹ä¾¿ä¿®æ”¹</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">gmall</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/opt/module/hive/bin/hive</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">hadoop</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/opt/module/hadoop-3.1.3/bin/hadoop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-n</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ] ;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">   do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">   do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">date</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;-1 day&quot; +%F`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==================</span><span style="color:#98C379;--shiki-dark:#98C379;"> æ—¥å¿—æ—¥æœŸä¸º</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $do_date</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==================</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/gmall/log/topic_log/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; into table &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;.ods_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -e </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> jar /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer -Dmapreduce.job.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">queuename</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">hive</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> /warehouse/gmall/ods/ods_log/dt</span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è„šæœ¬è¯´æ˜</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ -n å˜é‡å€¼ ]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> åˆ¤æ–­å˜é‡çš„å€¼ï¼Œæ˜¯å¦ä¸ºç©º</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å˜é‡çš„å€¼ï¼Œéç©ºï¼Œè¿”å›true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å˜é‡çš„å€¼ï¼Œä¸ºç©ºï¼Œè¿”å›false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ -z å˜é‡å€¼ ]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> åˆ¤æ–­å˜é‡çš„å€¼ï¼Œæ˜¯å¦ä¸ºç©º</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å˜é‡çš„å€¼ï¼Œéç©ºï¼Œè¿”å›false</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å˜é‡çš„å€¼ï¼Œä¸ºç©ºï¼Œè¿”å›true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">æ³¨æ„ï¼š</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[ -n å˜é‡å€¼ ]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ä¸ä¼šè§£ææ•°æ®,ä½¿ç”¨</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[ -n å˜é‡å€¼ ]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">æ—¶ï¼Œéœ€è¦å¯¹å˜é‡åŠ ä¸ŠåŒå¼•å·(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><ol start="3"><li>å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ chmod 777 ods_log.sh</span></span></code></pre></div><ol start="4"><li>æŸ¥çœ‹å¯¼å…¥æ•°æ®</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive (gmall)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-15&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> limit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="_3-3-odså±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥" tabindex="-1"><a class="header-anchor" href="#_3-3-odså±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥"><span>3.3 ODSå±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥</span></a></h3><h4 id="_3-3-1-ä¸šåŠ¡æ•°æ®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_3-3-1-ä¸šåŠ¡æ•°æ®è¯´æ˜"><span>3.3.1 ä¸šåŠ¡æ•°æ®è¯´æ˜</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 	 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. odså±‚çš„ä¸šåŠ¡æ•°æ®ï¼Œå»ºè¡¨å­—æ®µå’Œmysqlå­—æ®µå®Œå…¨ä¸€è‡´ï¼Œåªéœ€è¦åŠ ä¸€ä¸ªdtçš„åˆ†åŒºå­—æ®µï¼ŒæŒ‰ç…§å¤©è¿›è¡Œåˆ†åŒºã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">	 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆ†éš”ç¬¦éœ€è¦å’Œsqoopå¯¼å…¥æ—¶çš„åˆ†å‰²ç¬¦ä¸€è‡´ï¼Œâ€˜\tâ€™</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">	 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºæ•°æ®æ˜¯æ¯å¤©éƒ½éœ€è¦å¯¼ä¸€æ¬¡ï¼Œä½†æ˜¯æœ‰ä¸¤å¼ è¡¨ï¼šåœ°åŒºè¡¨å’Œçœä»½è¡¨åªè¦å¯¼ä¸€æ¬¡å°±å¯ä»¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">	 4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. éœ€è¦æ·±åˆ»äº†è§£æ¯å¼ è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºæ˜¯ä»€ä¹ˆæ•°æ®ã€æ¯è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. è„šæœ¬è¯´æ˜</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºåœ°åŒºè¡¨å’Œçœä»½è¡¨åªè¦ç¬¬ä¸€æ¬¡å¯¼å…¥å°±å¯ä»¥ï¼Œåç»­å°±ä¸è¦å†å¯¼å…¥äº†ã€‚åœ¨è„šæœ¬ä¸­ï¼Œä½¿ç”¨firstæ¥è¡¨ç¤ºç¬¬ä¸€æ¬¡å¯¼å…¥ï¼Œallè¡¨ç¤ºå…¶ä»–å¯¼å…¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åŒæ ·æŒ‡å®šæ•°æ®å¯¼å…¥çš„æ—¥æœŸï¼Œå¦‚æœä¼ æ—¥æœŸäº†ï¼Œåˆ™è¡¨ç¤ºå¯¼å…¥æŒ‡å®šæ—¥æœŸçš„æ•°æ®ï¼Œå¦åˆ™å¯¼å…¥å‰ä¸€å¤©çš„æ•°æ®ã€‚</span></span></code></pre></div><h4 id="_3-3-2-å»ºè¡¨è¯­å¥" tabindex="-1"><a class="header-anchor" href="#_3-3-2-å»ºè¡¨è¯­å¥"><span>3.3.2 å»ºè¡¨è¯­å¥</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.1 è®¢å•è¡¨ï¼ˆå¢é‡åŠæ›´æ–°ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_info (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `final_total_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•çŠ¶æ€&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `out_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æµæ°´å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ“ä½œæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_reduce_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `original_total_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŸä»·é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `feight_fee`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¿è´¹&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_order_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- &#39;\t&#39;ä¸ç”Ÿæˆæ•°æ®è„šæœ¬çš„ä¸€è‡´éƒ½æ˜¯&#39;\t&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å‹ç¼©æ ¼å¼æ˜¯lzop</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.2 è®¢å•è¯¦æƒ…è¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_detail;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_detail( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_price`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“æ•°é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç¼–å·&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•è¯¦æƒ…è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_order_detail/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.3 SKUå•†å“è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_sku_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_sku_info( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuId&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string   COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `price`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_desc`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“æè¿°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `weight`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é‡é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category3_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;SKUå•†å“è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_sku_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.4 ç”¨æˆ·è¡¨ï¼ˆå¢é‡åŠæ›´æ–°ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å§“å&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `birthday`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”Ÿæ—¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `gender`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ€§åˆ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `email`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é‚®ç®±&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_level`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ç­‰çº§&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ“ä½œæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_user_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.5 å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category1;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category1( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åç§°&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ä¸€çº§åˆ†ç±»è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_category1/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.6 å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category2;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category2( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    category1_id string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€çº§å“ç±»id&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“äºŒçº§åˆ†ç±»è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_category2/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.7 å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category3;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category3(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    category2_id string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äºŒçº§å“ç±»id&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ä¸‰çº§åˆ†ç±»è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_category3/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.8 æ”¯ä»˜æµæ°´è¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_payment_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_payment_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD;">   bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `out_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `alipay_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `total_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;">    decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `subject`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº¤æ˜“å†…å®¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æµæ°´è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_payment_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.9 çœä»½è¡¨ï¼ˆç‰¹æ®Šï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_province;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_province (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD;">   bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `region_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºç¼–ç &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `iso_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;isoç¼–ç ,supersetå¯è§†åŒ–ä½¿ç”¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   )  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½è¡¨&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_province/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.10 åœ°åŒºè¡¨ï¼ˆç‰¹æ®Šï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_region;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_region (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `region_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºåç§°&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   )  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºè¡¨&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_region/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.11 å“ç‰Œè¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_trademark;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_trademark (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œåç§°&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œè¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_trademark/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.12 è®¢å•çŠ¶æ€è¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•çŠ¶æ€&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿®æ”¹æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•çŠ¶æ€è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_order_status_log/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.13 SPUå•†å“è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_spu_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_spu_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuåç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category3_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œid&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;SPUå•†å“è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_spu_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.14 å•†å“è¯„è®ºè¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_comment_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_comment_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“sku&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“spu&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `appraise`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¯„ä»·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¯„ä»·æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“è¯„è®ºè¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_comment_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.15 é€€å•è¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_refund_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_refund_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_reason_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾åŸå› ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€å•è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_order_refund_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.16 åŠ è´­è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_cart_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_cart_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `cart_price`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ•°é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuåç§° (å†—ä½™)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿®æ”¹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_ordered`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦å·²ç»ä¸‹å•&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`order_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸‹å•æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç¼–å·&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŠ è´­è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_cart_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.17 å•†å“æ”¶è—è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_favor_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_favor_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_cancel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦å–æ¶ˆ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¶è—æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `cancel_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å–æ¶ˆæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“æ”¶è—è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_favor_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.18 ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆæ–°å¢åŠå˜åŒ–ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸çŠ¶æ€&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `get_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é¢†å–æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `using_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä½¿ç”¨æ—¶é—´(ä¸‹å•)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `used_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_coupon_use/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.19 ä¼˜æƒ åˆ¸è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `coupon_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `coupon_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `condition_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡é¢æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `condition_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `activity_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `benefit_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‡é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `benefit_discount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æŠ˜æ‰£&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `range_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `category3_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `limit_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿®æ”¹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  `expire_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¿‡æœŸæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_coupon_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.20 æ´»åŠ¨è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `start_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¼€å§‹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `end_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç»“æŸæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_activity_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.21 æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆå¢é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_order;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_order(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é¢†å–æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨è®¢å•å…³è”è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_activity_order/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.22 ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_rule;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_rule(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡å‡é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡å‡ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_discount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ æŠ˜æ‰£&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_level`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ çº§åˆ«&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ è§„åˆ™è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_activity_rule/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3.3.23 ç¼–ç å­—å…¸è¡¨ï¼ˆå…¨é‡ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- hive (gmall)&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_dic;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_dic(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `dic_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `dic_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–ç åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `parent_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çˆ¶ç¼–ç &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¥æœŸ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ“ä½œæ—¥æœŸ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–ç å­—å…¸è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STORED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  INPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;com.hadoop.mapred.DeprecatedLzoTextInputFormat&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  OUTPUTFORMAT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/ods/ods_base_dic/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-3-åŠ è½½æ•°ä¸šåŠ¡æ®è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_3-3-3-åŠ è½½æ•°ä¸šåŠ¡æ®è„šæœ¬"><span>3.3.3 åŠ è½½æ•°ä¸šåŠ¡æ®è„šæœ¬</span></a></h4><ol><li>åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬hdfs_to_ods_db.sh</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ vim hdfs_to_ods_db.sh</span></span></code></pre></div><ol start="2"><li>å¡«å†™è„šæœ¬å†…å®¹</li></ol><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">gmall</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/opt/module/hive/bin/hive</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-n</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ] ;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">date</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;-1 day&quot; +%F`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot; </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/order_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/order_detail/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_detail partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/sku_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_sku_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/user_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_user_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/payment_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_payment_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_category1/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category1 partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_category2/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category2 partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_category3/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category3 partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_trademark/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_trademark partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/activity_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/activity_order/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_order partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/cart_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_cart_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/comment_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_comment_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/coupon_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_coupon_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/coupon_use/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_coupon_use partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/favor_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_favor_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/order_refund_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_refund_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/order_status_log/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_status_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/spu_info/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_spu_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/activity_rule/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_rule partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_dic/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_dic partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;); </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot; </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_province/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_province;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">load data inpath &#39;/origin_data/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP</span><span style="color:#98C379;--shiki-dark:#98C379;">/db/base_region/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; OVERWRITE into table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_region;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">case</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;first&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    $hive</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql1$sql2</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">};;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;all&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    $hive</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql1</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">};;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">esac</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>ä¿®æ”¹æƒé™</li></ol><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[atguigu@hadoop102 bin]$ chmod 777 hdfs_to_ods_db.sh</span></span></code></pre></div><ol start="4"><li>åˆæ¬¡å¯¼å…¥</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ hdfs_to_ods_db.sh first 2020-06-22</span></span></code></pre></div><ol start="5"><li>æ¯æ—¥å¯¼å…¥</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ hdfs_to_ods_db.sh all 2020-06-15</span></span></code></pre></div><ol start="6"><li>æµ‹è¯•æ•°æ®æ˜¯å¦å¯¼å…¥æˆåŠŸ</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (gmall)&gt; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> from ods_order_detail where </span><span style="color:#E06C75;--shiki-dark:#E06C75;">dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-15&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h2 id="å››ã€dwdå±‚-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#å››ã€dwdå±‚-é‡ç‚¹"><span>å››ã€DWDå±‚(é‡ç‚¹)</span></a></h2><h3 id="_4-1-dwdå±‚æ•°æ®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_4-1-dwdå±‚æ•°æ®è¯´æ˜"><span>4.1 DWDå±‚æ•°æ®è¯´æ˜</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. DWDå±‚æ˜¯æ•°ä»“å»ºæ¨¡çš„æ ¸å¿ƒï¼Œå»ºæ¨¡æ¶‰åŠåˆ°ç»´åº¦å»ºæ¨¡ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”¨æˆ·è¡Œä¸ºæ•°æ®ä¸æ¶‰åŠç»´åº¦å»ºæ¨¡ã€‚ä¸šåŠ¡æ•°æ®æ‰æ¶‰åŠåˆ°ç»´åº¦å»ºæ¨¡ç†è®º  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. DWDå±‚çš„è¡¨éƒ½æ˜¯åˆ†åŒºè¡¨ï¼Œé™¤ä¸¤å¼ ç‰¹æ®Šè¡¨å’Œç”¨æˆ·æ‹‰é“¾è¡¨ä»¥å¤–</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åœ¨åˆ›å»ºDWDå±‚çš„è¡¨æ—¶ï¼Œç”±äºå‰æœŸå¯èƒ½æ˜¯ä¸çŸ¥é“æœ€åçš„ç”¨æˆ·éœ€æ±‚çš„ï¼Œéœ€è¦è®¡ç®—ä»€ä¹ˆæ ·çš„æŒ‡æ ‡ï¼Œæ‰€ä»¥æŠŠèƒ½æ”¾è¿›å»çš„å­—æ®µå°½é‡éƒ½æ”¾è¿›å»ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å‡æ˜¯åˆ›å»ºå¤–éƒ¨è¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. éœ€è¦æŒæ¡ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¦‚ä½•åˆ›å»ºè¡¨ï¼Œå³è¡¨çš„å­—æ®µæ˜¯ä»€ä¹ˆï¼Ÿ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®æ¥æºï¼Ÿ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ•°æ®çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®å­˜å‚¨æ ¼å¼ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      parquet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆåˆ—å¼å­˜å‚¨ï¼‰ + lzo</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€ç”±äºåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ˜¯éœ€è¦æŸåˆ—çš„æ‰€æœ‰æ•°æ®ï¼Œæ‰æœ‰åˆ—å¼å­˜å‚¨çš„æ–¹å¼ï¼ŒåŒä¸€åˆ—çš„æ•°æ®ç´§å¯†æ’åˆ—åœ¨ä¸€èµ·ï¼Œè¿™æ ·æé«˜äº†æŸ¥è¯¢çš„æ•ˆç‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€åˆ—å¼å­˜å‚¨çš„æ–‡ä»¶ï¼Œä¸éœ€è¦åˆ›å»ºç´¢å¼•æ–‡ä»¶ï¼Œparquetå­˜å‚¨æ–¹å¼æ”¯æŒåˆ‡ç‰‡ã€‚</span></span></code></pre></div><h3 id="_4-2-dwdç”¨æˆ·è¡Œä¸ºæ—¥å¿—è§£æ" tabindex="-1"><a class="header-anchor" href="#_4-2-dwdç”¨æˆ·è¡Œä¸ºæ—¥å¿—è§£æ"><span>4.2 DWDç”¨æˆ·è¡Œä¸ºæ—¥å¿—è§£æ</span></a></h3><h4 id="_4-2-1-è¡Œä¸ºæ•°æ®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_4-2-1-è¡Œä¸ºæ•°æ®è¯´æ˜"><span>4.2.1 è¡Œä¸ºæ•°æ®è¯´æ˜</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. odså±‚çš„æ—¥å¿—æ•°æ®ï¼Œå­˜å‚¨åœ¨ä¸€åˆ—ä¸­ï¼Œæ•°æ®æ ¼å¼ä¸ºï¼šjsonæ ¼å¼</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ—¥å¿—æ•°æ®åˆ†ç±»ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¯åŠ¨æ—¥å¿—&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåŒ…å«å…¬å…±å­—æ®µã€å¯åŠ¨ä¿¡æ¯ã€é”™è¯¯ä¿¡æ¯ã€å¯åŠ¨æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é¡µé¢åŸ‹ç‚¹æ—¥å¿—&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåŒ…å«å…¬å…±å­—æ®µã€åŠ¨ä½œæ•°æ®ã€æ›å…‰æ•°æ®ã€é¡µé¢æ•°æ®ã€é”™è¯¯ä¿¡æ¯ã€å½“å‰é¡µé¢è·³å…¥æ—¶é—´</span></span></code></pre></div><p>![image-20200705221707581](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705221707.png)</p><p>![image-20200705221840943](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200705221841.png)</p><h4 id="_4-2-2-è¡Œä¸ºæ•°æ®è§£ææ€è·¯" tabindex="-1"><a class="header-anchor" href="#_4-2-2-è¡Œä¸ºæ•°æ®è§£ææ€è·¯"><span>4.2.2 è¡Œä¸ºæ•°æ®è§£ææ€è·¯</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. æ€è·¯ï¼šä¸ºæ–¹ä¾¿åç»­çš„æ•°æ®åˆ†æï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ—¥å¿—è§£æåˆ°å¯åŠ¨ã€é¡µé¢ã€åŠ¨ä½œã€æ›å…‰ã€é”™è¯¯äº”å¼ è¡¨ä¸­ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ¯å¼ è¡¨å¤„ç†çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. å„å¼ è¡¨çš„è®¾è®¡å¦‚ä¸‹ï¼š      </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¯åŠ¨æ—¥å¿—è§£æ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             å¯åŠ¨æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€å¯åŠ¨ä¿¡æ¯ã€å¯åŠ¨æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡å¯åŠ¨æ—¥å¿—ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;start&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªå¯åŠ¨è®°å½•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      **************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é¡µé¢æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             é¡µé¢æ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;page&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªé¡µé¢è®¿é—®è®°å½•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      *****************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åŠ¨ä½œæ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€åŠ¨ä½œæ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œç”±äºåœ¨æ—¥å¿—æ•°æ®ä¸­ï¼Œä¸€è¡Œæ•°æ®ä»£è¡¨ç€è¿™ä¸ªé¡µé¢çš„æ‰€æœ‰æ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ‰€ä»¥ï¼Œä¸€è¡Œæ•°æ®å¯èƒ½ä¼šæœ‰å¤šä¸ªåŠ¨ä½œï¼Œéœ€è¦è¿›è¡Œåˆ†è§£æˆå¤šä¸ªåŠ¨ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨åœ¨ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      *****************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ›å…‰æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€æ›å…‰æ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;displays&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œç”±äºåœ¨æ—¥å¿—æ•°æ®ä¸­ï¼Œä¸€è¡Œæ•°æ®ä»£è¡¨ç€è¿™ä¸ªé¡µé¢çš„æ‰€æœ‰</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ›å…‰æ•°æ®ï¼Œæ‰€ä»¥ï¼Œä¸€è¡Œæ•°æ®å¯èƒ½ä¼šæœ‰å¤šä¸ªæ›å…‰ï¼Œéœ€è¦è¿›è¡Œåˆ†è§£æˆå¤šä¸ªåŠ¨ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨åœ¨ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæ›å…‰æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      *****************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é”™è¯¯æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€æ›å…‰æ•°æ®ã€åŠ¨ä½œæ•°æ®ï¼Œé¡µé¢æ•°æ®ã€æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®å’Œå¯åŠ¨æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;err&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œæˆ‘ä»¬ä¼šå°†è¿™ä¸ªé¡µé¢çš„æ›å…‰æ•°æ®å°è£…æˆä¸€åˆ—ï¼Œé¡µé¢</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ•°æ®ã€åŠ¨ä½œæ•°æ®éƒ½åŒ…è£…æˆä¸€åˆ—æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®å¯¹åº”ä¸€ä¸ªé”™è¯¯è®°å½•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. ä»å¦‚ä¸Šçš„è®¾è®¡æ€è·¯ï¼Œé‚£ä¹ˆæœ‰å¦‚ä¸‹ä¸‰ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">          1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. jsonæ•°æ®å¦‚ä½•è¿›è¡Œè§£æ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">          2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸€è¡Œå¤šä¸ªactionåŠ¨ä½œäº‹ä»¶å¦‚ä½•æ‹†åˆ†æˆå¤šè¡Œæ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">          3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸€è¡Œå¤šä¸ªactionåŠ¨ä½œäº‹ä»¶å¦‚ä½•åŒ…è£…æˆä¸€åˆ—æ•°æ®ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-3-jsonæ•°æ®è§£æ" tabindex="-1"><a class="header-anchor" href="#_4-2-3-jsonæ•°æ®è§£æ"><span>4.2.3 jsonæ•°æ®è§£æ</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å‡½æ•°ï¼šget_json_object(jsonå¯¹è±¡ï¼Œéœ€è¦è·å–çš„å­—æ®µ)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å‚æ•°1ï¼šjsonå¯¹è±¡,å­—ç¬¦ä¸²ç±»å‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;å¯ä»¥æ˜¯ä¸€ä¸ªjsonï¼Œä¹Ÿå¯ä»¥æ˜¯jsonæ•°ç»„&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä¾‹ï¼š</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         -- aã€ä¸€ä¸ªjson</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         {</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzp&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         -- bã€jsonæ•°ç»„ </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">         [{&quot;name&quot;:&quot;lzp&quot;,&quot;age&quot;:10},{&quot;name&quot;:&quot;ryx&quot;,&quot;age&quot;:5}]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. å‚æ•°2ï¼šéœ€è¦è·å–çš„å­—æ®µï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚ä¸Šæ¡ˆä¾‹ï¼Œéœ€è¦è·å–ç¬¬ä¸€ä¸ªjsonå¯¹è±¡çš„nameçš„valueå€¼ï¼Œæ­¤æ—¶å‚æ•°2çš„å€¼ä¸ºï¼š</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- aã€ä¸€ä¸ªjson</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;$.name&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         -- bã€jsonæ•°ç»„ </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">         &quot;$[0].name&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. å¦‚ä¸Šæ¡ˆä¾‹çš„ä½¿ç”¨æ–¹å¼</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       get_json_object(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;{&quot;name&quot;:&quot;lzp&quot;,&quot;age&quot;:10}&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;$.name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">lzp</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       get_json_object(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;[{&quot;name&quot;:&quot;lzp&quot;,&quot;age&quot;:10},{&quot;name&quot;:&quot;ryx&quot;,&quot;age&quot;:5}]&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;$[1].name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">lzp</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. æ³¨æ„äº‹é¡¹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       aã€ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯éœ€è¦ä¼ é€’å­—ç¬¦ä¸²ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå•å¼•å·å’ŒåŒå¼•å·éƒ½å¯ä»¥ï¼Œä¸è¿‡ä¸ºé¿å…åµŒå¥—çš„é—®é¢˜ï¼Œå»ºè®®jsonæ•°æ®ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          å•å¼•å·ï¼Œåé¢çš„å–å€¼ä½¿ç”¨åŒå¼•å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       bã€jsonæ•°ç»„çš„è§’æ ‡ä»</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;0&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">å¼€å§‹è®¡ç®—ã€‚  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. å®é™…æ•°æ®</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">json</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;common&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:{</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ar&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;370000&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ba&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Huawei&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ch&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;oppo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;md&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Huawei Mate 30&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;mid&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;mid_633&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Android 9.0&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;156&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;vc&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;v2.1.134&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">},</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;start&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;entry&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;icon&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;loading_time&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">11342</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;open_ad_id&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;open_ad_ms&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">6391</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;open_ad_skip_ms&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3578</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">},</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ts&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1591113606000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">get_json_object(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;json&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;$.common.ar&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 370000</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-4-è‡ªå®šä¹‰å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4-2-4-è‡ªå®šä¹‰å‡½æ•°"><span>4.2.4 è‡ªå®šä¹‰å‡½æ•°</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ä¸€è¡Œå˜å¤šè¡Œï¼šUDTF</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;åŠ¨ä½œæ•°æ®è¡¨å’Œæ›å…‰æ•°æ®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      åœ¨odså±‚ï¼Œä¸€è¡Œæ•°æ®ä¸­ï¼Œactionå’Œdisplaysæ•°æ®æ˜¯ä¸€ä¸ªjsonæ•°ç»„ï¼Œä¸€ä¸ªjsonå¯¹è±¡åŒ…å«ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†ä¸€è¡Œæ•°æ®è½¬æ¢æˆä¸º</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å¤šè¡Œæ•°æ®ï¼Œè½¬æ¢åçš„ä¸€è¡Œæ•°æ®è¡¨ç¤ºä¸€ä¸ªåŠ¨ä½œäº‹ä»¶æˆ–è€…æ˜¯æ›å…‰äº‹ä»¶ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ä¸€è¡Œå˜ä¸€è¡Œï¼šUDF</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">       &#39;é”™è¯¯æ•°æ®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       åœ¨odså±‚ï¼Œactionå’Œdisplaysæ•°æ®æ˜¯ä¸€ä¸ªjsonæ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªjsonæ•°æ®è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­ä¸ºstructç±»å‹ï¼Œä¸€ä¸ªstruct</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       ä»£è¡¨ä¸€ä¸ªåŠ¨ä½œäº‹ä»¶æˆ–è€…æ›å…‰äº‹ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¾¿äºå–æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. è‡ªå®šä¹‰å‡½æ•°çš„è¯¦ç»†æ­¥éª¤è§æ–‡æ¡£ï¼šhiveè‡ªå®šä¹‰å‡½æ•°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. å®Œæˆè‡ªå®šä¹‰å‡½æ•°ä»¥åéœ€è¦å¯¹å‡½æ•°è¿›è¡Œæ³¨å†Œ</span></span></code></pre></div><h4 id="_4-2-5-æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4-2-5-æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°"><span>4.2.5 æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    aã€å¦‚æœåˆ›å»ºçš„è‡ªå®šä¹‰å‡½æ•°æ˜¯ä¸´æ—¶å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¸å±äºæŸä¸€ä¸ªæ•°æ®åº“ï¼Œåœ¨ä»»ä½•æ•°æ®åº“ä¸­å‡å¯ä»¥ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    bã€å¦‚æœåˆ›å»ºçš„è‡ªå®šä¹‰å‡½æ•°æ˜¯æ°¸ä¹…å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å±äºå½“å‰æ•°æ®åº“ï¼Œå¦‚æœéœ€è¦åœ¨å…¶ä»–æ•°æ®åº“ä¸­ä½¿ç”¨ï¼Œéœ€è¦å¸¦ä¸Šæ•°æ®åº“çš„åå­—ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å¦‚æœä¿®æ”¹äº†è‡ªå®šä¹‰å‡½æ•°é‡æ–°ç”ŸæˆjaråŒ…æ€ä¹ˆå¤„ç†ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    åªéœ€è¦æ›¿æ¢HDFSè·¯å¾„ä¸Šçš„æ—§jaråŒ…ï¼Œç„¶åé‡å¯Hiveå®¢æˆ·ç«¯å³å¯ã€‚</span></span></code></pre></div><ol><li>æ‰“åŒ…</li><li>å°†hivefunction-1.0-SNAPSHOT.jarä¸Šä¼ åˆ°hadoop102çš„/opt/moduleï¼Œç„¶åå†å°†è¯¥jaråŒ…ä¸Šä¼ åˆ°HDFSçš„/user/hive/jarsè·¯å¾„ä¸‹</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ hadoop fs -mkdir -p /user/hive/jars</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 module]$ hadoop fs -put hivefunction-1.0-SNAPSHOT.jar /user/hive/jars</span></span></code></pre></div><ol start="3"><li>åˆ›å»ºæ°¸ä¹…å‡½æ•°ä¸å¼€å‘å¥½çš„java classå…³è”</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (gmall)&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#98C379;--shiki-dark:#98C379;"> explode_json_array</span><span style="color:#98C379;--shiki-dark:#98C379;"> as</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;com.atguigu.hive.udtf.ExplodeJSONArray&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span><span style="color:#98C379;--shiki-dark:#98C379;"> jar</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;hdfs://hadoop102:8020/user/hive/jars/hivefunction-1.0-SNAPSHOT.jar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--</span><span style="color:#98C379;--shiki-dark:#98C379;"> è¯­æ³•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#98C379;--shiki-dark:#98C379;"> å‡½æ•°å</span><span style="color:#98C379;--shiki-dark:#98C379;"> as</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;è‡ªå®šä¹‰å‡½æ•°å…¨ç±»å&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span><span style="color:#98C379;--shiki-dark:#98C379;"> jar</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;hdfsçš„è·¯å¾„&#39;</span></span></code></pre></div><h4 id="_4-2-6-å¯åŠ¨æ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-2-6-å¯åŠ¨æ—¥å¿—è¡¨"><span>4.2.6 å¯åŠ¨æ—¥å¿—è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --1. &#39;å¯åŠ¨æ—¥å¿—è§£æ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             å¯åŠ¨æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€å¯åŠ¨ä¿¡æ¯ã€å¯åŠ¨æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡å¯åŠ¨æ—¥å¿—ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;start&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªå¯åŠ¨è®°å½•</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. åˆ†åŒºè¡¨ï¼šæ¯ä¸ªåˆ†åŒºä¸ºå½“å¤©çš„å¯åŠ¨æ—¥å¿—æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. è§£å†³ç´¢å¼•æ–‡ä»¶è¢«å½“æˆæ•°æ®çš„æ–¹å¼ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span></code></pre></div><p>![image-20200706001851147](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200706001851.png)</p><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_start_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_start_log(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `brand`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `channel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `model`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `mid_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `os`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `version_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `entry`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `loading_time`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_ms`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_skip_ms`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `ts`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_start_log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TBLPROPERTIES(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;parquet.compression&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;lzo&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ•°æ®æ’å…¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- odså±‚æœ‰lzoå’Œindexæ–‡ä»¶</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é»˜è®¤HiveInputFormat</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¼šæŠŠç´¢å¼•æ–‡ä»¶å½“ä½œè¾“å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¸€èˆ¬æƒ…å†µä¸‹, ä¼šæŠŠç´¢å¼•æ–‡ä»¶è½¬æ¢æˆnullçš„æ–‡ä»¶, ä½†æ˜¯ç”±äºåŒ…çš„åŸå› , ä¼šè¯†åˆ«æˆç´¢å¼•æ–‡ä»¶</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.CombineHiveInputFormat</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_start_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ba&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ch&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.md&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.mid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.os&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.uid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.vc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.entry&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.loading_time&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_ms&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_skip_ms&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">is not null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-7-é¡µé¢æ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-2-7-é¡µé¢æ—¥å¿—è¡¨"><span>4.2.7 é¡µé¢æ—¥å¿—è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 1. é¡µé¢æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             é¡µé¢æ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;page&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªé¡µé¢è®¿é—®è®°å½•</span></span></code></pre></div><p>![image-20200706002327821](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200706002328.png)</p><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_page_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_page_log(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `brand`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `channel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `model`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `mid_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `os`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `version_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `during_time`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `last_page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `ts`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_page_log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TBLPROPERTIES(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;parquet.compression&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;lzo&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ•°æ®å¯¼å…¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_page_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ba&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ch&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.md&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.mid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.os&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.uid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.vc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.during_time&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.last_page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.sourceType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-125&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">is not null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-8-åŠ¨ä½œæ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-2-8-åŠ¨ä½œæ—¥å¿—è¡¨"><span>4.2.8 åŠ¨ä½œæ—¥å¿—è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   --1. åŠ¨ä½œæ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€åŠ¨ä½œæ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œç”±äºåœ¨æ—¥å¿—æ•°æ®ä¸­ï¼Œä¸€è¡Œæ•°æ®ä»£è¡¨ç€è¿™ä¸ªé¡µé¢çš„æ‰€æœ‰æ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ‰€ä»¥ï¼Œä¸€è¡Œæ•°æ®å¯èƒ½ä¼šæœ‰å¤šä¸ªåŠ¨ä½œï¼Œéœ€è¦è¿›è¡Œåˆ†è§£æˆå¤šä¸ªåŠ¨ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨åœ¨ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæ“ä½œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    --2. ä¸€è¡Œå˜å¤šè¡Œï¼Œè‡ªå®šä¹‰UDTFå‡½æ•°explode_json_arrayï¼Œä½¿ç”¨ </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       lateral view explode_json_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.actions&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) tmp </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> action</span></span></code></pre></div><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_action_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_action_log(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `brand`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `channel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `model`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `mid_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `os`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `version_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `during_time`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `last_page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `action_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `ts`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_action_log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TBLPROPERTIES(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;parquet.compression&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;lzo&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_action_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ba&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ch&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.md&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.mid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.os&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.uid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.vc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.during_time&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.last_page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.sourceType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.action_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log lateral view explode_json_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.actions&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) tmp </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> action</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.actions&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">is not null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-9-æ›å…‰æ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-2-9-æ›å…‰æ—¥å¿—è¡¨"><span>4.2.9 æ›å…‰æ—¥å¿—è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  --1. æ›å…‰æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€é¡µé¢æ•°æ®ã€æ›å…‰æ•°æ®ã€è·³å…¥å½“å‰é¡µé¢æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;displays&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œç”±äºåœ¨æ—¥å¿—æ•°æ®ä¸­ï¼Œä¸€è¡Œæ•°æ®ä»£è¡¨ç€è¿™ä¸ªé¡µé¢çš„æ‰€æœ‰</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ›å…‰æ•°æ®ï¼Œæ‰€ä»¥ï¼Œä¸€è¡Œæ•°æ®å¯èƒ½ä¼šæœ‰å¤šä¸ªæ›å…‰ï¼Œéœ€è¦è¿›è¡Œåˆ†è§£æˆå¤šä¸ªåŠ¨ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®ä»£è¡¨åœ¨ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæ›å…‰æ•°æ®</span></span></code></pre></div><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_display_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_display_log(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `brand`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `channel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `model`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `mid_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `os`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `version_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `during_time`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `last_page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `ts`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `display_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_display_log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TBLPROPERTIES(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;parquet.compression&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;lzo&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_display_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ba&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ch&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.md&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.mid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.os&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.uid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.vc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.during_time&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.last_page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.sourceType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(displays,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.displayType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(displays,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(displays,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(displays,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.order&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log lateral view explode_json_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.displays&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) tmp </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> displays</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.displays&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">is not null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-10-é”™è¯¯æ—¥å¿—è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-2-10-é”™è¯¯æ—¥å¿—è¡¨"><span>4.2.10 é”™è¯¯æ—¥å¿—è¡¨</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    --1. é”™è¯¯æ—¥å¿—è§£æ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„å­—æ®µæ€ä¹ˆåˆ›å»ºï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             åŠ¨ä½œæ—¥å¿—æ•°æ®åŒ…å«ï¼šå…¬å…±å­—æ®µã€æ›å…‰æ•°æ®ã€åŠ¨ä½œæ•°æ®ï¼Œé¡µé¢æ•°æ®ã€æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨çš„æ•°æ®æ¥æºå“ªé‡Œï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              é€šè¿‡é¡µé¢åŸ‹ç‚¹æ•°æ®å’Œå¯åŠ¨æ•°æ®ä¸­è·å–ï¼Œå¹¶é€šè¿‡è¿‡æ»¤åŒ…å«</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;err&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">çš„å­—æ ·æ¥è·å–ï¼Œæˆ‘ä»¬ä¼šå°†è¿™ä¸ªé¡µé¢çš„æ›å…‰æ•°æ®å°è£…æˆä¸€åˆ—ï¼Œé¡µé¢</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              æ•°æ®ã€åŠ¨ä½œæ•°æ®éƒ½åŒ…è£…æˆä¸€åˆ—æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          cã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¡¨ä¸­ä¸€è¡Œæ•°æ®ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              ä¸€è¡Œæ•°æ®å¯¹åº”ä¸€ä¸ªé”™è¯¯è®°å½•</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     -- 2.ä½¿ç”¨UDFå‡½æ•°:json_array_to_struct_array</span></span></code></pre></div><ul><li>å»ºè¡¨:</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_error_log;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_error_log(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `brand`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `channel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `model`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `mid_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `os`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `version_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_item_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `last_page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `page_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `entry`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `loading_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_ms`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string, </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `open_ad_skip_ms`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `actions`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> array</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">struct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">action_id:string,item:string,item_type:string,ts:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `displays`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> array</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">struct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">display_type:string,item:string,item_type:string,</span><span style="color:#98C379;--shiki-dark:#98C379;">`order`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `ts`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `error_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `msg`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">LOCATION</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_error_log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TBLPROPERTIES(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;parquet.compression&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;lzo&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è§£é‡Š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hiveçš„ç»“æ„ä½“æ•°ç»„å£°æ˜</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`actions`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> array</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">struct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">action_id:string,item:string,item_type:string,ts:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`displays`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> array</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">struct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">display_type:string,item:string,item_type:string,</span><span style="color:#98C379;--shiki-dark:#98C379;">`order`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">array</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">map</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">string,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">bigint</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">struct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">id:id, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:string, age:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_error_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ar&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ba&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.ch&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.md&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.mid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.os&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.uid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.common.vc&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.last_page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.page_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.page.sourceType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.entry&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.loading_time&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_ms&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.start.open_ad_skip_ms&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    json_array_to_struct_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.actions&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action_id:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ts:bigint&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    json_array_to_struct_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.displays&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;displayType&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;order&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;display_type:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;order:int&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.err.error_code&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.err.msg&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_log </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.err&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">is not null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è§£é‡Š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">json_array_to_struct_array(get_json_object(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;$.actions&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action_id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ts&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;action_id:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;item_type:string&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ts:bigint&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">åœ¨æ€»å…±çš„å­—æ®µä¸­é€‰æ‹©éœ€è¦çš„å­—æ®µ, æ­¤æ—¶å‰é¢çš„å­—æ®µ(å‚æ•°)ç”¨æ¥æŒ‡å®š, åé¢å¯¹åº”çš„å­—æ®µ(å‚æ•°)ç”¨æ¥æ•°æ®å¤„ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-11-dwdå±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®åŠ è½½è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_4-2-11-dwdå±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®åŠ è½½è„šæœ¬"><span>4.2.11 DWDå±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®åŠ è½½è„šæœ¬</span></a></h4><ol><li>åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ vim ods_to_dwd_log.sh</span></span></code></pre></div><ol start="2"><li>åœ¨è„šæœ¬ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹</li></ol><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/opt/module/hive/bin/hive</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">gmall</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-n</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ] ;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">date</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;-1 day&quot; +%F`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">SET mapreduce.job.queuename=hive;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">SETÂ hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_start_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ar&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ba&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ch&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.md&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.mid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.os&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.uid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.vc&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.entry&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.loading_time&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_ms&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_skip_ms&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.ts&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_log</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">and get_json_object(line,&#39;$.start&#39;) is not null;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_action_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ar&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ba&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ch&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.md&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.mid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.os&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.uid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.vc&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.during_time&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.last_page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.sourceType&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(action,&#39;$.action_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(action,&#39;$.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(action,&#39;$.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(action,&#39;$.ts&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_log lateral view ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.explode_json_array(get_json_object(line,&#39;$.actions&#39;)) tmp as action</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">and get_json_object(line,&#39;$.actions&#39;) is not null;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_display_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ar&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ba&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ch&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.md&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.mid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.os&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.uid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.vc&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.during_time&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.last_page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.sourceType&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.ts&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(displays,&#39;$.displayType&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(displays,&#39;$.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(displays,&#39;$.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(displays,&#39;$.order&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_log lateral view ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.explode_json_array(get_json_object(line,&#39;$.displays&#39;)) tmp as displays</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">and get_json_object(line,&#39;$.displays&#39;) is not null;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_page_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ar&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ba&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ch&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.md&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.mid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.os&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.uid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.vc&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.during_time&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.last_page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.sourceType&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.ts&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_log</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">and get_json_object(line,&#39;$.page&#39;) is not null;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_error_log partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ar&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ba&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.ch&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.md&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.mid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.os&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.uid&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.common.vc&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.item_type&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.last_page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.page_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.page.sourceType&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.entry&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.loading_time&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_id&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_ms&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.start.open_ad_skip_ms&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.json_array_to_struct_array(get_json_object(line,&#39;$.actions&#39;), &#39;action_id&#39;,&#39;item&#39;,&#39;item_type&#39;,&#39;ts&#39;,&#39;action_id:string&#39;,&#39;item:string&#39;,&#39;item_type:string&#39;,&#39;ts:bigint&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.json_array_to_struct_array(get_json_object(line,&#39;$.displays&#39;), &#39;displayType&#39;,&#39;item&#39;,&#39;item_type&#39;,&#39;order&#39;,&#39;display_type:string&#39;,&#39;item:string&#39;,&#39;item_type:string&#39;,&#39;order:int&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.ts&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.err.error_code&#39;),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    get_json_object(line,&#39;$.err.msg&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_log </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">and get_json_object(line,&#39;$.err&#39;) is not null;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -e </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-dwdä¸šåŠ¡æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_4-3-dwdä¸šåŠ¡æ•°æ®"><span>4.3 DWDä¸šåŠ¡æ•°æ®</span></a></h3><h4 id="_4-3-1-ä¸šåŠ¡å»ºæ¨¡è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_4-3-1-ä¸šåŠ¡å»ºæ¨¡è¯´æ˜"><span>4.3.1 ä¸šåŠ¡å»ºæ¨¡è¯´æ˜</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- DWDå±‚çš„æ•°æ®éƒ½æ˜¯åˆ†åŒºè¡¨,åœ°åŒºè¡¨ã€æ—¶é—´è¡¨ã€ç”¨æˆ·è¡¨ï¼Œè¿™ä¸‰ä¸ªç»´åº¦è¡¨ä¸æ˜¯åˆ†åŒºè¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. DWDç»´åº¦å»ºæ¨¡çš„4ä¸ªæ­¥éª¤</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šäº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å£°æ˜ç²’åº¦&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ ¹æ®æœ€å°ç²’åº¦é€‰æ‹©å…·ä½“çš„äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¡®å®šç»´åº¦&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šæ¯ä¸ªäº‹å®è¡¨ç›¸å…³çš„ç»´åº¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¡®å®šäº‹å®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šæ¯ä¸ªäº‹å®è¡¨çš„åº¦é‡å€¼</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;ç»´åº¦å»ºæ¨¡ç†è®ºåªé€‚ç”¨äºäº‹å®è¡¨&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æœ¬é¡¹ç›®ä¸­æœ‰å“ªäº›ç»´åº¦è¡¨ï¼Œæœ‰å“ªäº›äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç»´åº¦è¡¨ï¼š6å¼ ï¼šç”¨æˆ·ã€æ—¶é—´ã€åœ°åŒºã€å•†å“ã€æ´»åŠ¨ã€ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         äº‹å®è¡¨ï¼š8å¼ ï¼šåŠ è´­ã€æ”¶è—ã€è®¢å•æ˜ç»†ã€é€€å•ã€è¯„ä»·ã€æ”¯ä»˜ã€è®¢å•ã€ä¼˜æƒ åˆ¸é¢†ç”¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. DWDå±‚çš„ç»´åº¦è¡¨å¦‚ä½•ç¡®å®šï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤1ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¡®å®šè¡¨çš„å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä»ODSå±‚æ‰¾åˆ°å’Œè¿™ä¸ªç»´åº¦ç›¸å…³æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œç„¶åè·å–è¿™äº›è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºç»´åº¦è¡¨çš„å­—æ®µ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤2ï¼š</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¡®å®šæ¯ä¸ªåˆ†åŒºä¸­å­˜å‚¨çš„æ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¹Ÿå°±æ˜¯åŒæ­¥ç­–ç•¥ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ç»´åº¦è¡¨éƒ½æ˜¯å…¨é‡è¡¨:ï¼Œå› ä¸ºæ˜¯å¯¹è¯¥ç»´åº¦çš„è¯¦æƒ…æè¿°ï¼Œæ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             é‡ä¸ä¼šå¤ªå¤§ï¼ŒåŒæ—¶æ–°å¢åŠå˜æ›´çš„é¢‘ç‡ä¹Ÿæ¯”è¾ƒå°‘ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. DWDå±‚çš„äº‹å®è¡¨å¦‚ä½•åˆ›å»ºï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤1ï¼šç¡®å®šç»´åº¦ï¼šæ ¹æ®å®é™…éœ€æ±‚ï¼Œç¡®å®šå’Œè¯¥äº‹å®è¡¨ç›¸å…³çš„æ‰€æœ‰ç»´åº¦ï¼›</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤2ï¼šç¡®å®šç›¸å…³è¡¨ï¼šä»odså±‚ç¡®å®šå’Œäº‹å®è¡¨ç›¸å…³çš„è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤3ï¼šç¡®å®šåº¦é‡å€¼ï¼šå°†æ­¥éª¤2ä¸­æ‰€æœ‰ç›¸å…³è¡¨çš„åº¦é‡å€¼ä½œä¸ºäº‹å®è¡¨åº¦é‡å€¼</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ­¥éª¤4ï¼šç¡®å®šå­—æ®µï¼šåº¦é‡å€¼ + ç»´åº¦è¡¨çš„å…³è”å¤–é”® + ç›¸å…³ç»´åº¦è¡¨çš„å…¶ä»–å­—æ®µï¼ˆä¿ç•™ç›¸å…³æ­¥éª¤2ä¸­çš„å­—æ®µï¼Œä»¥ä¾¿åé¢è®¡ç®—çš„ä½¿ç”¨ï¼‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. DWDå±‚äº‹å®è¡¨åŒæ­¥ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. äº‹åŠ¡å‹äº‹å®è¡¨ï¼šè®¢å•æ˜ç»†ã€é€€å•ã€æ”¯ä»˜ã€è¯„ä»·</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">         &#39;åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ–°å¢è¡¨</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">         &#39;åˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå½“å¤©æ–°å¢çš„æ•°æ®</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">         &#39;é€‚ç”¨èŒƒå›´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ•°æ®åªæœ‰æ–°å¢ï¼Œæ—§æ•°æ®ä¸ä¼šå‡ºç°å˜æ›´çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ï¼šåŠ è´­ã€æ”¶è—</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå…¨é‡è¡¨</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;åˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ¯å¤©ä¸€ä¸ªå¿«ç…§ï¼Œæ•°æ®ä¸ºæ‰€æœ‰æ•°æ®</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;é€‚ç”¨èŒƒå›´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåªå…³å¿ƒå½“å¤©æ•°æ®çš„æœ€ç»ˆç»“æœï¼Œä¸å…³æ³¨ä¸­é—´è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;è¯´æ˜&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šåœ¨å¼€å‘ä¸­ï¼Œä¼šæ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚ï¼Œå®šæœŸæ¸…ç†éƒ¨åˆ†åˆ†åŒºçš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç´¯è®¡å‹å¿«ç…§äº‹å®è¡¨ï¼šä¼˜æƒ åˆ¸é¢†ç”¨ã€è®¢å•äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;åŒæ­¥ç­–ç•¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ–°å¢åŠå˜åŒ–è¡¨</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;åˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå½“å¤©æ–°å¢çš„æ•°æ®ï¼ŒåŒæ—¶å¦‚æœæœ‰å˜åŒ–çš„æ•°æ®ï¼Œä¼šå°†æ—§æ•°æ®è¿›è¡Œæ›´æ–°</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          &#39;é€‚ç”¨èŒƒå›´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šé€‚åˆä¸€æ¬¡æ€§å†™ä¸å®Œçš„äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. DWDå±‚è¡¨çš„æ•°æ®æ¥æºï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ¥æºäºODSå±‚ï¼Œæ‰€ä»¥DWDå±‚äº‹å®è¡¨ä¸ODSå±‚æ•°æ®åŒæ­¥ç­–ç•¥ä¸€è‡´ï¼Œè€ŒODSå±‚çš„æ•°æ®å’Œå¯¼å…¥åˆ°HDFSä¸Šçš„ç­–ç•¥ä¿æŒä¸€è‡´ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä¸åŒçš„åŒæ­¥ç­–ç•¥æ•°æ®å¯¼å…¥çš„ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å…¨é‡ç­–ç•¥ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ï¼Œè¡¨ç¤ºmysqlæ•°æ®åº“ä¸­çš„æ•°æ®å…¨éƒ¨è¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ–°å¢åŠå˜åŒ–ç­–ç•¥ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> create_time</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$do_date </span><span style="color:#C678DD;--shiki-dark:#C678DD;">or</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> operate_time</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$do_dateï¼Œè¡¨ç¤ºåˆ›å»ºæ—¶é—´æˆ–æœ€æ–°çš„æ›´æ–°æ—¶é—´ç­‰äºæŒ‡å®šæ—¥æœŸ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ–°å¢ç­–ç•¥ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> create_time</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$do_dateï¼Œè¡¨ç¤ºåªè¦ä»Šå¤©æ–°å¢çš„æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 7. ç»´åº¦è¡¨å’Œäº‹å®è¡¨æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç»´åº¦è¡¨ï¼šä¸€èˆ¬æ˜¯å…¨é‡è¡¨ï¼Œæ‰€ä»¥åœ¨odså±‚å’Œç»´åº¦ç›¸å…³çš„è¡¨ä¸€èˆ¬ä¹Ÿéƒ½æ˜¯å…¨é‡è¡¨ï¼Œæ‰€ä»¥ç›´æ¥è·å–odså±‚å½“å¤©çš„åˆ†åŒºæ•°æ®ä½œä¸ºç»´åº¦è¡¨åˆ†åŒºçš„æ•°æ®</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">                &#39;ç‰¹ä¾‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                aã€åœ°åŒºè¡¨ã€æ—¶é—´è¡¨åªéœ€è¦å¯¼å…¥ä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªç»´åº¦è¡¨ä¸æ˜¯åˆ†åŒºè¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                bã€ç”¨æˆ·ç»´åº¦è¡¨é‡‡ç”¨æ‹‰é“¾è¡¨ï¼ŒåŸå› ã€æ•°æ®ç»´æŠ¤æ–¹å¼åé¢è¯¦ç»†è¯´ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. äº‹å®è¡¨ï¼šä¸åŒäº‹å®è¡¨ç»´æŠ¤çš„ç­–ç•¥ä¸åŒ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">               &#39;äº‹åŠ¡å‹äº‹å®è¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:è·å–odså±‚ç›¸å…³è¡¨çš„æœ€æ–°åˆ†åŒºçš„æ•°æ®ï¼Œç›´æ¥åŠ åˆ°dwdå±‚æœ€æ–°åˆ†åŒºä¸­</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">               &#39;å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šè·å–odså±‚ç›¸å…³è¡¨çš„æœ€æ–°åˆ†åŒºçš„æ•°æ®ï¼Œç›´æ¥åŠ åˆ°dwdå±‚æœ€æ–°åˆ†åŒºä¸­</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">               &#39;ç´¯è®¡å‹å¿«ç…§äº‹å®è¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šè·å–odså±‚ç›¸å…³è¡¨çš„æœ€æ–°åˆ†åŒºçš„æ•°æ®ï¼Œä¿®æ”¹å˜åŒ–æ•°æ®æ‰€åœ¨åˆ†åŒºçš„æ•°æ®ï¼Œæ–°å¢çš„æ•°æ®ç›´æ¥æ·»åŠ åˆ°æ–°åˆ†åŒºä¸­</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 8. æ•°æ®å­˜å‚¨æ ¼å¼ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">       parquet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> + lzo</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       ç‰¹æ®Šè¡¨ï¼šåœ°åŒºå’Œæ—¶é—´è¡¨ï¼Œä¸ä½¿ç”¨åˆ†åŒºè¡¨ï¼Œä¹Ÿä¸ä½¿ç”¨lzoå‹ç¼©ï¼Œå› ä¸ºä½¿ç”¨å‹ç¼©æ—¶ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œè¿˜éœ€è¦æ¶ˆè€—å†…å­˜è¿›è¡Œæ•°æ®çš„è§£å‹ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 9. æ•°æ®å¯¼å…¥è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºDWDå±‚çš„æ•°æ®æ¥æºäºODSå±‚ï¼Œå¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡insertçš„æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸æŒ‡å®šåˆ—çš„åˆ†å‰²ç¬¦</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ’å…¥æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨insert overwriteçš„æ–¹å¼ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> å’Œ </span><span style="color:#C678DD;--shiki-dark:#C678DD;">insert into</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> çš„åŒºåˆ«ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        aã€ </span><span style="color:#C678DD;--shiki-dark:#C678DD;">insert into</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,è¡¨ç¤ºå‘åŸè¡¨ä¸­æ’å…¥æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        bã€ </span><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šé¦–å…ˆå°†æ•°æ®å†™åˆ°ä¸€ä¸ªä¸´æ—¶è·¯å¾„ä¸‹ï¼Œå½“æ‰€æœ‰çš„æ•°æ®å†™å®Œä»¥åï¼Œåˆ é™¤åŸè¡¨ä¸­çš„æ•°æ®</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¦‚æœæ’å…¥æ•°æ®æ—¶æŒ‡å®š</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        äº†åˆ†åŒºï¼Œé‚£ä¹ˆåˆ é™¤åŸè¡¨ä¸­æŒ‡å®šåˆ†åŒºï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†åŒºï¼Œé‚£ä¹ˆåˆ é™¤å…¨è¡¨æ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œç„¶åå†å°†ä¸´æ—¶è·¯å¾„ä¸‹çš„æ•°æ®æ’å…¥åˆ°ç›®æ ‡è·¯å¾„ä¸‹ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”±äºdwdå±‚è¡¨éƒ½æ˜¯å»ºæˆåˆ—å¼å­˜å‚¨ + lzoæ–¹å¼ï¼Œé‚£ä¹ˆä¸èƒ½ç›´æ¥é€šè¿‡loadçš„æ–¹å¼åŠ è½½æ•°æ®ï¼Œåªèƒ½ä½¿ç”¨insert + </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> çš„æ–¹å¼</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20200706005338451](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200706005338.png)</p><h4 id="_4-3-2-ç»´åº¦è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-3-2-ç»´åº¦è¡¨"><span>4.3.2 ç»´åº¦è¡¨</span></a></h4><h5 id="_4-3-2-1-å•†å“ç»´åº¦è¡¨-å…¨é‡" tabindex="-1"><a class="header-anchor" href="#_4-3-2-1-å•†å“ç»´åº¦è¡¨-å…¨é‡"><span>4.3.2.1 å•†å“ç»´åº¦è¡¨(å…¨é‡)</span></a></h5><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¡¨æ„å»ºè¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚æ‰¾åˆ°å’Œå•†å“ç»´åº¦æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œå¹¶åˆ¤æ–­è¿™äº›è¡¨åœ¨odså±‚åŒæ­¥ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.å•†å“ä¸‰çº§åˆ†ç±»è¡¨ </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.å•†å“äºŒçº§åˆ†ç±»è¡¨ </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.å•†å“ä¸€çº§åˆ†ç±»è¡¨ </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.SPUå•†å“è¡¨     </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.skuå•†å“è¡¨     </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.å“ç‰Œè¡¨        </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å–ä¸Šè¿°ç›¸å…³è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºå•†å“ç»´åº¦è¡¨çš„å­—æ®µ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è¡¨å‘½åï¼šdwd_dim_sku_info</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ•°æ®ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å–ä¸Šé¢6å¼ è¡¨ä¸­å½“å¤©åˆ†åŒºå†…çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°å•†å“ç»´åº¦è¡¨çš„å½“å¤©åˆ†åŒºå†…  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ’å…¥æ•°æ®æ—¶ï¼Œæ³¨æ„æ•°æ®è¿æ¥çš„é¡ºåºï¼Œå°¤å…¶çš„ä¸€äºŒä¸‰çº§å•†å“åˆ†ç±»è¡¨ã€‚</span></span></code></pre></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_sku_info`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_sku_info`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `price`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_desc`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“æè¿°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `weight`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é‡é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œåç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category3_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸‰çº§åˆ†ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category2_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äºŒçº§åˆ†ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category1_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€çº§åˆ†ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category3_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸‰çº§åˆ†ç±»åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category2_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äºŒçº§åˆ†ç±»åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category1_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€çº§åˆ†ç±»åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuåç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ç»´åº¦è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_sku_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_sku_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">spu_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">price</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">sku_name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">sku_desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">weight</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tm_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ob</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tm_name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">category3_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    c2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> category2_id,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    c1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> category1_id,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    c3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> category3_name,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    c2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> category2_name,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    c1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> category1_name,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    spu</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">spu_name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_sku_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)sku</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_trademark </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)ob </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tm_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ob</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tm_id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_spu_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)spu </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> spu</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">spu_id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category3 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)c3 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">category3_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">c3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category2 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)c2 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> c3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">category2_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">c2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_category1 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)c1 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> c2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">category1_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">c1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥è¯¢</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> from dwd_dim_sku_info where </span><span style="color:#E06C75;--shiki-dark:#E06C75;">dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> limit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-2-2-ä¼˜æƒ åˆ¸ç»´åº¦è¡¨-å…¨é‡" tabindex="-1"><a class="header-anchor" href="#_4-3-2-2-ä¼˜æƒ åˆ¸ç»´åº¦è¡¨-å…¨é‡"><span>4.3.2.2 ä¼˜æƒ åˆ¸ç»´åº¦è¡¨(å…¨é‡)</span></a></h5><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¡¨æ„å»ºè¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚æ‰¾åˆ°å’Œä¼˜æƒ åˆ¸ç»´åº¦æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œå¹¶åˆ¤æ–­è¿™äº›è¡¨åœ¨odså±‚åŒæ­¥ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¼˜æƒ åˆ¸è¡¨ï¼šods_coupon_info </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å–ä¸Šè¿°ç›¸å…³è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºå•†å“ç»´åº¦è¡¨çš„å­—æ®µ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è¡¨å‘½åï¼šdwd_dim_coupon_info</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ•°æ®ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å–ods_coupon_infoè¡¨ä¸­å½“å¤©åˆ†åŒºå†…çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¼˜æƒ åˆ¸ç»´åº¦è¡¨çš„å½“å¤©åˆ†åŒºå†…</span></span></code></pre></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_coupon_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_coupon_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡é¢æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‡é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_discount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æŠ˜æ‰£&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `range_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `tm_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç‰Œid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `category3_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å“ç±»id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `limit_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿®æ”¹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `expire_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¿‡æœŸæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_coupon_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_coupon_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    coupon_name,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    coupon_type,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    condition_amount,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    condition_num,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    activity_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    benefit_amount,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    benefit_discount,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    range_type,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    spu_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    tm_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    category3_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    limit_num,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    operate_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    expire_time</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥è¯¢</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_coupon_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> limit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-2-3-æ´»åŠ¨ç»´åº¦è¡¨-å…¨é‡" tabindex="-1"><a class="header-anchor" href="#_4-3-2-3-æ´»åŠ¨ç»´åº¦è¡¨-å…¨é‡"><span>4.3.2.3 æ´»åŠ¨ç»´åº¦è¡¨(å…¨é‡)</span></a></h5><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¡¨æ„å»ºè¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚æ‰¾åˆ°å’Œæ´»åŠ¨ç»´åº¦æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œå¹¶åˆ¤æ–­è¿™äº›è¡¨åœ¨odså±‚åŒæ­¥ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¼˜æƒ è§„åˆ™è¡¨ï¼šods_activity_rule </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡ </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ´»åŠ¨è¡¨: ods_activity_info     </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å…¨é‡</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å–ä¸Šè¿°ç›¸å…³è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºæ´»åŠ¨ç»´åº¦è¡¨çš„å­—æ®µ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è¡¨å‘½åï¼šdwd_dim_activity_info</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ•°æ®ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å–ä¸Šè¿°ç›¸å…³è¡¨ä¸­å½“å¤©åˆ†åŒºå†…çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°æ´»åŠ¨ç»´åº¦è¡¨çš„å½“å¤©åˆ†åŒºå†…</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. åŠ è½½æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ä½¿ç”¨ods_activity_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_ruleï¼Œå› ä¸ºæœ‰äº›æ´»åŠ¨å¯èƒ½æ²¡æœ‰æ´»åŠ¨è§„åˆ™</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å…³è”æ¡ä»¶ï¼šæ´»åŠ¨id</span></span></code></pre></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_activity_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_activity_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡å‡é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `condition_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ»¡å‡ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_discount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ æŠ˜æ‰£&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_level`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ çº§åˆ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `start_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¼€å§‹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `end_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç»“æŸæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ä¿¡æ¯è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_activity_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_activity_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">condition_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">condition_num</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_discount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_level</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">start_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">end_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">left join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_rule </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)rule </span><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> rule</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> from dwd_dim_activity_info where </span><span style="color:#E06C75;--shiki-dark:#E06C75;">dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> limit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-2-4-åœ°åŒºç»´åº¦è¡¨-ç‰¹æ®Š" tabindex="-1"><a class="header-anchor" href="#_4-3-2-4-åœ°åŒºç»´åº¦è¡¨-ç‰¹æ®Š"><span>4.3.2.4 åœ°åŒºç»´åº¦è¡¨(ç‰¹æ®Š)</span></a></h5><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¡¨æ„å»ºè¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚æ‰¾åˆ°å’Œåœ°åŒºç»´åº¦æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œå¹¶åˆ¤æ–­è¿™äº›è¡¨åœ¨odså±‚åŒæ­¥ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åœ°åŒºè¡¨ï¼šods_base_region       </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç‰¹æ®Š </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. çœä»½è¡¨: ods_base_province     </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç‰¹æ®Š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å–ä¸Šè¿°ç›¸å…³è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºæ´»åŠ¨ç»´åº¦è¡¨çš„å­—æ®µ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è¡¨å‘½åï¼šdwd_dim_base_province</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ•°æ®ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ç”±äºåœ°åŒºè¡¨åªå¯¼ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸æ˜¯åˆ†åŒºè¡¨ï¼Œå±äºå…¨é‡è¡¨ï¼Œå…¶å®å¯ä»¥ä¸ç”¨åˆ—å¼å­˜å‚¨å’Œlzoå‹ç¼©</span></span></code></pre></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_base_province`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_base_province`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `province_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœå¸‚åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `area_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºç¼–ç &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `iso_code`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ISOç¼–ç &#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `region_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `region_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºåç§°&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åœ°åŒºçœå¸‚è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_base_province/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_base_province</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">area_code</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">iso_code</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">region_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">region_name</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_province bp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_base_region br</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> bp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">region_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-2-5-æ—¶é—´ç»´åº¦è¡¨-ç‰¹æ®Š" tabindex="-1"><a class="header-anchor" href="#_4-3-2-5-æ—¶é—´ç»´åº¦è¡¨-ç‰¹æ®Š"><span>4.3.2.5 æ—¶é—´ç»´åº¦è¡¨(ç‰¹æ®Š)</span></a></h5><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæ˜¯æ²¡æœ‰æ—¶é—´ç»´åº¦è¡¨ï¼Œä½†æ˜¯åœ¨æ•°ä»“ä¸­ï¼Œå¿…é¡»æœ‰æ—¶é—´ç»´åº¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä»£ç çš„æ–¹å¼ç”Ÿæˆæ—¶é—´æ•°æ®ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. é€šè¿‡æ—¶é—´ç»´åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†æã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®å¯¼å…¥è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#D19A66;--shiki-dark:#D19A66;">æŠŠdate_info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">txtæ–‡ä»¶ä¸Šä¼ åˆ°hadoop102çš„</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/opt/module/db_log/è·¯å¾„</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#D19A66;--shiki-dark:#D19A66;">åˆ›å»ºçš„è¡¨ç”¨åˆ—å¼å­˜å‚¨å’Œå»ºç«‹å‹ç¼©</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ä¸èƒ½ä½¿ç”¨loadçš„æ–¹å¼åŠ è½½æ•°æ®</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œè¦å»ºä¸€å¼ ä¸´æ—¶è¡¨è¿›è¡Œ</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;éåˆ—å¼å­˜å‚¨å’Œå»ºç«‹å‹ç¼©çš„å­˜å‚¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         å°†æ•°æ®loadåˆ°åˆ›å»ºçš„ä¸´æ—¶è¡¨ä¸­ï¼Œæœ€åå†é€šè¿‡insert overwrite + </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> çš„æ–¹å¼å¯¼å…¥æ•°æ®ã€‚</span></span></code></pre></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_date_info`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_date_info`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `date_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ—¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `week_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‘¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `week_day`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‘¨çš„ç¬¬å‡ å¤©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `day`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `month`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¬¬å‡ æœˆ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `quarter`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¬¬å‡ å­£åº¦&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `year`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¹´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_workday`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `holiday_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_date_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ï¼ˆ1ï¼‰åˆ›å»ºä¸´æ—¶è¡¨ï¼Œéåˆ—å¼å­˜å‚¨</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_date_info_tmp`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXTERNAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379;"> `dwd_dim_date_info_tmp`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `date_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ—¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `week_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‘¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `week_day`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å‘¨çš„ç¬¬å‡ å¤©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `day`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `month`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¬¬å‡ æœˆ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `quarter`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¬¬å‡ å­£åº¦&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `year`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¹´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_workday`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `holiday_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_date_info_tmp/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ï¼ˆ2ï¼‰å°†æ•°æ®å¯¼å…¥ä¸´æ—¶è¡¨</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">load</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> data</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> local</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inpath </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/opt/module/db_log/date_info.txt&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> into</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_date_info_tmp;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ï¼ˆ3ï¼‰å°†æ•°æ®å¯¼å…¥æ­£å¼è¡¨</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_date_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_date_info_tmp;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4ï¼‰æŸ¥è¯¢åŠ è½½ç»“æœ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_date_info;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-2-6-ç”¨æˆ·ç»´åº¦è¡¨-æ‹‰é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-3-2-6-ç”¨æˆ·ç»´åº¦è¡¨-æ‹‰é“¾è¡¨"><span>4.3.2.6 ç”¨æˆ·ç»´åº¦è¡¨(æ‹‰é“¾è¡¨)</span></a></h5><ol><li>æ‹‰é“¾è¡¨è¯´æ˜</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. æ‹‰é“¾è¡¨åº”ç”¨äºç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. ä»€ä¹ˆæ ·çš„ç»´åº¦è¡¨ä½¿ç”¨æ‹‰é“¾è¡¨ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ˜¯ä¸å˜çš„è¡¨ã€‚</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;æ¯”å¦‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç”¨æˆ·ä¿¡æ¯ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯æ¯å¤©å˜åŒ–çš„æ¯”ä¾‹ä¸é«˜ã€‚å¦‚æœæ•°æ®é‡æœ‰ä¸€å®šè§„æ¨¡ï¼ŒæŒ‰ç…§æ¯æ—¥å…¨é‡çš„æ–¹å¼ä¿å­˜æ•ˆç‡å¾ˆä½ã€‚ </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">      &#39;æ¯”å¦‚&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š1äº¿ç”¨æˆ·*365å¤©ï¼Œæ¯å¤©ä¸€ä»½ç”¨æˆ·ä¿¡æ¯ã€‚(åšæ¯æ—¥å…¨é‡æ•ˆç‡ä½)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ‹‰é“¾è¡¨çš„å®šä¹‰</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      è®°å½•æ¯æ¡ä¿¡æ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦ä¸€æ¡è®°å½•çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå°±é‡æ–°å¼€å§‹ä¸€æ¡æ–°çš„è®°å½•ï¼Œå¹¶æŠŠå½“å‰æ—¥æœŸæ”¾å…¥ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å¦‚æœå½“å‰ä¿¡æ¯è‡³ä»Šæœ‰æ•ˆï¼Œåœ¨ç”Ÿæ•ˆç»“æŸæ—¥æœŸä¸­å¡«å…¥ä¸€ä¸ªæå¤§å€¼ï¼ˆå¦‚9999-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ï¼‰ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. ä½¿ç”¨æ‹‰é“¾è¡¨çš„æ•ˆæœï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€èƒ½ä¿ç•™å†å²æ•°æ®çš„çŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€æ•°æ®ä¸ä¼šå‡ºç°å†—ä½™</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      cã€ä¸€æ¡æ•°æ®ä¼šæœ‰å¤šè¡Œï¼Œåœ¨è¿™é‡Œï¼Œä¸€ä¸ªç”¨æˆ·ä¼šæœ‰å¤šè¡Œæ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. æ‹‰é“¾è¡¨ä¸€èˆ¬æ€ä¹ˆä½¿ç”¨ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      aã€è·å–æ¯æ¡æ•°æ®çš„æœ€æ–°æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      bã€åˆ†æå†å²æ•°æ®ï¼Œå¦‚æŒ‡å®šæŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. æ‹‰é“¾è¡¨çš„å½¢æˆè¿‡ç¨‹ï¼š  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆå§‹åŒ–æ‹‰é“¾è¡¨ï¼Œå°±æ˜¯æ·»åŠ start-</span><span style="color:#C678DD;--shiki-dark:#C678DD;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> å’Œ end_time,é¦–æ¬¡ç‹¬ç«‹è¿è¡Œ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å…ˆåˆå¹¶å˜åŠ¨æ•°æ®ï¼Œå†è¿½åŠ æ–°å¢æ•°æ®ï¼Œæ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æŠŠä¸´æ—¶è¡¨æ±‡æ€»çš„æ•°æ®è¦†ç›–åŸæ¥çš„æ—§è¡¨</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20200706025313933](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200706025314.png)</p><p>![image-20200706025419456](<a href="https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic" target="_blank" rel="noopener noreferrer">https://lian-zp.oss-cn-shenzhen.aliyuncs.com/pic</a> GO/20200706025419.png)</p><ol start="2"><li>ç”¨æˆ·ç»´åº¦è¡¨</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. è¯´æ˜ï¼š </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       å•ç‹¬ä½¿ç”¨sqoopå°†ä¸šåŠ¡ç³»ç»Ÿæ•°æ®ä¸­çš„ç”¨æˆ·è¡¨å…¨éƒ¨å¯¼å…¥åˆ°HDFSä¸Šï¼Œç”±äºæ‹‰é“¾è¡¨çš„æ•°æ®éœ€è¦å¢åŠ start_time å’Œend_timeä¸¤åˆ—æ•°æ®ï¼Œæ‰€ä»¥å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       ä»¥å…ˆé€šè¿‡åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œå°†æ•°æ®å¯¼å…¥åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œå¹¶æ·»åŠ start_time å’Œend_timeï¼Œç„¶åå†insert overwrite åˆ°æ‹‰é“¾è¡¨ä¸­ã€‚</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®éªŒé˜¶æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   	   æ•°æ®ç›´æ¥ä»odså±‚è·å–ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨è¿‡ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚æ‰¾åˆ°å’Œç”¨æˆ·ç»´åº¦æ‰€æœ‰ç›¸å…³çš„è¡¨ï¼Œå¹¶åˆ¤æ–­è¿™äº›è¡¨åœ¨odså±‚åŒæ­¥ç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ç”¨æˆ·è¡¨ï¼šods_user_info      </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ–°å¢åŠå˜åŒ– </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å–ä¸Šè¿°ç›¸å…³è¡¨çš„æ‰€æœ‰å­—æ®µä½œä¸ºç”¨æˆ·ç»´åº¦è¡¨çš„å­—æ®µï¼Œå¹¶åŠ ä¸Šstart_time å’Œ end_timeå­—æ®µ</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. è¡¨å‘½åï¼šdwd_dim_user_info</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®ç»´æŠ¤</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆå§‹åŒ–dwd_dim_user_info_hisï¼Œå°†ç¬¬ä¸€å¤©ç”¨æˆ·æ•°æ®å¯¼å…¥å¹¶å°†start_dateè®¾ç½®ä¸ºä»Šå¤©ï¼Œend_dateè®¾ç½®ä¸º9999-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¤„ç†æ–°æ•°æ®ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         å–å‡ºods_user_infoè¡¨ç¬¬äºŒå¤©çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é¦–å…ˆå°†ods_user_infoæ•°æ®ï¼Œå¢åŠ start_date å’Œ end_dateå­—æ®µ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">             start_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå½“å¤©æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             end_dateï¼šè®¾ç½®ä¸º9999-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¤„ç†æ—§æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">          1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆå§‹è¡¨ </span><span style="color:#C678DD;--shiki-dark:#C678DD;">left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_infoè¡¨ç¬¬äºŒå¤©çš„æ•°æ®ï¼Œå½“ods_user_infoçš„idä¸ä¸ºnullä¸”åˆå§‹è¡¨çš„end_dateä¸º9999-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             çš„æ•°æ®ï¼Œå°†end_dateæ”¹ä¸ºæ˜¨å¤©ï¼Œå¦åˆ™ä½¿ç”¨åˆå§‹åŒ–æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆ›å»ºä¸´æ—¶è¡¨dwd_dim_user_info_his_tmp  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆå¹¶æ–°æ—§æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       		æ­¥éª¤3æ•°æ® </span><span style="color:#C678DD;--shiki-dark:#C678DD;">union all</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> æ­¥éª¤2çš„è¡¨ï¼Œå°†ç»“æœ </span><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite åˆ°ä¸´æ—¶è¡¨ä¸­</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸¤å¼ è¡¨çš„å­—æ®µåç§°è¦ä¸€ä¸€å¯¹åº”&#39;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å°†ä¸´æ—¶è¡¨çš„æ•°æ®æ’å…¥åˆ°ç”¨æˆ·ç»´æŠ¤è¡¨ä¸­ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. ç”¨æˆ·ç»´åº¦è¡¨çš„æ•°æ®å†…å®¹ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸æ˜¯åˆ†åŒºè¡¨ï¼Œä¿å­˜æ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¸€ä¸ªç”¨æˆ·ä¼šæœ‰å¤šè¡Œæ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">      3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¯¼å…¥æ•°æ®æ—¶ï¼Œè¿™è¡Œä»£ç ä¸€å®šè¦åŠ </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åˆ›å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å§“å&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `birthday`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”Ÿæ—¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `gender`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ€§åˆ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `email`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é‚®ç®±&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_level`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ç­‰çº§&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ“ä½œæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     `start_date`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     `end_date`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_user_info_his/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆå§‹åŒ– dwd_dim_user_info_his</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  INSERT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        id,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        birthday,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        gender,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        email,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        user_level,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;9999-99-99&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>å¤„ç†æ–°æ•°æ®</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    id,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		    name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    birthday,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    gender,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    email,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    user_level,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		    operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">		    &#39;2020-06-26&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">		    &#39;9999-99-99&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-26&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) tmp</span></span></code></pre></div><ol start="3"><li>å¤„ç†æ—§æ•°æ®</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">birthday</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">gender</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">email</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_level</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">operate_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">		    his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">start_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is not null</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">end_date</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;9999-99-99&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,date_add(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#D19A66;--shiki-dark:#D19A66;">his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">end_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) end_date</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  dwd_dim_user_info_his his</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">			(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">			from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">			where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;2020-06-26&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">			)tmp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>å°†å¤„ç†åçš„æ–°æ•°æ®å’Œå¤„ç†åçš„æ—§æ•°æ® union all æ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­</li></ol><p>â€‹ åˆ›å»ºä¸´æ—¶è¡¨dwd_dim_user_info_his_tmp</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his_tmp;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his_tmp( </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å§“å&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `birthday`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”Ÿæ—¥&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `gender`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ€§åˆ«&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `email`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é‚®ç®±&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_level`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ç­‰çº§&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ“ä½œæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     `start_date`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     `end_date`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_dim_user_info_his_tmp/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">     SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">     insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his_tmp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">       select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">birthday</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">gender</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">email</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_level</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">operate_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">start_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is not null</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">end_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;9999-99-99&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,date_add(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#D19A66;--shiki-dark:#D19A66;">his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">end_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  end_date</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  dwd_dim_user_info_his his</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;2020-06-26&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            )tmp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tmp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> his</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        union all</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            id,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            birthday,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            gender,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            email,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            user_level,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            &#39;2020-06-26&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> start_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            &#39;9999-99-99&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> end_date</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_user_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-26&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       ) tmp1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">       order by</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tmp1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tmp1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">start_date</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>å°†ä¸´æ—¶è¡¨çš„æ•°æ®æ’å…¥åˆ°ç”¨æˆ·ç»´åº¦è¡¨ä¸­</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his  </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_dim_user_info_his_tmp;</span></span></code></pre></div><h4 id="_4-3-3-äº‹å®è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-3-3-äº‹å®è¡¨"><span>4.3.3 äº‹å®è¡¨</span></a></h4><h5 id="_4-3-3-1-è®¢å•æ˜ç»†äº‹å®è¡¨-äº‹åŠ¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-3-3-1-è®¢å•æ˜ç»†äº‹å®è¡¨-äº‹åŠ¡å‹"><span>4.3.3.1 è®¢å•æ˜ç»†äº‹å®è¡¨(äº‹åŠ¡å‹)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ å•†å“ ã€åœ°åŒº</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_order_detailï¼Œè®¢å•æ˜ç»†è¡¨ï¼Œå¢é‡è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            ods_order_info ï¼Œè®¢å•è¡¨ï¼Œæ–°å¢åŠå˜åŒ–è¡¨</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šé‡‘é¢/ä¸ªæ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šäº‹åŠ¡å‹äº‹å®è¡¨ï¼Œæ–°å¢ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©æ–°å¢è®¢å•æ˜ç»†</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€ä¸ªè®¢å•ä¼šæœ‰å¤šä¸ªäº§å“ï¼Œè¿™é‡Œçš„ä¸€è¡Œæ•°æ®å°±æ˜¯ä¸€ä¸ªè®¢å•ä¸­ä¸€ä¸ªå•†å“çš„è¯¦æƒ…</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚è·å–å½“å¤©æ–°å¢çš„æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_detail;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_detail (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç”¨æˆ·ç»´åº¦</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuå•†å“id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“ç»´åº¦</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“åç§°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_price`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“æ•°é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ—¶é—´ç»´åº¦</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,       </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åœ°åŒºç»´åº¦</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `original_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŸå§‹ä»·æ ¼åˆ†æ‘Š&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `final_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ä¹°ä»·æ ¼åˆ†æ‘Š&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `feight_fee_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ†æ‘Šè¿è´¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_reduce_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ†æ‘Šä¼˜æƒ &#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_order_detail/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¯­å¥è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»å¦‚ä¸Šçš„å»ºè¡¨è¯­å¥å¯çŸ¥ï¼Œå’±ä»¬çš„åº¦é‡å€¼æ— æ³•ä»odså±‚çš„è®¢å•è¯¦æƒ…è¡¨ä¸­ç›´æ¥è·å–ï¼Œé‚£ä¹ˆå’±ä»¬éœ€è¦æƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹æ¥è·å–ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å‡ ä¸ªåº¦é‡å€¼çš„ä»‹ç»</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `original_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŸå§‹ä»·æ ¼åˆ†æ‘Š&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŒ‡è¿™ä¸ªäº§å“çš„åŸä»· = å•†å“ä»·æ ¼ * å•†å“æ•°é‡</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `final_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è´­ä¹°ä»·æ ¼åˆ†æ‘Š&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŒ‡åœ¨ä¸€ä¸ªè®¢å•ä¸­ï¼Œä¹°äº†è¿™ä¸ªäº§å“çš„åˆ†æ‘Šä»·æ ¼ = å•†å“ä»·æ ¼ * å•†å“æ•°é‡ / è®¢å•åŸä»·  * è®¢å•æœ€ç»ˆä»·æ ¼</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `feight_fee_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ†æ‘Šè¿è´¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- ç”±äºä¸€ä¸ªè®¢å•ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šäº§å“ï¼Œé‚£ä¹ˆéœ€å¯¹è¿è´¹è¿›è¡Œåˆ†æ‘Šï¼Œåˆ†æ‘Šä»·æ ¼ =  å•†å“ä»·æ ¼ * å•†å“æ•°é‡ / è®¢å•åŸä»·  * è®¢å•è¿è´¹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_reduce_amount_d`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ†æ‘Šä¼˜æƒ &#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- åœ¨ä¸€ä¸ªè®¢å•ä¸­ï¼Œå½“å‰äº§å“åˆ†æ‘Šçš„ä¼˜æƒ é‡‘é¢ =  å•†å“ä»·æ ¼ * å•†å“æ•°é‡ / è®¢å•åŸä»·  * è®¢å•ä¼˜æƒ é‡‘é¢</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 3. å¦‚ä¸Šçš„å‡ ä¸ªæ•°æ®ï¼šè®¢å•ä»·æ ¼ã€è®¢å•è¿è´¹ã€è®¢å•çš„ä¼˜æƒ é‡‘é¢å‡åœ¨odså±‚çš„è®¢å•è¡¨ä¸­ï¼Œé‚£ä¹ˆéœ€è¦æƒ³åŠæ³•ä»å…¶ä¸­è·å–</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 4. ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ†æ‘Šä»·æ ¼å¯èƒ½ä¼šæœ‰å¾ˆå¤šå°æ•°ï¼Œå’±ä»¬å°±ä¼šä½¿ç”¨å››èˆäº”å…¥çš„æ–¹å¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæœ€åçš„ä»·æ ¼å¯èƒ½å’Œè®¢å•æ”¯ä»˜çš„ä»·æ ¼ä¸ç¬¦ï¼Œæ‰€ä»¥</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      å·®é¢çš„å“ªä¸€éƒ¨åˆ†ï¼Œå°±åˆ†æ‘Šåˆ°ä¸€ä¸ªè®¢å•ä¸­è´­ä¹°ä»·æ ¼åˆ†æ‘Šæœ€å¤šçš„äº§å“ä¸­ã€‚</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_detail </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•ç¼–å·</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è®¢å•å·</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç”¨æˆ·id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“åç§°</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `order_price`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“ä»·æ ¼</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `sku_num`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“æ•°é‡</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åˆ›å»ºæ—¶é—´</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--çœä»½ID</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ¥æºç±»å‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            `source_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ¥æºç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            original_amount_d,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åŸå§‹ä»·æ ¼åˆ†æ‘Š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(rk</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,final_amount_d + final_total_amount-sum_final_amount_d,final_amount_d),</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è´­ä¹°ä»·æ ¼åˆ†æ‘Š</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(rk</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,feight_fee_d + feight_fee-sum_feight_fee_d,feight_fee_d),</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åˆ†æ‘Šè¿è´¹</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(rk</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,benefit_reduce_amount_d + benefit_reduce_amount-sum_benefit_reduce_amount_d,benefit_reduce_amount_d) </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åˆ†æ‘Šä¼˜æƒ </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è®¢å•å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç”¨æˆ·id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“åç§°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_price`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“ä»·æ ¼</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`sku_num`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“æ•°é‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åˆ›å»ºæ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--çœä»½ID</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ¥æºç±»å‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`source_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ¥æºç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            order_price * sku_num original_amount_d , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åŸå§‹ä»·æ ¼åˆ†æ‘Š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">final_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•é‡‘é¢</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">feight_fee</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•è¿è´¹</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">            info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_reduce_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•ä¼˜æƒ é‡‘é¢</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount * final_total_amount , </span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) final_amount_d,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è´­ä¹°ä»·æ ¼åˆ†æ‘Š</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount  * feight_fee  ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) feight_fee_d, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è¿è´¹åˆ†æ‘Šè¿è´¹</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount  * benefit_reduce_amount  ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) benefit_reduce_amount_d, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ†æ‘Šä¼˜æƒ </span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            rank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#C678DD;--shiki-dark:#C678DD;">over</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#C678DD;--shiki-dark:#C678DD;">  order by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_price * sku_num </span><span style="color:#C678DD;--shiki-dark:#C678DD;">desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) rk , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŒ‰ç…§è´­ä¹°ä»·æ ¼åˆ†æ‘Šé™åºæ’åº</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount * final_total_amount ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">over</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ) sum_final_amount_d,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è´­ä¹°ä»·æ ¼åˆ†æ‘Šæ€»é¢</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount  * feight_fee  ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">over</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ) sum_feight_fee_d, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆ†æ‘Šä¼˜æƒ æ€»é¢</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">            sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">round</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_price * sku_num / original_total_amount  * benefit_reduce_amount ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">over</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> detail.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ) sum_benefit_reduce_amount_d    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--åˆ†æ‘Šä¼˜æƒ æ€»é¢</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_detail detail</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ods_order_info  info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        on</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  detail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> detail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )oi;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-2-æ”¯ä»˜äº‹å®è¡¨-äº‹åŠ¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-3-3-2-æ”¯ä»˜äº‹å®è¡¨-äº‹åŠ¡å‹"><span>4.3.3.2 æ”¯ä»˜äº‹å®è¡¨(äº‹åŠ¡å‹)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ åœ°åŒº</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_payment_info ï¼Œæ”¯ä»˜è¡¨ï¼Œå¢é‡è¡¨          </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šé‡‘é¢/ä¸ªæ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åœ¨æ­¤äº‹å®è¡¨ä¸­ï¼Œåœ°åŒºå­—æ®µå°±ä¸èƒ½é€šè¿‡ç›¸å…³è¡¨ç›´æ¥è·å–ï¼Œé‚£æ‰¾åˆ°è®¢å•è¡¨ä¸­åœ°åŒºã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šäº‹åŠ¡å‹äº‹å®è¡¨ï¼Œæ–°å¢ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©æ”¯ä»˜çš„è®¢å•ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªæ”¯ä»˜è®¢å•</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚è·å–å½“å¤©æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åˆ†åŒºå­—æ®µï¼šè®¢å•æ”¯ä»˜çš„æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨è¯­å¥</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_payment_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_payment_info (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `out_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `alipay_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;">    decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `subject`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">         string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº¤æ˜“å†…å®¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½ID&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_payment_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_payment_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`out_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹å¤–ä¸šåŠ¡ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç”¨æˆ·ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`alipay_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`total_amount`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ”¯ä»˜é‡‘é¢</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`subject`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--äº¤æ˜“å†…å®¹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`payment_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ”¯ä»˜ç±»å‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ods_payment_info.</span><span style="color:#98C379;--shiki-dark:#98C379;">`payment_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æ”¯ä»˜æ—¶é—´</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        ods_order_info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">province_id</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --çœä»½ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_payment_info </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> ods_order_info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> ods_payment_info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    where</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> ods_payment_info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-3-é€€æ¬¾äº‹å®è¡¨-äº‹åŠ¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-3-3-3-é€€æ¬¾äº‹å®è¡¨-äº‹åŠ¡å‹"><span>4.3.3.3 é€€æ¬¾äº‹å®è¡¨(äº‹åŠ¡å‹)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ å•†å“</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_order_refund_info ï¼Œé€€æ¬¾è¡¨ï¼Œå¢é‡è¡¨          </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šé‡‘é¢/ä¸ªæ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šäº‹åŠ¡å‹äº‹å®è¡¨ï¼Œæ–°å¢ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©é€€æ¬¾çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªé€€æ¬¾ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚ods_order_refund_infoè¡¨ä¸­è·å–å½“å¤©æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åˆ†åŒºå­—æ®µï¼šé€€å•åˆ›å»ºçš„æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_refund_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_num`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾ä»¶æ•°&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_reason_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾åŸå› ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾äº‹å®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_order_refund_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  dwd_fact_order_refund_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç”¨æˆ·ID</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--è®¢å•ID</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--å•†å“ID</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `refund_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--é€€æ¬¾ç±»å‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `refund_num`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--é€€æ¬¾ä»¶æ•°</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `refund_amount`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é€€æ¬¾é‡‘é¢</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `refund_reason_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--é€€æ¬¾åŸå› ç±»å‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        `create_time`</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --é€€æ¬¾æ—¶é—´</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_refund_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span></code></pre></div><h5 id="_4-3-3-4-è¯„ä»·äº‹å®è¡¨-äº‹åŠ¡å‹" tabindex="-1"><a class="header-anchor" href="#_4-3-3-4-è¯„ä»·äº‹å®è¡¨-äº‹åŠ¡å‹"><span>4.3.3.4 è¯„ä»·äº‹å®è¡¨(äº‹åŠ¡å‹)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ å•†å“</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_comment_infoï¼Œè¯„è®ºè¡¨ï¼Œå¢é‡è¡¨          </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šè¯„è®ºçš„æ¬¡æ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šäº‹åŠ¡å‹äº‹å®è¡¨ï¼Œæ–°å¢ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©è¯„è®ºæ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªè¯„è®ºä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚ods_comment_infoè¡¨ä¸­è·å–å½“å¤©æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åˆ†åŒºå­—æ®µï¼šè¯„è®ºæ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_comment_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_comment_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“sku&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å•†å“spu&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `appraise`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¯„ä»·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¯„ä»·æ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¯„ä»·äº‹å®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_comment_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_comment_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    user_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    sku_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    spu_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    order_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    appraise,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    create_time</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_comment_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-3-5-åŠ è´­äº‹å®è¡¨-å‘¨æœŸæ€§å¿«ç…§" tabindex="-1"><a class="header-anchor" href="#_4-3-3-5-åŠ è´­äº‹å®è¡¨-å‘¨æœŸæ€§å¿«ç…§"><span>4.3.3.5 åŠ è´­äº‹å®è¡¨(å‘¨æœŸæ€§å¿«ç…§)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ å•†å“</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_cart_infoï¼ŒåŠ è´­è¡¨ï¼Œå…¨é‡è¡¨         </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šåŠ è´­å•†å“çš„é‡‘é¢å’Œæ•°é‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå‘¨æœŸæ€§å¿«ç…§äº‹å®è¡¨ï¼Œæ¯å¤©ä¸€ä¸ªå…¨é‡ï¼Œå…¨é‡ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€ä¸ªå½“å¤©çš„ä¸€ä¸ªå…¨é‡æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªåŠ è´­è½¦ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚ods_cart_infoè¡¨ä¸­è·å–å½“å¤©æ•°æ®å³ä¸ºå…¨é‡æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åˆ†åŒºå­—æ®µï¼šåŠ è´­è½¦æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_cart_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_cart_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `cart_price`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_num`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ•°é‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuåç§° (å†—ä½™)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `operate_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿®æ”¹æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_ordered`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦å·²ç»ä¸‹å•ã€‚1ä¸ºå·²ä¸‹å•;0ä¸ºæœªä¸‹å•&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`order_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸‹å•æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`source_type`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">`srouce_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¥æºç¼–å·&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŠ è´­äº‹å®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_cart_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_cart_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    user_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    sku_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    cart_price,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    sku_num,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    sku_name,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    operate_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    is_ordered,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">order_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">source_type,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">source_id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_cart_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-6-æ”¶è—äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§" tabindex="-1"><a class="header-anchor" href="#_4-3-3-6-æ”¶è—äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§"><span>4.3.3.6 æ”¶è—äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´ ã€ å•†å“</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼šods_favor_infoï¼Œå•†å“æ”¶è—è¡¨ï¼Œå…¨é‡è¡¨         </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šæ”¶è—å•†å“çš„é‡‘é¢å’Œæ•°é‡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šå‘¨æœŸæ€§å¿«ç…§äº‹å®è¡¨ï¼Œæ¯å¤©ä¸€ä¸ªå…¨é‡ï¼Œå…¨é‡ç­–ç•¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€ä¸ªå½“å¤©çš„ä¸€ä¸ªå…¨é‡æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªæ”¶è—ä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ä»odså±‚ods_favor_infoè¡¨ä¸­è·å–å½“å¤©æ•°æ®å³ä¸ºå…¨é‡æ•°æ®ï¼Œä¿å­˜åˆ°å½“å¤©çš„åˆ†åŒºä¸­ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   åˆ†åŒºå­—æ®µï¼šåŠ å…¥æ”¶è—çš„æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_favor_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_favor_info(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `sku_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;skuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `spu_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;spuid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `is_cancel`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ˜¯å¦å–æ¶ˆ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¶è—æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `cancel_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å–æ¶ˆæ—¶é—´&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¶è—äº‹å®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_favor_info/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_favor_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    user_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    sku_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    spu_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    is_cancel,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    cancel_time</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_favor_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h5 id="_4-3-3-7ä¼˜æƒ åˆ¸äº‹å®è¡¨-ç´¯è®¡å‹å¿«ç…§" tabindex="-1"><a class="header-anchor" href="#_4-3-3-7ä¼˜æƒ åˆ¸äº‹å®è¡¨-ç´¯è®¡å‹å¿«ç…§"><span>4.3.3.7ä¼˜æƒ åˆ¸äº‹å®è¡¨(ç´¯è®¡å‹å¿«ç…§)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´   ã€ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼š ods_coupon_useï¼Œå•†å“æ”¶è—è¡¨ï¼Œæ–°å¢åŠå˜åŒ–         </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šä¼˜æƒ åˆ¸çš„é¢†ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç´¯è®¡å‹å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œå½“å¤©æ·»åŠ æ•°æ®æ—¶ï¼Œå½“å¤©çš„åˆ†åŒºä¸­åªæœ‰æ–°å¢æ•°æ®ï¼Œè€Œå˜åŒ–çš„æ•°æ®ï¼Œä¼šå°†æ—§åˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªä¼˜æƒ åˆ¸çš„ä½¿ç”¨æƒ…å†µ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   -- æ€è·¯1ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»odså±‚ods_favor_info è¡¨</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç§°ä½œnewè¡¨&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ä¸­è·å–å½“å¤©æ•°æ®ï¼Œè¯¥æ•°æ®ä¸­æœ‰æ–°å¢åŠå˜åŒ–æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»newè¡¨ä¸­å–å‡ºä»Šå¤©æ–°å¢çš„æ•°æ® </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æŸ¥è¯¢1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»newè¡¨ä¸­å–å‡ºä»Šå¤©å˜åŒ–çš„æ•°æ®ï¼Œç„¶åæ‰¾åˆ°è¿™ä¸ªæ•°æ®æ‰€åœ¨çš„åˆ†åŒº</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»oldè¡¨ä¸­ï¼Œå–å‡ºä¸Šè¿°åˆ†åŒºæ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å¯¹æ­¥éª¤4å˜åŒ–çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ²¡æœ‰å˜åŒ–çš„æ•°æ®ä¸åšä¿®æ”¹ï¼Œç„¶åå°†è®¡ç®—ç»“æœæ”¾å›åŸæ¥çš„åˆ†åŒºä¸­ </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--æŸ¥è¯¢2</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å°†æŸ¥è¯¢1çš„æ•°æ®å’ŒæŸ¥è¯¢2çš„æ•°æ®è¿›è¡Œåˆå¹¶ï¼š</span><span style="color:#C678DD;--shiki-dark:#C678DD;">union all</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ï¼Œä»¥ååŠ¨æ€æ’å…¥åˆ°æ—§è¡¨ä¸­ï¼Œåˆ™å®Œæˆäº†oldè¡¨çš„æ›´æ–°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   -- æ€è·¯2ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»newè¡¨ä¸­å–å‡ºä»Šå¤©å˜åŒ–çš„æ•°æ®ï¼Œç„¶åæ‰¾åˆ°è¿™ä¸ªæ•°æ®æ‰€åœ¨çš„åˆ†åŒº</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä»oldè¡¨ä¸­ï¼Œå–å‡ºä¸Šè¿°åˆ†åŒºæ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ­¥éª¤2çš„ç»“æœæ•°æ®å’Œæ–°è¡¨æ•°æ®è¿›è¡Œfull </span><span style="color:#C678DD;--shiki-dark:#C678DD;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ï¼Œç„¶åå–å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      æ–°è¡¨æœ‰æ•°æ®ï¼Œåˆ™å–æ–°è¡¨æ•°æ®ï¼Œæ–°è¡¨å¦‚æœä¸ºnullï¼Œåˆ™å–æ—§è¡¨æ•°æ®ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æœ€åä½¿ç”¨åŠ¨æ€åˆ†åŒºçš„æ–¹å¼å°†æ•°æ®æ’å…¥åˆ°åŸè¡¨ä¸­</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. hiveä¸­ä¸æ”¯æŒinsert ã€ upsert æ“ä½œï¼Œè™½ç„¶ç°åœ¨ä¹Ÿæ”¯æŒäº†ã€‚ä½†æ˜¯æ•ˆç‡æ˜¯éå¸¸ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ–°æ•°æ®æ—¶ï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. é€šè¿‡selectå°†æ•°æ®æŸ¥è¯¢å‡ºæ¥</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. æ ¹æ®éœ€æ±‚å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. ä¿®æ”¹å®Œæˆä»¥åå†insert overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> åˆ°æ—§è¡¨ä¸­</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. ç´¯ç§¯æ€§å¿«ç…§äº‹å®è¡¨å¿…é¡»æ˜¯åˆ†åŒºè¡¨ï¼Œå¦åˆ™æ¯æ¬¡ä¿®æ”¹æ•°æ®éƒ½éœ€è¦å…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆæ•°æ®çš„éå¸¸ä½ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 7. æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼šé¢†ç”¨-&gt;æ­£åœ¨ä½¿ç”¨-&gt;å·²ä½¿ç”¨</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åˆ›å»ºè¡¨</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;userid&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `coupon_status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸çŠ¶æ€&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `get_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é¢†å–æ—¶é—´&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `using_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä½¿ç”¨æ—¶é—´(ä¸‹å•)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `used_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string  COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">by</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\t&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_coupon_use/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®å®ç°æ­¥éª¤</li></ul><ol><li>è·å–æ–°å¢æ•°æ®</li></ol><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">select</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        id,--ç¼–å·</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        coupon_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,--ä¼˜æƒ åˆ¸ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        user_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --skuid</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        order_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,--</span><span style="color:#98C379;--shiki-dark:#98C379;"> spuid</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        coupon_status</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,--ä¼˜æƒ åˆ¸çŠ¶æ€</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        get_time,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --é¢†å–æ—¶é—´</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        using_time</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,--ä½¿ç”¨æ—¶é—´</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ä¸‹å•</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        used_time</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --</span><span style="color:#98C379;--shiki-dark:#98C379;"> ä½¿ç”¨æ—¶é—´</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">æ”¯ä»˜</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    from</span><span style="color:#98C379;--shiki-dark:#98C379;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    where</span><span style="color:#98C379;--shiki-dark:#98C379;"> dt=&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    and</span><span style="color:#98C379;--shiki-dark:#98C379;"> date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get_time,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">!=&#39;2020-06-25&#39;</span></span></code></pre></div><ol start="2"><li>è·å–æ—§è¡¨ä¸­å˜åŒ–æ•°æ®æ‰€åœ¨åˆ†åŒºçš„æ‰€æœ‰æ•°æ®</li></ol><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        and</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       )</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--t1</span></span></code></pre></div><ol start="3"><li>ä¿®æ”¹æ—§è¡¨ä¸­çš„æ–°å¢æ•°æ®</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸ID</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--skuid</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- spuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) coupon_status,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸çŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">get_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">get_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) get_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é¢†å–æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">using_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">using_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  using_time,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä½¿ç”¨æ—¶é—´(ä¸‹å•)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">used_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">used_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) used_time</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            and</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )t1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )new </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>åˆå¹¶æ–°æ—§æ•°æ®å¹¶åŠ¨æ€æ’å…¥æ•°æ®</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  set</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dynamic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.mode</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">nonstrict;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        id,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        coupon_id ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸ID</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        user_id, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--skuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        order_id ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- spuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        coupon_status ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸çŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        get_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é¢†å–æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        using_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä½¿ç”¨æ—¶é—´(ä¸‹å•)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        used_time, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) dt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        id,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        coupon_id ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸ID</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        user_id, </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--skuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        order_id ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- spuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        coupon_status ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸çŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        get_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é¢†å–æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        using_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä½¿ç”¨æ—¶é—´(ä¸‹å•)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        used_time </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)      </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    and</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    union all</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ç¼–å·</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸ID</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--skuid</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- spuid</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">coupon_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) coupon_status,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä¼˜æƒ åˆ¸çŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">get_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">get_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) get_time ,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é¢†å–æ—¶é—´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">using_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">using_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  using_time,</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--ä½¿ç”¨æ—¶é—´(ä¸‹å•)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        nvl(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">used_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">used_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) used_time</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            and</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(get_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )t1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    left join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_coupon_use</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )new </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )tmp</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-8-ç³»ç»Ÿå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4-3-3-8-ç³»ç»Ÿå‡½æ•°"><span>4.3.3.8 ç³»ç»Ÿå‡½æ•°</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰concatå‡½æ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">concatå‡½æ•°åœ¨è¿æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæ˜¯NULLï¼Œé‚£ä¹ˆå°†è¿”å›NULL</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ab</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰concat_wså‡½æ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">concat_wså‡½æ•°åœ¨è¿æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä¸æ˜¯NULLï¼Œå°±ä¸ä¼šè¿”å›NULLã€‚concat_wså‡½æ•°éœ€è¦æŒ‡å®šåˆ†éš”ç¬¦ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;-&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a-b</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;-&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">a-b</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ab</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰STR_TO_MAPå‡½æ•°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰è¯­æ³•æè¿°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">STR_TO_MAP(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> text</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> listDelimiter, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> keyValueDelimiter)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰åŠŸèƒ½æè¿°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ä½¿ç”¨listDelimiterå°†textåˆ†éš”æˆK-Vå¯¹ï¼Œç„¶åä½¿ç”¨keyValueDelimiteråˆ†éš”æ¯ä¸ªK-Vå¯¹ï¼Œç»„è£…æˆMAPè¿”å›ã€‚é»˜è®¤listDelimiterä¸ºï¼ˆ ï¼Œï¼‰ï¼ŒkeyValueDelimiterä¸ºï¼ˆ</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼ˆ</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼‰æ¡ˆä¾‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">str_to_map(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;1001=2020-06-14,1002=2020-06-14&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ,  </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">è¾“å‡º</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1001&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2020-06-14&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1002&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2020-06-14&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-9-è®¢å•äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§" tabindex="-1"><a class="header-anchor" href="#_4-3-3-9-è®¢å•äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§"><span>4.3.3.9 è®¢å•äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§)</span></a></h5><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. å»ºè¡¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;å‡†å¤‡&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š ç»´åº¦æœ‰ï¼šç”¨æˆ· ã€ åœ°åŒº ã€ æ—¶é—´ ã€ å•†å“ ã€ æ´»åŠ¨ ã€ ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šè®¢å•æ˜ç»†äº‹å®è¡¨çš„ç»´åº¦ï¼šç”¨æˆ· ã€ æ—¶é—´   ã€ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰¾åˆ°odså±‚çš„ç›¸å…³è¡¨ï¼š ods_coupon_useï¼Œå•†å“æ”¶è—è¡¨ï¼Œæ–°å¢åŠå˜åŒ–         </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;æ­¥éª¤3&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç¡®å®šåº¦é‡å€¼ï¼šä¼˜æƒ åˆ¸çš„é¢†ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å»ºè¡¨çš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å¤–é”®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ‰€æœ‰çš„ç»´åº¦ä½œä¸ºäº‹å®è¡¨çš„å¤–é”®ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åº¦é‡å€¼&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„æ‰€æœ‰æ•°å€¼ç±»å‹çš„å­—æ®µä½œä¸ºäº‹å®è¡¨çš„åº¦é‡å€¼ï¼Œå¦‚æœè¿™ä¸ªåº¦é‡å€¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘ä»å…¶ä»–è¡¨ä¸­ç»„åˆè·å–ï¼›</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å†—ä½™å­—æ®µ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç›¸å…³è¡¨çš„å…¶ä»–å­—æ®µä¹Ÿç›´æ¥æ”¾ç½®åœ¨äº‹å®è¡¨ä¸­ï¼Œä¾¿äºåç»­è®¡ç®—çš„éœ€æ±‚ã€‚  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;åœ¨å®é™…åˆ›å»ºè¡¨æ—¶ï¼Œå–åˆ°ç›¸å…³è¡¨çš„å­—æ®µï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¦‚ä¸Š3ä¸ªæ–¹é¢å­—æ®µçš„éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæƒ³åŠæ³•ä»å…¶ä»–åœ°æ–¹è·å–&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. æ•°æ®è¯´æ˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;äº‹å®è¡¨ç±»å‹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šç´¯è®¡å‹å¿«ç…§äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ¯ä¸ªåˆ†åŒºæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šæ˜¯åˆ†åŒºè¡¨ï¼Œå½“å¤©æ·»åŠ æ•°æ®æ—¶ï¼Œå½“å¤©çš„åˆ†åŒºä¸­åªæœ‰æ–°å¢æ•°æ®ï¼Œè€Œå˜åŒ–çš„æ•°æ®ï¼Œä¼šå°†æ—§åˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¸€è¡Œæ•°æ®&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼šä¸€è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªä¼˜æƒ åˆ¸çš„ä½¿ç”¨æƒ…å†µ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. æ•°æ®çš„ç»´æŠ¤</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   å’Œä¼˜æƒ åˆ¸äº‹å®è¡¨çš„å·®å¼‚åœ¨ä¸ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   aã€è®¢å•è¡¨çš„ç”Ÿå‘½å‘¨æœŸéœ€è¦å’Œå…¶ä»–è¡¨join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   bã€åŒæ—¶éœ€è¦å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   ç”±äºæ—¶é—´åŸå› ï¼Œè¿™ä¸ªè¡¨å°±ä¸å†ä¸€ä¸€åˆ†æã€‚</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 6. ç´¯ç§¯æ€§å¿«ç…§äº‹å®è¡¨å¿…é¡»æ˜¯åˆ†åŒºè¡¨ï¼Œå¦åˆ™æ¯æ¬¡ä¿®æ”¹æ•°æ®éƒ½éœ€è¦å…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆæ•°æ®çš„éå¸¸ä½ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 7. æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»º -&gt; æ”¯ä»˜ -&gt; å–æ¶ˆ -&gt; å®Œæˆ -&gt; é€€æ¬¾ -&gt; é€€æ¬¾å®Œæˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å»ºè¡¨</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">drop</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_info;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">create</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> external</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_info (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•ç¼–å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `order_status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•çŠ¶æ€&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `user_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨æˆ·id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `out_trade_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æµæ°´å·&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `create_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åˆ›å»ºæ—¶é—´(æœªæ”¯ä»˜çŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `payment_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ”¯ä»˜æ—¶é—´(å·²æ”¯ä»˜çŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `cancel_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å–æ¶ˆæ—¶é—´(å·²å–æ¶ˆçŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `finish_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;å®Œæˆæ—¶é—´(å·²å®ŒæˆçŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾æ—¶é—´(é€€æ¬¾ä¸­çŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `refund_finish_time`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;é€€æ¬¾å®Œæˆæ—¶é—´(é€€æ¬¾å®ŒæˆçŠ¶æ€)&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `province_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;çœä»½ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `activity_id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;æ´»åŠ¨ID&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `original_total_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;åŸä»·é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `benefit_reduce_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¼˜æƒ é‡‘é¢&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `feight_fee`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è¿è´¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    `final_total_amount`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;è®¢å•é‡‘é¢&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">PARTITIONED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#98C379;--shiki-dark:#98C379;">`dt`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> string)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">stored </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> parquet</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/warehouse/gmall/dwd/dwd_fact_order_info/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">tblproperties (</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;parquet.compression&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;lzo&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿ç”¨ç”¨å‡½æ•°</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¼ å¤šä¸ªå­—ç¬¦, å¤šå­—ç¬¦æ‹¼æ¥åœ¨ä¸€èµ·, å¦‚æœé‡Œé¢æœ‰null, åˆ™æœ€ç»ˆç»“æœä¸ºnull</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_status,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, operate_time) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ•°ç»„</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id, collect_set(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_status,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,operate_time)) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> group by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¼ ä¸€ä¸ªåˆ†éš”ç¬¦, å’Œä¸€ä¸ªå­—ç¬¦. åˆ™ä¼šä½¿ç”¨æ‹¼æ¥èµ·æ¥</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id, concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, collect_set(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_status,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,operate_time))) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> group by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- map</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id, str_to_map(concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,collect_set(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_status,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,operate_time))), </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ,  </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> group by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id;</span></span></code></pre></div><ul><li>æ’å…¥æ•°æ®</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dynamic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.mode</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">nonstrict;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> overwrite </span><span style="color:#C678DD;--shiki-dark:#C678DD;">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(dt)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_status</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">out_trade_no</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">out_trade_no</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">out_trade_no</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1001&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1001&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--1001å¯¹åº”æœªæ”¯ä»˜çŠ¶æ€</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1002&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">payment_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1002&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1003&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">cancel_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1003&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1004&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">finish_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1004&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1005&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">refund_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1005&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1006&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">refund_finish_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1006&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">province_id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">province_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">province_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">original_total_amount</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">original_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">original_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_reduce_amount</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_reduce_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_reduce_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">feight_fee</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">feight_fee</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">feight_fee</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">final_total_amount</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">final_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">final_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1001&#39;]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> is</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">create_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[&#39;1001&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        order_status,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        user_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        out_trade_no,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        create_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        payment_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        cancel_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        finish_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        refund_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        refund_finish_time,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        province_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        activity_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        original_total_amount,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        benefit_reduce_amount,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        feight_fee,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        final_total_amount</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dwd_fact_order_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    in</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">          date_format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(create_time,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;yyyy-MM-dd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)old</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">full outer join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    select</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">out_trade_no</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">province_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        act</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">activity_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">original_total_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">benefit_reduce_amount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">feight_fee</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">final_total_amount</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    from</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            order_id,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            str_to_map(concat_ws(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,collect_set(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order_status,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,operate_time))),</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) tms</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_status_log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        group by</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> order_id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )</span><span style="color:#C678DD;--shiki-dark:#C678DD;">log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_order_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )info</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    left join</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ods_activity_order </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-06-25&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    )act</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">act</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">order_id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)new</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">on</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-4-dwdå±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥" tabindex="-1"><a class="header-anchor" href="#_4-3-4-dwdå±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥"><span>4.3.4 DWDå±‚ä¸šåŠ¡æ•°æ®å¯¼å…¥</span></a></h4><ol><li>åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬ods_to_dwd_db.sh</li></ol><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[atguigu@hadoop102 bin]$ vim ods_to_dwd_db.sh</span></span></code></pre></div><ol start="2"><li>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</li></ol><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">gmall</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">hive</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/opt/module/hive/bin/hive</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-n</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ] ;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    do_date</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">date</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;-1 day&quot; +%F`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">set mapreduce.job.queuename=hive;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">set hive.exec.dynamic.partition.mode=nonstrict;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">SET hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_sku_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.spu_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.price,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.sku_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.sku_desc,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.weight,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.tm_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ob.tm_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.category3_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    c2.id category2_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    c1.id category1_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    c3.name category3_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    c2.name category2_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    c1.name category1_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    spu.spu_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku.create_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_sku_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)sku</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_trademark where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)ob on sku.tm_id=ob.tm_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_spu_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)spu on spu.id = sku.spu_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category3 where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)c3 on sku.category3_id=c3.id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category2 where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)c2 on c3.category2_id=c2.id </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_category1 where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)c1 on c2.category1_id=c1.id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_coupon_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    coupon_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    coupon_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    condition_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    condition_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    activity_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    benefit_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    benefit_discount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    range_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    spu_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    tm_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    category3_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    limit_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    expire_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_coupon_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_activity_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.activity_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.activity_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    rule.condition_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    rule.condition_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    rule.benefit_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    rule.benefit_discount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    rule.benefit_level,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.start_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.end_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    info.create_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">left join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_rule where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)rule on info.id = rule.activity_id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_order_detail partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    order_price,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    province_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    source_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    source_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    original_amount_d,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(rn=1,final_total_amount-(sum_div_final_amount-final_amount_d),final_amount_d),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(rn=1,feight_fee-(sum_div_feight_fee-feight_fee_d),feight_fee_d),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(rn=1,benefit_reduce_amount-(sum_div_benefit_reduce_amount-benefit_reduce_amount_d),benefit_reduce_amount_d)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.sku_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.order_price,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.sku_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        oi.province_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.source_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        od.source_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        round(od.order_price*od.sku_num,2) original_amount_d,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        round(od.order_price*od.sku_num/oi.original_total_amount*oi.final_total_amount,2) final_amount_d,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        round(od.order_price*od.sku_num/oi.original_total_amount*oi.feight_fee,2) feight_fee_d,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        round(od.order_price*od.sku_num/oi.original_total_amount*oi.benefit_reduce_amount,2) benefit_reduce_amount_d,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        row_number() over(partition by od.order_id order by od.id desc) rn,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        oi.final_total_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        oi.feight_fee,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        oi.benefit_reduce_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        sum(round(od.order_price*od.sku_num/oi.original_total_amount*oi.final_total_amount,2)) over(partition by od.order_id) sum_div_final_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        sum(round(od.order_price*od.sku_num/oi.original_total_amount*oi.feight_fee,2)) over(partition by od.order_id) sum_div_feight_fee,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        sum(round(od.order_price*od.sku_num/oi.original_total_amount*oi.benefit_reduce_amount,2)) over(partition by od.order_id) sum_div_benefit_reduce_amount</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_detail where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ) od</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    join </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ) oi</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    on od.order_id=oi.id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)t1;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_payment_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.out_trade_no,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.alipay_trade_no,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.total_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.subject,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.payment_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    pi.payment_time,          </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    oi.province_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_payment_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)pi</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select id, province_id from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)oi</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">on pi.order_id = oi.id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_order_refund_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    refund_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    refund_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    refund_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    refund_reason_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_refund_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_comment_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    spu_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    appraise,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_comment_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_cart_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    cart_price,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_num,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    is_ordered,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    order_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    source_type,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    source_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_cart_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_favor_info partition(dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    sku_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    spu_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    is_cancel,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    cancel_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_favor_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_coupon_use partition(dt)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.id is null,old.id,new.id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.coupon_id is null,old.coupon_id,new.coupon_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.user_id is null,old.user_id,new.user_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.order_id is null,old.order_id,new.order_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.coupon_status is null,old.coupon_status,new.coupon_status),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.get_time is null,old.get_time,new.get_time),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.using_time is null,old.using_time,new.using_time),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.used_time is null,old.used_time,new.used_time),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    date_format(if(new.get_time is null,old.get_time,new.get_time),&#39;yyyy-MM-dd&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        coupon_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        coupon_status,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        get_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        using_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        used_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_coupon_use</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    where dt in</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            date_format(get_time,&#39;yyyy-MM-dd&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_coupon_use</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    )</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)old</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">full outer join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        coupon_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        coupon_status,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        get_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        using_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        used_time</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_coupon_use</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)new</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">on old.id=new.id;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_order_info partition(dt)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.id is null,old.id,new.id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.order_status is null,old.order_status,new.order_status),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.user_id is null,old.user_id,new.user_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.out_trade_no is null,old.out_trade_no,new.out_trade_no),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1001&#39;] is null,old.create_time,new.tms[&#39;1001&#39;]),--1001å¯¹åº”æœªæ”¯ä»˜çŠ¶æ€</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1002&#39;] is null,old.payment_time,new.tms[&#39;1002&#39;]),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1003&#39;] is null,old.cancel_time,new.tms[&#39;1003&#39;]),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1004&#39;] is null,old.finish_time,new.tms[&#39;1004&#39;]),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1005&#39;] is null,old.refund_time,new.tms[&#39;1005&#39;]),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.tms[&#39;1006&#39;] is null,old.refund_finish_time,new.tms[&#39;1006&#39;]),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.province_id is null,old.province_id,new.province_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.activity_id is null,old.activity_id,new.activity_id),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.original_total_amount is null,old.original_total_amount,new.original_total_amount),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.benefit_reduce_amount is null,old.benefit_reduce_amount,new.benefit_reduce_amount),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.feight_fee is null,old.feight_fee,new.feight_fee),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    if(new.final_total_amount is null,old.final_total_amount,new.final_total_amount),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    date_format(if(new.tms[&#39;1001&#39;] is null,old.create_time,new.tms[&#39;1001&#39;]),&#39;yyyy-MM-dd&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        order_status,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        out_trade_no,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        payment_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        cancel_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        finish_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        refund_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        refund_finish_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        province_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        activity_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        original_total_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        benefit_reduce_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        feight_fee,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        final_total_amount</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_fact_order_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    where dt</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    in</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">          date_format(create_time,&#39;yyyy-MM-dd&#39;)</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    )</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)old</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">full outer join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.order_status,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.user_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.out_trade_no,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.province_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        act.activity_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        log.tms,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.original_total_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.benefit_reduce_amount,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.feight_fee,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        info.final_total_amount</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            order_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            str_to_map(concat_ws(&#39;,&#39;,collect_set(concat(order_status,&#39;=&#39;,operate_time))),&#39;,&#39;,&#39;=&#39;) tms</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_status_log</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        group by order_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    )log</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_order_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    )info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    on log.order_id=info.id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    left join</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_activity_order where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    )act</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    on log.order_id=act.order_id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)new</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">on old.id=new.id;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_base_province</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    bp.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    bp.name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    bp.area_code,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    bp.iso_code,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    bp.region_id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    br.region_name</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_province bp</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">join ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_base_region br</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">on bp.region_id=br.id;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">sql3</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_user_info_his_tmp</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select * from </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        birthday,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        gender,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        email,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        user_level,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39; start_date,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;9999-99-99&#39; end_date</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_user_info where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    union all </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    select </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.id,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.name,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.birthday,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.gender,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.email,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.user_level,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.create_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.operate_time,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        uh.start_date,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        if(ui.id is not null  and uh.end_date=&#39;9999-99-99&#39;, date_add(ui.dt,-1), uh.end_date) end_date</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_user_info_his uh left join </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        select</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">            *</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.ods_user_info</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        where dt=&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$do_date</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ) ui on uh.id=ui.id</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">)his </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">order by his.id, start_date;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">insert overwrite table ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_user_info_his </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">select * from ${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">APP</span><span style="color:#98C379;--shiki-dark:#98C379;">}.dwd_dim_user_info_his_tmp;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">case</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;first&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    $hive</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql1$sql2</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">};;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;all&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    $hive</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sql1$sql3</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">};;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">esac</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>è„šæœ¬çš„ä½¿ç”¨</li></ol><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ chmod 777 ods_to_dwd_db.sh</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3ï¼‰åˆæ¬¡å¯¼å…¥</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ï¼ˆ1ï¼‰æ—¶é—´ç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‚ç…§4.4.5èŠ‚æ•°æ®è£…è½½</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ï¼ˆ2ï¼‰ç”¨æˆ·ç»´åº¦è¡¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‚ç…§4.4.14èŠ‚æ‹‰é“¾è¡¨åˆå§‹åŒ–</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ï¼ˆ3ï¼‰å…¶ä½™è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ ods_to_dwd_db.sh first 2020-06-25</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4ï¼‰æ¯æ—¥å®šæ—¶å¯¼å…¥</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[atguigu@hadoop102 bin]$ ods_to_dwd_db.sh all 2020-06-26</span></span></code></pre></div><h4 id="_4-3-5-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_4-3-5-æ€»ç»“"><span>4.3.5 æ€»ç»“</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. ä¸åŒç±»å‹çš„äº‹å®è¡¨ï¼Œä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼Ÿ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       aã€äº‹åŠ¡å‹äº‹å®è¡¨ï¼Œæ–°å¢ç­–ç•¥ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©æ–°å¢çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       bã€å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ï¼šå…¨é‡ç­–ç•¥ï¼Œæ¯ä¸ªåˆ†åŒºå­˜å‚¨å½“å¤©çš„mysqlä¸­æ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       cã€ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨ï¼šæ–°å¢å˜åŒ–ç­–ç•¥ï¼Œå½“å¤©æ–°åˆ†åŒºå­˜å‚¨æ–°å¢çš„æ•°æ®ï¼ŒåŒæ—¶ä¼šä¿®æ”¹æ—§åˆ†åŒºä¸­æ”¹å˜çš„æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. æ‹‰é“¾è¡¨ä¸ç´¯ç§¯å‹äº‹å®è¡¨ä¹‹é—´çš„å·®åˆ«</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;ç›¸åŒç‚¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        aã€åŒæ­¥ç­–ç•¥ç›¸åŒ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        bã€ç»´æŠ¤æ•°æ®æ—¶ï¼Œéƒ½æ¶‰åŠåˆ°ä¿®æ”¹åŸè¡¨ä¸­çš„æ—§æ•°æ®</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        cã€åŠŸèƒ½ç›¸ä¼¼ï¼šéƒ½å¯ä»¥è¿½æº¯ä¸šåŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¿å­˜äº†æ•°æ®çš„å†å²çŠ¶æ€</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;ä¸åŒç‚¹&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    aã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ç”¨é€”ä¸åŒ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨ï¼šæ˜¯äº‹å®è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           æ‹‰é“¾è¡¨ï¼šæ˜¯ç»´åº¦è¡¨ï¼Œè€Œä¸”æ˜¯ç¼“æ…¢å˜åŒ–ç»´</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    bã€</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ä¿ç•™å†å²æ•°æ®çš„æ–¹å¼ä¸åŒ&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨ï¼šå†å²çŠ¶æ€çš„æ•°æ®ä¿ç•™åœ¨ä¸€è¡Œä¸­</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           æ‹‰é“¾è¡¨ï¼šä¸€ä¸ªçŠ¶æ€ä¸€è¡Œæ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 3. åŠ¨æ€åˆ†åŒºè¡¨å¿…é¡»è®¾ç½®éä¸¥æ ¼æ¨¡å¼ã€‚</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      set</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">dynamic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.mode</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">nonstrict;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- 4. å…³äºå­˜å‚¨æ ¼å¼é—®é¢˜ï¼š</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. odså±‚çš„æ•°æ®ï¼šé‡‡ç”¨lzoå‹ç¼©ï¼Œå› ä¸ºdwdå±‚ä»odså–æ•°æ®æ—¶ï¼ŒåŸºæœ¬ä¸Šæ˜¯å…¨éƒ¨è¦ï¼Œå¹¶ä¸ä¼šæŸ¥æŸä¸€åˆ—çš„æ•°æ®ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. å…¶ä»–å±‚çš„æ•°æ®ï¼šé‡‡ç”¨åˆ—å¼å­˜å‚¨</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. åˆ—å¼å­˜å‚¨ï¼šè‡ªå¸¦åˆ‡ç‰‡åŠŸèƒ½ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼ŒæŸ¥è¯¢æŸä¸€åˆ—çš„æ•ˆç‡æ˜¯éå¸¸é«˜</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. lzoå­˜å‚¨ï¼šåªæœ‰lzopçš„å‹ç¼©æ ¼å¼æ”¯æŒåˆ‡ç‰‡ï¼Œè€Œä¸”éœ€è¦åˆ›å»ºç´¢å¼•æ–‡ä»¶æ‰èƒ½å®ç°åˆ‡ç‰‡ã€‚</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">       5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. dwdå±‚è¯»å–odsçš„æ•°æ®æ—¶ï¼Œä¸ºäº†é¿å…ç´¢å¼•æ–‡ä»¶è¢«è¯»å–åˆ°æ•°æ®ä¸­ï¼Œéœ€è¦è®¾ç½®ï¼šè¿™æ ·ç´¢å¼•æ–‡ä»¶ä¼šè¢«è¿‡æ»¤</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">          SET</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.format</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hadoop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">hive</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">ql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">io</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.HiveInputFormat;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. åˆ†åŒºè¡¨ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      odsã€dwdã€dwså±‚æ•°æ®ä¸ºåˆ†åŒºè¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      dwtã€adsä¸æ˜¯åˆ†åŒºè¡¨ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><div class="sponsor" data-v-98f29c97><div id="drinks-box" data-v-98f29c97><div id="drinks-box-s" class="drinks-button left-100" data-v-98f29c97><div id="drinks-icons" class="left-100 tr3" data-v-98f29c97><div id="coffee-donate" class="icon-donate" data-v-98f29c97><span class="font-icon icon iconfont icon-hk-flutter" data-v-98f29c97></span> èµåŠ© </div></div><div id="drinks-button-box" class="tr3 left-100" data-v-98f29c97><div id="drinks-button-bg" class="left-100" data-v-98f29c97></div><div id="github-box" data-v-98f29c97><a href="https://github.com/OrageKK/sponsor-page" target="_blank" data-v-98f29c97>Github</a></div><ul id="donate-buttons" class="list tr3" data-v-98f29c97><li id="paypal_donate" data-v-98f29c97><a href="https://www.paypal.me/oragekk" target="_blank" data-v-98f29c97>Paypal</a></li><!-- <li id="btc_donate" class="donate-button">Bitcoin</li> --><li id="alipay_donate" class="donate-button" data-v-98f29c97>AliPay</li><li id="wechat_donate" class="donate-button2" data-v-98f29c97>WeChat</li></ul></div><div id="drinks-qrcodes" class="left-100 tr3" data-v-98f29c97><div id="drinks-qrcode" data-v-98f29c97></div></div></div></div></div><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/MrjackC/mrjackc.github.io/edit/main/src/posts/BigData/11_æ•°ä»“/ç”µå•†æ•°ä»“ç³»ç»Ÿ(ä¸€).md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 845886914@qq.com">MrJason</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E9%A1%B9%E7%9B%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85.html" aria-label="æ•°ä»“é¡¹ç›®è¡¥å……"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->æ•°ä»“é¡¹ç›®è¡¥å……</div></a><a class="route-link auto-link next" href="/posts/BigData/11_%E6%95%B0%E4%BB%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E7%B3%BB%E7%BB%9F(%E4%BA%8C).html" aria-label="ç”µå•†æ•°ä»“ç³»ç»Ÿ(äºŒ)"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">ç”µå•†æ•°ä»“ç³»ç»Ÿ(äºŒ)<!----></div></a></nav><div id="vp-comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-reaction"><div class="wl-reaction-title">ä½ è®¤ä¸ºè¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼Ÿ</div><ul class="wl-reaction-list"><!--[--><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_agree.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_look_down.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sunglasses.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_pick_nose.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_awkward.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sleep.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><!--]--></ul></div><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€(å¯é€‰)</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" aria-hidden="true" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡" aria-label="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <span> Â /Â  <span class="">300</span></span> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v3.3.2</div></div></div><!----><!--]--></main><!--]--><div style="--0dfcb062:;"><footer class="footer-wrapper" style="display:none;"><div class="busuanzi"><span id="busuanzi_container_site_pv" style="display:none;"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span>æ¬¡ <span class="post-meta-divider">|</span></span><span id="busuanzi_container_site_uv" style="display:none;"> æ‚¨æ˜¯æœ¬ç«™ç¬¬ <span id="busuanzi_value_site_uv"></span>ä½è®¿é—®è€… </span></div><div class="footer-content"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2020-2024 MrJason</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="å¼€å¾€-å‹é“¾æ¥åŠ›"></a></div></footer></div></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BOcQBfH9.js" defer></script>
  </body>
</html>
