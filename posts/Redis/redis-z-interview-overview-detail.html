<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mrjackc.github.io/posts/Redis/redis-z-interview-overview-detail.html"><meta property="og:site_name" content="mrjasonâ€™s Blog"><meta property="og:title" content="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)"><meta property="og:description" content="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ) 1. å¸¸è§„é—®é¢˜ 1.1 ä»€ä¹ˆæ˜¯Redisï¼Œä¸ºä»€ä¹ˆç”¨Redisï¼Ÿ Redisæ˜¯ä¸€ç§æ”¯æŒkey-valueç­‰å¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ç³»ç»Ÿã€‚å¯ç”¨äºç¼“å­˜ï¼Œäº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ï¼Œé«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚æ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œï¼Œåˆ—è¡¨ï¼Œé˜Ÿåˆ—ï¼Œé›†åˆç»“æ„ç›´æ¥å­˜å–ï¼ŒåŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚ è¯»å†™æ€§èƒ½ä¼˜å¼‚ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/..."><meta property="og:type" content="article"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037008.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-21T07:03:09.000Z"><meta property="article:author" content="MrJason"><meta property="article:modified_time" content="2024-10-21T07:03:09.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)","image":["https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037008.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037061.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037094.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037125.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037160.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037186.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037212.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037241.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037262.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037288.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037310.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037336.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037361.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037385.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037413.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037448.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037477.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037507.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037545.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037568.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037602.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037631.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037657.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037685.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037722.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037758.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037796.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037828.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037869.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037899.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037931.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037955.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037987.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/image-20220628232200617-1684919697045-787.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/image-20220628232219119-1684919697045-789.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037021.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037049.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037080.png","https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037129.png"],"dateModified":"2024-10-21T07:03:09.000Z","author":[{"@type":"Person","name":"MrJason","url":"https://mrjackc.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://mrjackc.github.io/rss.xml" title="mrjasonâ€™s Blog RSS Feed"><title>Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ) | mrjasonâ€™s Blog</title><meta name="description" content="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ) 1. å¸¸è§„é—®é¢˜ 1.1 ä»€ä¹ˆæ˜¯Redisï¼Œä¸ºä»€ä¹ˆç”¨Redisï¼Ÿ Redisæ˜¯ä¸€ç§æ”¯æŒkey-valueç­‰å¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ç³»ç»Ÿã€‚å¯ç”¨äºç¼“å­˜ï¼Œäº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ï¼Œé«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚æ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œï¼Œåˆ—è¡¨ï¼Œé˜Ÿåˆ—ï¼Œé›†åˆç»“æ„ç›´æ¥å­˜å–ï¼ŒåŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚ è¯»å†™æ€§èƒ½ä¼˜å¼‚ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/...">
    <link rel="preload" href="/assets/style-D5zIXRKB.css" as="style"><link rel="stylesheet" href="/assets/style-D5zIXRKB.css">
    <link rel="modulepreload" href="/assets/app-BQBjlK2G.js"><link rel="modulepreload" href="/assets/redis-z-interview-overview-detail.html-C5WRhliz.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">mrjasonâ€™s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="å¯¼èˆª"><!--[--><span class="font-icon icon iconfont icon-discover" style=""></span><!--]-->å¯¼èˆª<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç¬”è®°åˆ†ç±»"><!--[--><span class="font-icon icon iconfont icon-edit" style=""></span>ç¬”è®°åˆ†ç±»<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">ä»£ç ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Computer-Basics/" aria-label="è®¡ç®—æœºåŸºç¡€"><!--[--><span class="font-icon icon iconfont icon-windows" style=""></span><!--]-->è®¡ç®—æœºåŸºç¡€<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Data-Structure/" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><!--[--><span class="font-icon icon iconfont icon-calculate" style=""></span><!--]-->æ•°æ®ç»“æ„ä¸ç®—æ³•<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Web/" aria-label="å‰ç«¯ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->å‰ç«¯ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Python/" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->Python<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Database/" aria-label="æ•°æ®åº“"><!--[--><span class="font-icon icon iconfont icon-table" style=""></span><!--]-->æ•°æ®åº“<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Docker/" aria-label="Docker"><!--[--><span class="font-icon icon iconfont icon-expansion" style=""></span><!--]-->Docker<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Git/" aria-label="Git"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->Git<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/posts/Redis/" aria-label="Redis"><!--[--><span class="font-icon icon iconfont icon-lock" style=""></span><!--]-->Redis<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/MiddleWare/" aria-label="ä¸­é—´ä»¶"><!--[--><span class="font-icon icon iconfont icon-process" style=""></span><!--]-->ä¸­é—´ä»¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/BigData/" aria-label="å¤§æ•°æ®"><!--[--><span class="font-icon icon iconfont icon-hot" style=""></span><!--]-->å¤§æ•°æ®<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Architect/" aria-label="æ¶æ„å¸ˆ"><!--[--><span class="font-icon icon iconfont icon-study" style=""></span><!--]-->æ¶æ„å¸ˆ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Daily-Thoughts/" aria-label="æ—¥å¸¸æ€è€ƒ"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->æ—¥å¸¸æ€è€ƒ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Development-Tools/" aria-label="å¼€å‘å·¥å…·"><!--[--><span class="font-icon icon iconfont icon-tool" style=""></span><!--]-->å¼€å‘å·¥å…·<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">åšå®¢ç›¸å…³</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/" aria-label="åšå®¢ç›¸å…³"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span><!--]-->åšå®¢ç›¸å…³<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/posts/Java/" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/collect.html" aria-label="æ”¶è—"><!--[--><span class="font-icon icon iconfont icon-hk-shoucang1" style=""></span><!--]-->æ”¶è—<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/news/" aria-label="è¯´è¯´"><!--[--><span class="font-icon icon iconfont icon-news" style=""></span><!--]-->è¯´è¯´<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="ç•™è¨€æ¿"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->ç•™è¨€æ¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->å‹é“¾<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å…³äº"><!--[--><span class="font-icon icon iconfont icon-info" style=""></span>å…³äº<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/intro.html" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-people" style=""></span><!--]-->å…³äºæˆ‘<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="å…³äºæœ¬ç«™"><!--[--><span class="font-icon icon iconfont icon-info" style=""></span><!--]-->å…³äºæœ¬ç«™<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/MrjackC/mrjackc.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="å¼€å¾€" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-introduce.html" aria-label="Rediså…¥é—¨ - Redisæ¦‚å¿µå’ŒåŸºç¡€"><!---->Rediså…¥é—¨ - Redisæ¦‚å¿µå’ŒåŸºç¡€<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-data-types.html" aria-label="Rediså…¥é—¨ - æ•°æ®ç±»å‹ï¼š5ç§åŸºç¡€æ•°æ®ç±»å‹è¯¦è§£"><!---->Rediså…¥é—¨ - æ•°æ®ç±»å‹ï¼š5ç§åŸºç¡€æ•°æ®ç±»å‹è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-data-type-special.html" aria-label="Rediså…¥é—¨ - 3ç§ç‰¹æ®Šç±»å‹è¯¦è§£"><!---->Rediså…¥é—¨ - 3ç§ç‰¹æ®Šç±»å‹è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-data-type-stream.html" aria-label="Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šStreamè¯¦è§£"><!---->Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šStreamè¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-redis-object.html" aria-label="Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šå¯¹è±¡æœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - æ•°æ®ç±»å‹ï¼šå¯¹è±¡æœºåˆ¶è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-rdb-aof.html" aria-label="Redisè¿›é˜¶ - æŒä¹…åŒ–ï¼šRDBå’ŒAOFæœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - æŒä¹…åŒ–ï¼šRDBå’ŒAOFæœºåˆ¶è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-pub-sub.html" aria-label="Redisè¿›é˜¶ - æ¶ˆæ¯ä¼ é€’ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼è¯¦è§£"><!---->Redisè¿›é˜¶ - æ¶ˆæ¯ä¼ é€’ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-event.html" aria-label="Redisè¿›é˜¶ - äº‹ä»¶ï¼šRedisäº‹ä»¶æœºåˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - äº‹ä»¶ï¼šRedisäº‹ä»¶æœºåˆ¶è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-trans.html" aria-label="Redisè¿›é˜¶ - äº‹åŠ¡ï¼šRedisäº‹åŠ¡è¯¦è§£"><!---->Redisè¿›é˜¶ - äº‹åŠ¡ï¼šRedisäº‹åŠ¡è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-copy.html" aria-label="Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-y-install-sentinel.html" aria-label="Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-cluster.html" aria-label="Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£"><!---->Redisè¿›é˜¶ - é«˜å¯æ‹“å±•ï¼šåˆ†ç‰‡æŠ€æœ¯ï¼ˆRedis Clusterï¼‰è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-consistency.html" aria-label="Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><!---->Redisè¿›é˜¶ - å¦‚ä½•ä¿éšœMySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-cache.html" aria-label="Redisè¿›é˜¶ -  Redisç¼“å­˜é—®é¢˜ï¼šä¸€è‡´æ€§, ç©¿å‡», ç©¿é€, é›ªå´©, æ±¡æŸ“ç­‰"><!---->Redisè¿›é˜¶ -  Redisç¼“å­˜é—®é¢˜ï¼šä¸€è‡´æ€§, ç©¿å‡», ç©¿é€, é›ªå´©, æ±¡æŸ“ç­‰<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-hot-key.html" aria-label="Redisè¿›é˜¶ - Redisçƒ­keyé—®é¢˜"><!---->Redisè¿›é˜¶ - Redisçƒ­keyé—®é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-x-performance.html" aria-label="Redisè¿›é˜¶ - æ€§èƒ½è°ƒä¼˜ï¼šRedisæ€§èƒ½è°ƒä¼˜è¯¦è§£"><!---->Redisè¿›é˜¶ - æ€§èƒ½è°ƒä¼˜ï¼šRedisæ€§èƒ½è°ƒä¼˜è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-overview.html" aria-label="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“"><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/posts/Redis/redis-z-interview-overview-detail.html" aria-label="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)"><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-basic.html" aria-label="Redisé¢è¯• - å¸¸è§„é—®é¢˜"><!---->Redisé¢è¯• - å¸¸è§„é—®é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-datatype.html" aria-label="Redisé¢è¯• - æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„"><!---->Redisé¢è¯• - æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-persistence.html" aria-label="Redisé¢è¯• - æŒä¹…åŒ–å’Œå†…å­˜"><!---->Redisé¢è¯• - æŒä¹…åŒ–å’Œå†…å­˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-tran.html" aria-label="Redisé¢è¯• - äº‹åŠ¡"><!---->Redisé¢è¯• - äº‹åŠ¡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-master-salve.html" aria-label="Redisé¢è¯• - é›†ç¾¤-ä¸»ä»å¤åˆ¶"><!---->Redisé¢è¯• - é›†ç¾¤-ä¸»ä»å¤åˆ¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-sentinel.html" aria-label="Redisé¢è¯• - é›†ç¾¤-å“¨å…µæœºåˆ¶"><!---->Redisé¢è¯• - é›†ç¾¤-å“¨å…µæœºåˆ¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-apply.html" aria-label="Redisé¢è¯• - åº”ç”¨åœºæ™¯"><!---->Redisé¢è¯• - åº”ç”¨åœºæ™¯<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-cluster.html" aria-label="Redisé¢è¯• - é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯"><!---->Redisé¢è¯• - é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-new.html" aria-label="Redisé¢è¯• - æ–°ç‰ˆæœ¬"><!---->Redisé¢è¯• - æ–°ç‰ˆæœ¬<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-z-interview-other.html" aria-label="Redisé¢è¯• -  å…¶ä»–ç‰¹æ€§"><!---->Redisé¢è¯• -  å…¶ä»–ç‰¹æ€§<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-question-double-write.html" aria-label="Redisä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§"><!---->Redisä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-y-install.html" aria-label="Rediså®‰è£…"><!---->Rediså®‰è£…<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-y-action-bloom.html" aria-label="Rediså¸ƒéš†è¿‡æ»¤å™¨"><!---->Rediså¸ƒéš†è¿‡æ»¤å™¨<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-cache-penetration.html" aria-label="Redisç¼“å­˜ç©¿é€"><!---->Redisç¼“å­˜ç©¿é€<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-question-ache-valanche.html" aria-label="Redisç¼“å­˜é›ªå´©"><!---->Redisç¼“å­˜é›ªå´©<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-questuin-cache-warm-up.html" aria-label="Redisç¼“å­˜é¢„çƒ­"><!---->Redisç¼“å­˜é¢„çƒ­<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-y-action-client.html" aria-label="redisè¿æ¥å®¢æˆ·ç«¯é€‰æ‹©ï¼šJedis,Redisson,Lettuce"><!---->redisè¿æ¥å®¢æˆ·ç«¯é€‰æ‹©ï¼šJedis,Redisson,Lettuce<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-hash.html" aria-label="Redisé›†ç¾¤ï¼šhashå¯»å€ç®—æ³•"><!---->Redisé›†ç¾¤ï¼šhashå¯»å€ç®—æ³•<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-sentinel-install.html" aria-label="Redisé›†ç¾¤æ­å»ºè¯¦è§£"><!---->Redisé›†ç¾¤æ­å»ºè¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-y-action-springboot.html" aria-label="Spring Booté›†æˆredisä½¿ç”¨"><!---->Spring Booté›†æˆredisä½¿ç”¨<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-y-action.html" aria-label="SpringBooté›†æˆredisé¡¹ç›®èŒƒä¾‹"><!---->SpringBooté›†æˆredisé¡¹ç›®èŒƒä¾‹<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-x-quest-key.html" aria-label="å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜"><!---->å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/db-redis-y-install-remote.html" aria-label="å¼€å¯è¿œç¨‹è®¿é—®"><!---->å¼€å¯è¿œç¨‹è®¿é—®<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/redis-y-action-gen-test-data.html" aria-label="æ‰¹é‡ç”Ÿæˆredisæµ‹è¯•æ•°æ®æ–¹æ³•"><!---->æ‰¹é‡ç”Ÿæˆredisæµ‹è¯•æ•°æ®æ–¹æ³•<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/%E7%AC%AC%E4%B8%80%E7%AB%A0%20Redis%E5%9F%BA%E7%A1%80.html" aria-label="ç¬¬ä¸€ç«  RedisåŸºç¡€"><!---->ç¬¬ä¸€ç«  RedisåŸºç¡€<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/%E7%AC%AC%E4%BA%8C%E7%AB%A0%20Redis%E9%AB%98%E7%BA%A7.html" aria-label="ç¬¬äºŒç« ï¼šRedisé«˜çº§"><!---->ç¬¬äºŒç« ï¼šRedisé«˜çº§<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mrjackc.github.io" target="_blank" rel="noopener noreferrer">MrJason</a></span><span property="author" content="MrJason"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-21T07:03:09.000Z"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/posts/Redis/redis-z-interview-overview-detail.html" data-page-key="/posts/Redis/redis-z-interview-overview-detail.html">...</span></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 70 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT70M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">æ•°æ®åº“</span><span class="page-category-item color3 clickable" role="navigation">Redis</span><!--]--><meta property="articleSection" content="æ•°æ®åº“,Redis"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-å¸¸è§„é—®é¢˜">1. å¸¸è§„é—®é¢˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-ä»€ä¹ˆæ˜¯redis-ä¸ºä»€ä¹ˆç”¨redis">1.1 ä»€ä¹ˆæ˜¯Redisï¼Œä¸ºä»€ä¹ˆç”¨Redisï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-ä¸ºä»€ä¹ˆredis-æ˜¯å•çº¿ç¨‹çš„ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«">1.2. ä¸ºä»€ä¹ˆRedis æ˜¯å•çº¿ç¨‹çš„ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-redis-ä¸€èˆ¬æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯">1.3. Redis ä¸€èˆ¬æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„">2. æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹">2.1 Redis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-è°ˆè°ˆredis-çš„å¯¹è±¡æœºåˆ¶-redisobject">2.2 è°ˆè°ˆRedis çš„å¯¹è±¡æœºåˆ¶ï¼ˆredisObject)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-redis-æ•°æ®ç±»å‹æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æ„">2.3 Redis æ•°æ®ç±»å‹æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-ä¸ºä»€ä¹ˆè¦è®¾è®¡sds">2.4 ä¸ºä»€ä¹ˆè¦è®¾è®¡sdsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-5-redis-ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘">2.5 Redis ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-6-ä¸ºä»€ä¹ˆä¼šè®¾è®¡stream">2.6 ä¸ºä»€ä¹ˆä¼šè®¾è®¡Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-7-redis-streamç”¨åœ¨ä»€ä¹ˆæ ·åœºæ™¯">2.7 Redis Streamç”¨åœ¨ä»€ä¹ˆæ ·åœºæ™¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-8-redis-streamæ¶ˆæ¯idçš„è®¾è®¡æ˜¯å¦è€ƒè™‘äº†æ—¶é—´å›æ‹¨çš„é—®é¢˜">2.8 Redis Streamæ¶ˆæ¯IDçš„è®¾è®¡æ˜¯å¦è€ƒè™‘äº†æ—¶é—´å›æ‹¨çš„é—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-9-redis-streamæ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„ä¼šä¸ä¼šæ¶ˆæ¯ä¸¢å¤±é—®é¢˜">2.9 Redis Streamæ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„ä¼šä¸ä¼šæ¶ˆæ¯ä¸¢å¤±é—®é¢˜?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-10-redis-steam-åæ¶ˆæ¯é—®é¢˜-æ­»ä¿¡é—®é¢˜">2.10 Redis Steam åæ¶ˆæ¯é—®é¢˜ï¼Œæ­»ä¿¡é—®é¢˜?</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-æŒä¹…åŒ–å’Œå†…å­˜">3. æŒä¹…åŒ–å’Œå†…å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆ-å„è‡ªçš„ä¼˜ç¼ºç‚¹-ä¸€èˆ¬æ€ä¹ˆç”¨">3.1 Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-rdb-è§¦å‘æ–¹å¼">3.2 RDB è§¦å‘æ–¹å¼?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢">3.3 é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-4-åœ¨è¿›è¡Œrdbå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´-å¦‚æœå‘ç”ŸæœåŠ¡å´©æºƒæ€ä¹ˆåŠ">3.4 åœ¨è¿›è¡ŒRDBå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´ï¼Œå¦‚æœå‘ç”ŸæœåŠ¡å´©æºƒæ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-5-å¯ä»¥æ¯ç§’åšä¸€æ¬¡rdbå¿«ç…§å—">3.5 å¯ä»¥æ¯ç§’åšä¸€æ¬¡RDBå¿«ç…§å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-6-aofæ˜¯å†™å‰æ—¥å¿—è¿˜æ˜¯å†™åæ—¥å¿—">3.6 AOFæ˜¯å†™å‰æ—¥å¿—è¿˜æ˜¯å†™åæ—¥å¿—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-7-å¦‚ä½•å®ç°aofçš„">3.7 å¦‚ä½•å®ç°AOFçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-8-ä¸‰ç§å†™å›ç­–ç•¥çš„ä¼˜ç¼ºç‚¹">3.8 ä¸‰ç§å†™å›ç­–ç•¥çš„ä¼˜ç¼ºç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-9-ä»€ä¹ˆæ˜¯aofé‡å†™">3.9 ä»€ä¹ˆæ˜¯AOFé‡å†™ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-10-aofé‡å†™ä¼šé˜»å¡å—">3.10 AOFé‡å†™ä¼šé˜»å¡å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-11-aofæ—¥å¿—ä½•æ—¶ä¼šé‡å†™">3.11 AOFæ—¥å¿—ä½•æ—¶ä¼šé‡å†™ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-12-aofé‡å†™æ—¥å¿—æ—¶-æœ‰æ–°æ•°æ®å†™å…¥å’‹æ•´">3.12 AOFé‡å†™æ—¥å¿—æ—¶ï¼Œæœ‰æ–°æ•°æ®å†™å…¥å’‹æ•´ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-13-ä¸»çº¿ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ˜¯å¦‚ä½•å¤åˆ¶å†…å­˜æ•°æ®çš„">3.13 ä¸»çº¿ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ˜¯å¦‚ä½•å¤åˆ¶å†…å­˜æ•°æ®çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-14-åœ¨é‡å†™æ—¥å¿—æ•´ä¸ªè¿‡ç¨‹æ—¶-ä¸»çº¿ç¨‹æœ‰å“ªäº›åœ°æ–¹ä¼šè¢«é˜»å¡">3.14 åœ¨é‡å†™æ—¥å¿—æ•´ä¸ªè¿‡ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹æœ‰å“ªäº›åœ°æ–¹ä¼šè¢«é˜»å¡ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-15-ä¸ºä»€ä¹ˆaofé‡å†™ä¸å¤ç”¨åŸaofæ—¥å¿—">3.15 ä¸ºä»€ä¹ˆAOFé‡å†™ä¸å¤ç”¨åŸAOFæ—¥å¿—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-16-redis-è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº›">3.16 Redis è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº›?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-17-redis-å†…å­˜æ·˜æ±°ç®—æ³•æœ‰å“ªäº›">3.17 Redis å†…å­˜æ·˜æ±°ç®—æ³•æœ‰å“ªäº›?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-18-redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ">3.18 Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-19-rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–">3.19 Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-20-redis-key-çš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®">3.20 Redis key çš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-21-redis-ä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨">3.21 Redis ä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-äº‹åŠ¡">4. äº‹åŠ¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-ä»€ä¹ˆæ˜¯redisäº‹åŠ¡">4.1 ä»€ä¹ˆæ˜¯redisäº‹åŠ¡ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-redisäº‹åŠ¡ç›¸å…³å‘½ä»¤">4.2 Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ">4.3 Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-redisäº‹åŠ¡å…¶å®ƒå®ç°">4.4 Redisäº‹åŠ¡å…¶å®ƒå®ç°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-5-redisäº‹åŠ¡ä¸­å‡ºç°é”™è¯¯çš„å¤„ç†">4.5 Redisäº‹åŠ¡ä¸­å‡ºç°é”™è¯¯çš„å¤„ç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-6-redisäº‹åŠ¡ä¸­watchæ˜¯å¦‚ä½•ç›‘è§†å®ç°çš„å‘¢">4.6 Redisäº‹åŠ¡ä¸­watchæ˜¯å¦‚ä½•ç›‘è§†å®ç°çš„å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-7-ä¸ºä»€ä¹ˆ-redis-ä¸æ”¯æŒå›æ»š">4.7 ä¸ºä»€ä¹ˆ Redis ä¸æ”¯æŒå›æ»šï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-8-redis-å¯¹-acidçš„æ”¯æŒæ€§ç†è§£">4.8 Redis å¯¹ ACIDçš„æ”¯æŒæ€§ç†è§£ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-9-redisäº‹åŠ¡å…¶ä»–å®ç°">4.9 Redisäº‹åŠ¡å…¶ä»–å®ç°ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-é›†ç¾¤-ä¸»ä»å¤åˆ¶">5. é›†ç¾¤-ä¸»ä»å¤åˆ¶</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-1-redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„">5.1 Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-redis-å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µ">5.2 Redis å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-redis-ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶">5.3 Redis ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-4-redis-å¢é‡å¤åˆ¶çš„æµç¨‹">5.4 Redis å¢é‡å¤åˆ¶çš„æµç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-5-å¢é‡å¤åˆ¶å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´-repl-backlog-sizeç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹å-ä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®-è¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢">5.5 å¢é‡å¤åˆ¶å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´ï¼Œrepl_backlog_sizeç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹åï¼Œä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®ï¼Œè¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-6-redis-ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢">5.6 Redis ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-7-redis-ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨rdbè€Œä¸ä½¿ç”¨aof">5.7 Redis ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨RDBè€Œä¸ä½¿ç”¨AOFï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-8-redis-ä¸ºä»€ä¹ˆè¿˜æœ‰æ— ç£ç›˜å¤åˆ¶æ¨¡å¼">5.8 Redis ä¸ºä»€ä¹ˆè¿˜æœ‰æ— ç£ç›˜å¤åˆ¶æ¨¡å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-9-redis-ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡">5.9 Redis ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-é›†ç¾¤-å“¨å…µæœºåˆ¶">6. é›†ç¾¤-å“¨å…µæœºåˆ¶</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-1-rediså“¨å…µæœºåˆ¶-å“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢">6.1 Rediså“¨å…µæœºåˆ¶ï¼Ÿå“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-2-redis-å“¨å…µé›†ç¾¤æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç»„å»ºçš„">6.2 Redis å“¨å…µé›†ç¾¤æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç»„å»ºçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-3-redis-å“¨å…µæ˜¯å¦‚ä½•ç›‘æ§redisé›†ç¾¤çš„">6.3 Redis å“¨å…µæ˜¯å¦‚ä½•ç›‘æ§Redisé›†ç¾¤çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-4-redis-å“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“å·²ç»ä¸‹çº¿äº†å‘¢">6.4 Redis å“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“å·²ç»ä¸‹çº¿äº†å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-4-redis-å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„">6.4 Redis å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-5-redis-1ä¸»4ä»-5ä¸ªå“¨å…µ-å“¨å…µé…ç½®quorumä¸º2-å¦‚æœ3ä¸ªå“¨å…µæ•…éšœ-å½“ä¸»åº“å®•æœºæ—¶-å“¨å…µèƒ½å¦åˆ¤æ–­ä¸»åº“-å®¢è§‚ä¸‹çº¿-èƒ½å¦è‡ªåŠ¨åˆ‡æ¢">6.5 Redis 1ä¸»4ä»ï¼Œ5ä¸ªå“¨å…µï¼Œå“¨å…µé…ç½®quorumä¸º2ï¼Œå¦‚æœ3ä¸ªå“¨å…µæ•…éšœï¼Œå½“ä¸»åº“å®•æœºæ—¶ï¼Œå“¨å…µèƒ½å¦åˆ¤æ–­ä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€ï¼Ÿèƒ½å¦è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-6-ä¸»åº“åˆ¤å®šå®¢è§‚ä¸‹çº¿äº†-é‚£ä¹ˆå¦‚ä½•ä»å‰©ä½™çš„ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ä¸»åº“å‘¢">6.6 ä¸»åº“åˆ¤å®šå®¢è§‚ä¸‹çº¿äº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä»å‰©ä½™çš„ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ä¸»åº“å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-7-æ–°çš„ä¸»åº“é€‰æ‹©å‡ºæ¥å-å¦‚ä½•è¿›è¡Œæ•…éšœçš„è½¬ç§»">6.7 æ–°çš„ä¸»åº“é€‰æ‹©å‡ºæ¥åï¼Œå¦‚ä½•è¿›è¡Œæ•…éšœçš„è½¬ç§»ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯">7. é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-1-ä»€ä¹ˆæ˜¯redis-cluster">7.1 ä»€ä¹ˆæ˜¯Redis Clusterï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-2-è¯´è¯´rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ-ä¸ºä»€ä¹ˆæ˜¯16384ä¸ª">7.2 è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿä¸ºä»€ä¹ˆæ˜¯16384ä¸ªï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—-ä¸ºä»€ä¹ˆ">7.3 Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8-åº”ç”¨åœºæ™¯">8. åº”ç”¨åœºæ™¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-1-redis-å®¢æˆ·ç«¯æœ‰å“ªäº›">8.1 Redis å®¢æˆ·ç«¯æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-2-rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥">8.2 Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-3-rediså®ç°åˆ†å¸ƒå¼é”å®ç°-ä»€ä¹ˆæ˜¯-redlock">8.3 Rediså®ç°åˆ†å¸ƒå¼é”å®ç°? ä»€ä¹ˆæ˜¯ RedLock?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-4-redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜-å¦‚ä½•è§£å†³">8.4 Redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-5-redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›-å¦‚ä½•åˆ†æå®šä½è§£å†³">8.5 Redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Œå¦‚ä½•åˆ†æå®šä½è§£å†³?</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-æ–°ç‰ˆæœ¬">9. æ–°ç‰ˆæœ¬</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-1-rediså•çº¿ç¨‹æ¨¡å‹-åœ¨6-0ä¹‹å‰å¦‚ä½•æé«˜å¤šæ ¸cpuçš„åˆ©ç”¨ç‡">9.1 Rediså•çº¿ç¨‹æ¨¡å‹ï¼Ÿ åœ¨6.0ä¹‹å‰å¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-2-redis6-0ä¹‹å‰çš„ç‰ˆæœ¬çœŸçš„æ˜¯å•çº¿ç¨‹çš„å—">9.2 Redis6.0ä¹‹å‰çš„ç‰ˆæœ¬çœŸçš„æ˜¯å•çº¿ç¨‹çš„å—?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-3-redis6-0ä¹‹å‰ä¸ºä»€ä¹ˆä¸€è‡´ä¸ç”¨å¤šçº¿ç¨‹">9.3 Redis6.0ä¹‹å‰ä¸ºä»€ä¹ˆä¸€è‡´ä¸ç”¨å¤šçº¿ç¨‹?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-4-redis6-0ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹å‘¢">9.4 Redis6.0ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-5-redis6-0é»˜è®¤æ˜¯å¦å¼€å¯äº†å¤šçº¿ç¨‹">9.5 Redis6.0é»˜è®¤æ˜¯å¦å¼€å¯äº†å¤šçº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-6-redis6-0å¤šçº¿ç¨‹å¼€å¯æ—¶-çº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®">9.6 Redis6.0å¤šçº¿ç¨‹å¼€å¯æ—¶ï¼Œçº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-7-redis6-0å¤šçº¿ç¨‹çš„å®ç°æœºåˆ¶">9.7 Redis6.0å¤šçº¿ç¨‹çš„å®ç°æœºåˆ¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-8-å¼€å¯å¤šçº¿ç¨‹å-æ˜¯å¦ä¼šå­˜åœ¨çº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜">9.8 å¼€å¯å¤šçº¿ç¨‹åï¼Œæ˜¯å¦ä¼šå­˜åœ¨çº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10-å…¶ä»–ç‰¹æ€§">10. å…¶ä»–ç‰¹æ€§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-1-redisäº‹ä»¶æœºåˆ¶">10.1 Redisäº‹ä»¶æœºåˆ¶?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-2-redisæ–‡ä»¶äº‹ä»¶çš„æ¨¡å‹">10.2 Redisæ–‡ä»¶äº‹ä»¶çš„æ¨¡å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-3-ä»€ä¹ˆæ˜¯rediså‘å¸ƒè®¢é˜…">10.3 ä»€ä¹ˆæ˜¯Rediså‘å¸ƒè®¢é˜…ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-4-rediså‘å¸ƒè®¢é˜…æœ‰å“ªä¸¤ç§æ–¹å¼">10.4 Rediså‘å¸ƒè®¢é˜…æœ‰å“ªä¸¤ç§æ–¹å¼ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="redisé¢è¯•-redisé—®é¢˜æ€»ç»“-ç­”æ¡ˆç‰ˆ" tabindex="-1"><a class="header-anchor" href="#redisé¢è¯•-redisé—®é¢˜æ€»ç»“-ç­”æ¡ˆç‰ˆ"><span>Redisé¢è¯• - redisé—®é¢˜æ€»ç»“(ç­”æ¡ˆç‰ˆ)</span></a></h1><h2 id="_1-å¸¸è§„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-å¸¸è§„é—®é¢˜"><span>1. å¸¸è§„é—®é¢˜</span></a></h2><h3 id="_1-1-ä»€ä¹ˆæ˜¯redis-ä¸ºä»€ä¹ˆç”¨redis" tabindex="-1"><a class="header-anchor" href="#_1-1-ä»€ä¹ˆæ˜¯redis-ä¸ºä»€ä¹ˆç”¨redis"><span>1.1 ä»€ä¹ˆæ˜¯Redisï¼Œä¸ºä»€ä¹ˆç”¨Redisï¼Ÿ</span></a></h3><p>Redisæ˜¯ä¸€ç§æ”¯æŒkey-valueç­‰å¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ç³»ç»Ÿã€‚å¯ç”¨äºç¼“å­˜ï¼Œäº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ï¼Œé«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚æ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œï¼Œåˆ—è¡¨ï¼Œé˜Ÿåˆ—ï¼Œé›†åˆç»“æ„ç›´æ¥å­˜å–ï¼ŒåŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚</p><ul><li>è¯»å†™æ€§èƒ½ä¼˜å¼‚ <ul><li>Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/s ï¼ˆæµ‹è¯•æ¡ä»¶è§ä¸‹ä¸€èŠ‚ï¼‰ã€‚</li></ul></li><li>æ•°æ®ç±»å‹ä¸°å¯Œ <ul><li>Redisæ”¯æŒäºŒè¿›åˆ¶æ¡ˆä¾‹çš„ Strings, Lists, Hashes, Sets åŠ Ordered Sets æ•°æ®ç±»å‹æ“ä½œã€‚</li></ul></li><li>åŸå­æ€§ <ul><li>Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶Redisè¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œå…¨å¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</li></ul></li><li>ä¸°å¯Œçš„ç‰¹æ€§ <ul><li>Redisæ”¯æŒ publish/subscribe, é€šçŸ¥, key è¿‡æœŸç­‰ç‰¹æ€§ã€‚</li></ul></li><li>æŒä¹…åŒ– <ul><li>Redisæ”¯æŒRDB, AOFç­‰æŒä¹…åŒ–æ–¹å¼</li></ul></li><li>å‘å¸ƒè®¢é˜… <ul><li>Redisæ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</li></ul></li><li>åˆ†å¸ƒå¼ <ul><li>Redis Cluster</li></ul></li></ul><h3 id="_1-2-ä¸ºä»€ä¹ˆredis-æ˜¯å•çº¿ç¨‹çš„ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¸ºä»€ä¹ˆredis-æ˜¯å•çº¿ç¨‹çš„ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><span>1.2. ä¸ºä»€ä¹ˆRedis æ˜¯å•çº¿ç¨‹çš„ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</span></a></h3><ul><li>rediså®Œå…¨åŸºäºå†…å­˜,ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œ,éå¸¸å¿«é€Ÿ.</li><li>æ•°æ®ç»“æ„ç®€å•,å¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•,redisä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„</li><li>é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹, é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶, ä¹Ÿä¸å­˜åœ¨å¤šçº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹åˆ‡æ¢è€Œæ¶ˆè€—CPU, ä¸ç”¨è€ƒè™‘å„ç§é”çš„é—®é¢˜, ä¸å­˜åœ¨åŠ é”, é‡Šæ”¾é”çš„æ“ä½œ, æ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´æ€§èƒ½æ¶ˆè€—</li><li>ä½¿ç”¨äº†å¤šè·¯IOå¤ç”¨æ¨¡å‹,éé˜»å¡IO</li><li>ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒ,å®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼åŠä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·,Redisç›´æ¥æ„å»ºäº†è‡ªå·±çš„VMæœºåˆ¶,å› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯,ä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚</li></ul><h3 id="_1-3-redis-ä¸€èˆ¬æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_1-3-redis-ä¸€èˆ¬æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯"><span>1.3. Redis ä¸€èˆ¬æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</span></a></h3><p>å¯ä»¥ç»“åˆè‡ªå·±çš„é¡¹ç›®è®²è®²ï¼Œæ¯”å¦‚</p><ul><li><strong>çƒ­ç‚¹æ•°æ®çš„ç¼“å­˜</strong></li></ul><p>ç¼“å­˜æ˜¯Redisæœ€å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œä¹‹æ‰€æœ‰è¿™ä¹ˆä½¿ç”¨ï¼Œä¸»è¦æ˜¯å› ä¸ºRedisè¯»å†™æ€§èƒ½ä¼˜å¼‚ã€‚è€Œä¸”é€æ¸æœ‰å–ä»£memcachedï¼Œæˆä¸ºé¦–é€‰æœåŠ¡ç«¯ç¼“å­˜çš„ç»„ä»¶ã€‚è€Œä¸”ï¼ŒRediså†…éƒ¨æ˜¯æ”¯æŒäº‹åŠ¡çš„ï¼Œåœ¨ä½¿ç”¨æ—¶å€™èƒ½æœ‰æ•ˆä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><ul><li><strong>é™æ—¶ä¸šåŠ¡çš„è¿ç”¨</strong></li></ul><p>redisä¸­å¯ä»¥ä½¿ç”¨expireå‘½ä»¤è®¾ç½®ä¸€ä¸ªé”®çš„ç”Ÿå­˜æ—¶é—´ï¼Œåˆ°æ—¶é—´åredisä¼šåˆ é™¤å®ƒã€‚åˆ©ç”¨è¿™ä¸€ç‰¹æ€§å¯ä»¥è¿ç”¨åœ¨é™æ—¶çš„ä¼˜æƒ æ´»åŠ¨ä¿¡æ¯ã€æ‰‹æœºéªŒè¯ç ç­‰ä¸šåŠ¡åœºæ™¯ã€‚</p><ul><li><strong>è®¡æ•°å™¨ç›¸å…³é—®é¢˜</strong></li></ul><p>redisç”±äºincrbyå‘½ä»¤å¯ä»¥å®ç°åŸå­æ€§çš„é€’å¢ï¼Œæ‰€ä»¥å¯ä»¥è¿ç”¨äºé«˜å¹¶å‘çš„ç§’æ€æ´»åŠ¨ã€åˆ†å¸ƒå¼åºåˆ—å·çš„ç”Ÿæˆã€å…·ä½“ä¸šåŠ¡è¿˜ä½“ç°åœ¨æ¯”å¦‚é™åˆ¶ä¸€ä¸ªæ‰‹æœºå·å‘å¤šå°‘æ¡çŸ­ä¿¡ã€ä¸€ä¸ªæ¥å£ä¸€åˆ†é’Ÿé™åˆ¶å¤šå°‘è¯·æ±‚ã€ä¸€ä¸ªæ¥å£ä¸€å¤©é™åˆ¶è°ƒç”¨å¤šå°‘æ¬¡ç­‰ç­‰ã€‚</p><ul><li><strong>åˆ†å¸ƒå¼é”</strong></li></ul><p>è¿™ä¸ªä¸»è¦åˆ©ç”¨redisçš„setnxå‘½ä»¤è¿›è¡Œï¼Œsetnxï¼š&quot;set if not exists&quot;å°±æ˜¯å¦‚æœä¸å­˜åœ¨åˆ™æˆåŠŸè®¾ç½®ç¼“å­˜åŒæ—¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0 ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨ä¿ä½ å¥”è¿œæ–¹çš„åå°ä¸­æœ‰æ‰€è¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœåŠ¡å™¨æ˜¯é›†ç¾¤çš„ï¼Œå®šæ—¶ä»»åŠ¡å¯èƒ½åœ¨ä¸¤å°æœºå™¨ä¸Šéƒ½ä¼šè¿è¡Œï¼Œæ‰€ä»¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­é¦–å…ˆ é€šè¿‡setnxè®¾ç½®ä¸€ä¸ªlockï¼Œå¦‚æœæˆåŠŸè®¾ç½®åˆ™æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸè®¾ç½®ï¼Œåˆ™è¡¨æ˜è¯¥å®šæ—¶ä»»åŠ¡å·²æ‰§è¡Œã€‚ å½“ç„¶ç»“åˆå…·ä½“ä¸šåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªlockåŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚è¯´30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå°äº30åˆ†é’Ÿçš„ä¸€ä¸ªæ—¶é—´å°±å¯ä»¥ï¼Œè¿™ä¸ªä¸å®šæ—¶ä»»åŠ¡çš„å‘¨æœŸä»¥åŠå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ¶ˆè€—æ—¶é—´ç›¸å…³ã€‚</p><p>åœ¨åˆ†å¸ƒå¼é”çš„åœºæ™¯ä¸­ï¼Œä¸»è¦ç”¨åœ¨æ¯”å¦‚ç§’æ€ç³»ç»Ÿç­‰ã€‚</p><h2 id="_2-æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„"><span>2. æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„</span></a></h2><h3 id="_2-1-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_2-1-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹"><span>2.1 Redis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿ</span></a></h3><ul><li><strong>5ç§åŸºç¡€æ•°æ®ç±»å‹</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼šStringã€Listã€Setã€Zsetã€Hashã€‚</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037008.png" alt="image-20220628220310533" tabindex="0" loading="lazy"><figcaption>image-20220628220310533</figcaption></figure><table><thead><tr><th>ç»“æ„ç±»å‹</th><th>ç»“æ„å­˜å‚¨çš„å€¼</th><th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th></tr></thead><tbody><tr><td><strong>Stringå­—ç¬¦ä¸²</strong></td><td>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°</td><td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼›å¯¹æ•´æ•°æˆ–æµ®ç‚¹æ•°è¿›è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œï¼›</td></tr><tr><td><strong>Liståˆ—è¡¨</strong></td><td>ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²</td><td>å¯¹é“¾è¡¨çš„ä¸¤ç«¯è¿›è¡Œpushå’Œpopæ“ä½œï¼Œè¯»å–å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–åˆ é™¤å…ƒç´ ï¼›</td></tr><tr><td><strong>Seté›†åˆ</strong></td><td>åŒ…å«å­—ç¬¦ä¸²çš„æ— åºé›†åˆ</td><td>å­—ç¬¦ä¸²çš„é›†åˆï¼ŒåŒ…å«åŸºç¡€çš„æ–¹æ³•æœ‰çœ‹æ˜¯å¦å­˜åœ¨æ·»åŠ ã€è·å–ã€åˆ é™¤ï¼›è¿˜åŒ…å«è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰</td></tr><tr><td><strong>Hashæ•£åˆ—</strong></td><td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td>åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ </td></tr><tr><td><strong>Zsetæœ‰åºé›†åˆ</strong></td><td>å’Œæ•£åˆ—ä¸€æ ·ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹</td><td>å­—ç¬¦ä¸²æˆå‘˜ä¸æµ®ç‚¹æ•°åˆ†æ•°ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼›å…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†æ•°çš„å¤§å°å†³å®šï¼›åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ä»¥åŠæ ¹æ®åˆ†å€¼èŒƒå›´æˆ–æˆå‘˜æ¥è·å–å…ƒç´ </td></tr></tbody></table><ul><li><strong>ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹</strong> åˆ†åˆ«æ˜¯ HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ï¼Œ Bitmaps (ä½å›¾) å’Œ geospatial ï¼ˆåœ°ç†ä½ç½®)</li></ul><h3 id="_2-2-è°ˆè°ˆredis-çš„å¯¹è±¡æœºåˆ¶-redisobject" tabindex="-1"><a class="header-anchor" href="#_2-2-è°ˆè°ˆredis-çš„å¯¹è±¡æœºåˆ¶-redisobject"><span>2.2 è°ˆè°ˆRedis çš„å¯¹è±¡æœºåˆ¶ï¼ˆredisObject)ï¼Ÿ</span></a></h3><p>æ¯”å¦‚è¯´ï¼Œ é›†åˆç±»å‹å°±å¯ä»¥ç”±å­—å…¸å’Œæ•´æ•°é›†åˆä¸¤ç§ä¸åŒçš„æ•°æ®ç»“æ„å®ç°ï¼Œ ä½†æ˜¯ï¼Œ å½“ç”¨æˆ·æ‰§è¡Œ ZADD å‘½ä»¤æ—¶ï¼Œ ä»–/å¥¹åº”è¯¥ä¸å¿…å…³å¿ƒé›†åˆä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç¼–ç ï¼Œ åªè¦ Redis èƒ½æŒ‰ç…§ ZADD å‘½ä»¤çš„æŒ‡ç¤ºï¼Œ å°†æ–°å…ƒç´ æ·»åŠ åˆ°é›†åˆå°±å¯ä»¥äº†ã€‚</p><p>è¿™è¯´æ˜, <strong>æ“ä½œæ•°æ®ç±»å‹çš„å‘½ä»¤é™¤äº†è¦å¯¹é”®çš„ç±»å‹è¿›è¡Œæ£€æŸ¥ä¹‹å¤–, è¿˜éœ€è¦æ ¹æ®æ•°æ®ç±»å‹çš„ä¸åŒç¼–ç è¿›è¡Œå¤šæ€å¤„ç†</strong>.</p><p>ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜, <strong>Redis æ„å»ºäº†è‡ªå·±çš„ç±»å‹ç³»ç»Ÿ</strong>, è¿™ä¸ªç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬:</p><ul><li>redisObject å¯¹è±¡.</li><li>åŸºäº redisObject å¯¹è±¡çš„ç±»å‹æ£€æŸ¥.</li><li>åŸºäº redisObject å¯¹è±¡çš„æ˜¾å¼å¤šæ€å‡½æ•°.</li><li>å¯¹ redisObject è¿›è¡Œåˆ†é…ã€å…±äº«å’Œé”€æ¯çš„æœºåˆ¶.</li></ul><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * Redis å¯¹è±¡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">typedef</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisObject {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ç±»å‹</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    unsigned</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> type:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ç¼–ç æ–¹å¼</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    unsigned</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> encoding:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // LRU - 24ä½, è®°å½•æœ€æœ«ä¸€æ¬¡è®¿é—®æ—¶é—´ï¼ˆç›¸å¯¹äºlru_clockï¼‰; æˆ–è€… LFUï¼ˆæœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼š8ä½é¢‘ç‡ï¼Œ16ä½è®¿é—®æ—¶é—´ï¼‰</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    unsigned</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> lru:LRU_BITS;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // LRU_BITS: 24</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¼•ç”¨è®¡æ•°</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> refcount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„å®ä¾‹</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ptr;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">} robj;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹å›¾å¯¹åº”ä¸Šé¢çš„ç»“æ„</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037061.png" alt="image-20220628220842046" tabindex="0" loading="lazy"><figcaption>image-20220628220842046</figcaption></figure><h3 id="_2-3-redis-æ•°æ®ç±»å‹æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-3-redis-æ•°æ®ç±»å‹æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æ„"><span>2.3 Redis æ•°æ®ç±»å‹æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037094.png" alt="image-20220628220915518" tabindex="0" loading="lazy"><figcaption>image-20220628220915518</figcaption></figure><ul><li>ç®€å•åŠ¨æ€å­—ç¬¦ä¸² - sds</li><li>å‹ç¼©åˆ—è¡¨ - ZipList</li><li>å¿«è¡¨ - QuickList</li><li>å­—å…¸/å“ˆå¸Œè¡¨ - Dict</li><li>æ•´æ•°é›† - IntSet</li><li>è·³è¡¨ - ZSkipList</li></ul><h3 id="_2-4-ä¸ºä»€ä¹ˆè¦è®¾è®¡sds" tabindex="-1"><a class="header-anchor" href="#_2-4-ä¸ºä»€ä¹ˆè¦è®¾è®¡sds"><span>2.4 ä¸ºä»€ä¹ˆè¦è®¾è®¡sdsï¼Ÿ</span></a></h3><ul><li><strong>å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</strong></li></ul><p>ç”±äº len å±æ€§çš„å­˜åœ¨ï¼Œæˆ‘ä»¬è·å– SDS å­—ç¬¦ä¸²çš„é•¿åº¦åªéœ€è¦è¯»å– len å±æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚è€Œå¯¹äº C è¯­è¨€ï¼Œè·å–å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯ç»è¿‡éå†è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚é€šè¿‡ <code>strlen key</code> å‘½ä»¤å¯ä»¥è·å– key çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</p><ul><li><strong>æœç»ç¼“å†²åŒºæº¢å‡º</strong></li></ul><p>æˆ‘ä»¬çŸ¥é“åœ¨ C è¯­è¨€ä¸­ä½¿ç”¨ <code>strcat</code> å‡½æ•°æ¥è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚è€Œå¯¹äº SDS æ•°æ®ç±»å‹ï¼Œåœ¨è¿›è¡Œå­—ç¬¦ä¿®æ”¹çš„æ—¶å€™ï¼Œ<strong>ä¼šé¦–å…ˆæ ¹æ®è®°å½•çš„ len å±æ€§æ£€æŸ¥å†…å­˜ç©ºé—´æ˜¯å¦æ»¡è¶³éœ€æ±‚</strong>ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œä¼šè¿›è¡Œç›¸åº”çš„ç©ºé—´æ‰©å±•ï¼Œç„¶ååœ¨è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºã€‚</p><ul><li><strong>å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å­˜é‡æ–°åˆ†é…æ¬¡æ•°</strong></li></ul><p>Cè¯­è¨€ç”±äºä¸è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆå…ˆé‡Šæ”¾å†ç”³è¯·ï¼‰ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é‡æ–°åˆ†é…ï¼Œå­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶ä¼šé€ æˆå†…å­˜ç¼“å†²åŒºæº¢å‡ºï¼Œå­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚</p><p>è€Œå¯¹äºSDSï¼Œç”±äº<code>len</code>å±æ€§å’Œ<code>alloc</code>å±æ€§çš„å­˜åœ¨ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ä¸²SDSå®ç°äº†<strong>ç©ºé—´é¢„åˆ†é…</strong>å’Œ<strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong>ä¸¤ç§ç­–ç•¥ï¼š</p><ol><li><strong>ç©ºé—´é¢„åˆ†é…</strong>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œæ‰©å±•çš„å†…å­˜æ¯”å®é™…éœ€è¦çš„å¤šï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</li><li><strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡æ–°åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šä½™çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>alloc</code> å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚ï¼ˆå½“ç„¶SDSä¹Ÿæä¾›äº†ç›¸åº”çš„APIï¼Œå½“æˆ‘ä»¬æœ‰éœ€è¦æ—¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡Šæ”¾è¿™äº›æœªä½¿ç”¨çš„ç©ºé—´ã€‚ï¼‰</li></ol><ul><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong></li></ul><p>å› ä¸ºCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè€Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œå†…å®¹å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤Cå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®å­˜å–ï¼›è€Œæ‰€æœ‰ SDS çš„API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† <code>buf</code> é‡Œé¢çš„å…ƒç´ ï¼Œå¹¶ä¸” SDS ä¸æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œè€Œæ˜¯ä»¥ len å±æ€§è¡¨ç¤ºçš„é•¿åº¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸã€‚</p><ul><li><strong>å…¼å®¹éƒ¨åˆ† C å­—ç¬¦ä¸²å‡½æ•°</strong></li></ul><p>è™½ç„¶ SDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸€æ ·éµä»æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²ç»“å°¾çš„æƒ¯ä¾‹ï¼Œè¿™æ ·å¯ä»¥é‡ç”¨ C è¯­è¨€åº“<code>&lt;string.h&gt;</code> ä¸­çš„ä¸€éƒ¨åˆ†å‡½æ•°ã€‚</p><h3 id="_2-5-redis-ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#_2-5-redis-ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘"><span>2.5 Redis ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ</span></a></h3><p>512M</p><h3 id="_2-6-ä¸ºä»€ä¹ˆä¼šè®¾è®¡stream" tabindex="-1"><a class="header-anchor" href="#_2-6-ä¸ºä»€ä¹ˆä¼šè®¾è®¡stream"><span>2.6 ä¸ºä»€ä¹ˆä¼šè®¾è®¡Streamï¼Ÿ</span></a></h3><p>ç”¨è¿‡Redisåšæ¶ˆæ¯é˜Ÿåˆ—çš„éƒ½äº†è§£ï¼ŒåŸºäºReidsçš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>PUB/SUBï¼Œè®¢é˜…/å‘å¸ƒæ¨¡å¼ <ul><li>ä½†æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯æ— æ³•æŒä¹…åŒ–çš„ï¼Œå¦‚æœå‡ºç°ç½‘ç»œæ–­å¼€ã€Redis å®•æœºç­‰ï¼Œæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒï¼›</li></ul></li><li>åŸºäºList LPUSH+BRPOP æˆ–è€… åŸºäºSorted-Set çš„å®ç° <ul><li>æ”¯æŒäº†æŒä¹…åŒ–ï¼Œä½†æ˜¯ä¸æ”¯æŒå¤šæ’­ï¼Œåˆ†ç»„æ¶ˆè´¹ç­‰</li></ul></li></ul><p><strong>æ¶ˆè´¹ç»„æ¶ˆè´¹å›¾</strong></p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037125.png" alt="image-20220628221135429" tabindex="0" loading="lazy"><figcaption>image-20220628221135429</figcaption></figure><h3 id="_2-7-redis-streamç”¨åœ¨ä»€ä¹ˆæ ·åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_2-7-redis-streamç”¨åœ¨ä»€ä¹ˆæ ·åœºæ™¯"><span>2.7 Redis Streamç”¨åœ¨ä»€ä¹ˆæ ·åœºæ™¯ï¼Ÿ</span></a></h3><p>å¯ç”¨ä½œæ—¶é€šä¿¡ç­‰ï¼Œå¤§æ•°æ®åˆ†æï¼Œå¼‚åœ°æ•°æ®å¤‡ä»½ç­‰</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037160.png" alt="image-20220628221236545" tabindex="0" loading="lazy"><figcaption>image-20220628221236545</figcaption></figure><p>å®¢æˆ·ç«¯å¯ä»¥å¹³æ»‘æ‰©å±•ï¼Œæé«˜å¤„ç†èƒ½åŠ›</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037186.png" alt="image-20220628221321712" tabindex="0" loading="lazy"><figcaption>image-20220628221321712</figcaption></figure><h3 id="_2-8-redis-streamæ¶ˆæ¯idçš„è®¾è®¡æ˜¯å¦è€ƒè™‘äº†æ—¶é—´å›æ‹¨çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-8-redis-streamæ¶ˆæ¯idçš„è®¾è®¡æ˜¯å¦è€ƒè™‘äº†æ—¶é—´å›æ‹¨çš„é—®é¢˜"><span>2.8 Redis Streamæ¶ˆæ¯IDçš„è®¾è®¡æ˜¯å¦è€ƒè™‘äº†æ—¶é—´å›æ‹¨çš„é—®é¢˜ï¼Ÿ</span></a></h3><p>XADDç”Ÿæˆçš„1553439850328-0ï¼Œå°±æ˜¯Redisç”Ÿæˆçš„æ¶ˆæ¯IDï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆ:<strong>æ—¶é—´æˆ³-åºå·</strong>ã€‚æ—¶é—´æˆ³æ˜¯æ¯«ç§’çº§å•ä½ï¼Œæ˜¯ç”Ÿæˆæ¶ˆæ¯çš„RedisæœåŠ¡å™¨æ—¶é—´ï¼Œå®ƒæ˜¯ä¸ª64ä½æ•´å‹ï¼ˆint64ï¼‰ã€‚åºå·æ˜¯åœ¨è¿™ä¸ªæ¯«ç§’æ—¶é—´ç‚¹å†…çš„æ¶ˆæ¯åºå·ï¼Œå®ƒä¹Ÿæ˜¯ä¸ª64ä½æ•´å‹ã€‚</p><p>å¯ä»¥é€šè¿‡multiæ‰¹å¤„ç†ï¼Œæ¥éªŒè¯åºå·çš„é€’å¢ï¼š</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">MULTI</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> memberMessage</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;"> msg</span><span style="color:#98C379;--shiki-dark:#98C379;"> one</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> memberMessage</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;"> msg</span><span style="color:#98C379;--shiki-dark:#98C379;"> two</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> memberMessage</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;"> msg</span><span style="color:#98C379;--shiki-dark:#98C379;"> three</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> memberMessage</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;"> msg</span><span style="color:#98C379;--shiki-dark:#98C379;"> four</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> memberMessage</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;"> msg</span><span style="color:#98C379;--shiki-dark:#98C379;"> five</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">EXEC</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553441006884-0&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553441006884-1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553441006884-2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553441006884-3&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553441006884-4&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºä¸€ä¸ªrediså‘½ä»¤çš„æ‰§è¡Œå¾ˆå¿«ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°åœ¨åŒä¸€æ—¶é—´æˆ³å†…ï¼Œæ˜¯é€šè¿‡åºå·é€’å¢æ¥è¡¨ç¤ºæ¶ˆæ¯çš„ã€‚</p><p>ä¸ºäº†ä¿è¯æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œå› æ­¤Redisç”Ÿæˆçš„IDæ˜¯å•è°ƒé€’å¢æœ‰åºçš„ã€‚ç”±äºIDä¸­åŒ…å«æ—¶é—´æˆ³éƒ¨åˆ†ï¼Œä¸ºäº†é¿å…æœåŠ¡å™¨æ—¶é—´é”™è¯¯è€Œå¸¦æ¥çš„é—®é¢˜ï¼ˆä¾‹å¦‚æœåŠ¡å™¨æ—¶é—´å»¶åäº†ï¼‰ï¼ŒRedisçš„æ¯ä¸ªStreamç±»å‹æ•°æ®éƒ½ç»´æŠ¤ä¸€ä¸ªlatest_generated_idå±æ€§ï¼Œç”¨äºè®°å½•æœ€åä¸€ä¸ªæ¶ˆæ¯çš„IDã€‚<strong>è‹¥å‘ç°å½“å‰æ—¶é—´æˆ³é€€åï¼ˆå°äºlatest_generated_idæ‰€è®°å½•çš„ï¼‰ï¼Œåˆ™é‡‡ç”¨æ—¶é—´æˆ³ä¸å˜è€Œåºå·é€’å¢çš„æ–¹æ¡ˆæ¥ä½œä¸ºæ–°æ¶ˆæ¯ID</strong>ï¼ˆè¿™ä¹Ÿæ˜¯åºå·ä¸ºä»€ä¹ˆä½¿ç”¨int64çš„åŸå› ï¼Œä¿è¯æœ‰è¶³å¤Ÿå¤šçš„çš„åºå·ï¼‰ï¼Œä»è€Œä¿è¯IDçš„å•è°ƒé€’å¢æ€§è´¨ã€‚</p><p>å¼ºçƒˆå»ºè®®ä½¿ç”¨Redisçš„æ–¹æ¡ˆç”Ÿæˆæ¶ˆæ¯IDï¼Œå› ä¸ºè¿™ç§æ—¶é—´æˆ³+åºå·çš„å•è°ƒé€’å¢çš„IDæ–¹æ¡ˆï¼Œå‡ ä¹å¯ä»¥æ»¡è¶³ä½ å…¨éƒ¨çš„éœ€æ±‚ã€‚ä½†åŒæ—¶ï¼Œè®°ä½IDæ˜¯æ”¯æŒè‡ªå®šä¹‰çš„ï¼Œåˆ«å¿˜äº†ï¼</p><h3 id="_2-9-redis-streamæ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„ä¼šä¸ä¼šæ¶ˆæ¯ä¸¢å¤±é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-9-redis-streamæ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„ä¼šä¸ä¼šæ¶ˆæ¯ä¸¢å¤±é—®é¢˜"><span>2.9 Redis Streamæ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„ä¼šä¸ä¼šæ¶ˆæ¯ä¸¢å¤±é—®é¢˜?</span></a></h3><p>ä¸ºäº†è§£å†³ç»„å†…æ¶ˆæ¯è¯»å–ä½†å¤„ç†æœŸé—´æ¶ˆè´¹è€…å´©æºƒå¸¦æ¥çš„æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ï¼ŒSTREAM è®¾è®¡äº† Pending åˆ—è¡¨ï¼Œç”¨äºè®°å½•è¯»å–ä½†å¹¶æœªå¤„ç†å®Œæ¯•çš„æ¶ˆæ¯ã€‚å‘½ä»¤XPENDIING ç”¨æ¥è·æ¶ˆè´¹ç»„æˆ–æ¶ˆè´¹å†…æ¶ˆè´¹è€…çš„æœªå¤„ç†å®Œæ¯•çš„æ¶ˆæ¯ã€‚æ¼”ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XPENDING</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> mqGroup</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # mpGroupçš„Pendingæƒ…å†µ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 5 </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 5ä¸ªå·²è¯»å–ä½†æœªå¤„ç†çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-0&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # èµ·å§‹ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-4&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # ç»“æŸID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerA&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆè´¹è€…Aæœ‰3ä¸ª</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;3&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerB&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆè´¹è€…Bæœ‰1ä¸ª</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerC&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆè´¹è€…Cæœ‰1ä¸ª</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XPENDING</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> mqGroup</span><span style="color:#98C379;--shiki-dark:#98C379;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> +</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # ä½¿ç”¨ start end count é€‰é¡¹å¯ä»¥è·å–è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-0&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆæ¯ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerA&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆè´¹è€…</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1654355 </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»è¯»å–åˆ°ç°åœ¨ç»å†äº†1654355msï¼ŒIDLE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 5 </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¶ˆæ¯è¢«è¯»å–äº†5æ¬¡ï¼Œdelivery counter</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerA&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1654355</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 4</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å…±5ä¸ªï¼Œä½™ä¸‹3ä¸ªçœç•¥ ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XPENDING</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> mqGroup</span><span style="color:#98C379;--shiki-dark:#98C379;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> +</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#98C379;--shiki-dark:#98C379;"> consumerA</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # åœ¨åŠ ä¸Šæ¶ˆè´¹è€…å‚æ•°ï¼Œè·å–å…·ä½“æŸä¸ªæ¶ˆè´¹è€…çš„Pendingåˆ—è¡¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-0&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerA&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1641083</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 5</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å…±3ä¸ªï¼Œä½™ä¸‹2ä¸ªçœç•¥ ...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªPendingçš„æ¶ˆæ¯æœ‰4ä¸ªå±æ€§ï¼š</p><ul><li>æ¶ˆæ¯ID</li><li>æ‰€å±æ¶ˆè´¹è€…</li><li>IDLEï¼Œå·²è¯»å–æ—¶é•¿</li><li>delivery counterï¼Œæ¶ˆæ¯è¢«è¯»å–æ¬¡æ•°</li></ul><p>ä¸Šé¢çš„ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¹‹å‰è¯»å–çš„æ¶ˆæ¯ï¼Œéƒ½è¢«è®°å½•åœ¨Pendingåˆ—è¡¨ä¸­ï¼Œè¯´æ˜å…¨éƒ¨è¯»åˆ°çš„æ¶ˆæ¯éƒ½æ²¡æœ‰å¤„ç†ï¼Œä»…ä»…æ˜¯è¯»å–äº†ã€‚é‚£å¦‚ä½•è¡¨ç¤ºæ¶ˆè´¹è€…å¤„ç†å®Œæ¯•äº†æ¶ˆæ¯å‘¢ï¼Ÿä½¿ç”¨å‘½ä»¤ XACK å®Œæˆå‘ŠçŸ¥æ¶ˆæ¯å¤„ç†å®Œæˆï¼Œæ¼”ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XACK</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> mqGroup</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1553585533795-0</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # é€šçŸ¥æ¶ˆæ¯å¤„ç†ç»“æŸï¼Œç”¨æ¶ˆæ¯IDæ ‡è¯†</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XPENDING</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> mqGroup</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # å†æ¬¡æŸ¥çœ‹Pendingåˆ—è¡¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 4 </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å·²è¯»å–ä½†æœªå¤„ç†çš„æ¶ˆæ¯å·²ç»å˜ä¸º4ä¸ª</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-4&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerA&quot;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æ¶ˆè´¹è€…Aï¼Œè¿˜æœ‰2ä¸ªæ¶ˆæ¯å¤„ç†</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerB&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consumerC&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>æœ‰äº†è¿™æ ·ä¸€ä¸ªPendingæœºåˆ¶ï¼Œå°±æ„å‘³ç€åœ¨æŸä¸ªæ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯ä½†æœªå¤„ç†åï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢å¤±çš„ã€‚ç­‰å¾…æ¶ˆè´¹è€…å†æ¬¡ä¸Šçº¿åï¼Œå¯ä»¥è¯»å–è¯¥Pendingåˆ—è¡¨ï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†è¯¥æ¶ˆæ¯äº†ï¼Œä¿è¯æ¶ˆæ¯çš„æœ‰åºå’Œä¸ä¸¢å¤±ã€‚</p><h3 id="_2-10-redis-steam-åæ¶ˆæ¯é—®é¢˜-æ­»ä¿¡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-10-redis-steam-åæ¶ˆæ¯é—®é¢˜-æ­»ä¿¡é—®é¢˜"><span>2.10 Redis Steam åæ¶ˆæ¯é—®é¢˜ï¼Œæ­»ä¿¡é—®é¢˜?</span></a></h3><p>æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œå¦‚æœæŸä¸ªæ¶ˆæ¯ï¼Œä¸èƒ½è¢«æ¶ˆè´¹è€…å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è¢«XACKï¼Œè¿™æ˜¯è¦é•¿æ—¶é—´å¤„äºPendingåˆ—è¡¨ä¸­ï¼Œå³ä½¿è¢«åå¤çš„è½¬ç§»ç»™å„ä¸ªæ¶ˆè´¹è€…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ­¤æ—¶è¯¥æ¶ˆæ¯çš„delivery counterå°±ä¼šç´¯åŠ ï¼ˆä¸Šä¸€èŠ‚çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼‰ï¼Œå½“ç´¯åŠ åˆ°æŸä¸ªæˆ‘ä»¬é¢„è®¾çš„ä¸´ç•Œå€¼æ—¶ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯åæ¶ˆæ¯ï¼ˆä¹Ÿå«æ­»ä¿¡ï¼ŒDeadLetterï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯ï¼‰ï¼Œç”±äºæœ‰äº†åˆ¤å®šæ¡ä»¶ï¼Œæˆ‘ä»¬å°†åæ¶ˆæ¯å¤„ç†æ‰å³å¯ï¼Œåˆ é™¤å³å¯ã€‚åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½¿ç”¨XDELè¯­æ³•ï¼Œæ¼”ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åˆ é™¤é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XDEL</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1553585533795-1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æŸ¥çœ‹é˜Ÿåˆ—ä¸­å†æ— æ­¤æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">XRANGE</span><span style="color:#98C379;--shiki-dark:#98C379;"> mq</span><span style="color:#98C379;--shiki-dark:#98C379;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> +</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-0&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;msg&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1553585533795-2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) 1) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;msg&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;3&quot;</span></span></code></pre></div><p>æ³¨æ„æœ¬ä¾‹ä¸­ï¼Œå¹¶æ²¡æœ‰åˆ é™¤Pendingä¸­çš„æ¶ˆæ¯å› æ­¤ä½ æŸ¥çœ‹Pendingï¼Œæ¶ˆæ¯è¿˜ä¼šåœ¨ã€‚å¯ä»¥æ‰§è¡ŒXACKæ ‡è¯†å…¶å¤„ç†å®Œæ¯•ï¼</p><h2 id="_3-æŒä¹…åŒ–å’Œå†…å­˜" tabindex="-1"><a class="header-anchor" href="#_3-æŒä¹…åŒ–å’Œå†…å­˜"><span>3. æŒä¹…åŒ–å’Œå†…å­˜</span></a></h2><h3 id="_3-1-redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆ-å„è‡ªçš„ä¼˜ç¼ºç‚¹-ä¸€èˆ¬æ€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#_3-1-redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆ-å„è‡ªçš„ä¼˜ç¼ºç‚¹-ä¸€èˆ¬æ€ä¹ˆç”¨"><span>3.1 Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ</span></a></h3><ol><li>RDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„è¿‡ç¨‹; é’ˆå¯¹RDBä¸é€‚åˆå®æ—¶æŒä¹…åŒ–çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFæŒä¹…åŒ–æ–¹å¼æ¥è§£å†³.</li><li>AOFæ˜¯â€œå†™åâ€æ—¥å¿—ï¼ŒRediså…ˆæ‰§è¡Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—ã€‚æ—¥å¿—é‡Œè®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜ã€‚</li><li>Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ª<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚</li></ol><p>è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒT1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037212.png" alt="image-20220628222023267" tabindex="0" loading="lazy"><figcaption>image-20220628222023267</figcaption></figure><p>è¿™ä¸ªæ–¹æ³•æ—¢èƒ½äº«å—åˆ° RDB æ–‡ä»¶å¿«é€Ÿæ¢å¤çš„å¥½å¤„ï¼Œåˆèƒ½äº«å—åˆ° AOF åªè®°å½•æ“ä½œå‘½ä»¤çš„ç®€å•ä¼˜åŠ¿, å®é™…ç¯å¢ƒä¸­ç”¨çš„å¾ˆå¤šã€‚</p><h3 id="_3-2-rdb-è§¦å‘æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_3-2-rdb-è§¦å‘æ–¹å¼"><span>3.2 RDB è§¦å‘æ–¹å¼?</span></a></h3><p>è§¦å‘rdbæŒä¹…åŒ–çš„æ–¹å¼æœ‰2ç§ï¼Œåˆ†åˆ«æ˜¯<strong>æ‰‹åŠ¨è§¦å‘</strong>å’Œ<strong>è‡ªåŠ¨è§¦å‘</strong>ã€‚</p><ul><li>æ‰‹åŠ¨è§¦å‘ <ul><li><strong>saveå‘½ä»¤</strong>ï¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜ æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´<strong>é˜»å¡</strong>ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</li><li><strong>bgsaveå‘½ä»¤</strong>ï¼šRedisè¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ç”±å­ è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨forké˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­</li></ul></li></ul><p>bgsaveæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037241.png" alt="image-20220628222152957" tabindex="0" loading="lazy"><figcaption>image-20220628222152957</figcaption></figure><ul><li>è‡ªåŠ¨è§¦å‘ <ul><li>redis.confä¸­é…ç½®<code>save m n</code>ï¼Œå³åœ¨mç§’å†…æœ‰næ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘bgsaveç”Ÿæˆrdbæ–‡ä»¶ï¼›</li><li>ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»èŠ‚ç‚¹è¦ä»ä¸»èŠ‚ç‚¹è¿›è¡Œå…¨é‡å¤åˆ¶æ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼Œç”Ÿæˆå½“æ—¶çš„å¿«ç…§å‘é€åˆ°ä»èŠ‚ç‚¹ï¼›</li><li>æ‰§è¡Œdebug reloadå‘½ä»¤é‡æ–°åŠ è½½redisæ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼›</li><li>é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œshutdownå‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯aofæŒä¹…åŒ–ï¼Œé‚£ä¹ˆä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼›</li></ul></li></ul><h3 id="_3-3-é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢" tabindex="-1"><a class="header-anchor" href="#_3-3-é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢"><span>3.3 é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ</span></a></h3><blockquote><p><strong>RDBç”±äºç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬ä¸ºRediså¼€è¾Ÿçš„å†…å­˜åŒºåŸŸéƒ½æ¯”è¾ƒå¤§ï¼ˆä¾‹å¦‚6GBï¼‰ï¼Œé‚£ä¹ˆå°†å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹å¯èƒ½å°±ä¼šæŒç»­æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œè€Œå®é™…æƒ…å†µæ˜¯è¿™æ®µæ—¶é—´RedisæœåŠ¡ä¸€èˆ¬éƒ½ä¼šæ”¶åˆ°æ•°æ®å†™æ“ä½œè¯·æ±‚ã€‚é‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ</strong></p></blockquote><p>RDBä¸­çš„æ ¸å¿ƒæ€è·¯æ˜¯Copy-on-Writeï¼Œæ¥ä¿è¯åœ¨è¿›è¡Œå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´ï¼Œéœ€è¦å‹ç¼©å†™å…¥ç£ç›˜ä¸Šçš„æ•°æ®åœ¨å†…å­˜ä¸­ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨æ­£å¸¸çš„å¿«ç…§æ“ä½œä¸­ï¼Œä¸€æ–¹é¢Redisä¸»è¿›ç¨‹ä¼šforkä¸€ä¸ªæ–°çš„å¿«ç…§è¿›ç¨‹ä¸“é—¨æ¥åšè¿™ä¸ªäº‹æƒ…ï¼Œè¿™æ ·ä¿è¯äº†RedisæœåŠ¡ä¸ä¼šåœæ­¢å¯¹å®¢æˆ·ç«¯åŒ…æ‹¬å†™è¯·æ±‚åœ¨å†…çš„ä»»ä½•å“åº”ã€‚å¦ä¸€æ–¹é¢è¿™æ®µæ—¶é—´å‘ç”Ÿçš„æ•°æ®å˜åŒ–ä¼šä»¥å‰¯æœ¬çš„æ–¹å¼å­˜æ”¾åœ¨å¦ä¸€ä¸ªæ–°çš„å†…å­˜åŒºåŸŸï¼Œå¾…å¿«ç…§æ“ä½œç»“æŸåæ‰ä¼šåŒæ­¥åˆ°åŸæ¥çš„å†…å­˜åŒºåŸŸã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®ä¹Ÿéƒ½æ˜¯è¯»æ“ä½œï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Aï¼‰ï¼Œé‚£ä¹ˆï¼Œä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹ç›¸äº’ä¸å½±å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»çº¿ç¨‹è¦ä¿®æ”¹ä¸€å—æ•°æ®ï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Cï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œç”Ÿæˆè¯¥æ•°æ®çš„å‰¯æœ¬ã€‚ç„¶åï¼Œbgsave å­è¿›ç¨‹ä¼šæŠŠè¿™ä¸ªå‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹ä»ç„¶å¯ä»¥ç›´æ¥ä¿®æ”¹åŸæ¥çš„æ•°æ®ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037262.png" alt="image-20220628222325269" tabindex="0" loading="lazy"><figcaption>image-20220628222325269</figcaption></figure><h3 id="_3-4-åœ¨è¿›è¡Œrdbå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´-å¦‚æœå‘ç”ŸæœåŠ¡å´©æºƒæ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#_3-4-åœ¨è¿›è¡Œrdbå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´-å¦‚æœå‘ç”ŸæœåŠ¡å´©æºƒæ€ä¹ˆåŠ"><span>3.4 åœ¨è¿›è¡ŒRDBå¿«ç…§æ“ä½œçš„è¿™æ®µæ—¶é—´ï¼Œå¦‚æœå‘ç”ŸæœåŠ¡å´©æºƒæ€ä¹ˆåŠï¼Ÿ</span></a></h3><p>å¾ˆç®€å•ï¼Œåœ¨æ²¡æœ‰å°†æ•°æ®å…¨éƒ¨å†™å…¥åˆ°ç£ç›˜å‰ï¼Œè¿™æ¬¡å¿«ç…§æ“ä½œéƒ½ä¸ç®—æˆåŠŸã€‚å¦‚æœå‡ºç°äº†æœåŠ¡å´©æºƒçš„æƒ…å†µï¼Œå°†ä»¥ä¸Šä¸€æ¬¡å®Œæ•´çš„RDBå¿«ç…§æ–‡ä»¶ä½œä¸ºæ¢å¤å†…å­˜æ•°æ®çš„å‚è€ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¿«ç…§æ“ä½œè¿‡ç¨‹ä¸­ä¸èƒ½å½±å“ä¸Šä¸€æ¬¡çš„å¤‡ä»½æ•°æ®ã€‚RedisæœåŠ¡ä¼šåœ¨ç£ç›˜ä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶è¿›è¡Œæ•°æ®æ“ä½œï¼Œå¾…æ“ä½œæˆåŠŸåæ‰ä¼šç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢æ‰ä¸Šä¸€æ¬¡çš„å¤‡ä»½ã€‚</p><h3 id="_3-5-å¯ä»¥æ¯ç§’åšä¸€æ¬¡rdbå¿«ç…§å—" tabindex="-1"><a class="header-anchor" href="#_3-5-å¯ä»¥æ¯ç§’åšä¸€æ¬¡rdbå¿«ç…§å—"><span>3.5 å¯ä»¥æ¯ç§’åšä¸€æ¬¡RDBå¿«ç…§å—ï¼Ÿ</span></a></h3><p>å¯¹äºå¿«ç…§æ¥è¯´ï¼Œæ‰€è°“â€œè¿æ‹â€å°±æ˜¯æŒ‡è¿ç»­åœ°åšå¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§çš„é—´éš”æ—¶é—´å˜å¾—å¾ˆçŸ­ï¼Œå³ä½¿æŸä¸€æ—¶åˆ»å‘ç”Ÿå®•æœºäº†ï¼Œå› ä¸ºä¸Šä¸€æ—¶åˆ»å¿«ç…§åˆšæ‰§è¡Œï¼Œä¸¢å¤±çš„æ•°æ®ä¹Ÿä¸ä¼šå¤ªå¤šã€‚ä½†æ˜¯ï¼Œè¿™å…¶ä¸­çš„å¿«ç…§é—´éš”æ—¶é—´å°±å¾ˆå…³é”®äº†ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆåœ¨ T0 æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œç„¶ååˆåœ¨ T0+t æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œåœ¨è¿™æœŸé—´ï¼Œæ•°æ®å— 5 å’Œ 9 è¢«ä¿®æ”¹äº†ã€‚å¦‚æœåœ¨ t è¿™æ®µæ—¶é—´å†…ï¼Œæœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆï¼Œåªèƒ½æŒ‰ç…§ T0 æ—¶åˆ»çš„å¿«ç…§è¿›è¡Œæ¢å¤ã€‚æ­¤æ—¶ï¼Œæ•°æ®å— 5 å’Œ 9 çš„ä¿®æ”¹å€¼å› ä¸ºæ²¡æœ‰å¿«ç…§è®°å½•ï¼Œå°±æ— æ³•æ¢å¤äº†ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037288.png" alt="image-20220628222410531" tabindex="0" loading="lazy"><figcaption>image-20220628222410531</figcaption></figure><p>æ‰€ä»¥ï¼Œè¦æƒ³å°½å¯èƒ½æ¢å¤æ•°æ®ï¼Œt å€¼å°±è¦å°½å¯èƒ½å°ï¼Œt è¶Šå°ï¼Œå°±è¶Šåƒâ€œè¿æ‹â€ã€‚é‚£ä¹ˆï¼Œt å€¼å¯ä»¥å°åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Œæ¯”å¦‚è¯´æ˜¯ä¸æ˜¯å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§ï¼Ÿæ¯•ç«Ÿï¼Œæ¯æ¬¡å¿«ç…§éƒ½æ˜¯ç”± bgsave å­è¿›ç¨‹åœ¨åå°æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><p>è¿™ç§æƒ³æ³•å…¶å®æ˜¯é”™è¯¯çš„ã€‚è™½ç„¶ bgsave æ‰§è¡Œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œ<strong>å¦‚æœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€</strong>ï¼š</p><ul><li>ä¸€æ–¹é¢ï¼Œé¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå¤šä¸ªå¿«ç…§ç«äº‰æœ‰é™çš„ç£ç›˜å¸¦å®½ï¼Œå‰ä¸€ä¸ªå¿«ç…§è¿˜æ²¡æœ‰åšå®Œï¼Œåä¸€ä¸ªåˆå¼€å§‹åšäº†ï¼Œå®¹æ˜“é€ æˆæ¶æ€§å¾ªç¯ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œbgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåä¸ä¼šå†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œfork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Šå¤§ï¼Œé˜»å¡æ—¶é—´è¶Šé•¿ã€‚å¦‚æœé¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹<strong>é˜»å¡ä¸»çº¿ç¨‹</strong>äº†ã€‚</li></ul><p>é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆå…¶ä»–å¥½æ–¹æ³•å—ï¼Ÿæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšå¢é‡å¿«ç…§ï¼Œå°±æ˜¯æŒ‡åšäº†ä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§åªå¯¹ä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€ã€‚è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚</p><p>ä½†æ˜¯å®ƒéœ€è¦æˆ‘ä»¬ä½¿ç”¨é¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯å»è®°å½•å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„<strong>ç©ºé—´å¼€é”€é—®é¢˜</strong>ã€‚é‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•æ—¢èƒ½åˆ©ç”¨ RDB çš„å¿«é€Ÿæ¢å¤ï¼Œåˆèƒ½ä»¥è¾ƒå°çš„å¼€é”€åšåˆ°å°½é‡å°‘ä¸¢æ•°æ®å‘¢ï¼ŸRDBå’ŒAOFçš„æ··åˆæ–¹å¼ã€‚</p><h3 id="_3-6-aofæ˜¯å†™å‰æ—¥å¿—è¿˜æ˜¯å†™åæ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_3-6-aofæ˜¯å†™å‰æ—¥å¿—è¿˜æ˜¯å†™åæ—¥å¿—"><span>3.6 AOFæ˜¯å†™å‰æ—¥å¿—è¿˜æ˜¯å†™åæ—¥å¿—ï¼Ÿ</span></a></h3><p>AOFæ—¥å¿—é‡‡ç”¨å†™åæ—¥å¿—ï¼Œå³<strong>å…ˆå†™å†…å­˜ï¼Œåå†™æ—¥å¿—</strong>ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037310.png" alt="image-20220628222701583" tabindex="0" loading="lazy"><figcaption>image-20220628222701583</figcaption></figure><p><strong>ä¸ºä»€ä¹ˆé‡‡ç”¨å†™åæ—¥å¿—</strong>ï¼Ÿ</p><p>Redisè¦æ±‚é«˜æ€§èƒ½ï¼Œé‡‡ç”¨å†™æ—¥å¿—æœ‰ä¸¤æ–¹é¢å¥½å¤„ï¼š</p><ul><li><strong>é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€</strong>ï¼šRedis åœ¨å‘ AOF é‡Œé¢è®°å½•æ—¥å¿—çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå…ˆå»å¯¹è¿™äº›å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœå…ˆè®°æ—¥å¿—å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œæ—¥å¿—ä¸­å°±æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚</li><li>ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œ</li></ul><p>ä½†è¿™ç§æ–¹å¼å­˜åœ¨æ½œåœ¨é£é™©ï¼š</p><ul><li>å¦‚æœå‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå†™æ—¥å¿—ä¹‹å‰å®•æœºäº†ï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚</li><li>ä¸»çº¿ç¨‹å†™ç£ç›˜å‹åŠ›å¤§ï¼Œå¯¼è‡´å†™ç›˜æ…¢ï¼Œé˜»å¡åç»­æ“ä½œã€‚</li></ul><h3 id="_3-7-å¦‚ä½•å®ç°aofçš„" tabindex="-1"><a class="header-anchor" href="#_3-7-å¦‚ä½•å®ç°aofçš„"><span>3.7 å¦‚ä½•å®ç°AOFçš„ï¼Ÿ</span></a></h3><p>AOFæ—¥å¿—è®°å½•Redisçš„æ¯ä¸ªå†™å‘½ä»¤ï¼Œæ­¥éª¤åˆ†ä¸ºï¼šå‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰ã€æ–‡ä»¶å†™å…¥ï¼ˆwriteï¼‰å’Œæ–‡ä»¶åŒæ­¥ï¼ˆsyncï¼‰ã€‚</p><ul><li><strong>å‘½ä»¤è¿½åŠ </strong> å½“AOFæŒä¹…åŒ–åŠŸèƒ½æ‰“å¼€äº†ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œä¼šä»¥åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ°æœåŠ¡å™¨çš„ aof_buf ç¼“å†²åŒºã€‚</li><li><strong>æ–‡ä»¶å†™å…¥å’ŒåŒæ­¥</strong> å…³äºä½•æ—¶å°† aof_buf ç¼“å†²åŒºçš„å†…å®¹å†™å…¥AOFæ–‡ä»¶ä¸­ï¼ŒRedisæä¾›äº†ä¸‰ç§å†™å›ç­–ç•¥ï¼š</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037336.png" alt="image-20220628222755767" tabindex="0" loading="lazy"><figcaption>image-20220628222755767</figcaption></figure><p><code>Always</code>ï¼ŒåŒæ­¥å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼›</p><p><code>Everysec</code>ï¼Œæ¯ç§’å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜ï¼›</p><p><code>No</code>ï¼Œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜ã€‚</p><h3 id="_3-8-ä¸‰ç§å†™å›ç­–ç•¥çš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-8-ä¸‰ç§å†™å›ç­–ç•¥çš„ä¼˜ç¼ºç‚¹"><span>3.8 <strong>ä¸‰ç§å†™å›ç­–ç•¥çš„ä¼˜ç¼ºç‚¹</strong></span></a></h3><p>ä¸Šé¢çš„ä¸‰ç§å†™å›ç­–ç•¥ä½“ç°äº†ä¸€ä¸ªé‡è¦åŸåˆ™ï¼š<strong>trade-off</strong>ï¼Œå–èˆï¼ŒæŒ‡åœ¨æ€§èƒ½å’Œå¯é æ€§ä¿è¯ä¹‹é—´åšå–èˆã€‚</p><p>å…³äºAOFçš„åŒæ­¥ç­–ç•¥æ˜¯æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„ write å‡½æ•°å’Œ fsync å‡½æ•°çš„ï¼Œåœ¨ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ä¸­æ˜¯è¿™æ ·è¯´æ˜çš„</p><blockquote><p>ä¸ºäº†æé«˜æ–‡ä»¶å†™å…¥æ•ˆç‡ï¼Œåœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œå½“ç”¨æˆ·è°ƒç”¨writeå‡½æ•°ï¼Œå°†ä¸€äº›æ•°æ®å†™å…¥æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå°†æ•°æ®æš‚å­˜åˆ°ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºé‡Œï¼Œå½“ç¼“å†²åŒºçš„ç©ºé—´è¢«å¡«æ»¡æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é™åï¼Œæ‰çœŸæ­£å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°ç£ç›˜é‡Œã€‚</p><p>è¿™æ ·çš„æ“ä½œè™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†ä¹Ÿä¸ºæ•°æ®å†™å…¥å¸¦æ¥äº†å®‰å…¨é—®é¢˜ï¼šå¦‚æœè®¡ç®—æœºåœæœºï¼Œå†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚ä¸ºæ­¤ï¼Œç³»ç»Ÿæä¾›äº†fsyncã€fdatasyncåŒæ­¥å‡½æ•°ï¼Œå¯ä»¥å¼ºåˆ¶æ“ä½œç³»ç»Ÿç«‹åˆ»å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜é‡Œï¼Œä»è€Œç¡®ä¿å†™å…¥æ•°æ®çš„å®‰å…¨æ€§ã€‚</p></blockquote><h3 id="_3-9-ä»€ä¹ˆæ˜¯aofé‡å†™" tabindex="-1"><a class="header-anchor" href="#_3-9-ä»€ä¹ˆæ˜¯aofé‡å†™"><span>3.9 ä»€ä¹ˆæ˜¯AOFé‡å†™ï¼Ÿ</span></a></h3><p>Redisé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ¥æ›¿æ¢ç°æœ‰çš„AOFï¼Œæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®ç›¸åŒï¼Œä½†æ–°AOFæ–‡ä»¶æ²¡æœ‰äº†å†—ä½™å‘½ä»¤ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037361.png" alt="image-20220628222858541" tabindex="0" loading="lazy"><figcaption>image-20220628222858541</figcaption></figure><h3 id="_3-10-aofé‡å†™ä¼šé˜»å¡å—" tabindex="-1"><a class="header-anchor" href="#_3-10-aofé‡å†™ä¼šé˜»å¡å—"><span>3.10 AOFé‡å†™ä¼šé˜»å¡å—ï¼Ÿ</span></a></h3><p>AOFé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°è¿›ç¨‹bgrewriteaofæ¥å®Œæˆçš„ã€‚ä¸»çº¿ç¨‹forkå‡ºåå°çš„bgrewriteaofå­è¿›ç¨‹ï¼Œforkä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™bgrewriteaofå­è¿›ç¨‹ï¼Œè¿™é‡Œé¢å°±åŒ…å«äº†æ•°æ®åº“çš„æœ€æ–°æ•°æ®ã€‚ç„¶åï¼Œbgrewriteaofå­è¿›ç¨‹å°±å¯ä»¥åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œé€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œï¼Œè®°å…¥é‡å†™æ—¥å¿—ã€‚</p><p>æ‰€ä»¥aofåœ¨é‡å†™æ—¶ï¼Œåœ¨forkè¿›ç¨‹æ—¶æ˜¯ä¼šé˜»å¡ä½ä¸»çº¿ç¨‹çš„</p><h3 id="_3-11-aofæ—¥å¿—ä½•æ—¶ä¼šé‡å†™" tabindex="-1"><a class="header-anchor" href="#_3-11-aofæ—¥å¿—ä½•æ—¶ä¼šé‡å†™"><span>3.11 AOFæ—¥å¿—ä½•æ—¶ä¼šé‡å†™ï¼Ÿ</span></a></h3><p>æœ‰ä¸¤ä¸ªé…ç½®é¡¹æ§åˆ¶AOFé‡å†™çš„è§¦å‘ï¼š</p><p><code>auto-aof-rewrite-min-size</code>:è¡¨ç¤ºè¿è¡ŒAOFé‡å†™æ—¶æ–‡ä»¶çš„æœ€å°å¤§å°ï¼Œé»˜è®¤ä¸º64MBã€‚</p><p><code>auto-aof-rewrite-percentage</code>:è¿™ä¸ªå€¼çš„è®¡ç®—æ–¹å¼æ˜¯ï¼Œå½“å‰aofæ–‡ä»¶å¤§å°å’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„å·®å€¼ï¼Œå†é™¤ä»¥ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°ã€‚ä¹Ÿå°±æ˜¯å½“å‰aofæ–‡ä»¶æ¯”ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶çš„å¢é‡å¤§å°ï¼Œå’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„æ¯”å€¼ã€‚</p><h3 id="_3-12-aofé‡å†™æ—¥å¿—æ—¶-æœ‰æ–°æ•°æ®å†™å…¥å’‹æ•´" tabindex="-1"><a class="header-anchor" href="#_3-12-aofé‡å†™æ—¥å¿—æ—¶-æœ‰æ–°æ•°æ®å†™å…¥å’‹æ•´"><span>3.12 AOFé‡å†™æ—¥å¿—æ—¶ï¼Œæœ‰æ–°æ•°æ®å†™å…¥å’‹æ•´ï¼Ÿ</span></a></h3><p>é‡å†™è¿‡ç¨‹æ€»ç»“ä¸ºï¼šâ€œä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—â€ã€‚åœ¨forkå‡ºå­è¿›ç¨‹æ—¶çš„æ‹·è´ï¼Œä»¥åŠåœ¨é‡å†™æ—¶ï¼Œå¦‚æœæœ‰æ–°æ•°æ®å†™å…¥ï¼Œä¸»çº¿ç¨‹å°±ä¼šå°†å‘½ä»¤è®°å½•åˆ°ä¸¤ä¸ªaofæ—¥å¿—å†…å­˜ç¼“å†²åŒºä¸­ã€‚å¦‚æœAOFå†™å›ç­–ç•¥é…ç½®çš„æ˜¯alwaysï¼Œåˆ™ç›´æ¥å°†å‘½ä»¤å†™å›æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”ä¿å­˜ä¸€ä»½å‘½ä»¤è‡³AOFé‡å†™ç¼“å†²åŒºï¼Œè¿™äº›æ“ä½œå¯¹æ–°çš„æ—¥å¿—æ–‡ä»¶æ˜¯ä¸å­˜åœ¨å½±å“çš„ã€‚ï¼ˆæ—§çš„æ—¥å¿—æ–‡ä»¶ï¼šä¸»çº¿ç¨‹ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼šbgrewriteaofè¿›ç¨‹ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶ï¼‰</p><p>è€Œåœ¨bgrewriteaofå­è¿›ç¨‹å®Œæˆä¼šæ—¥å¿—æ–‡ä»¶çš„é‡å†™æ“ä½œåï¼Œä¼šæç¤ºä¸»çº¿ç¨‹å·²ç»å®Œæˆé‡å†™æ“ä½œï¼Œä¸»çº¿ç¨‹ä¼šå°†AOFé‡å†™ç¼“å†²ä¸­çš„å‘½ä»¤è¿½åŠ åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶åé¢ã€‚è¿™æ—¶å€™åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒAOFé‡å†™ç¼“å†²åŒºç§¯ç´¯å¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¿™æ ·å°±ä¼šé€ æˆé˜»å¡ï¼ŒRedisåæ¥é€šè¿‡Linuxç®¡é“æŠ€æœ¯è®©aofé‡å†™æœŸé—´å°±èƒ½åŒæ—¶è¿›è¡Œå›æ”¾ï¼Œè¿™æ ·aofé‡å†™ç»“æŸååªéœ€å›æ”¾å°‘é‡å‰©ä½™çš„æ•°æ®å³å¯ã€‚</p><p>æœ€åé€šè¿‡ä¿®æ”¹æ–‡ä»¶åçš„æ–¹å¼ï¼Œä¿è¯æ–‡ä»¶åˆ‡æ¢çš„åŸå­æ€§ã€‚</p><p>åœ¨AOFé‡å†™æ—¥å¿—æœŸé—´å‘ç”Ÿå®•æœºçš„è¯ï¼Œå› ä¸ºæ—¥å¿—æ–‡ä»¶è¿˜æ²¡åˆ‡æ¢ï¼Œæ‰€ä»¥æ¢å¤æ•°æ®æ—¶ï¼Œç”¨çš„è¿˜æ˜¯æ—§çš„æ—¥å¿—æ–‡ä»¶ã€‚</p><h3 id="_3-13-ä¸»çº¿ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ˜¯å¦‚ä½•å¤åˆ¶å†…å­˜æ•°æ®çš„" tabindex="-1"><a class="header-anchor" href="#_3-13-ä¸»çº¿ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ˜¯å¦‚ä½•å¤åˆ¶å†…å­˜æ•°æ®çš„"><span>3.13 ä¸»çº¿ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ˜¯å¦‚ä½•å¤åˆ¶å†…å­˜æ•°æ®çš„ï¼Ÿ</span></a></h3><p>forké‡‡ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å†™æ—¶å¤åˆ¶ï¼ˆcopy on writeï¼‰æœºåˆ¶ï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‹·è´å¤§é‡å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹é€ æˆé˜»å¡ã€‚forkå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹æ—¶ä¼šæ‹·è´çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œå³è™šå®æ˜ å°„å…³ç³»ï¼ˆè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„ç´¢å¼•è¡¨ï¼‰ï¼Œè€Œä¸ä¼šæ‹·è´ç‰©ç†å†…å­˜ã€‚è¿™ä¸ªæ‹·è´ä¼šæ¶ˆè€—å¤§é‡cpuèµ„æºï¼Œå¹¶ä¸”æ‹·è´å®Œæˆå‰ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œé˜»å¡æ—¶é—´å–å†³äºå†…å­˜ä¸­çš„æ•°æ®é‡ï¼Œæ•°æ®é‡è¶Šå¤§ï¼Œåˆ™å†…å­˜é¡µè¡¨è¶Šå¤§ã€‚æ‹·è´å®Œæˆåï¼Œçˆ¶å­è¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„å†…å­˜åœ°å€ç©ºé—´ã€‚</p><p>ä½†ä¸»è¿›ç¨‹æ˜¯å¯ä»¥æœ‰æ•°æ®å†™å…¥çš„ï¼Œè¿™æ—¶å€™å°±ä¼šæ‹·è´ç‰©ç†å†…å­˜ä¸­çš„æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼ˆè¿›ç¨‹1çœ‹åšæ˜¯ä¸»è¿›ç¨‹ï¼Œè¿›ç¨‹2çœ‹åšæ˜¯å­è¿›ç¨‹ï¼‰ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037385.png" alt="image-20220628223022048" tabindex="0" loading="lazy"><figcaption>image-20220628223022048</figcaption></figure><p>åœ¨ä¸»è¿›ç¨‹æœ‰æ•°æ®å†™å…¥æ—¶ï¼Œè€Œè¿™ä¸ªæ•°æ®åˆšå¥½åœ¨é¡µcä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºè¿™ä¸ªé¡µé¢çš„å‰¯æœ¬ï¼ˆé¡µcçš„å‰¯æœ¬ï¼‰ï¼Œå³æ‹·è´å½“å‰é¡µçš„ç‰©ç†æ•°æ®ï¼Œå°†å…¶æ˜ å°„åˆ°ä¸»è¿›ç¨‹ä¸­ï¼Œè€Œå­è¿›ç¨‹è¿˜æ˜¯ä½¿ç”¨åŸæ¥çš„çš„é¡µcã€‚</p><h3 id="_3-14-åœ¨é‡å†™æ—¥å¿—æ•´ä¸ªè¿‡ç¨‹æ—¶-ä¸»çº¿ç¨‹æœ‰å“ªäº›åœ°æ–¹ä¼šè¢«é˜»å¡" tabindex="-1"><a class="header-anchor" href="#_3-14-åœ¨é‡å†™æ—¥å¿—æ•´ä¸ªè¿‡ç¨‹æ—¶-ä¸»çº¿ç¨‹æœ‰å“ªäº›åœ°æ–¹ä¼šè¢«é˜»å¡"><span>3.14 åœ¨é‡å†™æ—¥å¿—æ•´ä¸ªè¿‡ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹æœ‰å“ªäº›åœ°æ–¹ä¼šè¢«é˜»å¡ï¼Ÿ</span></a></h3><ol><li>forkå­è¿›ç¨‹æ—¶ï¼Œéœ€è¦æ‹·è´è™šæ‹Ÿé¡µè¡¨ï¼Œä¼šå¯¹ä¸»çº¿ç¨‹é˜»å¡ã€‚</li><li>ä¸»è¿›ç¨‹æœ‰bigkeyå†™å…¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºé¡µé¢çš„å‰¯æœ¬ï¼Œå¹¶æ‹·è´åŸæœ‰çš„æ•°æ®ï¼Œä¼šå¯¹ä¸»çº¿ç¨‹é˜»å¡ã€‚</li><li>å­è¿›ç¨‹é‡å†™æ—¥å¿—å®Œæˆåï¼Œä¸»è¿›ç¨‹è¿½åŠ aofé‡å†™ç¼“å†²åŒºæ—¶å¯èƒ½ä¼šå¯¹ä¸»çº¿ç¨‹é˜»å¡ã€‚</li></ol><h3 id="_3-15-ä¸ºä»€ä¹ˆaofé‡å†™ä¸å¤ç”¨åŸaofæ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_3-15-ä¸ºä»€ä¹ˆaofé‡å†™ä¸å¤ç”¨åŸaofæ—¥å¿—"><span>3.15 ä¸ºä»€ä¹ˆAOFé‡å†™ä¸å¤ç”¨åŸAOFæ—¥å¿—ï¼Ÿ</span></a></h3><p>ä¸¤æ–¹é¢åŸå› ï¼š</p><ol><li>çˆ¶å­è¿›ç¨‹å†™åŒä¸€ä¸ªæ–‡ä»¶ä¼šäº§ç”Ÿç«äº‰é—®é¢˜ï¼Œå½±å“çˆ¶è¿›ç¨‹çš„æ€§èƒ½ã€‚</li><li>å¦‚æœAOFé‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œç›¸å½“äºæ±¡æŸ“äº†åŸæœ¬çš„AOFæ–‡ä»¶ï¼Œæ— æ³•åšæ¢å¤æ•°æ®ä½¿ç”¨ã€‚</li></ol><h3 id="_3-16-redis-è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_3-16-redis-è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº›"><span>3.16 Redis è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº›?</span></a></h3><p>åœ¨å•æœºç‰ˆRedisä¸­ï¼Œå­˜åœ¨ä¸¤ç§åˆ é™¤ç­–ç•¥ï¼š</p><ul><li><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œåªæœ‰å½“å®¢æˆ·ç«¯æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ã€‚</li><li><strong>å®šæœŸåˆ é™¤</strong>ï¼šæœåŠ¡å™¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å†…å­˜å’ŒCPUçš„æŠ˜ä¸­ï¼ˆåˆ é™¤ä¼šé‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯é¢‘ç¹çš„åˆ é™¤æ“ä½œå¯¹CPUä¸å‹å¥½ï¼‰ï¼Œè¯¥åˆ é™¤çš„é¢‘ç‡å’Œæ‰§è¡Œæ—¶é—´éƒ½å—åˆ°äº†é™åˆ¶ã€‚</li></ul><p>åœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸‹ï¼Œä¸ºäº†ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ç”±ä¸»èŠ‚ç‚¹æ§åˆ¶ä»èŠ‚ç‚¹ä¸­è¿‡æœŸæ•°æ®çš„åˆ é™¤ã€‚ç”±äºä¸»èŠ‚ç‚¹çš„æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç­–ç•¥ï¼Œéƒ½ä¸èƒ½ä¿è¯ä¸»èŠ‚ç‚¹åŠæ—¶å¯¹è¿‡æœŸæ•°æ®æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå› æ­¤ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡Redisä»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶ï¼Œå¾ˆå®¹æ˜“è¯»å–åˆ°å·²ç»è¿‡æœŸçš„æ•°æ®ã€‚</p><p>Redis 3.2ä¸­ï¼Œä»èŠ‚ç‚¹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¢åŠ äº†å¯¹æ•°æ®æ˜¯å¦è¿‡æœŸçš„åˆ¤æ–­ï¼šå¦‚æœè¯¥æ•°æ®å·²è¿‡æœŸï¼Œåˆ™ä¸è¿”å›ç»™å®¢æˆ·ç«¯ï¼›å°†Rediså‡çº§åˆ°3.2å¯ä»¥è§£å†³æ•°æ®è¿‡æœŸé—®é¢˜ã€‚</p><h3 id="_3-17-redis-å†…å­˜æ·˜æ±°ç®—æ³•æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_3-17-redis-å†…å­˜æ·˜æ±°ç®—æ³•æœ‰å“ªäº›"><span>3.17 Redis å†…å­˜æ·˜æ±°ç®—æ³•æœ‰å“ªäº›?</span></a></h3><p>Rediså…±æ”¯æŒå…«ç§æ·˜æ±°ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯noevictionã€volatile-randomã€volatile-ttlã€volatile-lruã€volatile-lfuã€allkeys-lruã€allkeys-random å’Œ allkeys-lfu ç­–ç•¥ã€‚</p><p><strong>æ€ä¹ˆç†è§£å‘¢</strong>ï¼Ÿä¸»è¦çœ‹åˆ†ä¸‰ç±»çœ‹ï¼š</p><ul><li>ä¸æ·˜æ±° <ul><li>noeviction ï¼ˆv4.0åé»˜è®¤çš„ï¼‰</li></ul></li><li>å¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±° <ul><li>éšæœºï¼švolatile-random</li><li>ttlï¼švolatile-ttl</li><li>lruï¼švolatile-lru</li><li>lfuï¼švolatile-lfu</li></ul></li><li>å…¨éƒ¨æ•°æ®è¿›è¡Œæ·˜æ±° <ul><li>éšæœºï¼šallkeys-random</li><li>lruï¼šallkeys-lru</li><li>lfuï¼šallkeys-lfu</li></ul></li></ul><p><strong>LRUç®—æ³•</strong>ï¼šLRU ç®—æ³•çš„å…¨ç§°æ˜¯ Least Recently Usedï¼ŒæŒ‰ç…§æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„åŸåˆ™æ¥ç­›é€‰æ•°æ®ã€‚è¿™ç§æ¨¡å¼ä¸‹ä¼šä½¿ç”¨ LRU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ã€‚</p><p>Redisä¼˜åŒ–çš„<strong>LRUç®—æ³•å®ç°</strong>ï¼š</p><p>Redisä¼šè®°å½•æ¯ä¸ªæ•°æ®çš„æœ€è¿‘ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´æˆ³ã€‚åœ¨Redisåœ¨å†³å®šæ·˜æ±°çš„æ•°æ®æ—¶ï¼Œç¬¬ä¸€æ¬¡ä¼šéšæœºé€‰å‡º N ä¸ªæ•°æ®ï¼ŒæŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªå€™é€‰é›†åˆã€‚æ¥ä¸‹æ¥ï¼ŒRedis ä¼šæ¯”è¾ƒè¿™ N ä¸ªæ•°æ®çš„ lru å­—æ®µï¼ŒæŠŠ lru å­—æ®µå€¼æœ€å°çš„æ•°æ®ä»ç¼“å­˜ä¸­æ·˜æ±°å‡ºå»ã€‚é€šè¿‡éšæœºè¯»å–å¾…åˆ é™¤é›†åˆï¼Œå¯ä»¥è®©Redisä¸ç”¨ç»´æŠ¤ä¸€ä¸ªå·¨å¤§çš„é“¾è¡¨ï¼Œä¹Ÿä¸ç”¨æ“ä½œé“¾è¡¨ï¼Œè¿›è€Œæå‡æ€§èƒ½ã€‚</p><p><strong>LFU ç®—æ³•</strong>ï¼šLFU ç¼“å­˜ç­–ç•¥æ˜¯åœ¨ LRU ç­–ç•¥åŸºç¡€ä¸Šï¼Œä¸ºæ¯ä¸ªæ•°æ®å¢åŠ äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¥ç»Ÿè®¡è¿™ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚å½“ä½¿ç”¨ LFU ç­–ç•¥ç­›é€‰æ·˜æ±°æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®æ•°æ®çš„è®¿é—®æ¬¡æ•°è¿›è¡Œç­›é€‰ï¼ŒæŠŠè®¿é—®æ¬¡æ•°æœ€ä½çš„æ•°æ®æ·˜æ±°å‡ºç¼“å­˜ã€‚å¦‚æœä¸¤ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ç›¸åŒï¼ŒLFU ç­–ç•¥å†æ¯”è¾ƒè¿™ä¸¤ä¸ªæ•°æ®çš„è®¿é—®æ—¶æ•ˆæ€§ï¼ŒæŠŠè·ç¦»ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´æ›´ä¹…çš„æ•°æ®æ·˜æ±°å‡ºç¼“å­˜ã€‚ Redisçš„LFUç®—æ³•å®ç°:</p><p>å½“ LFU ç­–ç•¥ç­›é€‰æ•°æ®æ—¶ï¼ŒRedis ä¼šåœ¨å€™é€‰é›†åˆä¸­ï¼Œæ ¹æ®æ•°æ® lru å­—æ®µçš„å 8bit é€‰æ‹©è®¿é—®æ¬¡æ•°æœ€å°‘çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚å½“è®¿é—®æ¬¡æ•°ç›¸åŒæ—¶ï¼Œå†æ ¹æ® lru å­—æ®µçš„å‰ 16bit å€¼å¤§å°ï¼Œé€‰æ‹©è®¿é—®æ—¶é—´æœ€ä¹…è¿œçš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚</p><p>Redis åªä½¿ç”¨äº† 8bit è®°å½•æ•°æ®çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œ 8bit è®°å½•çš„æœ€å¤§å€¼æ˜¯ 255ï¼Œè¿™æ ·åœ¨è®¿é—®å¿«é€Ÿçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ¯æ¬¡è¢«è®¿é—®å°±å°†è®¿é—®æ¬¡æ•°åŠ ä¸€ï¼Œå¾ˆå¿«æŸæ¡æ•°æ®å°±è¾¾åˆ°æœ€å¤§å€¼255ï¼Œå¯èƒ½å¾ˆå¤šæ•°æ®éƒ½æ˜¯255ï¼Œé‚£ä¹ˆé€€åŒ–æˆLRUç®—æ³•äº†ã€‚æ‰€ä»¥Redisä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ç°äº†ä¸€ä¸ªæ›´ä¼˜çš„è®¡æ•°è§„åˆ™ï¼Œå¹¶å¯ä»¥é€šè¿‡é…ç½®é¡¹ï¼Œæ¥æ§åˆ¶è®¡æ•°å™¨å¢åŠ çš„é€Ÿåº¦ã€‚</p><h3 id="_3-18-redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_3-18-redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>3.18 Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h3><p>å¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥é…ç½®å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚</p><h3 id="_3-19-rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-19-rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–"><span>3.19 Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</span></a></h3><ol><li>ç¼©å‡é”®å€¼å¯¹è±¡: ç¼©å‡é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰çš„é•¿åº¦ï¼Œ</li></ol><p>keyé•¿åº¦ï¼šå¦‚åœ¨è®¾è®¡é”®æ—¶ï¼Œåœ¨å®Œæ•´æè¿°ä¸šåŠ¡æƒ…å†µä¸‹ï¼Œé”®å€¼è¶ŠçŸ­è¶Šå¥½ã€‚</p><p>valueé•¿åº¦ï¼šå€¼å¯¹è±¡ç¼©å‡æ¯”è¾ƒå¤æ‚ï¼Œå¸¸è§éœ€æ±‚æ˜¯æŠŠä¸šåŠ¡å¯¹è±¡åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°ç»„æ”¾å…¥Redisã€‚é¦–å…ˆåº”è¯¥åœ¨ä¸šåŠ¡ä¸Šç²¾ç®€ä¸šåŠ¡å¯¹è±¡ï¼Œå»æ‰ä¸å¿…è¦çš„å±æ€§é¿å…å­˜å‚¨æ— æ•ˆæ•°æ®ã€‚å…¶æ¬¡åœ¨åºåˆ—åŒ–å·¥å…·é€‰æ‹©ä¸Šï¼Œåº”è¯¥é€‰æ‹©æ›´é«˜æ•ˆçš„åºåˆ—åŒ–å·¥å…·æ¥é™ä½å­—èŠ‚æ•°ç»„å¤§å°ã€‚ä»¥JAVAä¸ºä¾‹ï¼Œå†…ç½®çš„åºåˆ—åŒ–æ–¹å¼æ— è®ºä»é€Ÿåº¦è¿˜æ˜¯å‹ç¼©æ¯”éƒ½ä¸å°½å¦‚äººæ„ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹©æ›´é«˜æ•ˆçš„åºåˆ—åŒ–å·¥å…·ï¼Œå¦‚: protostuffï¼Œkryoç­‰ï¼Œä¸‹å›¾æ˜¯JAVAå¸¸è§åºåˆ—åŒ–å·¥å…·ç©ºé—´å‹ç¼©å¯¹æ¯”ã€‚</p><ol><li>å…±äº«å¯¹è±¡æ± </li></ol><p>å¯¹è±¡å…±äº«æ± æŒ‡Rediså†…éƒ¨ç»´æŠ¤[0-9999]çš„æ•´æ•°å¯¹è±¡æ± ã€‚åˆ›å»ºå¤§é‡çš„æ•´æ•°ç±»å‹redisObjectå­˜åœ¨å†…å­˜å¼€é”€ï¼Œæ¯ä¸ªredisObjectå†…éƒ¨ç»“æ„è‡³å°‘å 16å­—èŠ‚ï¼Œç”šè‡³è¶…è¿‡äº†æ•´æ•°è‡ªèº«ç©ºé—´æ¶ˆè€—ã€‚æ‰€ä»¥Rediså†…å­˜ç»´æŠ¤ä¸€ä¸ª[0-9999]çš„æ•´æ•°å¯¹è±¡æ± ï¼Œç”¨äºèŠ‚çº¦å†…å­˜ã€‚ é™¤äº†æ•´æ•°å€¼å¯¹è±¡ï¼Œå…¶ä»–ç±»å‹å¦‚list,hash,set,zsetå†…éƒ¨å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°å¯¹è±¡æ± ã€‚å› æ­¤å¼€å‘ä¸­åœ¨æ»¡è¶³éœ€æ±‚çš„å‰æä¸‹ï¼Œå°½é‡ä½¿ç”¨æ•´æ•°å¯¹è±¡ä»¥èŠ‚çœå†…å­˜ã€‚</p><ol><li>å­—ç¬¦ä¸²ä¼˜åŒ–</li><li>ç¼–ç ä¼˜åŒ–</li><li>æ§åˆ¶keyçš„æ•°é‡</li></ol><h3 id="_3-20-redis-key-çš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_3-20-redis-key-çš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®"><span>3.20 Redis key çš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</span></a></h3><p>EXPIRE å’Œ PERSIST å‘½ä»¤</p><h3 id="_3-21-redis-ä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#_3-21-redis-ä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨"><span>3.21 Redis ä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></a></h3><p>ä¸€æ¬¡è¯·æ±‚/å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ï¼Œè¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚</p><p>è¿™å°±æ˜¯ç®¡é“ï¼ˆpipeliningï¼‰ï¼Œæ˜¯ä¸€ç§å‡ åå¹´æ¥å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä¾‹å¦‚è®¸å¤š POP3 åè®®å·²ç»å®ç°æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¤§å¤§åŠ å¿«äº†ä»æœåŠ¡å™¨ä¸‹è½½æ–°é‚®ä»¶çš„è¿‡ç¨‹ã€‚</p><h2 id="_4-äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_4-äº‹åŠ¡"><span>4. äº‹åŠ¡</span></a></h2><h3 id="_4-1-ä»€ä¹ˆæ˜¯redisäº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_4-1-ä»€ä¹ˆæ˜¯redisäº‹åŠ¡"><span>4.1 ä»€ä¹ˆæ˜¯redisäº‹åŠ¡ï¼Ÿ</span></a></h3><p>Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚</p><p>æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚</p><h3 id="_4-2-redisäº‹åŠ¡ç›¸å…³å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-2-redisäº‹åŠ¡ç›¸å…³å‘½ä»¤"><span>4.2 Redisäº‹åŠ¡ç›¸å…³å‘½ä»¤ï¼Ÿ</span></a></h3><p>MULTI ã€ EXEC ã€ DISCARD å’Œ WATCH æ˜¯ Redis äº‹åŠ¡ç›¸å…³çš„å‘½ä»¤ã€‚</p><ul><li>MULTI ï¼šå¼€å¯äº‹åŠ¡ï¼Œredisä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨EXECå‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ—ã€‚</li><li>EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤ã€‚</li><li>DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</li><li>WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey,å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚</li><li>UNWATCHï¼šå–æ¶ˆWATCHå¯¹æ‰€æœ‰keyçš„ç›‘è§†</li></ul><h3 id="_4-3-redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#_4-3-redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ"><span>4.3 Redisäº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µï¼Ÿ</span></a></h3><p>Redisäº‹åŠ¡æ‰§è¡Œæ˜¯ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>å¼€å¯</strong>ï¼šä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡</li><li><strong>å…¥é˜Ÿ</strong>ï¼šå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢</li><li><strong>æ‰§è¡Œ</strong>ï¼šç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡</li></ul><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯åˆ‡æ¢åˆ°äº‹åŠ¡çŠ¶æ€ä¹‹åï¼Œ æœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªå®¢æˆ·ç«¯å‘æ¥çš„ä¸åŒå‘½ä»¤æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š</p><ul><li>å¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ä¸º EXEC ã€ DISCARD ã€ WATCH ã€ MULTI å››ä¸ªå‘½ä»¤çš„å…¶ä¸­ä¸€ä¸ªï¼Œ é‚£ä¹ˆæœåŠ¡å™¨ç«‹å³æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</li><li>ä¸æ­¤ç›¸åï¼Œ å¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤æ˜¯ EXEC ã€ DISCARD ã€ WATCH ã€ MULTI å››ä¸ªå‘½ä»¤ä»¥å¤–çš„å…¶ä»–å‘½ä»¤ï¼Œ é‚£ä¹ˆæœåŠ¡å™¨å¹¶ä¸ç«‹å³æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™ä¸ªå‘½ä»¤æ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œé¢ï¼Œ ç„¶åå‘å®¢æˆ·ç«¯è¿”å› QUEUED å›å¤ã€‚</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037413.png" alt="image-20220628223526301" tabindex="0" loading="lazy"><figcaption>image-20220628223526301</figcaption></figure><h3 id="_4-4-redisäº‹åŠ¡å…¶å®ƒå®ç°" tabindex="-1"><a class="header-anchor" href="#_4-4-redisäº‹åŠ¡å…¶å®ƒå®ç°"><span>4.4 Redisäº‹åŠ¡å…¶å®ƒå®ç°ï¼Ÿ</span></a></h3><ul><li>åŸºäºLuaè„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œå…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ</li><li>åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç</li></ul><h3 id="_4-5-redisäº‹åŠ¡ä¸­å‡ºç°é”™è¯¯çš„å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-5-redisäº‹åŠ¡ä¸­å‡ºç°é”™è¯¯çš„å¤„ç†"><span>4.5 Redisäº‹åŠ¡ä¸­å‡ºç°é”™è¯¯çš„å¤„ç†ï¼Ÿ</span></a></h3><ul><li><strong>è¯­æ³•é”™è¯¯ï¼ˆç¼–è¯‘å™¨é”™è¯¯ï¼‰</strong></li></ul><p>åœ¨å¼€å¯äº‹åŠ¡åï¼Œä¿®æ”¹k1å€¼ä¸º11ï¼Œk2å€¼ä¸º22ï¼Œä½†k2è¯­æ³•é”™è¯¯ï¼Œ<strong>æœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œk1ã€k2ä¿ç•™åŸå€¼</strong>ã€‚</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span><span style="color:#98C379;--shiki-dark:#98C379;"> v1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k2</span><span style="color:#98C379;--shiki-dark:#98C379;"> v2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">MULTI</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 11</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">sets</span><span style="color:#98C379;--shiki-dark:#98C379;"> k2</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 22</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ERR</span><span style="color:#98C379;--shiki-dark:#98C379;"> unknown</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#98C379;--shiki-dark:#98C379;"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sets</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> args</span><span style="color:#98C379;--shiki-dark:#98C379;"> beginning</span><span style="color:#98C379;--shiki-dark:#98C379;"> with:</span><span style="color:#98C379;--shiki-dark:#98C379;"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">k2</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">22</span><span style="color:#98C379;--shiki-dark:#98C379;">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">exec</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EXECABORT</span><span style="color:#98C379;--shiki-dark:#98C379;"> Transaction</span><span style="color:#98C379;--shiki-dark:#98C379;"> discarded</span><span style="color:#98C379;--shiki-dark:#98C379;"> because</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> previous</span><span style="color:#98C379;--shiki-dark:#98C379;"> errors.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">get</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;v1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">get</span><span style="color:#98C379;--shiki-dark:#98C379;"> k2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;v2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Redisç±»å‹é”™è¯¯ï¼ˆè¿è¡Œæ—¶é”™è¯¯ï¼‰</strong></li></ul><p>åœ¨å¼€å¯äº‹åŠ¡åï¼Œä¿®æ”¹k1å€¼ä¸º11ï¼Œk2å€¼ä¸º22ï¼Œä½†å°†k2çš„ç±»å‹ä½œä¸ºListï¼Œ<strong>åœ¨è¿è¡Œæ—¶æ£€æµ‹ç±»å‹é”™è¯¯ï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œæ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œè€Œæ˜¯è·³è¿‡é”™è¯¯å‘½ä»¤ç»§ç»­æ‰§è¡Œ</strong>ï¼Œ ç»“æœk1å€¼æ”¹å˜ã€k2ä¿ç•™åŸå€¼</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span><span style="color:#98C379;--shiki-dark:#98C379;"> v1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span><span style="color:#98C379;--shiki-dark:#98C379;"> v2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">MULTI</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 11</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">lpush</span><span style="color:#98C379;--shiki-dark:#98C379;"> k2</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 22</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">QUEUED</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">EXEC</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) WRONGTYPE Operation against a key holding the wrong kind of value</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">get</span><span style="color:#98C379;--shiki-dark:#98C379;"> k1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;11&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">get</span><span style="color:#98C379;--shiki-dark:#98C379;"> k2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;v2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-redisäº‹åŠ¡ä¸­watchæ˜¯å¦‚ä½•ç›‘è§†å®ç°çš„å‘¢" tabindex="-1"><a class="header-anchor" href="#_4-6-redisäº‹åŠ¡ä¸­watchæ˜¯å¦‚ä½•ç›‘è§†å®ç°çš„å‘¢"><span>4.6 Redisäº‹åŠ¡ä¸­watchæ˜¯å¦‚ä½•ç›‘è§†å®ç°çš„å‘¢ï¼Ÿ</span></a></h3><p>Redisä½¿ç”¨WATCHå‘½ä»¤æ¥å†³å®šäº‹åŠ¡æ˜¯ç»§ç»­æ‰§è¡Œè¿˜æ˜¯å›æ»šï¼Œé‚£å°±éœ€è¦åœ¨MULTIä¹‹å‰ä½¿ç”¨WATCHæ¥ç›‘æ§æŸäº›é”®å€¼å¯¹ï¼Œç„¶åä½¿ç”¨MULTIå‘½ä»¤æ¥å¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œå¯¹æ•°æ®ç»“æ„æ“ä½œçš„å„ç§å‘½ä»¤ï¼Œæ­¤æ—¶è¿™äº›å‘½ä»¤å…¥é˜Ÿåˆ—ã€‚</p><p>å½“ä½¿ç”¨EXECæ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œé¦–å…ˆä¼šæ¯”å¯¹WATCHæ‰€ç›‘æ§çš„é”®å€¼å¯¹ï¼Œå¦‚æœæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå®ƒä¼šæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œæäº¤äº‹åŠ¡ï¼›å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œå°†ä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ï¼ŒåŒæ—¶äº‹åŠ¡å›æ»šã€‚å½“ç„¶æ— è®ºæ˜¯å¦å›æ»šï¼ŒRediséƒ½ä¼šå–æ¶ˆæ‰§è¡Œäº‹åŠ¡å‰çš„WATCHå‘½ä»¤ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037448.png" alt="image-20220628223740040" tabindex="0" loading="lazy"><figcaption>image-20220628223740040</figcaption></figure><h3 id="_4-7-ä¸ºä»€ä¹ˆ-redis-ä¸æ”¯æŒå›æ»š" tabindex="-1"><a class="header-anchor" href="#_4-7-ä¸ºä»€ä¹ˆ-redis-ä¸æ”¯æŒå›æ»š"><span>4.7 ä¸ºä»€ä¹ˆ Redis ä¸æ”¯æŒå›æ»šï¼Ÿ</span></a></h3><p>ä»¥ä¸‹æ˜¯è¿™ç§åšæ³•çš„ä¼˜ç‚¹ï¼š</p><ul><li>Redis å‘½ä»¤åªä¼šå› ä¸ºé”™è¯¯çš„è¯­æ³•è€Œå¤±è´¥ï¼ˆå¹¶ä¸”è¿™äº›é—®é¢˜ä¸èƒ½åœ¨å…¥é˜Ÿæ—¶å‘ç°ï¼‰ï¼Œæˆ–æ˜¯å‘½ä»¤ç”¨åœ¨äº†é”™è¯¯ç±»å‹çš„é”®ä¸Šé¢ï¼šè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œä»å®ç”¨æ€§çš„è§’åº¦æ¥è¯´ï¼Œå¤±è´¥çš„å‘½ä»¤æ˜¯ç”±ç¼–ç¨‹é”™è¯¯é€ æˆçš„ï¼Œè€Œè¿™äº›é”™è¯¯åº”è¯¥åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­è¢«å‘ç°ï¼Œè€Œä¸åº”è¯¥å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</li><li>å› ä¸ºä¸éœ€è¦å¯¹å›æ»šè¿›è¡Œæ”¯æŒï¼Œæ‰€ä»¥ Redis çš„å†…éƒ¨å¯ä»¥ä¿æŒç®€å•ä¸”å¿«é€Ÿã€‚</li></ul><p>æœ‰ç§è§‚ç‚¹è®¤ä¸º Redis å¤„ç†äº‹åŠ¡çš„åšæ³•ä¼šäº§ç”Ÿ bug ï¼Œ ç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œ <strong>å›æ»šå¹¶ä¸èƒ½è§£å†³ç¼–ç¨‹é”™è¯¯å¸¦æ¥çš„é—®é¢˜</strong>ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœä½ æœ¬æ¥æƒ³é€šè¿‡ INCR å‘½ä»¤å°†é”®çš„å€¼åŠ ä¸Š 1 ï¼Œ å´ä¸å°å¿ƒåŠ ä¸Šäº† 2 ï¼Œ åˆæˆ–è€…å¯¹é”™è¯¯ç±»å‹çš„é”®æ‰§è¡Œäº† INCR ï¼Œ å›æ»šæ˜¯æ²¡æœ‰åŠæ³•å¤„ç†è¿™äº›æƒ…å†µçš„ã€‚</p><h3 id="_4-8-redis-å¯¹-acidçš„æ”¯æŒæ€§ç†è§£" tabindex="-1"><a class="header-anchor" href="#_4-8-redis-å¯¹-acidçš„æ”¯æŒæ€§ç†è§£"><span>4.8 Redis å¯¹ ACIDçš„æ”¯æŒæ€§ç†è§£ï¼Ÿ</span></a></h3><ul><li><strong>åŸå­æ€§atomicity</strong></li></ul><p>é¦–å…ˆé€šè¿‡ä¸Šæ–‡çŸ¥é“ è¿è¡ŒæœŸçš„é”™è¯¯æ˜¯ä¸ä¼šå›æ»šçš„ï¼Œå¾ˆå¤šæ–‡ç« ç”±æ­¤è¯´Redisäº‹åŠ¡è¿èƒŒåŸå­æ€§çš„ï¼›è€Œå®˜æ–¹æ–‡æ¡£è®¤ä¸ºæ˜¯éµä»åŸå­æ€§çš„ã€‚</p><p>Rediså®˜æ–¹æ–‡æ¡£ç»™çš„ç†è§£æ˜¯ï¼Œ<strong>Redisçš„äº‹åŠ¡æ˜¯åŸå­æ€§çš„ï¼šæ‰€æœ‰çš„å‘½ä»¤ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</strong>ã€‚è€Œä¸æ˜¯å®Œå…¨æˆåŠŸã€‚</p><ul><li><strong>ä¸€è‡´æ€§consistency</strong></li></ul><p>redisäº‹åŠ¡å¯ä»¥ä¿è¯å‘½ä»¤å¤±è´¥çš„æƒ…å†µä¸‹å¾—ä»¥å›æ»šï¼Œæ•°æ®èƒ½æ¢å¤åˆ°æ²¡æœ‰æ‰§è¡Œä¹‹å‰çš„æ ·å­ï¼Œæ˜¯ä¿è¯ä¸€è‡´æ€§çš„ï¼Œé™¤éredisè¿›ç¨‹æ„å¤–ç»ˆç»“ã€‚</p><ul><li><strong>éš”ç¦»æ€§Isolation</strong></li></ul><p>redisäº‹åŠ¡æ˜¯ä¸¥æ ¼éµå®ˆéš”ç¦»æ€§çš„ï¼ŒåŸå› æ˜¯redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼(v6.0ä¹‹å‰ï¼‰ï¼Œå¯ä»¥ä¿è¯å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘½ä»¤æ‰“æ–­ã€‚</p><p>ä½†æ˜¯ï¼ŒRedisä¸åƒå…¶å®ƒç»“æ„åŒ–æ•°æ®åº“æœ‰éš”ç¦»çº§åˆ«è¿™ç§è®¾è®¡ã€‚</p><ul><li><strong>æŒä¹…æ€§Durability</strong></li></ul><p><strong>redisäº‹åŠ¡æ˜¯ä¸ä¿è¯æŒä¹…æ€§çš„</strong>ï¼Œè¿™æ˜¯å› ä¸ºredisæŒä¹…åŒ–ç­–ç•¥ä¸­ä¸ç®¡æ˜¯RDBè¿˜æ˜¯AOFéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸ä¿è¯æŒä¹…æ€§æ˜¯å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘ã€‚</p><h3 id="_4-9-redisäº‹åŠ¡å…¶ä»–å®ç°" tabindex="-1"><a class="header-anchor" href="#_4-9-redisäº‹åŠ¡å…¶ä»–å®ç°"><span>4.9 Redisäº‹åŠ¡å…¶ä»–å®ç°ï¼Ÿ</span></a></h3><p>åŸºäºLuaè„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œå…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ</p><p>åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç</p><h2 id="_5-é›†ç¾¤-ä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#_5-é›†ç¾¤-ä¸»ä»å¤åˆ¶"><span>5. é›†ç¾¤-ä¸»ä»å¤åˆ¶</span></a></h2><h3 id="_5-1-redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„" tabindex="-1"><a class="header-anchor" href="#_5-1-redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„"><span>5.1 Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</span></a></h3><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><p><strong>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</strong>ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><p>ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯<strong>è¯»å†™åˆ†ç¦»</strong>çš„æ–¹å¼ã€‚</p><ul><li>è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼›</li><li>å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037477.png" alt="image-20220628224139614" tabindex="0" loading="lazy"><figcaption>image-20220628224139614</figcaption></figure><p>æ³¨æ„ï¼šåœ¨2.8ç‰ˆæœ¬ä¹‹å‰åªæœ‰å…¨é‡å¤åˆ¶ï¼Œè€Œ2.8ç‰ˆæœ¬åæœ‰å…¨é‡å’Œå¢é‡å¤åˆ¶ï¼š</p><ul><li><strong>å…¨é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</strong>ï¼šæ¯”å¦‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶</li><li><strong>å¢é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</strong>ï¼šåªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“</li></ul><h3 id="_5-2-redis-å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#_5-2-redis-å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µ"><span>5.2 Redis å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µï¼Ÿ</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037507.png" alt="image-20220628224222691" tabindex="0" loading="lazy"><figcaption>image-20220628224222691</figcaption></figure><p><strong>ç¬¬ä¸€é˜¶æ®µæ˜¯ä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥çš„è¿‡ç¨‹</strong>ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°ã€‚runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚offsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒFULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“ã€‚</p><p><strong>ç¬¬äºŒé˜¶æ®µï¼Œä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“</strong>ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆ RDB æ–‡ä»¶ï¼Œæ¥ç€å°†æ–‡ä»¶å‘ç»™ä»åº“ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œä¸»åº“ä¼šæŠŠç¬¬äºŒé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­æ–°æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†å‘é€ç»™ä»åº“</strong>ã€‚å…·ä½“çš„æ“ä½œæ˜¯ï¼Œå½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“å°±å®ç°åŒæ­¥äº†ã€‚</p><h3 id="_5-3-redis-ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#_5-3-redis-ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶"><span>5.3 Redis ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶ï¼Ÿ</span></a></h3><p>å¦‚æœä¸»ä»åº“åœ¨å‘½ä»¤ä¼ æ’­æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œé‚£ä¹ˆï¼Œä»åº“å°±ä¼šå’Œä¸»åº“é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¼€é”€éå¸¸å¤§ã€‚ä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­äº†ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚</p><h3 id="_5-4-redis-å¢é‡å¤åˆ¶çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-4-redis-å¢é‡å¤åˆ¶çš„æµç¨‹"><span>5.4 Redis å¢é‡å¤åˆ¶çš„æµç¨‹ï¼Ÿ</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037545.png" alt="image-20220628225658343" tabindex="0" loading="lazy"><figcaption>image-20220628225658343</figcaption></figure><p>å…ˆçœ‹ä¸¤ä¸ªæ¦‚å¿µï¼š <code>replication buffer</code> å’Œ <code>repl_backlog_buffer</code></p><p><code>repl_backlog_buffer</code>ï¼šå®ƒæ˜¯ä¸ºäº†ä»åº“æ–­å¼€ä¹‹åï¼Œå¦‚ä½•æ‰¾åˆ°ä¸»ä»å·®å¼‚æ•°æ®è€Œè®¾è®¡çš„ç¯å½¢ç¼“å†²åŒºï¼Œä»è€Œé¿å…å…¨é‡å¤åˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœä»åº“æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_backlog_bufferç¯å½¢ç¼“å†²åŒºè¢«ä¸»åº“çš„å†™å‘½ä»¤è¦†ç›–äº†ï¼Œé‚£ä¹ˆä»åº“è¿ä¸Šä¸»åº“ååªèƒ½ä¹–ä¹–åœ°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œæ‰€ä»¥<strong>repl_backlog_bufferé…ç½®å°½é‡å¤§ä¸€äº›ï¼Œå¯ä»¥é™ä½ä¸»ä»æ–­å¼€åå…¨é‡å¤åˆ¶çš„æ¦‚ç‡</strong>ã€‚è€Œåœ¨repl_backlog_bufferä¸­æ‰¾ä¸»ä»å·®å¼‚çš„æ•°æ®åï¼Œå¦‚ä½•å‘ç»™ä»åº“å‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†replication bufferã€‚</p><p><code>replication buffer</code>ï¼šRediså’Œå®¢æˆ·ç«¯é€šä¿¡ä¹Ÿå¥½ï¼Œå’Œä»åº“é€šä¿¡ä¹Ÿå¥½ï¼ŒRediséƒ½éœ€è¦ç»™åˆ†é…ä¸€ä¸ª å†…å­˜bufferè¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªclientï¼Œä»åº“ä¹Ÿæ˜¯ä¸€ä¸ªclientï¼Œæˆ‘ä»¬æ¯ä¸ªclientè¿ä¸ŠRedisåï¼ŒRediséƒ½ä¼šåˆ†é…ä¸€ä¸ªclient bufferï¼Œæ‰€æœ‰æ•°æ®äº¤äº’éƒ½æ˜¯é€šè¿‡è¿™ä¸ªbufferè¿›è¡Œçš„ï¼šRediså…ˆæŠŠæ•°æ®å†™åˆ°è¿™ä¸ªbufferä¸­ï¼Œç„¶åå†æŠŠbufferä¸­çš„æ•°æ®å‘åˆ°client socketä¸­å†é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œè¿™æ ·å°±å®Œæˆäº†æ•°æ®äº¤äº’ã€‚æ‰€ä»¥ä¸»ä»åœ¨å¢é‡åŒæ­¥æ—¶ï¼Œä»åº“ä½œä¸ºä¸€ä¸ªclientï¼Œä¹Ÿä¼šåˆ†é…ä¸€ä¸ªbufferï¼Œåªä¸è¿‡è¿™ä¸ªbufferä¸“é—¨ç”¨æ¥ä¼ æ’­ç”¨æˆ·çš„å†™å‘½ä»¤åˆ°ä»åº“ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åšreplication bufferã€‚</p><h3 id="_5-5-å¢é‡å¤åˆ¶å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´-repl-backlog-sizeç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹å-ä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®-è¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢" tabindex="-1"><a class="header-anchor" href="#_5-5-å¢é‡å¤åˆ¶å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´-repl-backlog-sizeç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹å-ä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®-è¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢"><span>5.5 å¢é‡å¤åˆ¶å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´ï¼Œrepl_backlog_sizeç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹åï¼Œä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®ï¼Œè¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢ï¼Ÿ</span></a></h3><p>å¯¹äºè¿™ä¸ªé—®é¢˜æ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li>ä¸€ä¸ªä»åº“å¦‚æœå’Œä¸»åº“æ–­è¿æ—¶é—´è¿‡é•¿ï¼Œé€ æˆå®ƒåœ¨ä¸»åº“repl_backlog_bufferçš„slave_repl_offsetä½ç½®ä¸Šçš„æ•°æ®å·²ç»è¢«è¦†ç›–æ‰äº†ï¼Œæ­¤æ—¶ä»åº“å’Œä¸»åº“é—´å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚</li><li>æ¯ä¸ªä»åº“ä¼šè®°å½•è‡ªå·±çš„slave_repl_offsetï¼Œæ¯ä¸ªä»åº“çš„å¤åˆ¶è¿›åº¦ä¹Ÿä¸ä¸€å®šç›¸åŒã€‚åœ¨å’Œä¸»åº“é‡è¿è¿›è¡Œæ¢å¤æ—¶ï¼Œä»åº“ä¼šé€šè¿‡psyncå‘½ä»¤æŠŠè‡ªå·±è®°å½•çš„slave_repl_offsetå‘ç»™ä¸»åº“ï¼Œä¸»åº“ä¼šæ ¹æ®ä»åº“å„è‡ªçš„å¤åˆ¶è¿›åº¦ï¼Œæ¥å†³å®šè¿™ä¸ªä»åº“å¯ä»¥è¿›è¡Œå¢é‡å¤åˆ¶ï¼Œè¿˜æ˜¯å…¨é‡å¤åˆ¶ã€‚</li></ol><h3 id="_5-6-redis-ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢" tabindex="-1"><a class="header-anchor" href="#_5-6-redis-ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢"><span>5.6 Redis ä¸ºä»€ä¹ˆä¸æŒä¹…åŒ–çš„ä¸»æœåŠ¡å™¨è‡ªåŠ¨é‡å¯éå¸¸å±é™©å‘¢?</span></a></h3><ul><li>æˆ‘ä»¬è®¾ç½®èŠ‚ç‚¹Aä¸ºä¸»æœåŠ¡å™¨ï¼Œå…³é—­æŒä¹…åŒ–ï¼ŒèŠ‚ç‚¹Bå’ŒCä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ®ã€‚</li><li>è¿™æ—¶å‡ºç°äº†ä¸€ä¸ªå´©æºƒï¼Œä½†Rediså…·æœ‰è‡ªåŠ¨é‡å¯ç³»ç»Ÿï¼Œé‡å¯äº†è¿›ç¨‹ï¼Œå› ä¸ºå…³é—­äº†æŒä¹…åŒ–ï¼ŒèŠ‚ç‚¹é‡å¯ååªæœ‰ä¸€ä¸ªç©ºçš„æ•°æ®é›†ã€‚</li><li>èŠ‚ç‚¹Bå’ŒCä»èŠ‚ç‚¹Aè¿›è¡Œå¤åˆ¶ï¼Œç°åœ¨èŠ‚ç‚¹Aæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥èŠ‚ç‚¹Bå’ŒCä¸Šçš„å¤åˆ¶æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</li><li>å½“åœ¨é«˜å¯ç”¨ç³»ç»Ÿä¸­ä½¿ç”¨Redis Sentinelï¼Œå…³é—­äº†ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–ï¼Œå¹¶ä¸”å…è®¸è‡ªåŠ¨é‡å¯ï¼Œè¿™ç§æƒ…å†µæ˜¯å¾ˆå±é™©çš„ã€‚æ¯”å¦‚ä¸»æœåŠ¡å™¨å¯èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å°±å®Œæˆäº†é‡å¯ï¼Œä»¥è‡³äºSentineléƒ½æ— æ³•æ£€æµ‹åˆ°è¿™æ¬¡å¤±è´¥ï¼Œé‚£ä¹ˆä¸Šé¢è¯´çš„è¿™ç§å¤±è´¥çš„æƒ…å†µå°±å‘ç”Ÿäº†ã€‚</li></ul><p>å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸»ä»å¤åˆ¶æ—¶å…³é—­äº†ä¸»æœåŠ¡å™¨æŒä¹…åŒ–åŠŸèƒ½çš„åœºæ™¯ä¸­ï¼Œéƒ½åº”è¯¥ç¦æ­¢å®ä¾‹è‡ªåŠ¨é‡å¯ã€‚</p><h3 id="_5-7-redis-ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨rdbè€Œä¸ä½¿ç”¨aof" tabindex="-1"><a class="header-anchor" href="#_5-7-redis-ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨rdbè€Œä¸ä½¿ç”¨aof"><span>5.7 Redis ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨RDBè€Œä¸ä½¿ç”¨AOFï¼Ÿ</span></a></h3><p>1ã€RDBæ–‡ä»¶å†…å®¹æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¸åŒæ•°æ®ç±»å‹æ•°æ®åšäº†é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰ï¼Œæ–‡ä»¶å¾ˆå°ã€‚è€ŒAOFæ–‡ä»¶è®°å½•çš„æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œçš„å‘½ä»¤ï¼Œå†™æ“ä½œè¶Šå¤šæ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å¾ˆå¤šå¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†—ä½™æ“ä½œã€‚åœ¨ä¸»ä»å…¨é‡æ•°æ®åŒæ­¥æ—¶ï¼Œä¼ è¾“RDBæ–‡ä»¶å¯ä»¥å°½é‡é™ä½å¯¹ä¸»åº“æœºå™¨ç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ï¼Œä»åº“åœ¨åŠ è½½RDBæ–‡ä»¶æ—¶ï¼Œä¸€æ˜¯æ–‡ä»¶å°ï¼Œè¯»å–æ•´ä¸ªæ–‡ä»¶çš„é€Ÿåº¦ä¼šå¾ˆå¿«ï¼ŒäºŒæ˜¯å› ä¸ºRDBæ–‡ä»¶å­˜å‚¨çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä»åº“ç›´æ¥æŒ‰ç…§RDBåè®®è§£æè¿˜åŸæ•°æ®å³å¯ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œè€ŒAOFéœ€è¦ä¾æ¬¡é‡æ”¾æ¯ä¸ªå†™å‘½ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç»å†å†—é•¿çš„å¤„ç†é€»è¾‘ï¼Œæ¢å¤é€Ÿåº¦ç›¸æ¯”RDBä¼šæ…¢å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨RDBè¿›è¡Œä¸»ä»å…¨é‡å¤åˆ¶çš„æˆæœ¬æœ€ä½ã€‚</p><p>2ã€å‡è®¾è¦ä½¿ç”¨AOFåšå…¨é‡å¤åˆ¶ï¼Œæ„å‘³ç€å¿…é¡»æ‰“å¼€AOFåŠŸèƒ½ï¼Œæ‰“å¼€AOFå°±è¦é€‰æ‹©æ–‡ä»¶åˆ·ç›˜çš„ç­–ç•¥ï¼Œé€‰æ‹©ä¸å½“ä¼šä¸¥é‡å½±å“Redisæ€§èƒ½ã€‚è€ŒRDBåªæœ‰åœ¨éœ€è¦å®šæ—¶å¤‡ä»½å’Œä¸»ä»å…¨é‡å¤åˆ¶æ•°æ®æ—¶æ‰ä¼šè§¦å‘ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚è€Œåœ¨å¾ˆå¤šä¸¢å¤±æ•°æ®ä¸æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ˜¯ä¸éœ€è¦å¼€å¯AOFçš„ã€‚</p><h3 id="_5-8-redis-ä¸ºä»€ä¹ˆè¿˜æœ‰æ— ç£ç›˜å¤åˆ¶æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_5-8-redis-ä¸ºä»€ä¹ˆè¿˜æœ‰æ— ç£ç›˜å¤åˆ¶æ¨¡å¼"><span>5.8 Redis ä¸ºä»€ä¹ˆè¿˜æœ‰æ— ç£ç›˜å¤åˆ¶æ¨¡å¼ï¼Ÿ</span></a></h3><p>Redis é»˜è®¤æ˜¯ç£ç›˜å¤åˆ¶ï¼Œä½†æ˜¯<strong>å¦‚æœä½¿ç”¨æ¯”è¾ƒä½é€Ÿçš„ç£ç›˜ï¼Œè¿™ç§æ“ä½œä¼šç»™ä¸»æœåŠ¡å™¨å¸¦æ¥è¾ƒå¤§çš„å‹åŠ›</strong>ã€‚Redisä»2.8.18ç‰ˆæœ¬å¼€å§‹å°è¯•æ”¯æŒæ— ç£ç›˜çš„å¤åˆ¶ã€‚ä½¿ç”¨è¿™ç§è®¾ç½®æ—¶ï¼Œå­è¿›ç¨‹ç›´æ¥å°†RDBé€šè¿‡ç½‘ç»œå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä¸ä½¿ç”¨ç£ç›˜ä½œä¸ºä¸­é—´å­˜å‚¨ã€‚</p><p><strong>æ— ç£ç›˜å¤åˆ¶æ¨¡å¼</strong>ï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ç›´æ¥dump RDBåˆ°slaveçš„socketï¼Œä¸ç»è¿‡ä¸»è¿›ç¨‹ï¼Œä¸ç»è¿‡ç¡¬ç›˜ã€‚é€‚ç”¨äºdiskè¾ƒæ…¢ï¼Œå¹¶ä¸”ç½‘ç»œè¾ƒå¿«çš„æ—¶å€™ã€‚</p><p>ä½¿ç”¨<code>repl-diskless-sync</code>é…ç½®å‚æ•°æ¥å¯åŠ¨æ— ç£ç›˜å¤åˆ¶ã€‚</p><p>ä½¿ç”¨<code>repl-diskless-sync-delay</code> å‚æ•°æ¥é…ç½®ä¼ è¾“å¼€å§‹çš„å»¶è¿Ÿæ—¶é—´ï¼›masterç­‰å¾…ä¸€ä¸ª<code>repl-diskless-sync-delay</code>çš„ç§’æ•°ï¼Œå¦‚æœæ²¡slaveæ¥çš„è¯ï¼Œå°±ç›´æ¥ä¼ ï¼Œåæ¥çš„å¾—æ’é˜Ÿç­‰äº†; å¦åˆ™å°±å¯ä»¥ä¸€èµ·ä¼ ã€‚</p><h3 id="_5-9-redis-ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_5-9-redis-ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡"><span>5.9 Redis ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡ï¼Ÿ</span></a></h3><p>é€šè¿‡åˆ†æä¸»ä»åº“é—´ç¬¬ä¸€æ¬¡æ•°æ®åŒæ­¥çš„è¿‡ç¨‹ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ¬¡å…¨é‡å¤åˆ¶ä¸­ï¼Œå¯¹äºä¸»åº“æ¥è¯´ï¼Œéœ€è¦å®Œæˆä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼š<strong>ç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶</strong>ã€‚</p><p>å¦‚æœä»åº“æ•°é‡å¾ˆå¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»åº“å¿™äº fork å­è¿›ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å…¨é‡å¤åˆ¶ã€‚fork è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ä¸»åº“å“åº”åº”ç”¨ç¨‹åºçš„è¯·æ±‚é€Ÿåº¦å˜æ…¢ã€‚æ­¤å¤–ï¼Œä¼ è¾“ RDB æ–‡ä»¶ä¹Ÿä¼šå ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼ŒåŒæ ·ä¼šç»™ä¸»åº“çš„èµ„æºä½¿ç”¨å¸¦æ¥å‹åŠ›ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•å¯ä»¥åˆ†æ‹…ä¸»åº“å‹åŠ›å‘¢ï¼Ÿ</p><p>å…¶å®æ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯â€œä¸» - ä» - ä»â€æ¨¡å¼ã€‚</p><p>åœ¨åˆšæ‰ä»‹ç»çš„ä¸»ä»åº“æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ˜¯å’Œä¸»åº“è¿æ¥ï¼Œæ‰€æœ‰çš„å…¨é‡å¤åˆ¶ä¹Ÿéƒ½æ˜¯å’Œä¸»åº“è¿›è¡Œçš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œä¸» - ä» - ä»â€æ¨¡å¼<strong>å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Š</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½²ä¸»ä»é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªä»åº“ï¼ˆæ¯”å¦‚é€‰æ‹©å†…å­˜èµ„æºé…ç½®è¾ƒé«˜çš„ä»åº“ï¼‰ï¼Œç”¨äºçº§è”å…¶ä»–çš„ä»åº“ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†é€‰æ‹©ä¸€äº›ä»åº“ï¼ˆä¾‹å¦‚ä¸‰åˆ†ä¹‹ä¸€çš„ä»åº“ï¼‰ï¼Œåœ¨è¿™äº›ä»åº“ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®©å®ƒä»¬å’Œåˆšæ‰æ‰€é€‰çš„ä»åº“ï¼Œå»ºç«‹èµ·ä¸»ä»å…³ç³»ã€‚</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">replicaof</span><span style="color:#98C379;--shiki-dark:#98C379;"> æ‰€é€‰ä»åº“çš„IP</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6379</span></span></code></pre></div><p>è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›ä»åº“å°±ä¼šçŸ¥é“ï¼Œåœ¨è¿›è¡ŒåŒæ­¥æ—¶ï¼Œä¸ç”¨å†å’Œä¸»åº“è¿›è¡Œäº¤äº’äº†ï¼Œåªè¦å’Œçº§è”çš„ä»åº“è¿›è¡Œå†™æ“ä½œåŒæ­¥å°±è¡Œäº†ï¼Œè¿™å°±å¯ä»¥å‡è½»ä¸»åº“ä¸Šçš„å‹åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037568.png" alt="image-20220628225901289" tabindex="0" loading="lazy"><figcaption>image-20220628225901289</figcaption></figure><p>çº§è”çš„â€œä¸»-ä»-ä»â€æ¨¡å¼å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬äº†è§£äº†ä¸»ä»åº“é—´é€šè¿‡å…¨é‡å¤åˆ¶å®ç°æ•°æ®åŒæ­¥çš„è¿‡ç¨‹ï¼Œä»¥åŠé€šè¿‡â€œä¸» - ä» - ä»â€æ¨¡å¼åˆ†æ‹…ä¸»åº“å‹åŠ›çš„æ–¹å¼ã€‚é‚£ä¹ˆï¼Œä¸€æ—¦ä¸»ä»åº“å®Œæˆäº†å…¨é‡å¤åˆ¶ï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šä¸€ç›´ç»´æŠ¤ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œä¸»åº“ä¼šé€šè¿‡è¿™ä¸ªè¿æ¥å°†åç»­é™†ç»­æ”¶åˆ°çš„å‘½ä»¤æ“ä½œå†åŒæ­¥ç»™ä»åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºåŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­ï¼Œå¯ä»¥é¿å…é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚</p><h2 id="_6-é›†ç¾¤-å“¨å…µæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_6-é›†ç¾¤-å“¨å…µæœºåˆ¶"><span>6. é›†ç¾¤-å“¨å…µæœºåˆ¶</span></a></h2><h3 id="_6-1-rediså“¨å…µæœºåˆ¶-å“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢" tabindex="-1"><a class="header-anchor" href="#_6-1-rediså“¨å…µæœºåˆ¶-å“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢"><span>6.1 Rediså“¨å…µæœºåˆ¶ï¼Ÿå“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢?</span></a></h3><p>å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„å“¨å…µé›†ç¾¤ç›‘æ§çš„é€»è¾‘å›¾ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037602.png" alt="image-20220628230005184" tabindex="0" loading="lazy"><figcaption>image-20220628230005184</figcaption></figure><p>å“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿä¸‹é¢æ˜¯Rediså®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š</p><ul><li><strong>ç›‘æ§ï¼ˆMonitoringï¼‰</strong>ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li><li><strong>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰</strong>ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li><strong>é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰</strong>ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚</li><li><strong>é€šçŸ¥ï¼ˆNotificationï¼‰</strong>ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>å…¶ä¸­ï¼Œç›‘æ§å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œä½¿å¾—å“¨å…µå¯ä»¥åŠæ—¶å‘ç°ä¸»èŠ‚ç‚¹æ•…éšœå¹¶å®Œæˆè½¬ç§»ï¼›è€Œé…ç½®æä¾›è€…å’Œé€šçŸ¥åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’ä¸­æ‰èƒ½ä½“ç°ã€‚</p><h3 id="_6-2-redis-å“¨å…µé›†ç¾¤æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç»„å»ºçš„" tabindex="-1"><a class="header-anchor" href="#_6-2-redis-å“¨å…µé›†ç¾¤æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç»„å»ºçš„"><span>6.2 Redis å“¨å…µé›†ç¾¤æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç»„å»ºçš„ï¼Ÿ</span></a></h3><p>å“¨å…µå®ä¾‹ä¹‹é—´å¯ä»¥ç›¸äº’å‘ç°ï¼Œè¦å½’åŠŸäº Redis æä¾›çš„ pub/sub æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒ / è®¢é˜…æœºåˆ¶ã€‚</p><p>åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»åº“ä¸Šæœ‰ä¸€ä¸ªåä¸º<code>__sentinel__:hello</code>çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œå“¨å…µ 1 æŠŠè‡ªå·±çš„ IPï¼ˆ172.16.19.3ï¼‰å’Œç«¯å£ï¼ˆ26579ï¼‰å‘å¸ƒåˆ°<code>__sentinel__:hello</code>é¢‘é“ä¸Šï¼Œå“¨å…µ 2 å’Œ 3 è®¢é˜…äº†è¯¥é¢‘é“ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œå“¨å…µ 2 å’Œ 3 å°±å¯ä»¥ä»è¿™ä¸ªé¢‘é“ç›´æ¥è·å–å“¨å…µ 1 çš„ IP åœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œå“¨å…µ 2ã€3 å¯ä»¥å’Œå“¨å…µ 1 å»ºç«‹ç½‘ç»œè¿æ¥ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037631.png" alt="image-20220628230047534" tabindex="0" loading="lazy"><figcaption>image-20220628230047534</figcaption></figure><p>é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œå“¨å…µ 2 å’Œ 3 ä¹Ÿå¯ä»¥å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå“¨å…µé›†ç¾¤å°±å½¢æˆäº†ã€‚å®ƒä»¬ç›¸äº’é—´å¯ä»¥é€šè¿‡ç½‘ç»œè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚è¯´å¯¹ä¸»åº“æœ‰æ²¡æœ‰ä¸‹çº¿è¿™ä»¶äº‹å„¿è¿›è¡Œåˆ¤æ–­å’Œåå•†ã€‚</p><h3 id="_6-3-redis-å“¨å…µæ˜¯å¦‚ä½•ç›‘æ§redisé›†ç¾¤çš„" tabindex="-1"><a class="header-anchor" href="#_6-3-redis-å“¨å…µæ˜¯å¦‚ä½•ç›‘æ§redisé›†ç¾¤çš„"><span>6.3 Redis å“¨å…µæ˜¯å¦‚ä½•ç›‘æ§Redisé›†ç¾¤çš„ï¼Ÿ</span></a></h3><p>è¿™æ˜¯ç”±å“¨å…µå‘ä¸»åº“å‘é€ INFO å‘½ä»¤æ¥å®Œæˆçš„ã€‚å°±åƒä¸‹å›¾æ‰€ç¤ºï¼Œå“¨å…µ 2 ç»™ä¸»åº“å‘é€ INFO å‘½ä»¤ï¼Œä¸»åº“æ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæŠŠä»åº“åˆ—è¡¨è¿”å›ç»™å“¨å…µã€‚æ¥ç€ï¼Œå“¨å…µå°±å¯ä»¥æ ¹æ®ä»åº“åˆ—è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ï¼Œå’Œæ¯ä¸ªä»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨è¿™ä¸ªè¿æ¥ä¸ŠæŒç»­åœ°å¯¹ä»åº“è¿›è¡Œç›‘æ§ã€‚å“¨å…µ 1 å’Œ 3 å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•å’Œä»åº“å»ºç«‹è¿æ¥ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037657.png" alt="image-20220628230125379" tabindex="0" loading="lazy"><figcaption>image-20220628230125379</figcaption></figure><h3 id="_6-4-redis-å“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“å·²ç»ä¸‹çº¿äº†å‘¢" tabindex="-1"><a class="header-anchor" href="#_6-4-redis-å“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“å·²ç»ä¸‹çº¿äº†å‘¢"><span>6.4 Redis å“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“å·²ç»ä¸‹çº¿äº†å‘¢ï¼Ÿ</span></a></h3><p>é¦–å…ˆè¦ç†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š<strong>ä¸»è§‚ä¸‹çº¿</strong>å’Œ<strong>å®¢è§‚ä¸‹çº¿</strong></p><ul><li><strong>ä¸»è§‚ä¸‹çº¿</strong>ï¼šä»»ä½•ä¸€ä¸ªå“¨å…µéƒ½æ˜¯å¯ä»¥ç›‘æ§æ¢æµ‹ï¼Œå¹¶ä½œå‡ºRedisèŠ‚ç‚¹ä¸‹çº¿çš„åˆ¤æ–­ï¼›</li><li><strong>å®¢è§‚ä¸‹çº¿</strong>ï¼šæœ‰å“¨å…µé›†ç¾¤å…±åŒå†³å®šRedisèŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿ï¼›</li></ul><p>å½“æŸä¸ªå“¨å…µï¼ˆå¦‚ä¸‹å›¾ä¸­çš„å“¨å…µ2ï¼‰åˆ¤æ–­ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€åï¼Œå°±ä¼šç»™å…¶ä»–å“¨å…µå‘é€ <code>is-master-down-by-addr</code> å‘½ä»¤ã€‚æ¥ç€ï¼Œå…¶ä»–å“¨å…µä¼šæ ¹æ®è‡ªå·±å’Œä¸»åº“çš„è¿æ¥æƒ…å†µï¼Œåšå‡º Y æˆ– N çš„å“åº”ï¼ŒY ç›¸å½“äºèµæˆç¥¨ï¼ŒN ç›¸å½“äºåå¯¹ç¥¨ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037685.png" alt="image-20220628230146608" tabindex="0" loading="lazy"><figcaption>image-20220628230146608</figcaption></figure><p>å¦‚æœèµæˆç¥¨æ•°ï¼ˆè¿™é‡Œæ˜¯2ï¼‰æ˜¯å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ <code>quorum</code> é…ç½®é¡¹ï¼ˆæ¯”å¦‚è¿™é‡Œå¦‚æœæ˜¯quorum=2ï¼‰, åˆ™å¯ä»¥åˆ¤å®š<strong>ä¸»åº“å®¢è§‚ä¸‹çº¿</strong>äº†ã€‚</p><h3 id="_6-4-redis-å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„" tabindex="-1"><a class="header-anchor" href="#_6-4-redis-å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„"><span>6.4 Redis å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</span></a></h3><ul><li><strong>ä¸ºä»€ä¹ˆå¿…ç„¶ä¼šå‡ºç°é€‰ä¸¾/å…±è¯†æœºåˆ¶</strong>ï¼Ÿ</li></ul><p>ä¸ºäº†é¿å…å“¨å…µçš„å•ç‚¹æƒ…å†µå‘ç”Ÿï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå“¨å…µçš„åˆ†å¸ƒå¼é›†ç¾¤ã€‚ä½œä¸ºåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¿…ç„¶æ¶‰åŠå…±è¯†é—®é¢˜ï¼ˆå³é€‰ä¸¾é—®é¢˜ï¼‰ï¼›åŒæ—¶æ•…éšœçš„è½¬ç§»å’Œé€šçŸ¥éƒ½åªéœ€è¦ä¸€ä¸ªä¸»çš„å“¨å…µèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚</p><ul><li><strong>å“¨å…µçš„é€‰ä¸¾æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„</strong>ï¼Ÿ</li></ul><p>å“¨å…µçš„é€‰ä¸¾æœºåˆ¶å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªRafté€‰ä¸¾ç®—æ³•ï¼š <strong>é€‰ä¸¾çš„ç¥¨æ•°å¤§äºç­‰äºnum(sentinels)/2+1æ—¶ï¼Œå°†æˆä¸ºé¢†å¯¼è€…ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œç»§ç»­é€‰ä¸¾</strong></p><p>Raftç®—æ³•ä½ å¯ä»¥å‚çœ‹è¿™ç¯‡æ–‡ç« <a href="">åˆ†å¸ƒå¼ç®—æ³• - Raftç®—æ³•</a></p><ul><li>ä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š <ul><li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li><li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li></ul></li></ul><p>ä»¥ 3 ä¸ªå“¨å…µä¸ºä¾‹ï¼Œå‡è®¾æ­¤æ—¶çš„ quorum è®¾ç½®ä¸º 2ï¼Œé‚£ä¹ˆï¼Œä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µåªè¦æ‹¿åˆ° 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥äº†ã€‚</p><h3 id="_6-5-redis-1ä¸»4ä»-5ä¸ªå“¨å…µ-å“¨å…µé…ç½®quorumä¸º2-å¦‚æœ3ä¸ªå“¨å…µæ•…éšœ-å½“ä¸»åº“å®•æœºæ—¶-å“¨å…µèƒ½å¦åˆ¤æ–­ä¸»åº“-å®¢è§‚ä¸‹çº¿-èƒ½å¦è‡ªåŠ¨åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#_6-5-redis-1ä¸»4ä»-5ä¸ªå“¨å…µ-å“¨å…µé…ç½®quorumä¸º2-å¦‚æœ3ä¸ªå“¨å…µæ•…éšœ-å½“ä¸»åº“å®•æœºæ—¶-å“¨å…µèƒ½å¦åˆ¤æ–­ä¸»åº“-å®¢è§‚ä¸‹çº¿-èƒ½å¦è‡ªåŠ¨åˆ‡æ¢"><span>6.5 Redis 1ä¸»4ä»ï¼Œ5ä¸ªå“¨å…µï¼Œå“¨å…µé…ç½®quorumä¸º2ï¼Œå¦‚æœ3ä¸ªå“¨å…µæ•…éšœï¼Œå½“ä¸»åº“å®•æœºæ—¶ï¼Œå“¨å…µèƒ½å¦åˆ¤æ–­ä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€ï¼Ÿèƒ½å¦è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</span></a></h3><p>ç»è¿‡å®é™…æµ‹è¯•ï¼š</p><p>1ã€å“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€ã€‚ç”±äºquorum=2ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€åï¼Œè¯¢é—®å¦å¤–ä¸€ä¸ªå“¨å…µåä¹Ÿä¼šå¾—åˆ°åŒæ ·çš„ç»“æœï¼Œ2ä¸ªå“¨å…µéƒ½åˆ¤å®šâ€œä¸»è§‚ä¸‹çº¿â€ï¼Œè¾¾åˆ°äº†quorumçš„å€¼ï¼Œå› æ­¤ï¼Œ<strong>å“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€</strong>ã€‚</p><p>2ã€<strong>ä½†å“¨å…µä¸èƒ½å®Œæˆä¸»ä»åˆ‡æ¢</strong>ã€‚å“¨å…µæ ‡è®°ä¸»åº“â€œå®¢è§‚ä¸‹çº¿åâ€ï¼Œåœ¨é€‰ä¸¾â€œå“¨å…µé¢†å¯¼è€…â€æ—¶ï¼Œä¸€ä¸ªå“¨å…µå¿…é¡»æ‹¿åˆ°è¶…è¿‡å¤šæ•°çš„é€‰ç¥¨(5/2+1=3ç¥¨)ã€‚ä½†ç›®å‰åªæœ‰2ä¸ªå“¨å…µæ´»ç€ï¼Œæ— è®ºæ€ä¹ˆæŠ•ç¥¨ï¼Œä¸€ä¸ªå“¨å…µæœ€å¤šåªèƒ½æ‹¿åˆ°2ç¥¨ï¼Œæ°¸è¿œæ— æ³•è¾¾åˆ°<code>N/2+1</code>é€‰ç¥¨çš„ç»“æœã€‚</p><h3 id="_6-6-ä¸»åº“åˆ¤å®šå®¢è§‚ä¸‹çº¿äº†-é‚£ä¹ˆå¦‚ä½•ä»å‰©ä½™çš„ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ä¸»åº“å‘¢" tabindex="-1"><a class="header-anchor" href="#_6-6-ä¸»åº“åˆ¤å®šå®¢è§‚ä¸‹çº¿äº†-é‚£ä¹ˆå¦‚ä½•ä»å‰©ä½™çš„ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ä¸»åº“å‘¢"><span>6.6 ä¸»åº“åˆ¤å®šå®¢è§‚ä¸‹çº¿äº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä»å‰©ä½™çš„ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ä¸»åº“å‘¢ï¼Ÿ</span></a></h3><ul><li>è¿‡æ»¤æ‰ä¸å¥åº·çš„ï¼ˆä¸‹çº¿æˆ–æ–­çº¿ï¼‰ï¼Œæ²¡æœ‰å›å¤è¿‡å“¨å…µpingå“åº”çš„ä»èŠ‚ç‚¹</li><li>é€‰æ‹©<code>salve-priority</code>ä»èŠ‚ç‚¹ä¼˜å…ˆçº§æœ€é«˜ï¼ˆredis.confï¼‰çš„</li><li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§ï¼Œåªå¤åˆ¶æœ€å®Œæ•´çš„ä»èŠ‚ç‚¹</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037722.png" alt="image-20220628230308886" tabindex="0" loading="lazy"><figcaption>image-20220628230308886</figcaption></figure><h3 id="_6-7-æ–°çš„ä¸»åº“é€‰æ‹©å‡ºæ¥å-å¦‚ä½•è¿›è¡Œæ•…éšœçš„è½¬ç§»" tabindex="-1"><a class="header-anchor" href="#_6-7-æ–°çš„ä¸»åº“é€‰æ‹©å‡ºæ¥å-å¦‚ä½•è¿›è¡Œæ•…éšœçš„è½¬ç§»"><span>6.7 æ–°çš„ä¸»åº“é€‰æ‹©å‡ºæ¥åï¼Œå¦‚ä½•è¿›è¡Œæ•…éšœçš„è½¬ç§»ï¼Ÿ</span></a></h3><p>å‡è®¾æ ¹æ®æˆ‘ä»¬ä¸€å¼€å§‹çš„å›¾ï¼šï¼ˆæˆ‘ä»¬å‡è®¾ï¼šåˆ¤æ–­ä¸»åº“å®¢è§‚ä¸‹çº¿äº†ï¼ŒåŒæ—¶é€‰å‡º<code>sentinel 3</code>æ˜¯å“¨å…µleaderï¼‰</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037758.png" alt="image-20220628230332745" tabindex="0" loading="lazy"><figcaption>image-20220628230332745</figcaption></figure><p><strong>æ•…éšœè½¬ç§»æµç¨‹å¦‚ä¸‹</strong>ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037796.png" alt="image-20220628230347436" tabindex="0" loading="lazy"><figcaption>image-20220628230347436</figcaption></figure><ul><li>å°†slave-1è„±ç¦»åŸä»èŠ‚ç‚¹ï¼ˆPS: 5.0 ä¸­åº”è¯¥æ˜¯<code>replicaof no one</code>)ï¼Œå‡çº§ä¸»èŠ‚ç‚¹ï¼Œ</li><li>å°†ä»èŠ‚ç‚¹slave-2æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹</li><li>é€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹å·²æ›´æ¢</li><li>å°†åŸä¸»èŠ‚ç‚¹ï¼ˆoldMasterï¼‰å˜æˆä»èŠ‚ç‚¹ï¼ŒæŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹</li></ul><p><strong>è½¬ç§»ä¹‹å</strong></p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037828.png" alt="image-20220628230408904" tabindex="0" loading="lazy"><figcaption>image-20220628230408904</figcaption></figure><h2 id="_7-é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#_7-é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯"><span>7. é›†ç¾¤-åˆ†ç‰‡æŠ€æœ¯</span></a></h2><h3 id="_7-1-ä»€ä¹ˆæ˜¯redis-cluster" tabindex="-1"><a class="header-anchor" href="#_7-1-ä»€ä¹ˆæ˜¯redis-cluster"><span>7.1 ä»€ä¹ˆæ˜¯Redis Clusterï¼Ÿ</span></a></h3><p>Redis-clusteræ˜¯ä¸€ç§æœåŠ¡å™¨ShardingæŠ€æœ¯ï¼ŒRedis3.0ä»¥åç‰ˆæœ¬æ­£å¼æä¾›æ”¯æŒã€‚</p><h3 id="_7-2-è¯´è¯´rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ-ä¸ºä»€ä¹ˆæ˜¯16384ä¸ª" tabindex="-1"><a class="header-anchor" href="#_7-2-è¯´è¯´rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ-ä¸ºä»€ä¹ˆæ˜¯16384ä¸ª"><span>7.2 è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿä¸ºä»€ä¹ˆæ˜¯16384ä¸ªï¼Ÿ</span></a></h3><p>Redis-clusteræ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯å¼•å…¥äº†<strong>å“ˆå¸Œæ§½</strong>çš„æ¦‚å¿µã€‚Redis-clusterä¸­æœ‰16384(å³2çš„14æ¬¡æ–¹ï¼‰ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16383å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ã€‚Clusterä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ï¼ˆhash slotï¼‰ã€‚</p><p>æ¯”å¦‚é›†ç¾¤ä¸­å­˜åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å¯èƒ½å­˜åœ¨çš„ä¸€ç§åˆ†é…å¦‚ä¸‹ï¼š</p><ol><li>èŠ‚ç‚¹AåŒ…å«0åˆ°5500å·å“ˆå¸Œæ§½ï¼›</li><li>èŠ‚ç‚¹BåŒ…å«5501åˆ°11000å·å“ˆå¸Œæ§½ï¼›</li><li>èŠ‚ç‚¹CåŒ…å«11001 åˆ° 16384å·å“ˆå¸Œæ§½ã€‚</li></ol><ul><li><strong>ä¸ºä»€ä¹ˆæ˜¯16384ä¸ª</strong></li></ul><p>æˆ‘ä»¬çŸ¥é“ä¸€è‡´æ€§hashç®—æ³•æ˜¯2çš„16æ¬¡æ–¹ï¼Œä¸ºä»€ä¹ˆhash slotæ˜¯2çš„14æ¬¡æ–¹å‘¢ï¼Ÿ</p><ol><li><p>å¦‚æœæ§½ä½ä¸º65536ï¼Œå‘é€å¿ƒè·³ä¿¡æ¯çš„æ¶ˆæ¯å¤´è¾¾8kï¼Œå‘é€çš„å¿ƒè·³åŒ…è¿‡äºåºå¤§ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æ¶ˆæ¯å¤´ä¸­ï¼Œæœ€å ç©ºé—´çš„æ˜¯myslots[CLUSTER_SLOTS/8]ã€‚ å½“æ§½ä½ä¸º65536æ—¶ï¼Œè¿™å—çš„å¤§å°æ˜¯: 65536Ã·8Ã·1024=8kb å› ä¸ºæ¯ç§’é’Ÿï¼ŒredisèŠ‚ç‚¹éœ€è¦å‘é€ä¸€å®šæ•°é‡çš„pingæ¶ˆæ¯ä½œä¸ºå¿ƒè·³åŒ…ï¼Œå¦‚æœæ§½ä½ä¸º65536ï¼Œè¿™ä¸ªpingæ¶ˆæ¯çš„æ¶ˆæ¯å¤´å¤ªå¤§äº†ï¼Œæµªè´¹å¸¦å®½ã€‚</p></li><li><p>redisçš„é›†ç¾¤ä¸»èŠ‚ç‚¹æ•°é‡åŸºæœ¬ä¸å¯èƒ½è¶…è¿‡1000ä¸ªã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œé›†ç¾¤èŠ‚ç‚¹è¶Šå¤šï¼Œå¿ƒè·³åŒ…çš„æ¶ˆæ¯ä½“å†…æºå¸¦çš„æ•°æ®è¶Šå¤šã€‚å¦‚æœèŠ‚ç‚¹è¿‡1000ä¸ªï¼Œä¹Ÿä¼šå¯¼è‡´ç½‘ç»œæ‹¥å µã€‚å› æ­¤redisä½œè€…ï¼Œä¸å»ºè®®redis clusterèŠ‚ç‚¹æ•°é‡è¶…è¿‡1000ä¸ªã€‚ é‚£ä¹ˆï¼Œå¯¹äºèŠ‚ç‚¹æ•°åœ¨1000ä»¥å†…çš„redis clusteré›†ç¾¤ï¼Œ16384ä¸ªæ§½ä½å¤Ÿç”¨äº†ã€‚æ²¡æœ‰å¿…è¦æ‹“å±•åˆ°65536ä¸ªã€‚</p></li><li><p>æ§½ä½è¶Šå°ï¼ŒèŠ‚ç‚¹å°‘çš„æƒ…å†µä¸‹ï¼Œå‹ç¼©æ¯”é«˜</p><p>Redisä¸»èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯ä¸­ï¼Œå®ƒæ‰€è´Ÿè´£çš„å“ˆå¸Œæ§½æ˜¯é€šè¿‡ä¸€å¼ bitmapçš„å½¢å¼æ¥ä¿å­˜çš„ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹bitmapè¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯å¦‚æœbitmapçš„å¡«å……ç‡slots / Nå¾ˆé«˜çš„è¯(Nè¡¨ç¤ºèŠ‚ç‚¹æ•°)ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚ å¦‚æœèŠ‚ç‚¹æ•°å¾ˆå°‘ï¼Œè€Œå“ˆå¸Œæ§½æ•°é‡å¾ˆå¤šçš„è¯ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚</p></li></ol><h3 id="_7-3-redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—-ä¸ºä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_7-3-redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—-ä¸ºä»€ä¹ˆ"><span>7.3 Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</span></a></h3><p>Rediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚</p><h2 id="_8-åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_8-åº”ç”¨åœºæ™¯"><span>8. åº”ç”¨åœºæ™¯</span></a></h2><h3 id="_8-1-redis-å®¢æˆ·ç«¯æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_8-1-redis-å®¢æˆ·ç«¯æœ‰å“ªäº›"><span>8.1 Redis å®¢æˆ·ç«¯æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p>Redissonã€Jedisã€lettuceç­‰ç­‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨Redissonã€‚</p><p>Redissonæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒRediså®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº›Javaçš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚</p><h3 id="_8-2-rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥" tabindex="-1"><a class="header-anchor" href="#_8-2-rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥"><span>8.2 Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</span></a></h3><p>Redis2.6å¼€å§‹redis-cliæ”¯æŒä¸€ç§æ–°çš„è¢«ç§°ä¹‹ä¸ºpipe modeçš„æ–°æ¨¡å¼ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥å·¥ä½œã€‚</p><h3 id="_8-3-rediså®ç°åˆ†å¸ƒå¼é”å®ç°-ä»€ä¹ˆæ˜¯-redlock" tabindex="-1"><a class="header-anchor" href="#_8-3-rediså®ç°åˆ†å¸ƒå¼é”å®ç°-ä»€ä¹ˆæ˜¯-redlock"><span>8.3 Rediså®ç°åˆ†å¸ƒå¼é”å®ç°? ä»€ä¹ˆæ˜¯ RedLock?</span></a></h3><ul><li><strong>å¸¸è§„</strong></li></ul><p>åŠ é”ï¼š SET NX PX + æ ¡éªŒå”¯ä¸€éšæœºå€¼</p><p>è§£é”ï¼š Luaè„šæœ¬</p><ul><li><strong>RedLock</strong></li></ul><p>æå¤šä¸ªRedis masteréƒ¨ç½²ï¼Œä»¥ä¿è¯å®ƒä»¬ä¸ä¼šåŒæ—¶å®•æ‰ã€‚å¹¶ä¸”è¿™äº›masterèŠ‚ç‚¹æ˜¯å®Œå…¨ç›¸äº’ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´ä¸å­˜åœ¨æ•°æ®åŒæ­¥ã€‚åŒæ—¶ï¼Œéœ€è¦ç¡®ä¿åœ¨è¿™å¤šä¸ªmasterå®ä¾‹ä¸Šï¼Œæ˜¯ä¸åœ¨Rediså•å®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒæ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾é”ã€‚</p><ul><li><strong>Redissonæ¡†æ¶</strong></li></ul><p>Redisson watchdogæˆ–è€…å®ƒå®ç°äº†RedLockæ–¹å¼</p><p>å…·ä½“å¯ä»¥çœ‹åæ–‡åˆ†å¸ƒå¼é”ä¸­å®ç°æ–¹å¼ã€‚</p><h3 id="_8-4-redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜-å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#_8-4-redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜-å¦‚ä½•è§£å†³"><span>8.4 Redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</span></a></h3><p>å½“ç¼“å­˜åº“å‡ºç°æ—¶ï¼Œå¿…é¡»è¦è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>ç¼“å­˜ç©¿é€</strong><ul><li><strong>é—®é¢˜æ¥æº</strong>: ç¼“å­˜ç©¿é€æ˜¯æŒ‡<strong>ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®</strong>ï¼Œè€Œç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚ã€‚ç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</li><li>è§£å†³æ–¹æ¡ˆ <ul><li>æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œå¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼ŒidåšåŸºç¡€æ ¡éªŒï¼Œid&lt;=0çš„ç›´æ¥æ‹¦æˆªï¼›</li><li>ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°†key-valueå¯¹å†™ä¸ºkey-nullï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚30ç§’ï¼ˆè®¾ç½®å¤ªé•¿ä¼šå¯¼è‡´æ­£å¸¸æƒ…å†µä¹Ÿæ²¡æ³•ä½¿ç”¨ï¼‰ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ªidæš´åŠ›æ”»å‡»</li><li>å¸ƒéš†è¿‡æ»¤å™¨ã€‚bloomfilterå°±ç±»ä¼¼äºä¸€ä¸ªhash setï¼Œç”¨äºå¿«é€Ÿåˆ¤æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå…¶å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨äºæŸå®¹å™¨ï¼Œä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ã€‚å¸ƒéš†è¿‡æ»¤å™¨çš„å…³é”®å°±åœ¨äºhashç®—æ³•å’Œå®¹å™¨å¤§å°</li></ul></li></ul></li><li><strong>ç¼“å­˜ç©¿å‡»</strong><ul><li><strong>é—®é¢˜æ¥æº</strong>: ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡<strong>ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®</strong>ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œè¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œé€ æˆè¿‡å¤§å‹åŠ›ã€‚</li><li>è§£å†³æ–¹æ¡ˆ <ul><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚</li><li>æ¥å£é™æµä¸ç†”æ–­ï¼Œé™çº§ã€‚é‡è¦çš„æ¥å£ä¸€å®šè¦åšå¥½é™æµç­–ç•¥ï¼Œé˜²æ­¢ç”¨æˆ·æ¶æ„åˆ·æ¥å£ï¼ŒåŒæ—¶è¦é™çº§å‡†å¤‡ï¼Œå½“æ¥å£ä¸­çš„æŸäº› æœåŠ¡ ä¸å¯ç”¨æ—¶å€™ï¼Œè¿›è¡Œç†”æ–­ï¼Œå¤±è´¥å¿«é€Ÿè¿”å›æœºåˆ¶ã€‚</li><li>åŠ äº’æ–¥é”</li></ul></li></ul></li><li><strong>ç¼“å­˜é›ªå´©</strong><ul><li><strong>é—®é¢˜æ¥æº</strong>: ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­<strong>æ•°æ®å¤§æ‰¹é‡åˆ°è¿‡æœŸæ—¶é—´ï¼Œè€ŒæŸ¥è¯¢æ•°æ®é‡å·¨å¤§ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³downæœº</strong>ã€‚å’Œç¼“å­˜å‡»ç©¿ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚</li><li>è§£å†³æ–¹æ¡ˆ <ul><li>ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®éšæœºï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿã€‚</li><li>å¦‚æœç¼“å­˜æ•°æ®åº“æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå°†çƒ­ç‚¹æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒçš„ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</li><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚</li></ul></li></ul></li><li><strong>ç¼“å­˜æ±¡æŸ“</strong>ï¼ˆæˆ–è€…æ»¡äº†ï¼‰</li></ul><p>ç¼“å­˜æ±¡æŸ“é—®é¢˜è¯´çš„æ˜¯ç¼“å­˜ä¸­ä¸€äº›åªä¼šè¢«è®¿é—®ä¸€æ¬¡æˆ–è€…å‡ æ¬¡çš„çš„æ•°æ®ï¼Œè¢«è®¿é—®å®Œåï¼Œå†ä¹Ÿä¸ä¼šè¢«è®¿é—®åˆ°ï¼Œä½†è¿™éƒ¨åˆ†æ•°æ®ä¾ç„¶ç•™å­˜åœ¨ç¼“å­˜ä¸­ï¼Œæ¶ˆè€—ç¼“å­˜ç©ºé—´ã€‚</p><p>ç¼“å­˜æ±¡æŸ“ä¼šéšç€æ•°æ®çš„æŒç»­å¢åŠ è€Œé€æ¸æ˜¾éœ²ï¼Œéšç€æœåŠ¡çš„ä¸æ–­è¿è¡Œï¼Œç¼“å­˜ä¸­ä¼šå­˜åœ¨å¤§é‡çš„æ°¸è¿œä¸ä¼šå†æ¬¡è¢«è®¿é—®çš„æ•°æ®ã€‚ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœç¼“å­˜ç©ºé—´æ»¡äº†ï¼Œå†å¾€ç¼“å­˜é‡Œå†™æ•°æ®æ—¶å°±ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå½±å“Redisæ€§èƒ½ã€‚è¿™éƒ¨åˆ†é¢å¤–å¼€é”€ä¸»è¦æ˜¯æŒ‡å†™çš„æ—¶å€™åˆ¤æ–­æ·˜æ±°ç­–ç•¥ï¼Œæ ¹æ®æ·˜æ±°ç­–ç•¥å»é€‰æ‹©è¦æ·˜æ±°çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œåˆ é™¤æ“ä½œã€‚</p><h3 id="_8-5-redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›-å¦‚ä½•åˆ†æå®šä½è§£å†³" tabindex="-1"><a class="header-anchor" href="#_8-5-redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›-å¦‚ä½•åˆ†æå®šä½è§£å†³"><span>8.5 Redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Œå¦‚ä½•åˆ†æå®šä½è§£å†³?</span></a></h3><p>ä¸¾å‡ ä¸ªä¾‹å­</p><ul><li><strong>çœ‹å»¶è¿Ÿ</strong> 60 ç§’å†…çš„æœ€å¤§å“åº”å»¶è¿Ÿï¼š</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> redis-cli</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6379</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --intrinsic-latency</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 60</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 15</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 17</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 18</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 31</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 32</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 59</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Max</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency</span><span style="color:#98C379;--shiki-dark:#98C379;"> so</span><span style="color:#98C379;--shiki-dark:#98C379;"> far:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 72</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds.</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1428669267</span><span style="color:#98C379;--shiki-dark:#98C379;"> total</span><span style="color:#98C379;--shiki-dark:#98C379;"> runs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (avg </span><span style="color:#98C379;--shiki-dark:#98C379;">latency:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0.0420</span><span style="color:#98C379;--shiki-dark:#98C379;"> microseconds</span><span style="color:#98C379;--shiki-dark:#98C379;"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 42.00</span><span style="color:#98C379;--shiki-dark:#98C379;"> nanoseconds</span><span style="color:#98C379;--shiki-dark:#98C379;"> per</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Worst</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#98C379;--shiki-dark:#98C379;"> took</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1429x</span><span style="color:#98C379;--shiki-dark:#98C379;"> longer</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> average</span><span style="color:#98C379;--shiki-dark:#98C379;"> latency.</span></span></code></pre></div><ul><li><strong>æ…¢æ—¥å¿—</strong>ï¼ˆslowlogï¼‰</li></ul><p>æ…¢æŸ¥è¯¢ï¼Œå°±ä¼šå¯¼è‡´åé¢çš„è¯·æ±‚å‘ç”Ÿæ’é˜Ÿï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå“åº”å»¶è¿Ÿä¹Ÿä¼šå˜é•¿ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037869.png" alt="image-20220628231317888" tabindex="0" loading="lazy"><figcaption>image-20220628231317888</figcaption></figure><ul><li><strong>bigkey</strong></li></ul><p>å¤§å¯¹è±¡</p><ul><li><strong>é›†ä¸­è¿‡æœŸ</strong></li></ul><p>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ¡ˆæ¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼š</p><ol><li>é›†ä¸­è¿‡æœŸ key å¢åŠ ä¸€ä¸ªéšæœºè¿‡æœŸæ—¶é—´ï¼ŒæŠŠé›†ä¸­è¿‡æœŸçš„æ—¶é—´æ‰“æ•£ï¼Œé™ä½ Redis æ¸…ç†è¿‡æœŸ key çš„å‹åŠ›</li><li>å¦‚æœä½ ä½¿ç”¨çš„ Redis æ˜¯ 4.0 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥å¼€å¯ lazy-free æœºåˆ¶ï¼Œå½“åˆ é™¤è¿‡æœŸ key æ—¶ï¼ŒæŠŠé‡Šæ”¾å†…å­˜çš„æ“ä½œæ”¾åˆ°åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹</li></ol><ul><li><strong>forkè€—æ—¶ä¸¥é‡</strong></li></ul><p>ä¸»è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ fork å‡½æ•°</p><ul><li><strong>ä½¿ç”¨Swap</strong></li></ul><p>å½“å†…å­˜ä¸­çš„æ•°æ®è¢«æ¢åˆ°ç£ç›˜ä¸Šåï¼ŒRedis å†è®¿é—®è¿™äº›æ•°æ®æ—¶ï¼Œå°±éœ€è¦ä»ç£ç›˜ä¸Šè¯»å–ï¼Œè®¿é—®ç£ç›˜çš„é€Ÿåº¦è¦æ¯”è®¿é—®å†…å­˜æ…¢å‡ ç™¾å€ï¼</p><ul><li><strong>å†…å­˜ç¢ç‰‡</strong></li></ul><p>Redis 4.0 ç‰ˆæœ¬ï¼Œå®ƒæ­£å¥½æä¾›äº†è‡ªåŠ¨ç¢ç‰‡æ•´ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é…ç½®å¼€å¯ç¢ç‰‡è‡ªåŠ¨æ•´ç†</p><h2 id="_9-æ–°ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#_9-æ–°ç‰ˆæœ¬"><span>9. æ–°ç‰ˆæœ¬</span></a></h2><h3 id="_9-1-rediså•çº¿ç¨‹æ¨¡å‹-åœ¨6-0ä¹‹å‰å¦‚ä½•æé«˜å¤šæ ¸cpuçš„åˆ©ç”¨ç‡" tabindex="-1"><a class="header-anchor" href="#_9-1-rediså•çº¿ç¨‹æ¨¡å‹-åœ¨6-0ä¹‹å‰å¦‚ä½•æé«˜å¤šæ ¸cpuçš„åˆ©ç”¨ç‡"><span>9.1 Rediså•çº¿ç¨‹æ¨¡å‹ï¼Ÿ åœ¨6.0ä¹‹å‰å¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ</span></a></h3><p>å¯ä»¥åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªRedisçš„å®ä¾‹ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸åŒçš„æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¤šä¸ªCPUï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹åˆ†ç‰‡ï¼ˆshardï¼‰ã€‚</p><h3 id="_9-2-redis6-0ä¹‹å‰çš„ç‰ˆæœ¬çœŸçš„æ˜¯å•çº¿ç¨‹çš„å—" tabindex="-1"><a class="header-anchor" href="#_9-2-redis6-0ä¹‹å‰çš„ç‰ˆæœ¬çœŸçš„æ˜¯å•çº¿ç¨‹çš„å—"><span>9.2 Redis6.0ä¹‹å‰çš„ç‰ˆæœ¬çœŸçš„æ˜¯å•çº¿ç¨‹çš„å—?</span></a></h3><p>Redisåœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶,åŒ…æ‹¬è·å–(socketè¯»)ã€è§£æã€æ‰§è¡Œã€å†…å®¹è¿”å›(socketå†™)ç­‰éƒ½æ˜¯ç”±ä¸€ä¸ªé¡ºåºä¸²è¡Œçš„ä¸»çº¿ç¨‹æ‰§è¡Œçš„,è¿™å°±æ˜¯æ‰€è°“çš„ å•çº¿ç¨‹.å•å¦‚æœä¸¥æ ¼è®²,ä»Redis4.0ä¹‹åå¹¶ä¸æ˜¯å•çº¿ç¨‹,é™¤äº†ä¸»çº¿ç¨‹ä¹‹å¤–,å®ƒä¹Ÿæœ‰åå°çº¿ç¨‹åœ¨å¤„ç†ä¸€äº›è¾ƒä¸ºç¼“æ…¢çš„æ“ä½œ,ä¾‹å¦‚ æ¸…ç†è„æ•°æ®, æ— ç”¨é“¾æ¥çš„é‡Šæ”¾, å¤§keyçš„åˆ é™¤, æ•°æ®æŒä¹…åŒ–bgsave,bgrewriteaofç­‰,éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–çš„å­çº¿ç¨‹å•ç‹¬æ‰§è¡Œçš„.</p><h3 id="_9-3-redis6-0ä¹‹å‰ä¸ºä»€ä¹ˆä¸€è‡´ä¸ç”¨å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_9-3-redis6-0ä¹‹å‰ä¸ºä»€ä¹ˆä¸€è‡´ä¸ç”¨å¤šçº¿ç¨‹"><span>9.3 Redis6.0ä¹‹å‰ä¸ºä»€ä¹ˆä¸€è‡´ä¸ç”¨å¤šçº¿ç¨‹?</span></a></h3><p>å®˜æ–¹æ›¾åšè¿‡ç±»ä¼¼é—®é¢˜çš„å›å¤ï¼šä½¿ç”¨Redisæ—¶ï¼Œå‡ ä¹ä¸å­˜åœ¨CPUæˆä¸ºç“¶é¢ˆçš„æƒ…å†µï¼Œ Redisä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªæ™®é€šçš„Linuxç³»ç»Ÿä¸Šï¼ŒRedisé€šè¿‡ä½¿ç”¨pipeliningæ¯ç§’å¯ä»¥å¤„ç†100ä¸‡ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å¦‚æœåº”ç”¨ç¨‹åºä¸»è¦ä½¿ç”¨O(N)æˆ–O(log(N))çš„å‘½ä»¤ï¼Œå®ƒå‡ ä¹ä¸ä¼šå ç”¨å¤ªå¤šCPUã€‚</p><p>ä½¿ç”¨äº†å•çº¿ç¨‹åï¼Œå¯ç»´æŠ¤æ€§é«˜ã€‚å¤šçº¿ç¨‹æ¨¡å‹è™½ç„¶åœ¨æŸäº›æ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼Œä½†æ˜¯å®ƒå´å¼•å…¥äº†ç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œå¸¦æ¥äº†å¹¶å‘è¯»å†™çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ã€åŒæ—¶å¯èƒ½å­˜åœ¨çº¿ç¨‹åˆ‡æ¢ã€ç”šè‡³åŠ é”è§£é”ã€æ­»é”é€ æˆçš„æ€§èƒ½æŸè€—ã€‚Redisé€šè¿‡AEäº‹ä»¶æ¨¡å‹ä»¥åŠIOå¤šè·¯å¤ç”¨ç­‰æŠ€æœ¯ï¼Œå¤„ç†æ€§èƒ½éå¸¸é«˜ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦ä½¿ç”¨å¤šçº¿ç¨‹ã€‚å•çº¿ç¨‹æœºåˆ¶ä½¿å¾— Redis å†…éƒ¨å®ç°çš„å¤æ‚åº¦å¤§å¤§é™ä½ï¼ŒHash çš„æƒ°æ€§ Rehashã€Lpush ç­‰ç­‰ â€œçº¿ç¨‹ä¸å®‰å…¨â€ çš„å‘½ä»¤éƒ½å¯ä»¥æ— é”è¿›è¡Œã€‚</p><h3 id="_9-4-redis6-0ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹å‘¢" tabindex="-1"><a class="header-anchor" href="#_9-4-redis6-0ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹å‘¢"><span>9.4 Redis6.0ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹å‘¢ï¼Ÿ</span></a></h3><p>Rediså°†æ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„å“åº”æ—¶é•¿å¤§çº¦ä¸º100çº³ç§’ï¼Œå¯¹äºå°æ•°æ®åŒ…ï¼ŒRedisæœåŠ¡å™¨å¯ä»¥å¤„ç†80,000åˆ°100,000 QPSï¼Œè¿™ä¹Ÿæ˜¯Rediså¤„ç†çš„æé™äº†ï¼Œå¯¹äº80%çš„å…¬å¸æ¥è¯´ï¼Œå•çº¿ç¨‹çš„Rediså·²ç»è¶³å¤Ÿä½¿ç”¨äº†ã€‚</p><p>ä½†éšç€è¶Šæ¥è¶Šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰äº›å…¬å¸åŠ¨ä¸åŠ¨å°±ä¸Šäº¿çš„äº¤æ˜“é‡ï¼Œå› æ­¤éœ€è¦æ›´å¤§çš„QPSã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºå¹¶é‡‡ç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œä½†è¯¥æ–¹æ¡ˆæœ‰éå¸¸å¤§çš„ç¼ºç‚¹ï¼Œä¾‹å¦‚è¦ç®¡ç†çš„RedisæœåŠ¡å™¨å¤ªå¤šï¼Œç»´æŠ¤ä»£ä»·å¤§ï¼›æŸäº›é€‚ç”¨äºå•ä¸ªRedisæœåŠ¡å™¨çš„å‘½ä»¤ä¸é€‚ç”¨äºæ•°æ®åˆ†åŒºï¼›æ•°æ®åˆ†åŒºæ— æ³•è§£å†³çƒ­ç‚¹è¯»/å†™é—®é¢˜ï¼›æ•°æ®åæ–œï¼Œé‡æ–°åˆ†é…å’Œæ”¾å¤§/ç¼©å°å˜å¾—æ›´åŠ å¤æ‚ç­‰ç­‰ã€‚</p><p>ä»Redisè‡ªèº«è§’åº¦æ¥è¯´ï¼Œå› ä¸ºè¯»å†™ç½‘ç»œçš„read/writeç³»ç»Ÿè°ƒç”¨å ç”¨äº†Redisæ‰§è¡ŒæœŸé—´å¤§éƒ¨åˆ†CPUæ—¶é—´ï¼Œç“¶é¢ˆä¸»è¦åœ¨äºç½‘ç»œçš„ IO æ¶ˆè€—, ä¼˜åŒ–ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å‘:</p><ul><li>æé«˜ç½‘ç»œ IO æ€§èƒ½ï¼Œå…¸å‹çš„å®ç°æ¯”å¦‚ä½¿ç”¨ DPDK æ¥æ›¿ä»£å†…æ ¸ç½‘ç»œæ ˆçš„æ–¹å¼</li><li>ä½¿ç”¨å¤šçº¿ç¨‹å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œå…¸å‹çš„å®ç°æ¯”å¦‚ Memcached</li></ul><p>åè®®æ ˆä¼˜åŒ–çš„è¿™ç§æ–¹å¼è·Ÿ Redis å…³ç³»ä¸å¤§ï¼Œæ”¯æŒå¤šçº¿ç¨‹æ˜¯ä¸€ç§æœ€æœ‰æ•ˆæœ€ä¾¿æ·çš„æ“ä½œæ–¹å¼ã€‚æ‰€ä»¥æ€»ç»“èµ·æ¥ï¼Œredisæ”¯æŒå¤šçº¿ç¨‹ä¸»è¦å°±æ˜¯ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>å¯ä»¥å……åˆ†åˆ©ç”¨æœåŠ¡å™¨ CPU èµ„æºï¼Œç›®å‰ä¸»çº¿ç¨‹åªèƒ½åˆ©ç”¨ä¸€ä¸ªæ ¸</li><li>å¤šçº¿ç¨‹ä»»åŠ¡å¯ä»¥åˆ†æ‘Š Redis åŒæ­¥ IO è¯»å†™è´Ÿè·</li></ul><h3 id="_9-5-redis6-0é»˜è®¤æ˜¯å¦å¼€å¯äº†å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_9-5-redis6-0é»˜è®¤æ˜¯å¦å¼€å¯äº†å¤šçº¿ç¨‹"><span>9.5 Redis6.0é»˜è®¤æ˜¯å¦å¼€å¯äº†å¤šçº¿ç¨‹ï¼Ÿ</span></a></h3><p>Redis6.0çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ï¼šio-threads-do-reads yes</p><h3 id="_9-6-redis6-0å¤šçº¿ç¨‹å¼€å¯æ—¶-çº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_9-6-redis6-0å¤šçº¿ç¨‹å¼€å¯æ—¶-çº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®"><span>9.6 Redis6.0å¤šçº¿ç¨‹å¼€å¯æ—¶ï¼Œçº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ</span></a></h3><p>å¼€å¯å¤šçº¿ç¨‹åï¼Œè¿˜éœ€è¦è®¾ç½®çº¿ç¨‹æ•°ï¼Œå¦åˆ™æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚åŒæ ·ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ io-threads4</p><p>å…³äºçº¿ç¨‹æ•°çš„è®¾ç½®ï¼Œå®˜æ–¹æœ‰ä¸€ä¸ªå»ºè®®ï¼š4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹æ•°ä¸€å®šè¦å°äºæœºå™¨æ ¸æ•°ã€‚è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹æ•°å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå®˜æ–¹è®¤ä¸ºè¶…è¿‡äº†8ä¸ªåŸºæœ¬å°±æ²¡ä»€ä¹ˆæ„ä¹‰äº†ã€‚</p><h3 id="_9-7-redis6-0å¤šçº¿ç¨‹çš„å®ç°æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_9-7-redis6-0å¤šçº¿ç¨‹çš„å®ç°æœºåˆ¶"><span>9.7 Redis6.0å¤šçº¿ç¨‹çš„å®ç°æœºåˆ¶ï¼Ÿ</span></a></h3><p>æ ¸å¿ƒæ€è·¯æ˜¯ï¼Œå°†ä¸»çº¿ç¨‹çš„IOè¯»å†™ä»»åŠ¡æ‹†åˆ†å‡ºæ¥ç»™ä¸€ç»„ç‹¬ç«‹çš„çº¿ç¨‹æ‰§è¡Œï¼Œä½¿å¾—å¤šä¸ª socket çš„è¯»å†™å¯ä»¥å¹¶è¡ŒåŒ–</p><ul><li>ä¸»çº¿ç¨‹è´Ÿè´£æ¥æ”¶å»ºç«‹è¿æ¥çš„è¯·æ±‚,è·å–socketæ”¾åˆ°å…¨å±€ç­‰å¾…å¤„ç†é˜Ÿåˆ—</li><li>ä¸»çº¿ç¨‹å¤„ç†å®Œè¯»äº‹ä»¶ä¹‹å,é€šè¿‡Round Robinå°†è¿™äº›è¿æ¥åˆ†é…ç»™IOçº¿ç¨‹(å¹¶ä¸ä¼šç­‰å¾…é˜Ÿåˆ—æ»¡)</li><li>ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾…IOçº¿ç¨‹è¯»å–socketå®Œæ¯•</li><li>ä¸»çº¿ç¨‹é€šè¿‡å•çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œè¯·æ±‚å‘½ä»¤ï¼Œè¯·æ±‚æ•°æ®è¯»å–å¹¶è§£æå®Œæˆï¼Œä½†å¹¶ä¸æ‰§è¡Œ</li><li>ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾…IOçº¿ç¨‹å°†æ•°æ®å›å†™socketå®Œæ¯•</li><li>è§£é™¤ç»‘å®š,æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—</li></ul><p>è¯¥çº¿ç¨‹æœ‰å¦‚ä¸‹ç‰¹ç‚¹:</p><ul><li>IOçº¿ç¨‹è¦ä¹ˆåŒæ—¶åœ¨è¯»socketï¼Œè¦ä¹ˆåŒæ—¶åœ¨å†™ï¼Œä¸ä¼šåŒæ—¶è¯»æˆ–å†™</li><li>IOçº¿ç¨‹åªè´Ÿè´£è¯»å†™socketè§£æå‘½ä»¤ï¼Œä¸è´Ÿè´£å‘½ä»¤å¤„ç†ï¼ˆä¸»çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œå‘½ä»¤ï¼‰</li></ul><h3 id="_9-8-å¼€å¯å¤šçº¿ç¨‹å-æ˜¯å¦ä¼šå­˜åœ¨çº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_9-8-å¼€å¯å¤šçº¿ç¨‹å-æ˜¯å¦ä¼šå­˜åœ¨çº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜"><span>9.8 å¼€å¯å¤šçº¿ç¨‹åï¼Œæ˜¯å¦ä¼šå­˜åœ¨çº¿ç¨‹å¹¶å‘å®‰å…¨é—®é¢˜ï¼Ÿ</span></a></h3><p>Redisçš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œ,å› æ­¤ä¸å­˜åœ¨çº¿ç¨‹çš„å¹¶å‘å®‰å…¨é—®é¢˜</p><h2 id="_10-å…¶ä»–ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_10-å…¶ä»–ç‰¹æ€§"><span>10. å…¶ä»–ç‰¹æ€§</span></a></h2><h3 id="_10-1-redisäº‹ä»¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_10-1-redisäº‹ä»¶æœºåˆ¶"><span>10.1 Redisäº‹ä»¶æœºåˆ¶?</span></a></h3><p>Redisä¸­çš„äº‹ä»¶é©±åŠ¨åº“åªå…³æ³¨ç½‘ç»œIOï¼Œä»¥åŠå®šæ—¶å™¨ã€‚è¯¥äº‹ä»¶åº“å¤„ç†ä¸‹é¢ä¸¤ç±»äº‹ä»¶ï¼š</p><ul><li><strong>æ–‡ä»¶äº‹ä»¶</strong>(file event)ï¼šç”¨äºå¤„ç† Redis æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œIOã€‚</li><li><strong>æ—¶é—´äº‹ä»¶</strong>(time eveat)ï¼šRedis æœåŠ¡å™¨ä¸­çš„ä¸€äº›æ“ä½œï¼ˆæ¯”å¦‚serverCronå‡½æ•°ï¼‰éœ€è¦åœ¨ç»™å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œï¼Œè€Œæ—¶é—´äº‹ä»¶å°±æ˜¯å¤„ç†è¿™ç±»å®šæ—¶æ“ä½œçš„ã€‚</li></ul><p>äº‹ä»¶é©±åŠ¨åº“çš„ä»£ç ä¸»è¦æ˜¯åœ¨<code>src/ae.c</code>ä¸­å®ç°çš„ï¼Œå…¶ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037899.png" alt="image-20220628231834918" tabindex="0" loading="lazy"><figcaption>image-20220628231834918</figcaption></figure><p><code>aeEventLoop</code>æ˜¯æ•´ä¸ªäº‹ä»¶é©±åŠ¨çš„æ ¸å¿ƒï¼Œå®ƒç®¡ç†ç€æ–‡ä»¶äº‹ä»¶è¡¨å’Œæ—¶é—´äº‹ä»¶åˆ—è¡¨ï¼Œä¸æ–­åœ°å¾ªç¯å¤„ç†ç€å°±ç»ªçš„æ–‡ä»¶äº‹ä»¶å’Œåˆ°æœŸçš„æ—¶é—´äº‹ä»¶ã€‚</p><h3 id="_10-2-redisæ–‡ä»¶äº‹ä»¶çš„æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_10-2-redisæ–‡ä»¶äº‹ä»¶çš„æ¨¡å‹"><span>10.2 Redisæ–‡ä»¶äº‹ä»¶çš„æ¨¡å‹ï¼Ÿ</span></a></h3><p>RedisåŸºäº<strong>Reactoræ¨¡å¼</strong>å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨<strong>IOå¤šè·¯å¤ç”¨æŠ€æœ¯</strong>ï¼ŒåŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚å½“å¥—æ¥å­—çš„å¯è¯»æˆ–è€…å¯å†™äº‹ä»¶è§¦å‘æ—¶ï¼Œå°±ä¼šè°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><ul><li><strong>1. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis èƒ½é‚£ä¹ˆå¿«</strong>ï¼Ÿ</li></ul><p>Redisçš„ç“¶é¢ˆä¸»è¦åœ¨IOè€Œä¸æ˜¯CPUï¼Œæ‰€ä»¥ä¸ºäº†çœå¼€å‘é‡ï¼Œåœ¨6.0ç‰ˆæœ¬å‰æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼›å…¶æ¬¡ï¼ŒRedis æ˜¯å•çº¿ç¨‹ä¸»è¦æ˜¯æŒ‡ <strong>Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„</strong>ï¼Œè¿™ä¹Ÿæ˜¯ Redis å¯¹å¤–æä¾›é”®å€¼å­˜å‚¨æœåŠ¡çš„ä¸»è¦æµç¨‹ã€‚ï¼ˆä½† Redis çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œå…¶å®æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œçš„ï¼‰ã€‚</p><p>Redis é‡‡ç”¨äº†å¤šè·¯å¤ç”¨æœºåˆ¶ä½¿å…¶åœ¨ç½‘ç»œ IO æ“ä½œä¸­èƒ½å¹¶å‘å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå®ç°é«˜ååç‡ã€‚</p><ul><li><strong>2. Redisäº‹ä»¶å“åº”æ¡†æ¶ae_eventåŠæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨</strong></li></ul><p>Rediså¹¶æ²¡æœ‰ä½¿ç”¨ libevent æˆ–è€… libev è¿™æ ·çš„æˆç†Ÿå¼€æºæ–¹æ¡ˆï¼Œè€Œæ˜¯è‡ªå·±å®ç°ä¸€ä¸ªéå¸¸ç®€æ´çš„äº‹ä»¶é©±åŠ¨åº“ ae_eventã€‚</p><p>Redis ä½¿ç”¨çš„IOå¤šè·¯å¤ç”¨æŠ€æœ¯ä¸»è¦æœ‰ï¼š<code>select</code>ã€<code>epoll</code>ã€<code>evport</code>å’Œ<code>kqueue</code>ç­‰ã€‚æ¯ä¸ªIOå¤šè·¯å¤ç”¨å‡½æ•°åº“åœ¨ Redis æºç ä¸­éƒ½å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œæ¯”å¦‚<code>ae_select.c</code>ï¼Œ<code>ae_epoll.c</code>ï¼Œ <code>ae_kqueue.c</code>ç­‰ã€‚Redis ä¼šæ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ŒæŒ‰ç…§ä¸åŒçš„ä¼˜å…ˆçº§é€‰æ‹©å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚äº‹ä»¶å“åº”æ¡†æ¶ä¸€èˆ¬éƒ½é‡‡ç”¨è¯¥æ¶æ„ï¼Œæ¯”å¦‚ netty å’Œ libeventã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037931.png" alt="image-20220628231916751" tabindex="0" loading="lazy"><figcaption>image-20220628231916751</figcaption></figure><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æœ‰å››ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å¥—æ¥å­—ã€I/Oå¤šè·¯å¤ç”¨ç¨‹åºã€æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä»¥åŠäº‹ä»¶å¤„ç†å™¨ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037955.png" alt="image-20220628231940531" tabindex="0" loading="lazy"><figcaption>image-20220628231940531</figcaption></figure><p>æ–‡ä»¶äº‹ä»¶æ˜¯å¯¹å¥—æ¥å­—æ“ä½œçš„æŠ½è±¡ï¼Œæ¯å½“ä¸€ä¸ªå¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œ <code>accept</code>ã€<code>read</code>ã€<code>write</code>å’Œ <code>close</code> ç­‰æ“ä½œæ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–‡ä»¶äº‹ä»¶ã€‚å› ä¸º Redis é€šå¸¸ä¼šè¿æ¥å¤šä¸ªå¥—æ¥å­—ï¼Œæ‰€ä»¥å¤šä¸ªæ–‡ä»¶äº‹ä»¶æœ‰å¯èƒ½å¹¶å‘çš„å‡ºç°ã€‚</p><p>I/Oå¤šè·¯å¤ç”¨ç¨‹åºè´Ÿè´£ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶å‘æ–‡ä»¶äº‹ä»¶æ´¾å‘å™¨ä¼ é€’é‚£äº›äº§ç”Ÿäº†äº‹ä»¶çš„å¥—æ¥å­—ã€‚</p><p>å°½ç®¡å¤šä¸ªæ–‡ä»¶äº‹ä»¶å¯èƒ½ä¼šå¹¶å‘åœ°å‡ºç°ï¼Œä½†I/Oå¤šè·¯å¤ç”¨ç¨‹åºæ€»æ˜¯ä¼šå°†æ‰€æœ‰äº§ç”Ÿçš„å¥—æ¥å­—éƒ½æ”¾åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—(ä¹Ÿå°±æ˜¯åæ–‡ä¸­æè¿°çš„aeEventLoopçš„firedå°±ç»ªäº‹ä»¶è¡¨)é‡Œè¾¹ï¼Œç„¶åæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä¼šä»¥æœ‰åºã€åŒæ­¥ã€å•ä¸ªå¥—æ¥å­—çš„æ–¹å¼å¤„ç†è¯¥é˜Ÿåˆ—ä¸­çš„å¥—æ¥å­—ï¼Œä¹Ÿå°±æ˜¯å¤„ç†å°±ç»ªçš„æ–‡ä»¶äº‹ä»¶ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037987.png" alt="image-20220628232005169" tabindex="0" loading="lazy"><figcaption>image-20220628232005169</figcaption></figure><h3 id="_10-3-ä»€ä¹ˆæ˜¯rediså‘å¸ƒè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#_10-3-ä»€ä¹ˆæ˜¯rediså‘å¸ƒè®¢é˜…"><span>10.3 ä»€ä¹ˆæ˜¯Rediså‘å¸ƒè®¢é˜…ï¼Ÿ</span></a></h3><p>Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>Redis çš„ SUBSCRIBE å‘½ä»¤å¯ä»¥è®©å®¢æˆ·ç«¯è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ï¼Œ æ¯å½“æœ‰æ–°ä¿¡æ¯å‘é€åˆ°è¢«è®¢é˜…çš„é¢‘é“æ—¶ï¼Œ ä¿¡æ¯å°±ä¼šè¢«å‘é€ç»™æ‰€æœ‰è®¢é˜…æŒ‡å®šé¢‘é“çš„å®¢æˆ·ç«¯ã€‚</p><p>ä½œä¸ºä¾‹å­ï¼Œ ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ channel1 ï¼Œ ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” client2 ã€ client5 å’Œ client1 ä¹‹é—´çš„å…³ç³»</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/image-20220628232200617-1684919697045-787.png" alt="image-20220628232200617-1684919697045-787" tabindex="0" loading="lazy"><figcaption>image-20220628232200617-1684919697045-787</figcaption></figure><p>å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ PUBLISH å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/image-20220628232219119-1684919697045-789.png" alt="image-20220628232219119-1684919697045-789" tabindex="0" loading="lazy"><figcaption>image-20220628232219119-1684919697045-789</figcaption></figure><h3 id="_10-4-rediså‘å¸ƒè®¢é˜…æœ‰å“ªä¸¤ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_10-4-rediså‘å¸ƒè®¢é˜…æœ‰å“ªä¸¤ç§æ–¹å¼"><span>10.4 Rediså‘å¸ƒè®¢é˜…æœ‰å“ªä¸¤ç§æ–¹å¼ï¼Ÿ</span></a></h3><ul><li><strong>åŸºäºé¢‘é“(Channel)çš„å‘å¸ƒ/è®¢é˜…</strong></li></ul><p>&quot;å‘å¸ƒ/è®¢é˜…&quot;æ¨¡å¼åŒ…å«ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯å‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚å‘å¸ƒè€…å¯ä»¥å‘æŒ‡å®šçš„é¢‘é“(channel)å‘é€æ¶ˆæ¯; è®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“(channel),æ‰€æœ‰è®¢é˜…æ­¤é¢‘é“çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037021.png" alt="image-20220628232251439" tabindex="0" loading="lazy"><figcaption>image-20220628232251439</figcaption></figure><ul><li><strong>åŸºäºæ¨¡å¼(pattern)çš„å‘å¸ƒ/è®¢é˜…</strong></li></ul><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰é¢‘é“å’Œæ¨¡å¼çš„ä¾‹å­ï¼Œ å…¶ä¸­ <a href="http://tweet.shop" target="_blank" rel="noopener noreferrer">tweet.shop</a>.* æ¨¡å¼åŒ¹é…äº† tweet.shop.kindle é¢‘é“å’Œ tweet.shop.ipad é¢‘é“ï¼Œ å¹¶ä¸”æœ‰ä¸åŒçš„å®¢æˆ·ç«¯åˆ†åˆ«è®¢é˜…å®ƒä»¬ä¸‰ä¸ªï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037049.png" alt="image-20220628232314728" tabindex="0" loading="lazy"><figcaption>image-20220628232314728</figcaption></figure><p>å½“æœ‰ä¿¡æ¯å‘é€åˆ° tweet.shop.kindle é¢‘é“æ—¶ï¼Œ ä¿¡æ¯é™¤äº†å‘é€ç»™ clientX å’Œ clientY ä¹‹å¤–ï¼Œ è¿˜ä¼šå‘é€ç»™è®¢é˜… <a href="http://tweet.shop" target="_blank" rel="noopener noreferrer">tweet.shop</a>.* æ¨¡å¼çš„ client123 å’Œ client256 ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037080.png" alt="image-20220628232334451" tabindex="0" loading="lazy"><figcaption>image-20220628232334451</figcaption></figure><p>å¦ä¸€æ–¹é¢ï¼Œ å¦‚æœæ¥æ”¶åˆ°ä¿¡æ¯çš„æ˜¯é¢‘é“ tweet.shop.ipad ï¼Œ é‚£ä¹ˆ client123 å’Œ client256 åŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403131037129.png" alt="image-20220628232349308" tabindex="0" loading="lazy"><figcaption>image-20220628232349308</figcaption></figure><h2 id="å‚è€ƒæ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡ç« "><span>å‚è€ƒæ–‡ç« </span></a></h2><p><a href="https://pdai.tech/md/interview/x-interview.html#83-redis" target="_blank" rel="noopener noreferrer">redisé¢è¯•</a></p></div><!--[--><div class="sponsor" data-v-98f29c97><div id="drinks-box" data-v-98f29c97><div id="drinks-box-s" class="drinks-button left-100" data-v-98f29c97><div id="drinks-icons" class="left-100 tr3" data-v-98f29c97><div id="coffee-donate" class="icon-donate" data-v-98f29c97><span class="font-icon icon iconfont icon-hk-flutter" data-v-98f29c97></span> èµåŠ© </div></div><div id="drinks-button-box" class="tr3 left-100" data-v-98f29c97><div id="drinks-button-bg" class="left-100" data-v-98f29c97></div><div id="github-box" data-v-98f29c97><a href="https://github.com/OrageKK/sponsor-page" target="_blank" data-v-98f29c97>Github</a></div><ul id="donate-buttons" class="list tr3" data-v-98f29c97><li id="paypal_donate" data-v-98f29c97><a href="https://www.paypal.me/oragekk" target="_blank" data-v-98f29c97>Paypal</a></li><!-- <li id="btc_donate" class="donate-button">Bitcoin</li> --><li id="alipay_donate" class="donate-button" data-v-98f29c97>AliPay</li><li id="wechat_donate" class="donate-button2" data-v-98f29c97>WeChat</li></ul></div><div id="drinks-qrcodes" class="left-100 tr3" data-v-98f29c97><div id="drinks-qrcode" data-v-98f29c97></div></div></div></div></div><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/MrjackC/mrjackc.github.io/edit/main/src/posts/Redis/redis-z-interview-overview-detail.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 845886914@qq.com">MrJason</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/Redis/redis-z-interview-overview.html" aria-label="Redisé¢è¯• - redisé—®é¢˜æ€»ç»“"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Redisé¢è¯• - redisé—®é¢˜æ€»ç»“</div></a><a class="route-link auto-link next" href="/posts/Redis/redis-z-interview-basic.html" aria-label="Redisé¢è¯• - å¸¸è§„é—®é¢˜"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Redisé¢è¯• - å¸¸è§„é—®é¢˜<!----></div></a></nav><div id="vp-comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-reaction"><div class="wl-reaction-title">ä½ è®¤ä¸ºè¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼Ÿ</div><ul class="wl-reaction-list"><!--[--><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_agree.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_look_down.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sunglasses.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_pick_nose.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_awkward.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sleep.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><!--]--></ul></div><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€(å¯é€‰)</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" aria-hidden="true" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡" aria-label="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <span> Â /Â  <span class="">300</span></span> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v3.3.2</div></div></div><!----><!--]--></main><!--]--><div style="--0dfcb062:;"><footer class="footer-wrapper" style="display:none;"><div class="busuanzi"><span id="busuanzi_container_site_pv" style="display:none;"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span>æ¬¡ <span class="post-meta-divider">|</span></span><span id="busuanzi_container_site_uv" style="display:none;"> æ‚¨æ˜¯æœ¬ç«™ç¬¬ <span id="busuanzi_value_site_uv"></span>ä½è®¿é—®è€… </span></div><div class="footer-content"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2020-2024 MrJason</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="å¼€å¾€-å‹é“¾æ¥åŠ›"></a></div></footer></div></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BQBjlK2G.js" defer></script>
  </body>
</html>
