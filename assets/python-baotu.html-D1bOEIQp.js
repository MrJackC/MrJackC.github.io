import{_ as a,c as n,a as i,o as l}from"./app-BOcQBfH9.js";const B={};function p(r,s){return l(),n("div",null,s[0]||(s[0]=[i(`<h1 id="python爬取包图网" tabindex="-1"><a class="header-anchor" href="#python爬取包图网"><span>python爬取包图网</span></a></h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介"><span>1. 简介</span></a></h2><p>下载包图网的视频资源到本地</p><h2 id="_2-涉及知识点" tabindex="-1"><a class="header-anchor" href="#_2-涉及知识点"><span>2. 涉及知识点</span></a></h2><ol><li><p>isinstance() 判断对象类型</p><p>函数来判断一个对象是否是一个已知的类型</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> not</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> isinstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.useragent, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span></code></pre></div></li><li><p>多线程</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">t1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> threading</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(target</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  # request线程，进行生产者任务</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  # 线程启动</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  # 等待其他线程结束，再结束 线程</span></span></code></pre></div></li><li><p>zip/unzip使用</p></li></ol><p><code>zip()</code>把两个或多个数组的所有元素按索引对齐，然后按索引合并成新数组。例如，你有一个<code>Array</code>保存了名字，另一个<code>Array</code>保存了分数，现在，要把名字和分数给对上，用<code>zip()</code>轻松实现：</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&#39;use strict&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>var names = [&#39;Adam&#39;, &#39;Lisa&#39;, &#39;Bart&#39;];</span></span>
<span class="line"><span>var scores = [85, 92, 59];</span></span>
<span class="line"><span>_.zip(names, scores);</span></span>
<span class="line"><span>// [[&#39;Adam&#39;, 85], [&#39;Lisa&#39;, 92], [&#39;Bart&#39;, 59]]</span></span></code></pre></div><p><code>unzip()</code>则是反过来：</p><ol start="4"><li><p>进程间通信 queue队列</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Baotu</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> __init__</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">url</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;https://ibaotu.com/shipin/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">max_page</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">250</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">useragent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">None</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Queue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 请求队列</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.fail </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Queue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 失败队列</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> i </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> range</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">           ...</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">           self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">({</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;http:&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> _[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;src&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: n[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;alt&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]})  </span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">         	...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> download</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">path</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=os.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getcwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()):  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 默认下载路径为当前文件夹下</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> not</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">empty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断如果队列不为空进行下载</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从队列中取出视频字典</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>保存文件</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">with</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> open</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path, data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]), </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    f.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(req.content)</span></span></code></pre></div></li><li><p>时间装饰器</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 时间装饰器</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> usetime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> inner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">kwargs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        time_start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*args, **kwargs)  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 装饰的函数在此运行</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        time_run </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time_start</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(func.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">__name__</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;用时 </span><span style="color:#D19A66;--shiki-dark:#D19A66;">%.2f</span><span style="color:#98C379;--shiki-dark:#98C379;"> 秒&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> %</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time_run)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inner</span></span></code></pre></div><p>需要使用的地方</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 	@usetime</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    	pass</span></span></code></pre></div></li></ol><h2 id="_3-完整代码" tabindex="-1"><a class="header-anchor" href="#_3-完整代码"><span>3. 完整代码</span></a></h2><p>思路：</p><ol><li>初始化要爬取的内容参数（请求队列，页数，请求头，线程数量等）</li><li>爬取页面内容，将网站中的视频和图片地址取出，存在queue队列</li><li>从queue队列中取出对应的地址，下载到本地</li></ol><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -*- coding: UTF-8 -*-</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">__author__ </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;Joynice&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> threading</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> bs4 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> BeautifulSoup</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> lxml </span><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> etree</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 时间装饰器</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> usetime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> inner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">kwargs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        time_start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*args, **kwargs)  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 装饰的函数在此运行</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        time_run </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time_start</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(func.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">__name__</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;用时 </span><span style="color:#D19A66;--shiki-dark:#D19A66;">%.2f</span><span style="color:#98C379;--shiki-dark:#98C379;"> 秒&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> %</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time_run)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inner</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Baotu</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    负责爬虫存储</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    TODO</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        目标网络有反爬虫机制，多线程下导致有些目标下载失败</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        1.解决多线程下网络错误：增加retry机制</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        2.异步进行</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    注意点：</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    requests.text与requests.context区别</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> __init__</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">url</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;https://ibaotu.com/shipin/&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">max_page</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">250</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">useragent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">None</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        :param url:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        :param thread: 线程数</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        :param max_page: 爬取页数</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        :param useragent: 请求useragent</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.url </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> url</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.thread </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> thread</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> max_page</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.useragent </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> useragent</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.header </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_get_header</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Queue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 请求队列</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.fail </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> queue.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Queue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 失败队列</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_get_maxpage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> page:</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> page</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        super</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(Baotu, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">__init__</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 如果用户没有设置浏览器类型将使用默认浏览器</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> _get_header</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> not</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> isinstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.useragent, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.useragent </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;User-Agent&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.useragent}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 检测当前共有多少分页若用户输入大于当前页面分页则使用当前分页</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> _get_maxpage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        req </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> requests.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.url, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">headers</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.header, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">verify</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">False</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).text</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        html </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> etree.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HTML</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(req)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(html.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">xpath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;//div[@class=&#39;pagelist&#39;]/a[8]/text()&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">])  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># xpath找到class为pagelist的div标签下第8个a标签下的text文本</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 获取请求列表</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    @usetime</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> i </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> range</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.url)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                req </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> requests.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.url </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;6-0-0-0-0-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">{}</span><span style="color:#98C379;--shiki-dark:#98C379;">.html&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(i), </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">headers</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.header, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">                                   verify</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">False</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;正在爬取第</span><span style="color:#D19A66;--shiki-dark:#D19A66;">%d</span><span style="color:#98C379;--shiki-dark:#98C379;">页的数据&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> %</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> i)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> req.status_code </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    bs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> BeautifulSoup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(req.text)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> _, n </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(bs.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">find_all</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;video&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), bs.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">find_all</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;img&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">                        &#39;class&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;scrollLoading&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">})):  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># bs找到所有video、以及class为scrollLoading的img标签</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                            {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;http:&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> _[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;src&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: n[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;alt&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]})  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将每个视频组成字典形式放入队列中，{url:视频url,name:视频的名字)}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            except</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> Exception </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                pass</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;共有</span><span style="color:#D19A66;--shiki-dark:#D19A66;">{}</span><span style="color:#98C379;--shiki-dark:#98C379;">条视频需要下载！&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">qsize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()))  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 计算队列的长度及存储多少视频字典</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 进行下载</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    @usetime</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> download</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">path</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=os.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getcwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()):  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 默认下载路径为当前文件夹下</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> not</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">empty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断如果队列不为空进行下载</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.que.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从队列中取出视频字典</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                req </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> requests.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">url</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">headers</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.header, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">verify</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">False</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> req.status_code </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                    print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;-&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;-&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    if</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> not</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path):  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果用户设置path不存在，则创建该path</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        os.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mkdir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">strip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rstrip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    with</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> open</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path, data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]), </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        f.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(req.content)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    # 如果请求失败，等待2秒重新下载，感觉没用，继续完善</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    time.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    req2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> requests.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">url</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">headers</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.header, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">verify</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">False</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> req2.status_code </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                        print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;+&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;+&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        with</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> open</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path, data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]), </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                            f.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(req.content)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                        self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.fail.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(data)  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将失败的字典存入fail队列中</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                        print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(data[</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\t</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;下载失败！&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            except</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> Exception </span><span style="color:#C678DD;--shiki-dark:#C678DD;">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 控制线程，进行工作</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        t1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> threading.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">target</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.request)  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># request线程，进行生产者任务</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        t1.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 线程启动</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        t1.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 等待其他线程结束，再结束线程</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        thread_list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> i </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> range</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.thread):  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建多个download线程</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            t </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> threading.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">target</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">self</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.download, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;D:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="color:#98C379;--shiki-dark:#98C379;">video&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            thread_list.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(t)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD;">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> thread_list:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            t.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> __name__</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Baotu</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">max_page</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">thread</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># D:\\video</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13)]))}const e=a(B,[["render",p],["__file","python-baotu.html.vue"]]),k=JSON.parse('{"path":"/posts/Python/python-baotu.html","title":"python爬取包图网","lang":"zh-CN","frontmatter":{"description":"python爬取包图网 1. 简介 下载包图网的视频资源到本地 2. 涉及知识点 isinstance() 判断对象类型 函数来判断一个对象是否是一个已知的类型 多线程 zip/unzip使用 zip()把两个或多个数组的所有元素按索引对齐，然后按索引合并成新数组。例如，你有一个Array保存了名字，另一个Array保存了分数，现在，要把名字和分数给对...","head":[["meta",{"property":"og:url","content":"https://mrjackc.github.io/posts/Python/python-baotu.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"python爬取包图网"}],["meta",{"property":"og:description","content":"python爬取包图网 1. 简介 下载包图网的视频资源到本地 2. 涉及知识点 isinstance() 判断对象类型 函数来判断一个对象是否是一个已知的类型 多线程 zip/unzip使用 zip()把两个或多个数组的所有元素按索引对齐，然后按索引合并成新数组。例如，你有一个Array保存了名字，另一个Array保存了分数，现在，要把名字和分数给对..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-21T07:03:09.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-21T07:03:09.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"python爬取包图网\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-21T07:03:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://mrjackc.github.io\\"}]}"]]},"headers":[{"level":2,"title":"1. 简介","slug":"_1-简介","link":"#_1-简介","children":[]},{"level":2,"title":"2. 涉及知识点","slug":"_2-涉及知识点","link":"#_2-涉及知识点","children":[]},{"level":2,"title":"3. 完整代码","slug":"_3-完整代码","link":"#_3-完整代码","children":[]}],"git":{"createdTime":1729494189000,"updatedTime":1729494189000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":3.96,"words":1189},"filePathRelative":"posts/Python/python-baotu.md","localizedDate":"2024年10月21日","excerpt":"\\n<h2>1. 简介</h2>\\n<p>下载包图网的视频资源到本地</p>\\n<h2>2. 涉及知识点</h2>\\n<ol>\\n<li>\\n<p>isinstance() 判断对象类型</p>\\n<p>函数来判断一个对象是否是一个已知的类型</p>\\n<div class=\\"language-python\\" data-ext=\\"python\\" data-title=\\"python\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\" style=\\"background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#C678DD;--shiki-dark:#C678DD\\">if</span><span style=\\"color:#C678DD;--shiki-dark:#C678DD\\"> not</span><span style=\\"color:#56B6C2;--shiki-dark:#56B6C2\\"> isinstance</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">(</span><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\">self</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">.useragent, </span><span style=\\"color:#56B6C2;--shiki-dark:#56B6C2\\">str</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">):</span></span></code></pre>\\n</div></li>\\n<li>\\n<p>多线程</p>\\n<div class=\\"language-java\\" data-ext=\\"java\\" data-title=\\"java\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\" style=\\"background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#E06C75;--shiki-dark:#E06C75\\">t1 </span><span style=\\"color:#56B6C2;--shiki-dark:#56B6C2\\">=</span><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\"> threading</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">Thread</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">(target</span><span style=\\"color:#56B6C2;--shiki-dark:#56B6C2\\">=</span><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\">self</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\">request</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">)</span><span style=\\"color:#E06C75;--shiki-dark:#E06C75\\">  # request线程，进行生产者任务</span></span>\\n<span class=\\"line\\"><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\">t1</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">start</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">()</span><span style=\\"color:#E06C75;--shiki-dark:#E06C75\\">  # 线程启动</span></span>\\n<span class=\\"line\\"><span style=\\"color:#E5C07B;--shiki-dark:#E5C07B\\">t1</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">join</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\">()</span><span style=\\"color:#E06C75;--shiki-dark:#E06C75\\">  # 等待其他线程结束，再结束 线程</span></span></code></pre>\\n</div></li>\\n<li>\\n<p>zip/unzip使用</p>\\n</li>\\n</ol>","autoDesc":true}');export{e as comp,k as data};
