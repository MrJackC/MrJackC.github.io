import{_ as s,c as n,a as r,o as e}from"./app-B-YfeyLA.js";const l={};function i(o,a){return e(),n("div",null,a[0]||(a[0]=[r(`<h1 id="调试排错-java-问题排查之应用在线调试arthas" tabindex="-1"><a class="header-anchor" href="#调试排错-java-问题排查之应用在线调试arthas"><span>调试排错 - Java 问题排查之应用在线调试Arthas</span></a></h1><h2 id="_1-arthas简介" tabindex="-1"><a class="header-anchor" href="#_1-arthas简介"><span>1. Arthas简介</span></a></h2><blockquote><p>在学习Arthas之前，推荐先看上一篇美团技术团队的<a href="https://pdai.tech/md/java/jvm/java-jvm-agent-usage.html" target="_blank" rel="noopener noreferrer">Java 动态调试技术原理及实践</a>，这样你会对它最底层技术有个了解。可以看下文中最后有个对比图：Greys(Arthas也是基于它做的二次开发)和Java-debug-tool。</p></blockquote><h3 id="_1-1-arthas是什么" tabindex="-1"><a class="header-anchor" href="#_1-1-arthas是什么"><span>1.1 Arthas是什么</span></a></h3><p><code>Arthas</code> 是Alibaba开源的Java诊断工具，深受开发者喜爱。</p><h3 id="_1-2-arthas能解决什么问题" tabindex="-1"><a class="header-anchor" href="#_1-2-arthas能解决什么问题"><span>1.2 Arthas能解决什么问题</span></a></h3><p>当你遇到以下类似问题而束手无策时，<code>Arthas</code>可以帮助你解决：</p><ul><li>这个类从哪个 jar 包加载的? 为什么会报各种类相关的 Exception?</li><li>我改的代码为什么没有执行到? 难道是我没 commit? 分支搞错了?</li><li>遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗?</li><li>线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！</li><li>是否有一个全局视角来查看系统的运行状况?</li><li>有什么办法可以监控到JVM的实时运行状态?</li></ul><p><code>Arthas</code>支持JDK 6+，支持Linux/Mac/Windows，采用命令行交互模式，同时提供丰富的 <code>Tab</code> 自动补全功能，进一步方便进行问题的定位和诊断。</p><h3 id="_1-3-arthas资源推荐" tabindex="-1"><a class="header-anchor" href="#_1-3-arthas资源推荐"><span>1.3 Arthas资源推荐</span></a></h3><ul><li><a href="https://alibaba.github.io/arthas/" target="_blank" rel="noopener noreferrer">用户文档</a></li><li><a href="https://alibaba.github.io/arthas/arthas-tutorials?language=cn" target="_blank" rel="noopener noreferrer">官方在线教程(推荐)</a></li><li><a href="https://alibaba.github.io/arthas/quick-start.html" target="_blank" rel="noopener noreferrer">快速入门</a></li><li><a href="https://alibaba.github.io/arthas/advanced-use.html" target="_blank" rel="noopener noreferrer">进阶使用</a></li><li><a href="https://alibaba.github.io/arthas/commands.html" target="_blank" rel="noopener noreferrer">命令列表</a></li><li><a href="https://alibaba.github.io/arthas/web-console.html" target="_blank" rel="noopener noreferrer">WebConsole</a></li><li><a href="https://alibaba.github.io/arthas/docker.html" target="_blank" rel="noopener noreferrer">Docker</a></li><li><a href="https://github.com/alibaba/arthas/issues?q=label%3Auser-case" target="_blank" rel="noopener noreferrer">用户案例</a></li><li><a href="https://github.com/alibaba/arthas/issues?utf8=%E2%9C%93&amp;q=label%3Aquestion-answered+" target="_blank" rel="noopener noreferrer">常见问题</a></li></ul><h3 id="_1-4-arthas基于了哪些工具上发展而来" tabindex="-1"><a class="header-anchor" href="#_1-4-arthas基于了哪些工具上发展而来"><span>1.4 Arthas基于了哪些工具上发展而来</span></a></h3><ul><li><a href="https://github.com/oldmanpushcart/greys-anatomy" target="_blank" rel="noopener noreferrer">greys-anatomy</a>: Arthas代码基于Greys二次开发而来，非常感谢Greys之前所有的工作，以及Greys原作者对Arthas提出的意见和建议！</li><li><a href="https://github.com/termd/termd" target="_blank" rel="noopener noreferrer">termd</a>: Arthas的命令行实现基于termd开发，是一款优秀的命令行程序开发框架，感谢termd提供了优秀的框架。</li><li><a href="https://github.com/crashub/crash" target="_blank" rel="noopener noreferrer">crash</a>: Arthas的文本渲染功能基于crash中的文本渲染功能开发，可以从<a href="https://github.com/crashub/crash/tree/1.3.2/shell" target="_blank" rel="noopener noreferrer">这里</a>看到源码，感谢crash在这方面所做的优秀工作。</li><li><a href="https://github.com/eclipse-vertx/vert.x/tree/master/src/main/java/io/vertx/core/cli" target="_blank" rel="noopener noreferrer">cli</a>: Arthas的命令行界面基于vert.x提供的cli库进行开发，感谢vert.x在这方面做的优秀工作。</li><li><a href="https://github.com/skalogs/SkaETL/tree/master/compiler" target="_blank" rel="noopener noreferrer">compiler</a> Arthas里的内存编绎器代码来源</li><li><a href="https://commons.apache.org/proper/commons-net/" target="_blank" rel="noopener noreferrer">Apache Commons Net</a> Arthas里的Telnet Client代码来源</li><li><code>JavaAgent</code>：运行在 main方法之前的拦截器，它内定的方法名叫 premain ，也就是说先执行 premain 方法然后再执行 main 方法</li><li><code>ASM</code>：一个通用的Java字节码操作和分析框架。它可以用于修改现有的类或直接以二进制形式动态生成类。ASM提供了一些常见的字节码转换和分析算法，可以从它们构建定制的复杂转换和代码分析工具。ASM提供了与其他Java字节码框架类似的功能，但是主要关注性能。因为它被设计和实现得尽可能小和快，所以非常适合在动态系统中使用(当然也可以以静态方式使用，例如在编译器中)</li></ul><h3 id="_1-5-同类工具有哪些" tabindex="-1"><a class="header-anchor" href="#_1-5-同类工具有哪些"><span>1.5 同类工具有哪些</span></a></h3><ul><li>BTrace</li><li>美团 Java-debug-tool</li><li><a href="https://github.com/qunarcorp/bistoury" target="_blank" rel="noopener noreferrer">去哪儿Bistoury: 一个集成了Arthas的项目</a></li><li><a href="https://github.com/XhinLiang/arthas" target="_blank" rel="noopener noreferrer">一个使用MVEL脚本的fork</a></li></ul><h2 id="_2-arthas入门" tabindex="-1"><a class="header-anchor" href="#_2-arthas入门"><span>2. Arthas入门</span></a></h2><h3 id="_2-1-arthas-上手前" tabindex="-1"><a class="header-anchor" href="#_2-1-arthas-上手前"><span>2.1 Arthas 上手前</span></a></h3><p>推荐先在线使用下arthas：<a href="https://arthas.aliyun.com/doc/arthas-tutorials.html?language=cn&amp;id=arthas-basics" target="_blank" rel="noopener noreferrer">官方在线教程(推荐)</a></p><h3 id="_2-2-arthas-安装" tabindex="-1"><a class="header-anchor" href="#_2-2-arthas-安装"><span>2.2 Arthas 安装</span></a></h3><p>下载<code>arthas-boot.jar</code>，然后用<code>java -jar</code>的方式启动：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -O</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://alibaba.github.io/arthas/arthas-boot.jar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">java</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -jar</span><span style="color:#98C379;--shiki-dark:#98C379;"> arthas-boot.jar</span></span></code></pre></div><h3 id="_2-3-arthas-官方案例展示" tabindex="-1"><a class="header-anchor" href="#_2-3-arthas-官方案例展示"><span>2.3 Arthas 官方案例展示</span></a></h3><h4 id="_2-3-1-dashboard" tabindex="-1"><a class="header-anchor" href="#_2-3-1-dashboard"><span>2.3.1 Dashboard</span></a></h4><ul><li><a href="https://alibaba.github.io/arthas/dashboard" target="_blank" rel="noopener noreferrer">https://alibaba.github.io/arthas/dashboard</a></li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942249.png" alt="image-20220827222601003" tabindex="0" loading="lazy"><figcaption>image-20220827222601003</figcaption></figure><h4 id="_2-3-2-thread" tabindex="-1"><a class="header-anchor" href="#_2-3-2-thread"><span>2.3.2 Thread</span></a></h4><p>一目了然的了解系统的状态，哪些线程比较占cpu? 他们到底在做什么?</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> thread</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -n</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;as-command-execute-daemon&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> Id=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">29</span><span style="color:#98C379;--shiki-dark:#98C379;"> cpuUsage=75%</span><span style="color:#98C379;--shiki-dark:#98C379;"> RUNNABLE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> sun.management.ThreadImpl.dumpThreads0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Native</span><span style="color:#98C379;--shiki-dark:#98C379;"> Method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> sun.management.ThreadImpl.getThreadInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadImpl.java:440</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.taobao.arthas.core.command.monitor200.ThreadCommand</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="color:#98C379;--shiki-dark:#98C379;">.action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadCommand.java:58</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.taobao.arthas.core.command.handler.AbstractCommandHandler.execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AbstractCommandHandler.java:238</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.taobao.arthas.core.command.handler.DefaultCommandHandler.handleCommand</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">DefaultCommandHandler.java:67</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.taobao.arthas.core.server.ArthasServer</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$4</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ArthasServer.java:276</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.util.concurrent.ThreadPoolExecutor.runWorker</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadPoolExecutor.java:1145</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.util.concurrent.ThreadPoolExecutor</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$Worker</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadPoolExecutor.java:615</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.Thread.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Thread.java:745</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Number</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> locked</span><span style="color:#98C379;--shiki-dark:#98C379;"> synchronizers</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.util.concurrent.ThreadPoolExecutor</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$Worker</span><span style="color:#98C379;--shiki-dark:#98C379;">@6cd0b6f8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;as-session-expire-daemon&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> Id=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">25</span><span style="color:#98C379;--shiki-dark:#98C379;"> cpuUsage=24%</span><span style="color:#98C379;--shiki-dark:#98C379;"> TIMED_WAITING</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.Thread.sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Native</span><span style="color:#98C379;--shiki-dark:#98C379;"> Method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.taobao.arthas.core.server.DefaultSessionManager</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">DefaultSessionManager.java:85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;Reference Handler&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> Id=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;"> cpuUsage=0%</span><span style="color:#98C379;--shiki-dark:#98C379;"> WAITING</span><span style="color:#98C379;--shiki-dark:#98C379;"> on</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.ref.Reference</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$Lock</span><span style="color:#98C379;--shiki-dark:#98C379;">@69ba0f27</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.Object.wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Native</span><span style="color:#98C379;--shiki-dark:#98C379;"> Method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;">  waiting</span><span style="color:#98C379;--shiki-dark:#98C379;"> on</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.ref.Reference</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$Lock</span><span style="color:#98C379;--shiki-dark:#98C379;">@69ba0f27</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.Object.wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Object.java:503</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.ref.Reference</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ReferenceHandler</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Reference.java:133</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-3-jad" tabindex="-1"><a class="header-anchor" href="#_2-3-3-jad"><span>2.3.3 jad</span></a></h4><p>对类进行反编译:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$ jad </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">javax</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">servlet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Servlet</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ClassLoader</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">net</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">URLClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">6108b2d7</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  +-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">misc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Launcher$AppClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">18b4aac2</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    +-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">misc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Launcher$ExtClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">1ddf84b8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">Location</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Users</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">xxx</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">work</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">test</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">lib</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">servlet</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">api</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jar</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * Decompiled with CFR 0_122.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">package</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> javax.servlet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> java.io.IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> javax.servlet.ServletConfig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> javax.servlet.ServletException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> javax.servlet.ServletRequest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> javax.servlet.ServletResponse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Servlet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> init</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ServletConfig</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> var1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ServletConfig</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getServletConfig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ServletRequest</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> var1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ServletResponse</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> var2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getServletInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> destroy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-4-mc" tabindex="-1"><a class="header-anchor" href="#_2-3-4-mc"><span>2.3.4 mc</span></a></h4><p>Memory Compiler/内存编译器，编译<code>.java</code>文件生成<code>.class</code>。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/Test.java</span></span></code></pre></div><h4 id="_2-3-5-redefine" tabindex="-1"><a class="header-anchor" href="#_2-3-5-redefine"><span>2.3.5 redefine</span></a></h4><p>加载外部的<code>.class</code>文件，redefine jvm已加载的类。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redefine</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/Test.class</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redefine</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#98C379;--shiki-dark:#98C379;"> 327a647b</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/Test.class</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/Test</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\$</span><span style="color:#98C379;--shiki-dark:#98C379;">Inner.class</span></span></code></pre></div><h4 id="_2-3-6-sc" tabindex="-1"><a class="header-anchor" href="#_2-3-6-sc"><span>2.3.6 sc</span></a></h4><p>查找JVM中已经加载的类</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> sc</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.springframework.web.context.support.XmlWebApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> class-info</span><span style="color:#98C379;--shiki-dark:#98C379;">        org.springframework.web.context.support.XmlWebApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> code-source</span><span style="color:#98C379;--shiki-dark:#98C379;">       /Users/xxx/work/test/WEB-INF/lib/spring-web-3.2.11.RELEASE.jar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> name</span><span style="color:#98C379;--shiki-dark:#98C379;">              org.springframework.web.context.support.XmlWebApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isInterface</span><span style="color:#D19A66;--shiki-dark:#D19A66;">       false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isAnnotation</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isEnum</span><span style="color:#D19A66;--shiki-dark:#D19A66;">            false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isAnonymousClass</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isArray</span><span style="color:#D19A66;--shiki-dark:#D19A66;">           false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isLocalClass</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isMemberClass</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isPrimitive</span><span style="color:#D19A66;--shiki-dark:#D19A66;">       false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isSynthetic</span><span style="color:#D19A66;--shiki-dark:#D19A66;">       false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> simple-name</span><span style="color:#98C379;--shiki-dark:#98C379;">       XmlWebApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> modifier</span><span style="color:#98C379;--shiki-dark:#98C379;">          public</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> annotation</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> interfaces</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> super-class</span><span style="color:#98C379;--shiki-dark:#98C379;">       +-org.springframework.web.context.support.AbstractRefreshableWebApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                     +-org.springframework.context.support.AbstractRefreshableConfigApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                       +-org.springframework.context.support.AbstractRefreshableApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                         +-org.springframework.context.support.AbstractApplicationContext</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                           +-org.springframework.core.io.DefaultResourceLoader</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                             +-java.lang.Object</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> class-loader</span><span style="color:#98C379;--shiki-dark:#98C379;">      +-org.apache.catalina.loader.ParallelWebappClassLoader</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                     +-java.net.URLClassLoader@6108b2d7</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                       +-sun.misc.Launcher$AppClassLoader@18b4aac2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                         +-sun.misc.Launcher$ExtClassLoader@1ddf84b8</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> classLoaderHash</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   25131501</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-7-stack" tabindex="-1"><a class="header-anchor" href="#_2-3-7-stack"><span>2.3.7 stack</span></a></h4><p>查看方法 <code>test.arthas.TestStack#doGet</code> 的调用堆栈：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> stack</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.arthas.TestStack</span><span style="color:#98C379;--shiki-dark:#98C379;"> doGet</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Press</span><span style="color:#98C379;--shiki-dark:#98C379;"> Ctrl+C</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> abort.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Affect(class-cnt:1</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#98C379;--shiki-dark:#98C379;"> method-cnt:1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) cost in 286 ms.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ts</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">2018-09-18</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 10:11:45</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">thread_name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">http-bio-8080-exec-10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">d9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">is_daemon</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">priority</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">TCCL</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">org.apache.catalina.loader.ParallelWebappClassLoader@25131501</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    @test.arthas.TestStack.doGet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> javax.servlet.http.HttpServlet.service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HttpServlet.java:624</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> javax.servlet.http.HttpServlet.service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HttpServlet.java:731</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.internalDoFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:303</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:208</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.tomcat.websocket.server.WsFilter.doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">WsFilter.java:52</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.internalDoFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:241</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:208</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.internalDoFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:241</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.ApplicationFilterChain.doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ApplicationFilterChain.java:208</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.StandardWrapperValve.invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">StandardWrapperValve.java:220</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.StandardContextValve.invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">StandardContextValve.java:110</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        ...</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.StandardHostValve.invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">StandardHostValve.java:169</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.valves.ErrorReportValve.invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ErrorReportValve.java:103</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.core.StandardEngineValve.invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">StandardEngineValve.java:116</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.catalina.connector.CoyoteAdapter.service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">CoyoteAdapter.java:451</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.coyote.http11.AbstractHttp11Processor.process</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AbstractHttp11Processor.java:1121</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.coyote.AbstractProtocol</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AbstractConnectionHandler</span><span style="color:#98C379;--shiki-dark:#98C379;">.process</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AbstractProtocol.java:637</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.tomcat.util.net.JIoEndpoint</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$SocketProcessor</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">JIoEndpoint.java:316</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.util.concurrent.ThreadPoolExecutor.runWorker</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadPoolExecutor.java:1142</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.util.concurrent.ThreadPoolExecutor</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$Worker</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ThreadPoolExecutor.java:617</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.tomcat.util.threads.TaskThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$WrappingRunnable</span><span style="color:#98C379;--shiki-dark:#98C379;">.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TaskThread.java:61</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        at</span><span style="color:#98C379;--shiki-dark:#98C379;"> java.lang.Thread.run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Thread.java:745</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-8-trace" tabindex="-1"><a class="header-anchor" href="#_2-3-8-trace"><span>2.3.8 Trace</span></a></h4><p>观察方法执行的时候哪个子调用比较慢:</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942278.png" alt="image-20220827223031123" tabindex="0" loading="lazy"><figcaption>image-20220827223031123</figcaption></figure><h4 id="_2-3-9-watch" tabindex="-1"><a class="header-anchor" href="#_2-3-9-watch"><span>2.3.9 Watch</span></a></h4><p>观察方法 <code>test.arthas.TestWatch#doGet</code> 执行的入参，仅当方法抛出异常时才输出。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> watch</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.arthas.TestWatch</span><span style="color:#98C379;--shiki-dark:#98C379;"> doGet</span><span style="color:#98C379;--shiki-dark:#98C379;"> {params[0],</span><span style="color:#98C379;--shiki-dark:#98C379;"> throwExp}</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Press</span><span style="color:#98C379;--shiki-dark:#98C379;"> Ctrl+C</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> abort.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Affect(class-cnt:1</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#98C379;--shiki-dark:#98C379;"> method-cnt:1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) cost in 65 ms.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ts</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">2018-09-18</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 10:26:28</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">result</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">@ArrayList[</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    @RequestFacade[org.apache.catalina.connector.RequestFacade@79f922b2],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    @NullPointerException[java.lang.NullPointerException],</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span></code></pre></div><h4 id="_2-3-10-monitor" tabindex="-1"><a class="header-anchor" href="#_2-3-10-monitor"><span>2.3.10 Monitor</span></a></h4><p>监控某个特殊方法的调用统计数据，包括总调用次数，平均rt，成功率等信息，每隔5秒输出一次。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> monitor</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.dubbo.demo.provider.DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;"> sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Press</span><span style="color:#98C379;--shiki-dark:#98C379;"> Ctrl+C</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> abort.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Affect(class-cnt:1</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#98C379;--shiki-dark:#98C379;"> method-cnt:1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) cost in 109 ms.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> timestamp</span><span style="color:#98C379;--shiki-dark:#98C379;">            class</span><span style="color:#98C379;--shiki-dark:#98C379;">                                           method</span><span style="color:#98C379;--shiki-dark:#98C379;">    total</span><span style="color:#98C379;--shiki-dark:#98C379;">  success</span><span style="color:#98C379;--shiki-dark:#98C379;">  fail</span><span style="color:#98C379;--shiki-dark:#98C379;">  avg-rt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#98C379;--shiki-dark:#98C379;">fail-rate</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:45:32</span><span style="color:#98C379;--shiki-dark:#98C379;">  org.apache.dubbo.demo.provider.DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">  sayHello</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     0.67</span><span style="color:#98C379;--shiki-dark:#98C379;">        0.00%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> timestamp</span><span style="color:#98C379;--shiki-dark:#98C379;">            class</span><span style="color:#98C379;--shiki-dark:#98C379;">                                           method</span><span style="color:#98C379;--shiki-dark:#98C379;">    total</span><span style="color:#98C379;--shiki-dark:#98C379;">  success</span><span style="color:#98C379;--shiki-dark:#98C379;">  fail</span><span style="color:#98C379;--shiki-dark:#98C379;">  avg-rt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#98C379;--shiki-dark:#98C379;">fail-rate</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:45:37</span><span style="color:#98C379;--shiki-dark:#98C379;">  org.apache.dubbo.demo.provider.DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">  sayHello</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1.00</span><span style="color:#98C379;--shiki-dark:#98C379;">        0.00%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> timestamp</span><span style="color:#98C379;--shiki-dark:#98C379;">            class</span><span style="color:#98C379;--shiki-dark:#98C379;">                                           method</span><span style="color:#98C379;--shiki-dark:#98C379;">    total</span><span style="color:#98C379;--shiki-dark:#98C379;">  success</span><span style="color:#98C379;--shiki-dark:#98C379;">  fail</span><span style="color:#98C379;--shiki-dark:#98C379;">  avg-rt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#98C379;--shiki-dark:#98C379;">fail-rate</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:45:42</span><span style="color:#98C379;--shiki-dark:#98C379;">  org.apache.dubbo.demo.provider.DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">  sayHello</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     0.43</span><span style="color:#98C379;--shiki-dark:#98C379;">        0.00%</span></span></code></pre></div><h4 id="_2-3-11-time-tunnel-tt" tabindex="-1"><a class="header-anchor" href="#_2-3-11-time-tunnel-tt"><span>2.3.11 Time Tunnel(tt)</span></a></h4><p>记录方法调用信息，支持事后查看方法调用的参数，返回值，抛出的异常等信息，仿佛穿越时空隧道回到调用现场一般。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> tt</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.apache.dubbo.demo.provider.DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;"> sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Press</span><span style="color:#98C379;--shiki-dark:#98C379;"> Ctrl+C</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> abort.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Affect(class-cnt:1</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#98C379;--shiki-dark:#98C379;"> method-cnt:1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) cost in 75 ms.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> INDEX</span><span style="color:#98C379;--shiki-dark:#98C379;">   TIMESTAMP</span><span style="color:#98C379;--shiki-dark:#98C379;">            COST</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="color:#98C379;--shiki-dark:#98C379;">IS-RET</span><span style="color:#98C379;--shiki-dark:#98C379;">  IS-EXP</span><span style="color:#98C379;--shiki-dark:#98C379;">   OBJECT</span><span style="color:#98C379;--shiki-dark:#98C379;">         CLASS</span><span style="color:#98C379;--shiki-dark:#98C379;">                          METHOD</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1000</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:10</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  1.971195</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1001</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:11</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.215685</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1002</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:12</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.236303</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1003</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:13</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.159598</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1004</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:14</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.201982</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1005</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:15</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.214205</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1006</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:16</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.241863</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1007</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:17</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.305747</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 1008</span><span style="color:#98C379;--shiki-dark:#98C379;">    2018-09-20</span><span style="color:#98C379;--shiki-dark:#98C379;"> 09:54:18</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.18468</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   true</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    false</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0x55965cca</span><span style="color:#98C379;--shiki-dark:#98C379;">     DemoServiceImpl</span><span style="color:#98C379;--shiki-dark:#98C379;">                sayHello</span></span></code></pre></div><h4 id="_2-3-12-classloader" tabindex="-1"><a class="header-anchor" href="#_2-3-12-classloader"><span>2.3.12 Classloader</span></a></h4><p>了解当前系统中有多少类加载器，以及每个加载器加载的类数量，帮助您判断是否有类加载器泄露。</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> classloader</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> name</span><span style="color:#98C379;--shiki-dark:#98C379;">                                                  numberOfInstances</span><span style="color:#98C379;--shiki-dark:#98C379;">  loadedCountTotal</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> BootstrapClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                                  1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  3346</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> com.taobao.arthas.agent.ArthasClassloader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">             1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  1262</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> java.net.URLClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                               2</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  1033</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> org.apache.catalina.loader.ParallelWebappClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  628</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> sun.reflect.DelegatingClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                     166</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                166</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> sun.misc.Launcher$AppClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                      1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  31</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> com.alibaba.fastjson.util.ASMClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">              6</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  15</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> sun.misc.Launcher$ExtClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                      1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  7</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> org.jvnet.hk2.internal.DelegatingClassLoader</span><span style="color:#D19A66;--shiki-dark:#D19A66;">          2</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> sun.reflect.misc.MethodUtil</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                           1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">                  1</span></span></code></pre></div><h4 id="_2-3-13-web-console" tabindex="-1"><a class="header-anchor" href="#_2-3-13-web-console"><span>2.3.13 Web Console</span></a></h4><ul><li><a href="https://alibaba.github.io/arthas/web-console" target="_blank" rel="noopener noreferrer">https://alibaba.github.io/arthas/web-console</a></li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942303.png" alt="image-20220827223405858" tabindex="0" loading="lazy"><figcaption>image-20220827223405858</figcaption></figure><h3 id="_2-4-arthas-命令集" tabindex="-1"><a class="header-anchor" href="#_2-4-arthas-命令集"><span>2.4 Arthas 命令集</span></a></h3><h4 id="_2-4-1-基础命令" tabindex="-1"><a class="header-anchor" href="#_2-4-1-基础命令"><span>2.4.1 基础命令</span></a></h4><ul><li>help——查看命令帮助信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/cat.md" target="_blank" rel="noopener noreferrer">cat</a>——打印文件内容，和linux里的cat命令类似</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/grep.md" target="_blank" rel="noopener noreferrer">grep</a>——匹配查找，和linux里的grep命令类似</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/pwd.md" target="_blank" rel="noopener noreferrer">pwd</a>——返回当前的工作目录，和linux命令类似</li><li>cls——清空当前屏幕区域</li><li>session——查看当前会话的信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/reset.md" target="_blank" rel="noopener noreferrer">reset</a>——重置增强类，将被 Arthas 增强过的类全部还原，Arthas 服务端关闭时会重置所有增强过的类</li><li>version——输出当前目标 Java 进程所加载的 Arthas 版本号</li><li>history——打印命令历史</li><li>quit——退出当前 Arthas 客户端，其他 Arthas 客户端不受影响</li><li>stop/shutdown——关闭 Arthas 服务端，所有 Arthas 客户端全部退出</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/keymap.md" target="_blank" rel="noopener noreferrer">keymap</a>——Arthas快捷键列表及自定义快捷键</li></ul><h4 id="_2-4-2-jvm相关" tabindex="-1"><a class="header-anchor" href="#_2-4-2-jvm相关"><span>2.4.2 jvm相关</span></a></h4><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/dashboard.md" target="_blank" rel="noopener noreferrer">dashboard</a>——当前系统的实时数据面板</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/thread.md" target="_blank" rel="noopener noreferrer">thread</a>——查看当前 JVM 的线程堆栈信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/jvm.md" target="_blank" rel="noopener noreferrer">jvm</a>——查看当前 JVM 的信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/sysprop.md" target="_blank" rel="noopener noreferrer">sysprop</a>——查看和修改JVM的系统属性</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/sysenv.md" target="_blank" rel="noopener noreferrer">sysenv</a>——查看JVM的环境变量</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/vmoption.md" target="_blank" rel="noopener noreferrer">vmoption</a>——查看和修改JVM里诊断相关的option</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/logger.md" target="_blank" rel="noopener noreferrer">logger</a>——查看和修改logger</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/getstatic.md" target="_blank" rel="noopener noreferrer">getstatic</a>——查看类的静态属性</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/ognl.md" target="_blank" rel="noopener noreferrer">ognl</a>——执行ognl表达式</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/mbean.md" target="_blank" rel="noopener noreferrer">mbean</a>——查看 Mbean 的信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/heapdump.md" target="_blank" rel="noopener noreferrer">heapdump</a>——dump java heap, 类似jmap命令的heap dump功能</li></ul><h4 id="_2-4-3-class-classloader相关" tabindex="-1"><a class="header-anchor" href="#_2-4-3-class-classloader相关"><span>2.4.3 class/classloader相关</span></a></h4><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/sc.md" target="_blank" rel="noopener noreferrer">sc</a>——查看JVM已加载的类信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/sm.md" target="_blank" rel="noopener noreferrer">sm</a>——查看已加载类的方法信息</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/jad.md" target="_blank" rel="noopener noreferrer">jad</a>——反编译指定已加载类的源码</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/mc.md" target="_blank" rel="noopener noreferrer">mc</a>——内存编绎器，内存编绎<code>.java</code>文件为<code>.class</code>文件</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/redefine.md" target="_blank" rel="noopener noreferrer">redefine</a>——加载外部的<code>.class</code>文件，redefine到JVM里</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/dump.md" target="_blank" rel="noopener noreferrer">dump</a>——dump 已加载类的 byte code 到特定目录</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/classloader.md" target="_blank" rel="noopener noreferrer">classloader</a>——查看classloader的继承树，urls，类加载信息，使用classloader去getResource</li></ul><h4 id="_2-4-4-monitor-watch-trace相关" tabindex="-1"><a class="header-anchor" href="#_2-4-4-monitor-watch-trace相关"><span>2.4.4 monitor/watch/trace相关</span></a></h4><blockquote><p>请注意，这些命令，都通过字节码增强技术来实现的，会在指定类的方法中插入一些切面来实现数据统计和观测，因此在线上、预发使用时，请尽量明确需要观测的类、方法以及条件，诊断结束要执行 <code>shutdown</code> 或将增强过的类执行 <code>reset</code> 命令。</p></blockquote><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/monitor.md" target="_blank" rel="noopener noreferrer">monitor</a>——方法执行监控</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/watch.md" target="_blank" rel="noopener noreferrer">watch</a>——方法执行数据观测</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/trace.md" target="_blank" rel="noopener noreferrer">trace</a>——方法内部调用路径，并输出方法路径上的每个节点上耗时</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/stack.md" target="_blank" rel="noopener noreferrer">stack</a>——输出当前方法被调用的调用路径</li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/tt.md" target="_blank" rel="noopener noreferrer">tt</a>——方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测</li></ul><h4 id="_2-4-5-options" tabindex="-1"><a class="header-anchor" href="#_2-4-5-options"><span>2.4.5 options</span></a></h4><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/options.md" target="_blank" rel="noopener noreferrer">options</a>——查看或设置Arthas全局开关</li></ul><h4 id="_2-4-6-管道" tabindex="-1"><a class="header-anchor" href="#_2-4-6-管道"><span>2.4.6 管道</span></a></h4><p>Arthas支持使用管道对上述命令的结果进行进一步的处理，如<code>sm java.lang.String * | grep &#39;index&#39;</code></p><ul><li>grep——搜索满足条件的结果</li><li>plaintext——将命令的结果去除ANSI颜色</li><li>wc——按行统计输出结果</li></ul><h4 id="_2-4-7-后台异步任务" tabindex="-1"><a class="header-anchor" href="#_2-4-7-后台异步任务"><span>2.4.7 后台异步任务</span></a></h4><p>当线上出现偶发的问题，比如需要watch某个条件，而这个条件一天可能才会出现一次时，异步后台任务就派上用场了，详情请参考<a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/async.md" target="_blank" rel="noopener noreferrer">这里</a></p><ul><li>使用 &gt; 将结果重写向到日志文件，使用 &amp; 指定命令是后台运行，session断开不影响任务执行(生命周期默认为1天)</li><li>jobs——列出所有job</li><li>kill——强制终止任务</li><li>fg——将暂停的任务拉到前台执行</li><li>bg——将暂停的任务放到后台执行</li></ul><h4 id="_2-4-8-web-console" tabindex="-1"><a class="header-anchor" href="#_2-4-8-web-console"><span>2.4.8 Web Console</span></a></h4><p>通过websocket连接Arthas。</p><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/web-console.md" target="_blank" rel="noopener noreferrer">Web Console</a></li></ul><h4 id="_2-4-9-用户数据回报" tabindex="-1"><a class="header-anchor" href="#_2-4-9-用户数据回报"><span>2.4.9 用户数据回报</span></a></h4><p>在<code>3.1.4</code>版本后，增加了用户数据回报功能，方便统一做安全或者历史数据统计。</p><p>在启动时，指定<code>stat-url</code>，就会回报执行的每一行命令，比如： <code>./as.sh --stat-url &#39;http://192.168.10.11:8080/api/stat&#39;</code></p><p>在tunnel server里有一个示例的回报代码，用户可以自己在服务器上实现。</p><p><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/https://github.com/alibaba/arthas/blob/master/tunnel-server/src/main/java/com/alibaba/arthas/tunnel/server/app/web/StatController.java" target="_blank" rel="noopener noreferrer">StatController.java</a></p><h4 id="_2-4-10-其他特性" tabindex="-1"><a class="header-anchor" href="#_2-4-10-其他特性"><span>2.4.10 其他特性</span></a></h4><ul><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/async.md" target="_blank" rel="noopener noreferrer">异步命令支持</a></li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/save-log.md" target="_blank" rel="noopener noreferrer">执行结果存日志</a></li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/batch-support.md" target="_blank" rel="noopener noreferrer">批处理的支持</a></li><li><a href="https://github.com/alibaba/arthas/blob/master/site/src/site/sphinx/https://github.com/alibaba/arthas/issues/11" target="_blank" rel="noopener noreferrer">ognl表达式的用法说明</a></li></ul><h2 id="_3-arthas场景实战" tabindex="-1"><a class="header-anchor" href="#_3-arthas场景实战"><span>3. Arthas场景实战</span></a></h2><h3 id="_3-1-查看最繁忙的线程-以及是否有阻塞情况发生" tabindex="-1"><a class="header-anchor" href="#_3-1-查看最繁忙的线程-以及是否有阻塞情况发生"><span>3.1 查看最繁忙的线程，以及是否有阻塞情况发生?</span></a></h3><blockquote><p>场景：我想看下查看最繁忙的线程，以及是否有阻塞情况发生? 常规查看线程，一般我们可以通过 top 等系统命令进行查看，但是那毕竟要很多个步骤，很麻烦。</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">thread</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -n</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 查看最繁忙的三个线程栈信息</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">thread</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 以直观的方式展现所有的线程情况</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">thread</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -b</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #找出当前阻塞其他线程的线程</span></span></code></pre></div><h3 id="_3-2-确认某个类是否已被系统加载" tabindex="-1"><a class="header-anchor" href="#_3-2-确认某个类是否已被系统加载"><span>3.2 确认某个类是否已被系统加载?</span></a></h3><blockquote><p>场景：我新写了一个类或者一个方法，我想知道新写的代码是否被部署了?</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 即可以找到需要的类全路径，如果存在的话</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sc</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span><span style="color:#98C379;--shiki-dark:#98C379;">MyServlet</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看这个某个类所有的方法</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sm</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看某个方法的信息，如果存在的话</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sm</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span><span style="color:#98C379;--shiki-dark:#98C379;"> testMethod</span></span></code></pre></div><h3 id="_3-3-如何查看一个class类的源码信息" tabindex="-1"><a class="header-anchor" href="#_3-3-如何查看一个class类的源码信息"><span>3.3 如何查看一个class类的源码信息?</span></a></h3><blockquote><p>场景：我新修改的内容在方法内部，而上一个步骤只能看到方法，这时候可以反编译看下源码</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 直接反编译出java 源代码，包含一此额外信息的</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">jad</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span></span></code></pre></div><h3 id="_3-4-重要-如何跟踪某个方法的返回值、入参" tabindex="-1"><a class="header-anchor" href="#_3-4-重要-如何跟踪某个方法的返回值、入参"><span>3.4 重要：如何跟踪某个方法的返回值、入参.... ?</span></a></h3><blockquote><p>场景：我想看下我新加的方法在线运行的参数和返回值?</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 同时监控入参，返回值，及异常</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">watch</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span><span style="color:#98C379;--shiki-dark:#98C379;"> testMethod</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;{params, returnObj, throwExp}&quot;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -x</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span></span></code></pre></div><p>具体看watch命令。</p><h3 id="_3-5-如何看方法调用栈的信息" tabindex="-1"><a class="header-anchor" href="#_3-5-如何看方法调用栈的信息"><span>3.5 如何看方法调用栈的信息?</span></a></h3><blockquote><p>场景：我想看下某个方法的调用栈的信息?</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">stack</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span><span style="color:#98C379;--shiki-dark:#98C379;"> testMethod</span></span></code></pre></div><p>运行此命令之后需要即时触发方法才会有响应的信息打印在控制台上</p><h3 id="_3-6-重要-找到最耗时的方法调用" tabindex="-1"><a class="header-anchor" href="#_3-6-重要-找到最耗时的方法调用"><span>3.6 重要：找到最耗时的方法调用?</span></a></h3><blockquote><p>场景：testMethod这个方法入口响应很慢，如何找到最耗时的子调用?</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行的时候每个子调用的运行时长，可以找到最耗时的子调用。</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">trace</span><span style="color:#98C379;--shiki-dark:#98C379;"> pdai.tech.servlet.TestMyServlet</span><span style="color:#98C379;--shiki-dark:#98C379;"> testMethod</span></span></code></pre></div><p>运行此命令之后需要即时触发方法才会有响应的信息打印在控制台上，然后一层一层看子调用。</p><h3 id="_3-7-重要-如何临时更改代码运行" tabindex="-1"><a class="header-anchor" href="#_3-7-重要-如何临时更改代码运行"><span>3.7 重要：如何临时更改代码运行?</span></a></h3><blockquote><p>场景：我找到了问题所在，能否线上直接修改测试，而不需要在本地改了代码后，重新打包部署，然后重启观察效果?</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 先反编译出class源码</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">jad</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --source-only</span><span style="color:#98C379;--shiki-dark:#98C379;"> com.example.demo.arthas.user.UserController</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">/tmp/UserController.java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 然后使用外部工具编辑内容</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/UserController.java</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 再编译成class</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 最后，重新载入定义的类，就可以实时验证你的猜测了</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redefine</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/com/example/demo/arthas/user/UserController.class</span></span></code></pre></div><p>如上，是直接更改线上代码的方式，但是一般好像是编译不成功的。所以，最好是本地ide编译成 class文件后，再上传替换为好！</p><p>总之，已经完全不用重启和发布了！这个功能真的很方便，比起重启带来的代价，真的是不可比的。比如，重启时可能导致负载重分配，选主等等问题，就不是你能控制的了。</p><h3 id="_3-8-我如何测试某个方法的性能问题" tabindex="-1"><a class="header-anchor" href="#_3-8-我如何测试某个方法的性能问题"><span>3.8 我如何测试某个方法的性能问题?</span></a></h3><blockquote><p>场景：我想看下某个方法的性能</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">monitor</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#98C379;--shiki-dark:#98C379;"> demo.MathGame</span><span style="color:#98C379;--shiki-dark:#98C379;"> primeFactors</span></span></code></pre></div><h2 id="_4-arthas源码" tabindex="-1"><a class="header-anchor" href="#_4-arthas源码"><span>4. Arthas源码</span></a></h2><p>首先我们先放出一张整体宏观的模块调用图：</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942328.png" alt="image-20220827225837014" tabindex="0" loading="lazy"><figcaption>image-20220827225837014</figcaption></figure><p>源码理解可以看移步这两篇文章:</p><ul><li><a href="https://www.jianshu.com/p/70c1c55f12ef" target="_blank" rel="noopener noreferrer">什么是 Arthas</a></li><li><a href="https://yq.aliyun.com/articles/704228" target="_blank" rel="noopener noreferrer">Arthas阅读</a></li></ul><h2 id="_5-优秀案例" tabindex="-1"><a class="header-anchor" href="#_5-优秀案例"><span>5. 优秀案例</span></a></h2><ul><li><a href="https://github.com/alibaba/arthas/issues/1892" target="_blank" rel="noopener noreferrer">通过 Arthas Trace 命令将接口性能优化十倍</a></li><li><a href="https://github.com/alibaba/arthas/issues/1202" target="_blank" rel="noopener noreferrer">利用Arthas精准定位Java应用CPU负载过高问题</a></li><li><a href="https://github.com/alibaba/arthas/issues/1416" target="_blank" rel="noopener noreferrer">使用arthas+jprofiler做复杂链路分析</a></li><li><a href="https://github.com/alibaba/arthas/issues/729" target="_blank" rel="noopener noreferrer">Arthas实践：是哪个Controller处理了请求？</a></li><li><a href="https://hengyun.tech/arthas-spring-boot-404-401/" target="_blank" rel="noopener noreferrer">Arthas实践--快速排查Spring Boot应用404/401问题</a></li><li><a href="https://github.com/alibaba/arthas/issues/597" target="_blank" rel="noopener noreferrer">Arthas里 Trace 命令怎样工作的/ Trace命令的实现原理</a><ul><li>为什么有时候trace 是多层的</li></ul></li><li><a href="https://github.com/alibaba/arthas/issues/569" target="_blank" rel="noopener noreferrer">引发线程cpu占用率持续飙升的根因分析</a></li><li><a href="https://github.com/alibaba/arthas/issues/537#top" target="_blank" rel="noopener noreferrer">Arthas实践--jad/mc/redefine线上热更新一条龙</a></li><li><a href="https://github.com/alibaba/arthas/issues/434#top" target="_blank" rel="noopener noreferrer">watch/monitor/trace 等判断重载函数/同名函数</a></li><li><a href="https://github.com/alibaba/arthas/issues/160#top" target="_blank" rel="noopener noreferrer">利用Arthas排查Spring Boot应用NoSuchMethodError</a></li><li><a href="https://github.com/alibaba/arthas/issues/71#top" target="_blank" rel="noopener noreferrer">Arthas的一些特殊用法文档说明</a></li><li><a href="https://github.com/alibaba/arthas/issues/20#top" target="_blank" rel="noopener noreferrer">【Arthas问题排查集】谁调用了System.exit/System.gc?</a></li></ul><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h2><p><a href="https://pdai.tech/md/java/jvm/java-jvm-agent-arthas.html" target="_blank" rel="noopener noreferrer">调试排错 - Java 问题排查之应用在线调试Arthas</a></p>`,128)]))}const p=s(l,[["render",i],["__file","java-jvm-agent-arthas.html.vue"]]),c=JSON.parse('{"path":"/posts/Java/JavaJVM/java-jvm-agent-arthas.html","title":"调试排错 - Java 问题排查之应用在线调试Arthas","lang":"zh-CN","frontmatter":{"aliases":"调试排错 - Java 问题排查之应用在线调试Arthas","tags":null,"cssclass":null,"source":null,"order":280,"category":["Java","JVM"],"created":"2024-02-22 10:47","updated":"2024-03-12 09:43","description":"调试排错 - Java 问题排查之应用在线调试Arthas 1. Arthas简介 在学习Arthas之前，推荐先看上一篇美团技术团队的Java 动态调试技术原理及实践，这样你会对它最底层技术有个了解。可以看下文中最后有个对比图：Greys(Arthas也是基于它做的二次开发)和Java-debug-tool。 1.1 Arthas是什么 Arthas...","head":[["meta",{"property":"og:url","content":"https://mrjackc.github.io/posts/Java/JavaJVM/java-jvm-agent-arthas.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"调试排错 - Java 问题排查之应用在线调试Arthas"}],["meta",{"property":"og:description","content":"调试排错 - Java 问题排查之应用在线调试Arthas 1. Arthas简介 在学习Arthas之前，推荐先看上一篇美团技术团队的Java 动态调试技术原理及实践，这样你会对它最底层技术有个了解。可以看下文中最后有个对比图：Greys(Arthas也是基于它做的二次开发)和Java-debug-tool。 1.1 Arthas是什么 Arthas..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942249.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-21T07:03:09.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-21T07:03:09.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"调试排错 - Java 问题排查之应用在线调试Arthas\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942249.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942278.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942303.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403120942328.png\\"],\\"dateModified\\":\\"2024-10-21T07:03:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://mrjackc.github.io\\"}]}"]]},"headers":[{"level":2,"title":"1. Arthas简介","slug":"_1-arthas简介","link":"#_1-arthas简介","children":[{"level":3,"title":"1.1 Arthas是什么","slug":"_1-1-arthas是什么","link":"#_1-1-arthas是什么","children":[]},{"level":3,"title":"1.2 Arthas能解决什么问题","slug":"_1-2-arthas能解决什么问题","link":"#_1-2-arthas能解决什么问题","children":[]},{"level":3,"title":"1.3 Arthas资源推荐","slug":"_1-3-arthas资源推荐","link":"#_1-3-arthas资源推荐","children":[]},{"level":3,"title":"1.4 Arthas基于了哪些工具上发展而来","slug":"_1-4-arthas基于了哪些工具上发展而来","link":"#_1-4-arthas基于了哪些工具上发展而来","children":[]},{"level":3,"title":"1.5 同类工具有哪些","slug":"_1-5-同类工具有哪些","link":"#_1-5-同类工具有哪些","children":[]}]},{"level":2,"title":"2. Arthas入门","slug":"_2-arthas入门","link":"#_2-arthas入门","children":[{"level":3,"title":"2.1 Arthas 上手前","slug":"_2-1-arthas-上手前","link":"#_2-1-arthas-上手前","children":[]},{"level":3,"title":"2.2 Arthas 安装","slug":"_2-2-arthas-安装","link":"#_2-2-arthas-安装","children":[]},{"level":3,"title":"2.3 Arthas 官方案例展示","slug":"_2-3-arthas-官方案例展示","link":"#_2-3-arthas-官方案例展示","children":[]},{"level":3,"title":"2.4 Arthas 命令集","slug":"_2-4-arthas-命令集","link":"#_2-4-arthas-命令集","children":[]}]},{"level":2,"title":"3. Arthas场景实战","slug":"_3-arthas场景实战","link":"#_3-arthas场景实战","children":[{"level":3,"title":"3.1 查看最繁忙的线程，以及是否有阻塞情况发生?","slug":"_3-1-查看最繁忙的线程-以及是否有阻塞情况发生","link":"#_3-1-查看最繁忙的线程-以及是否有阻塞情况发生","children":[]},{"level":3,"title":"3.2 确认某个类是否已被系统加载?","slug":"_3-2-确认某个类是否已被系统加载","link":"#_3-2-确认某个类是否已被系统加载","children":[]},{"level":3,"title":"3.3 如何查看一个class类的源码信息?","slug":"_3-3-如何查看一个class类的源码信息","link":"#_3-3-如何查看一个class类的源码信息","children":[]},{"level":3,"title":"3.4 重要：如何跟踪某个方法的返回值、入参.... ?","slug":"_3-4-重要-如何跟踪某个方法的返回值、入参","link":"#_3-4-重要-如何跟踪某个方法的返回值、入参","children":[]},{"level":3,"title":"3.5 如何看方法调用栈的信息?","slug":"_3-5-如何看方法调用栈的信息","link":"#_3-5-如何看方法调用栈的信息","children":[]},{"level":3,"title":"3.6 重要：找到最耗时的方法调用?","slug":"_3-6-重要-找到最耗时的方法调用","link":"#_3-6-重要-找到最耗时的方法调用","children":[]},{"level":3,"title":"3.7 重要：如何临时更改代码运行?","slug":"_3-7-重要-如何临时更改代码运行","link":"#_3-7-重要-如何临时更改代码运行","children":[]},{"level":3,"title":"3.8 我如何测试某个方法的性能问题?","slug":"_3-8-我如何测试某个方法的性能问题","link":"#_3-8-我如何测试某个方法的性能问题","children":[]}]},{"level":2,"title":"4. Arthas源码","slug":"_4-arthas源码","link":"#_4-arthas源码","children":[]},{"level":2,"title":"5. 优秀案例","slug":"_5-优秀案例","link":"#_5-优秀案例","children":[]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"git":{"createdTime":1729494189000,"updatedTime":1729494189000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":13.72,"words":4117},"filePathRelative":"posts/Java/JavaJVM/java-jvm-agent-arthas.md","localizedDate":"2024年10月21日","excerpt":"\\n<h2>1. Arthas简介</h2>\\n<blockquote>\\n<p>在学习Arthas之前，推荐先看上一篇美团技术团队的<a href=\\"https://pdai.tech/md/java/jvm/java-jvm-agent-usage.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Java 动态调试技术原理及实践</a>，这样你会对它最底层技术有个了解。可以看下文中最后有个对比图：Greys(Arthas也是基于它做的二次开发)和Java-debug-tool。</p>\\n</blockquote>\\n<h3>1.1 Arthas是什么</h3>","autoDesc":true}');export{p as comp,c as data};
