import{_ as o,c as a,a as r,o as n}from"./app-4x2aIoqi.js";const t={};function d(i,e){return n(),a("div",null,e[0]||(e[0]=[r(`<h1 id="支付宝、微信退款接入" tabindex="-1"><a class="header-anchor" href="#支付宝、微信退款接入"><span>支付宝、微信退款接入</span></a></h1><h2 id="_0-概述" tabindex="-1"><a class="header-anchor" href="#_0-概述"><span><a href="https://doc.iocoder.cn/pay/refund-demo/#_0-%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>0. 概述</span></a></h2><p>在 <code>yudao-module-pay-biz</code> 模块的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/demo" target="_blank" rel="noopener noreferrer"><code>demo</code> (opens new window)</a>模块，我们提供了一个 <strong>退款</strong> 接入的示例，它已支持支付宝、微信的所有退款方式。</p><p>下面，我们以 <code>demo</code> 模块为例子，讲解如何接入退款。</p><h2 id="_1-第一步-创建支付订单" tabindex="-1"><a class="header-anchor" href="#_1-第一步-创建支付订单"><span><a href="https://doc.iocoder.cn/pay/refund-demo/#_1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%88%9B%E5%BB%BA%E6%94%AF%E4%BB%98%E8%AE%A2%E5%8D%95" target="_blank" rel="noopener noreferrer">#</a>1. 第一步，创建支付订单</span></a></h2><p>① 如果你是看支付宝退款接入，则需要先看完 <a href="https://doc.iocoder.cn/pay/alipay-pay-demo/" target="_blank" rel="noopener noreferrer">《支付宝支付接入》</a> 文档</p><p>② 如果你是看微信退款接入，则需要先看完 <a href="https://doc.iocoder.cn/pay/wx-pub-pay-demo/" target="_blank" rel="noopener noreferrer">《微信小程序支付接入》</a> 或 <a href="https://doc.iocoder.cn/pay/wx-pub-pay-demo/" target="_blank" rel="noopener noreferrer">《微信公众号支付接入》</a> 文档</p><p>③ 然后，我们在 [支付管理 -&gt; 接入示例] 菜单，可以看到一个可以“发起退款”的订单。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/支付手册/退款接入/发起退款.png" alt="“发起退款”" tabindex="0" loading="lazy"><figcaption>“发起退款”</figcaption></figure><h2 id="_2-第二步-实现退款调用【重要】" tabindex="-1"><a class="header-anchor" href="#_2-第二步-实现退款调用【重要】"><span><a href="https://doc.iocoder.cn/pay/refund-demo/#_2-%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%AE%9E%E7%8E%B0%E9%80%80%E6%AC%BE%E8%B0%83%E7%94%A8%E3%80%90%E9%87%8D%E8%A6%81%E3%80%91" target="_blank" rel="noopener noreferrer">#</a>2. 第二步，实现退款调用【重要】</span></a></h2><p>友情提示：由于 demo 模块的退款接入已经实现，这里你只要看懂什么意思即可，不用操作。</p><p>① 【后端】在 <code>demo</code> 模块所在的 <code>yudao-module-xx-biz</code> 模块的 <code>pom.xml</code> 文件，引入 <code>yudao-module-pay-api</code> 依赖，这样才可以调用到 PayOrderApi 接口。代码如下：</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;cn.iocoder.boot&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;yudao-module-pay-api&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;\${revision}&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>② 【后端】在 <code>demo</code> 模块的下单逻辑中，需要调用 PayRefundApi 的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/service/demo/PayDemoOrderServiceImpl.java#L190-L203" target="_blank" rel="noopener noreferrer"><code>#createRefund(...)</code> (opens new window)</a>方法，创建退款单。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/支付手册/退款接入/调用PayRefundApi.png" alt="调用 PayRefundApi" tabindex="0" loading="lazy"><figcaption>调用 PayRefundApi</figcaption></figure><h2 id="_3-第三步-实现回调接口【重要】" tabindex="-1"><a class="header-anchor" href="#_3-第三步-实现回调接口【重要】"><span><a href="https://doc.iocoder.cn/pay/refund-demo/#_3-%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%AE%9E%E7%8E%B0%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3%E3%80%90%E9%87%8D%E8%A6%81%E3%80%91" target="_blank" rel="noopener noreferrer">#</a>3. 第三步，实现回调接口【重要】</span></a></h2><p>友情提示：由于 demo 模块的退款接入已经实现，这里你只要看懂什么意思即可，不用操作。</p><p>在 <code>demo</code> 模块所在的 <code>yudao-module-xx-biz</code> 模块，实现一个支付回调的接口，提供给支付【中心】回调。对应的代码在 PayDemoOrderController 的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/demo/PayDemoOrderController.java#L68-L76" target="_blank" rel="noopener noreferrer"><code>#updateDemoOrderPaid(...)</code> (opens new window)</a>方法中，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/支付手册/退款接入/实现回调接口.png" alt="实现回调接口" tabindex="0" loading="lazy"><figcaption>实现回调接口</figcaption></figure><h2 id="_4-第四步-退款功能测试" tabindex="-1"><a class="header-anchor" href="#_4-第四步-退款功能测试"><span><a href="https://doc.iocoder.cn/pay/refund-demo/#_4-%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E9%80%80%E6%AC%BE%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95" target="_blank" rel="noopener noreferrer">#</a>4. 第四步，退款功能测试</span></a></h2><p>至此，我们已经完成了退款接入的所有步骤，接下来，我们来测试一下退款功能。</p><p>① 点击“发起退款”按钮，发起刚支付订单的退款流程。</p><figure><img src="https://doc.iocoder.cn/img/支付手册/退款接入/测试-发起退款.png" alt="发起退款" tabindex="0" loading="lazy"><figcaption>发起退款</figcaption></figure><p>此时，在 <code>pay_refund</code> 表中，会新增一条退款订单记录。</p><p>② 退款成功后，先是支付【中心】的回调接口被回调，然后是 <code>demo</code> 模块的回调接口被回调。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/支付手册/退款接入/测试-退款回调.png" alt="退款回调" tabindex="0" loading="lazy"><figcaption>退款回调</figcaption></figure><p>注意</p><ul><li>支付宝发起退款时，它是直接返回退款成功，所以它没有支付【中心】 PayNotifyController 的异步回调，只有 <code>demo</code> 模块的回调接口被回调。</li><li>微信发起退款时，它是可能返回退款成功，也可能返回退款处理中。微信退款是有支付【中心】 PayNotifyController 的异步回调，也有 <code>demo</code> 模块的回调接口被回调。</li></ul><p>至此，我们已经完成退款接入的测试流程，可以试着多多 debug 调试整个流程，并不复杂噢。</p><p>上次更新: 2023/07/17, 18:07:06</p>`,30)]))}const s=o(t,[["render",d],["__file","5.支付宝、微信退款接入.html.vue"]]),c=JSON.parse('{"path":"/posts/Java/Ruoyi-Vue-Pro/7.%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/5.%E6%94%AF%E4%BB%98%E5%AE%9D%E3%80%81%E5%BE%AE%E4%BF%A1%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5.html","title":"支付宝、微信退款接入","lang":"zh-CN","frontmatter":{"description":"支付宝、微信退款接入 #0. 概述 在 yudao-module-pay-biz 模块的 demo (opens new window)模块，我们提供了一个 退款 接入的示例，它已支持支付宝、微信的所有退款方式。 下面，我们以 demo 模块为例子，讲解如何接入退款。 #1. 第一步，创建支付订单 ① 如果你是看支付宝退款接入，则需要先看完 《支付宝支...","watermark":true,"head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/Java/Ruoyi-Vue-Pro/7.%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/5.%E6%94%AF%E4%BB%98%E5%AE%9D%E3%80%81%E5%BE%AE%E4%BF%A1%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"支付宝、微信退款接入"}],["meta",{"property":"og:description","content":"支付宝、微信退款接入 #0. 概述 在 yudao-module-pay-biz 模块的 demo (opens new window)模块，我们提供了一个 退款 接入的示例，它已支持支付宝、微信的所有退款方式。 下面，我们以 demo 模块为例子，讲解如何接入退款。 #1. 第一步，创建支付订单 ① 如果你是看支付宝退款接入，则需要先看完 《支付宝支..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E5%8F%91%E8%B5%B7%E9%80%80%E6%AC%BE.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-21T07:41:53.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-11-21T07:41:53.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"支付宝、微信退款接入\\",\\"image\\":[\\"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E5%8F%91%E8%B5%B7%E9%80%80%E6%AC%BE.png\\",\\"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E8%B0%83%E7%94%A8PayRefundApi.png\\",\\"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E5%AE%9E%E7%8E%B0%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3.png\\",\\"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E6%B5%8B%E8%AF%95-%E5%8F%91%E8%B5%B7%E9%80%80%E6%AC%BE.png\\",\\"https://doc.iocoder.cn/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%80%80%E6%AC%BE%E6%8E%A5%E5%85%A5/%E6%B5%8B%E8%AF%95-%E9%80%80%E6%AC%BE%E5%9B%9E%E8%B0%83.png\\"],\\"dateModified\\":\\"2024-11-21T07:41:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":2,"title":"#0. 概述","slug":"_0-概述","link":"#_0-概述","children":[]},{"level":2,"title":"#1. 第一步，创建支付订单","slug":"_1-第一步-创建支付订单","link":"#_1-第一步-创建支付订单","children":[]},{"level":2,"title":"#2. 第二步，实现退款调用【重要】","slug":"_2-第二步-实现退款调用【重要】","link":"#_2-第二步-实现退款调用【重要】","children":[]},{"level":2,"title":"#3. 第三步，实现回调接口【重要】","slug":"_3-第三步-实现回调接口【重要】","link":"#_3-第三步-实现回调接口【重要】","children":[]},{"level":2,"title":"#4. 第四步，退款功能测试","slug":"_4-第四步-退款功能测试","link":"#_4-第四步-退款功能测试","children":[]}],"git":{"createdTime":1732174913000,"updatedTime":1732174913000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":3.4,"words":1019},"filePathRelative":"posts/Java/Ruoyi-Vue-Pro/7.支付手册/5.支付宝、微信退款接入.md","localizedDate":"2024年11月21日","excerpt":"\\n<h2><a class=\\"header-anchor\\" href=\\"#_0-概述\\"><span></span></a><a href=\\"https://doc.iocoder.cn/pay/refund-demo/#_0-%E6%A6%82%E8%BF%B0\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">#</a>0. 概述</h2>\\n<p>在 <code>yudao-module-pay-biz</code> 模块的 <a href=\\"https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/demo\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\"><code>demo</code> (opens new window)</a>模块，我们提供了一个 <strong>退款</strong> 接入的示例，它已支持支付宝、微信的所有退款方式。</p>","autoDesc":true}');export{s as comp,c as data};
