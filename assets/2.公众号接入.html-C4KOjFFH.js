import{_ as o,c as n,a as r,o as a}from"./app-CpAF2rca.js";const t={};function i(E,e){return a(),n("div",null,e[0]||(e[0]=[r('<h1 id="公众号接入" tabindex="-1"><a class="header-anchor" href="#公众号接入"><span>公众号接入</span></a></h1><p>本章节，讲解如果将你的公众号，接入到系统中。步骤如下：</p><ul><li>第一步，申请公众号（可选）</li><li>第二步，在系统中，添加公众号账号</li><li>第三步，在公众号中，配置接入信息</li></ul><h2 id="_1-配置步骤" tabindex="-1"><a class="header-anchor" href="#_1-配置步骤"><span><a href="https://doc.iocoder.cn/mp/account/#_1-%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4" target="_blank" rel="noopener noreferrer">#</a>1. 配置步骤</span></a></h2><p>本小节，手把手教你如何将公众号接入到系统中。</p><h3 id="第一步-申请公众号-可选" tabindex="-1"><a class="header-anchor" href="#第一步-申请公众号-可选"><span><a href="https://doc.iocoder.cn/mp/account/#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E5%85%AC%E4%BC%97%E5%8F%B7-%E5%8F%AF%E9%80%89" target="_blank" rel="noopener noreferrer">#</a>第一步，申请公众号（可选）</span></a></h3><p>友情提示：如果你已经有公众号，可以忽略这一步。</p><p>① 如果你还没有公众号，可以申请一个测试帐号。</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/第一步-申请测试帐号.png" alt="申请测试账号" tabindex="0" loading="lazy"><figcaption>申请测试账号</figcaption></figure><p>申请地址：<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login" target="_blank" rel="noopener noreferrer">微信公众平台接口测试帐号申请(opens new window)</a></p><p>② 申请完成后，获得一个测试号。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/第一步-测试账号信息.png" alt="测试账号信息" tabindex="0" loading="lazy"><figcaption>测试账号信息</figcaption></figure><h3 id="第二步-添加公众号账号" tabindex="-1"><a class="header-anchor" href="#第二步-添加公众号账号"><span><a href="https://doc.iocoder.cn/mp/account/#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E6%B7%BB%E5%8A%A0%E5%85%AC%E4%BC%97%E5%8F%B7%E8%B4%A6%E5%8F%B7" target="_blank" rel="noopener noreferrer">#</a>第二步，添加公众号账号</span></a></h3><p>点击 [公众号管理 -&gt; 账号管理] 菜单，添加一个公众号账号。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/第二步-添加公众号账号.png" alt="添加公众号账号" tabindex="0" loading="lazy"><figcaption>添加公众号账号</figcaption></figure><h3 id="第三步-配置接入信息" tabindex="-1"><a class="header-anchor" href="#第三步-配置接入信息"><span><a href="https://doc.iocoder.cn/mp/account/#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E4%BF%A1%E6%81%AF" target="_blank" rel="noopener noreferrer">#</a>第三步，配置接入信息</span></a></h3><p>① 由于公众号通知需要外网地址，可参考 <a href="https://doc.iocoder.cn/natapp/" target="_blank" rel="noopener noreferrer">《内网穿透》</a> 文档，将本地的 48080 端口，转发到外网中。这里，我的域名是 <code>http://yunai.natapp1.cc</code>。</p><p>② 打开微信公众号界面，填写 URL 和 Token 信息。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/第三步-填写URL和Token.png" alt="填写 URL 和 Token 信息" tabindex="0" loading="lazy"><figcaption>填写 URL 和 Token 信息</figcaption></figure><p>点击提交后，看到“配置成功”提示，说明配置成功。</p><h2 id="_2-实现代码" tabindex="-1"><a class="header-anchor" href="#_2-实现代码"><span><a href="https://doc.iocoder.cn/mp/account/#_2-%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener noreferrer">#</a>2. 实现代码</span></a></h2><p>本小节，将介绍如何实现公众号接入的代码。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="https://doc.iocoder.cn/mp/account/#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">#</a>2.1 表结构</span></a></h3><p>公众号账号对应 <code>mp_account</code> 表，结构如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/表结构.png" alt="表结构" tabindex="0" loading="lazy"><figcaption>表结构</figcaption></figure><h3 id="_2-2-账号管理界面" tabindex="-1"><a class="header-anchor" href="#_2-2-账号管理界面"><span><a href="https://doc.iocoder.cn/mp/account/#_2-2-%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2" target="_blank" rel="noopener noreferrer">#</a>2.2 账号管理界面</span></a></h3><ul><li>前端：<a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-ui-admin/src/views/mp/account/index.vue" target="_blank" rel="noopener noreferrer">/@views/mp/account(opens new window)</a></li><li>后端：<a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/account/MpAccountController.java" target="_blank" rel="noopener noreferrer">MpAccountController(opens new window)</a></li></ul><h3 id="_2-3-配置接入回调" tabindex="-1"><a class="header-anchor" href="#_2-3-配置接入回调"><span><a href="https://doc.iocoder.cn/mp/account/#_2-3-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E5%9B%9E%E8%B0%83" target="_blank" rel="noopener noreferrer">#</a>2.3 配置接入回调</span></a></h3><p>在 <a href="https://doc.iocoder.cn/mp/account/#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E4%BF%A1%E6%81%AF" target="_blank" rel="noopener noreferrer">第三步，配置接入信息</a> 时，微信公众号会回调系统的 <code>GET /admin-api/mp/open/{appID}</code> 接口，进行接入配置的验证。对应 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L39-L57" target="_blank" rel="noopener noreferrer">MpOpenController (opens new window)</a>类的 <code>checkSignature</code> 方法，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/配置接入回调.png" alt="checkSignature 方法" tabindex="0" loading="lazy"><figcaption>checkSignature 方法</figcaption></figure><p>对应 <a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E7%A1%AE%E6%9D%A5%E8%87%AA%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener noreferrer">《微信公众号官方文档 —— 接入指南》 (opens new window)</a>文档。</p><p>友情提示：</p><p>项目使用的微信工具开发包是 <a href="https://github.com/Wechat-Group/WxJava/tree/develop/weixin-java-mp" target="_blank" rel="noopener noreferrer"><code>weixin-java-mp</code> (opens new window)</a>，超级好用！</p><h3 id="_2-4-消息处理" tabindex="-1"><a class="header-anchor" href="#_2-4-消息处理"><span><a href="https://doc.iocoder.cn/mp/account/#_2-4-%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86" target="_blank" rel="noopener noreferrer">#</a>2.4 消息处理</span></a></h3><p>配置接入完成后，用户发给公众号的消息，公众号都会回调到 <code>POST /admin-api/mp/open/{appID}</code> 接口，进行消息的处理。对应 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114" target="_blank" rel="noopener noreferrer">MpOpenController (opens new window)</a>类的 <code>handleMessage</code> 方法，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/消息处理.png" alt="handleMessage 方法" tabindex="0" loading="lazy"><figcaption>handleMessage 方法</figcaption></figure><p>核心逻辑是第二步，再解析到消息后，交给 WxMpMessageRouter 进行消息的处理。WxMpMessageRouter 在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114" target="_blank" rel="noopener noreferrer">DefaultMpServiceFactory (opens new window)</a>初始化，设置每种消息对应的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/" target="_blank" rel="noopener noreferrer"><code>handler</code> (opens new window)</a>处理器。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/公众号手册/公众号接入/消息处理器.png" alt="消息处理器" tabindex="0" loading="lazy"><figcaption>消息处理器</figcaption></figure><p>具体每个处理器的实现，后续每个章节单独详细讲解。</p><p>上次更新: 2023/07/10, 12:50:06</p>',40)]))}const c=o(t,[["render",i],["__file","2.公众号接入.html.vue"]]),l=JSON.parse('{"path":"/posts/Java/Ruoyi-Vue-Pro/8.%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/2.%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5.html","title":"公众号接入","lang":"zh-CN","frontmatter":{"description":"公众号接入 本章节，讲解如果将你的公众号，接入到系统中。步骤如下： 第一步，申请公众号（可选） 第二步，在系统中，添加公众号账号 第三步，在公众号中，配置接入信息 #1. 配置步骤 本小节，手把手教你如何将公众号接入到系统中。 #第一步，申请公众号（可选） 友情提示：如果你已经有公众号，可以忽略这一步。 ① 如果你还没有公众号，可以申请一个测试帐号。 ...","watermark":true,"head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/Java/Ruoyi-Vue-Pro/8.%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/2.%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"公众号接入"}],["meta",{"property":"og:description","content":"公众号接入 本章节，讲解如果将你的公众号，接入到系统中。步骤如下： 第一步，申请公众号（可选） 第二步，在系统中，添加公众号账号 第三步，在公众号中，配置接入信息 #1. 配置步骤 本小节，手把手教你如何将公众号接入到系统中。 #第一步，申请公众号（可选） 友情提示：如果你已经有公众号，可以忽略这一步。 ① 如果你还没有公众号，可以申请一个测试帐号。 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E6%B5%8B%E8%AF%95%E5%B8%90%E5%8F%B7.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-21T07:41:53.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-11-21T07:41:53.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"公众号接入\\",\\"image\\":[\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E6%B5%8B%E8%AF%95%E5%B8%90%E5%8F%B7.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E6%B5%8B%E8%AF%95%E8%B4%A6%E5%8F%B7%E4%BF%A1%E6%81%AF.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E6%B7%BB%E5%8A%A0%E5%85%AC%E4%BC%97%E5%8F%B7%E8%B4%A6%E5%8F%B7.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%A1%AB%E5%86%99URL%E5%92%8CToken.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E8%A1%A8%E7%BB%93%E6%9E%84.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E5%9B%9E%E8%B0%83.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86.png\\",\\"https://doc.iocoder.cn/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E5%99%A8.png\\"],\\"dateModified\\":\\"2024-11-21T07:41:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":2,"title":"#1. 配置步骤","slug":"_1-配置步骤","link":"#_1-配置步骤","children":[{"level":3,"title":"#第一步，申请公众号（可选）","slug":"第一步-申请公众号-可选","link":"#第一步-申请公众号-可选","children":[]},{"level":3,"title":"#第二步，添加公众号账号","slug":"第二步-添加公众号账号","link":"#第二步-添加公众号账号","children":[]},{"level":3,"title":"#第三步，配置接入信息","slug":"第三步-配置接入信息","link":"#第三步-配置接入信息","children":[]}]},{"level":2,"title":"#2. 实现代码","slug":"_2-实现代码","link":"#_2-实现代码","children":[{"level":3,"title":"#2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"#2.2 账号管理界面","slug":"_2-2-账号管理界面","link":"#_2-2-账号管理界面","children":[]},{"level":3,"title":"#2.3 配置接入回调","slug":"_2-3-配置接入回调","link":"#_2-3-配置接入回调","children":[]},{"level":3,"title":"#2.4 消息处理","slug":"_2-4-消息处理","link":"#_2-4-消息处理","children":[]}]}],"git":{"createdTime":1732174913000,"updatedTime":1732174913000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":4.18,"words":1255},"filePathRelative":"posts/Java/Ruoyi-Vue-Pro/8.公众号手册/2.公众号接入.md","localizedDate":"2024年11月21日","excerpt":"\\n<p>本章节，讲解如果将你的公众号，接入到系统中。步骤如下：</p>\\n<ul>\\n<li>第一步，申请公众号（可选）</li>\\n<li>第二步，在系统中，添加公众号账号</li>\\n<li>第三步，在公众号中，配置接入信息</li>\\n</ul>\\n<h2><a class=\\"header-anchor\\" href=\\"#_1-配置步骤\\"><span></span></a><a href=\\"https://doc.iocoder.cn/mp/account/#_1-%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">#</a>1. 配置步骤</h2>","autoDesc":true}');export{c as comp,l as data};
