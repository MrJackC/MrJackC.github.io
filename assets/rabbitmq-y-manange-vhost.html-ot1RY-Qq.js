import{_ as a,c as t,a as n,o as i}from"./app-tJW29Kmg.js";const o={};function e(r,s){return i(),t("div",null,s[0]||(s[0]=[n(`<h1 id="rabbitmq管理-多租户与权限-vhost" tabindex="-1"><a class="header-anchor" href="#rabbitmq管理-多租户与权限-vhost"><span>RabbitMQ管理 - 多租户与权限：vhost</span></a></h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介"><span>1. 简介</span></a></h2><p>每一个 RabbitMQ 服务器都能创建 <strong>虚拟的消息服务器</strong>，称之为 <strong>虚拟主机（virtual host）</strong>，简称 <strong>vhost</strong>。</p><p>vhost 本质上是一个独立的小型 RabbitMQ 服务器，拥有自己独立的队列、交换器、绑定关系等，并且 <strong>拥有自己独立的权限</strong>。</p><p>vhost 可避免队列和交换器等命名冲突，<strong>vhost 之间是绝对隔离的</strong>，无法将 vhost1 中的交换器与 vhost2 中的队列进行绑定，这样的机制既保证了安全性，又确保可移植性。</p><p>如果使用的 RabbitMQ 达到一定规模的时候，<strong>建议用户对业务功能、场景进行归类区分，并分配独立的 vhost</strong></p><p>vhost 是 AMQP 概念的基础，客户端在联机的时候 <strong>必须指定一个 vhost</strong>。RabbitMQ 默认创建的 vhost 为 <code>/</code>，使用默认的用户名 guest 和密码 guest 就可以访问它。但是为了安装和方便，建议重新建立一个新的用户来访问它。</p><h2 id="_2-创建-vhost-add-host" tabindex="-1"><a class="header-anchor" href="#_2-创建-vhost-add-host"><span>2. 创建 vhost：add_host</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> add_host</span><span style="color:#98C379;--shiki-dark:#98C379;"> {vhost}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 就是</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> 名称</span></span></code></pre></div><p>实践练习</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl add_vhost vhost1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Creating</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;vhost1&quot;</span></span></code></pre></div><h2 id="_3-vhost-查看-list-vhosts" tabindex="-1"><a class="header-anchor" href="#_3-vhost-查看-list-vhosts"><span>3. vhost 查看：list_vhosts</span></a></h2><p>查看 vhost 的相关信息</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> list_vhosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [vhostinfoitem...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhostinfoitem</span><span style="color:#98C379;--shiki-dark:#98C379;"> 参数：</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	name：</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> 名称</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	tracing：表示是否使用了</span><span style="color:#98C379;--shiki-dark:#98C379;"> RabbitMQ</span><span style="color:#98C379;--shiki-dark:#98C379;"> 的</span><span style="color:#98C379;--shiki-dark:#98C379;"> trace</span><span style="color:#98C379;--shiki-dark:#98C379;"> 功能。trace</span><span style="color:#98C379;--shiki-dark:#98C379;"> 功能</span><span style="color:#98C379;--shiki-dark:#98C379;"> RabbitMQ</span><span style="color:#98C379;--shiki-dark:#98C379;"> 扩展中讲解</span></span></code></pre></div><p>实践练习</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts name tracing</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">	false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span><span style="color:#D19A66;--shiki-dark:#D19A66;">	    false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 打开 trace 功能</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl trace_on</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Starting</span><span style="color:#98C379;--shiki-dark:#98C379;"> tracing</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts name tracing</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">	false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span><span style="color:#D19A66;--shiki-dark:#D19A66;">	    true</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 可以看到这里变成了 true</span></span></code></pre></div><h2 id="_4-删除-vhost-delete-host" tabindex="-1"><a class="header-anchor" href="#_4-删除-vhost-delete-host"><span>4. 删除 vhost：delete_host</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> delete_host</span><span style="color:#98C379;--shiki-dark:#98C379;"> {vhost}</span></span></code></pre></div><p>删除一个 vhost ，同时也会删除下面的队列、交换器、绑定关系、用户权限、参数和策略等信息。</p><p>实践练习</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl delete_vhost vhost1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Deleting</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;vhost1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span></span></code></pre></div><h2 id="_5-权限授予-set-permissions" tabindex="-1"><a class="header-anchor" href="#_5-权限授予-set-permissions"><span>5. 权限授予：set_permissions</span></a></h2><p>AMQP 协议中并没有指定权限在 vhost 级别还是在服务器级别实现，由具体的应用自定义。</p><p>在 RabbitMQ 中，权限以 vhost 为单位。在 <strong>创建一个用户时</strong>，用户通常会被 <strong>指派给至少一个 vhost</strong>，意味着该用户只能访问被指派的 vhost 内的资源。</p><p>授予权限命令为</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> set_permissions</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-p </span><span style="color:#98C379;--shiki-dark:#98C379;">vhost]</span><span style="color:#98C379;--shiki-dark:#98C379;"> {user}</span><span style="color:#98C379;--shiki-dark:#98C379;"> {conf}</span><span style="color:#98C379;--shiki-dark:#98C379;"> {write}</span><span style="color:#98C379;--shiki-dark:#98C379;"> {read}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">参数含义：</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-p</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">：给哪一个</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> 授权用户访问权限</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user：给哪一个用户指定权限</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> conf：</span><span style="color:#98C379;--shiki-dark:#98C379;"> 用于匹配用户在哪些资源上拥有可配置权限的正则表达式；指：队列和交换器的创建及删除之类的操作</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> write：用于匹配用户在哪些资源上拥有可写权限的正则表达式；指：发布消息</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> read</span><span style="color:#98C379;--shiki-dark:#98C379;">：</span><span style="color:#98C379;--shiki-dark:#98C379;"> 用于匹配用户在哪些资源上拥有可读权限的正则表达式；指：与消息有关的操作，包括读取消息及清空整个队列等</span></span></code></pre></div><p>下表展示了不同 AMQP 命令的列表和对应的权限</p><table><thead><tr><th>AMQP 命令</th><th>可配置</th><th>可写</th><th>可读</th></tr></thead><tbody><tr><td><code>Exchange.Declare</code></td><td>exchange</td><td></td><td></td></tr><tr><td><code>Exchange.Declare(with AE)</code></td><td>exchange</td><td>exchange(AE)</td><td>exchange</td></tr><tr><td><code>Exchange.Delete</code></td><td>exchange</td><td></td><td></td></tr><tr><td><code>Queue.Declare</code></td><td>queue</td><td></td><td></td></tr><tr><td><code>Queue.Declare(with DLX)</code></td><td>queue</td><td>exchange(DLX)</td><td>queue</td></tr><tr><td><code>Queue.Delete</code></td><td>queue</td><td></td><td></td></tr><tr><td><code>Exchange.Bind</code></td><td></td><td>exchange(destination)</td><td>exchange(source)</td></tr><tr><td><code>Exchange.Unbind</code></td><td></td><td>exchange(destination)</td><td>exchange(source)</td></tr><tr><td><code>Queue.Bind</code></td><td></td><td>queue</td><td>exchange</td></tr><tr><td><code>Queue.Unbind</code></td><td></td><td>queue</td><td>exchange</td></tr><tr><td><code>Basic.Publish</code></td><td></td><td>exchange</td><td></td></tr><tr><td><code>Basic.Get</code></td><td></td><td></td><td>queue</td></tr><tr><td><code>Basic.Consume</code></td><td></td><td></td><td>queue</td></tr><tr><td><code>Queue.Purge</code></td><td></td><td></td><td>queue</td></tr></tbody></table><p>实践练习：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 示例 1. 授予 admin 用户可访问虚拟主机 vhost1，并且在所有资源上都具备可配置、可写、可读的权限</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 	 前提是 vhost 要存在</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl set_permissions -p vhost1 admin </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;.*&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;.*&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;.*&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Setting</span><span style="color:#98C379;--shiki-dark:#98C379;"> permissions</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;admin&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;vhost1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 示例 2. 授予 admin 可访问虚拟主机 vhost2，在 queue 开头的资源上具备可配置权限，并在所有资源上拥有可写、可读权限</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl set_permissions -p vhost2 admin </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;^queue.*&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;.*&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;.*&quot;</span></span></code></pre></div><h2 id="_6-vhost-权限查看-list-permissions" tabindex="-1"><a class="header-anchor" href="#_6-vhost-权限查看-list-permissions"><span>6. vhost 权限查看：list_permissions</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> list_permissions</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-p </span><span style="color:#98C379;--shiki-dark:#98C379;">vhost]</span></span></code></pre></div><p>查看虚拟主机上的权限</p><p>实践练习：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_permissions -p vhost1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> permissions</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;vhost1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">admin</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span></code></pre></div><h2 id="_7-用户权限查看-list-user-permissions" tabindex="-1"><a class="header-anchor" href="#_7-用户权限查看-list-user-permissions"><span>7. 用户权限查看：list_user_permissions</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> list_user_permissions</span><span style="color:#98C379;--shiki-dark:#98C379;"> {username}</span></span></code></pre></div><p>显示用户权限</p><p>实践练习：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_user_permissions admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> permissions</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;admin&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span><span style="color:#98C379;--shiki-dark:#98C379;">		.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">	.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span></code></pre></div><h2 id="_8-清除权限-clear-permissions" tabindex="-1"><a class="header-anchor" href="#_8-清除权限-clear-permissions"><span>8. 清除权限：clear_permissions</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> clear_permissions</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-p </span><span style="color:#98C379;--shiki-dark:#98C379;">vhost]</span><span style="color:#98C379;--shiki-dark:#98C379;"> {username}</span></span></code></pre></div><p>实践练习</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl clear_permissions -p vhost1 admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Clearing</span><span style="color:#98C379;--shiki-dark:#98C379;"> permissions</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;admin&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhost</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;vhost1&quot;</span></span></code></pre></div><h2 id="_9-rabbitmqctl-标准语法" tabindex="-1"><a class="header-anchor" href="#_9-rabbitmqctl-标准语法"><span>9. rabbitmqctl 标准语法</span></a></h2><p>上述讲到的管理功能都是通过 rabbitmqctl 来操作的。它通过 <strong>连接各个 RabbitMQ 节点来执行所有操作</strong>。</p><p>如果有节点没有运行，将显示诊断信息：不能到达或因不匹配的 Erlang cookie（后续章节：RabbitMQ 运维中讲解）而拒绝连接。</p><p>标准语法如下：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-n </span><span style="color:#98C379;--shiki-dark:#98C379;">node]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-t </span><span style="color:#98C379;--shiki-dark:#98C379;">timeout]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [-q] {</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">command</span><span style="color:#98C379;--shiki-dark:#98C379;">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command </span><span style="color:#98C379;--shiki-dark:#98C379;">options...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">参数说明：</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	-n</span><span style="color:#98C379;--shiki-dark:#98C379;"> node：默认节点是「rabbit@hostname」,</span><span style="color:#98C379;--shiki-dark:#98C379;"> hostname</span><span style="color:#98C379;--shiki-dark:#98C379;"> 是主机名称。</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		     在一个名为「node.hidden.com」的主机上，RabbitMQ</span><span style="color:#98C379;--shiki-dark:#98C379;"> 节点的名称通常是</span><span style="color:#98C379;--shiki-dark:#98C379;"> rabbit@node</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (除非是 </span><span style="color:#98C379;--shiki-dark:#98C379;">RABBITMQ_NODENAME</span><span style="color:#98C379;--shiki-dark:#98C379;"> 参数在启动时被设置了自定义的值</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		     在</span><span style="color:#98C379;--shiki-dark:#98C379;"> linux</span><span style="color:#98C379;--shiki-dark:#98C379;"> 指令的</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hostname</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 下，通常输出的就是</span><span style="color:#98C379;--shiki-dark:#98C379;"> @</span><span style="color:#98C379;--shiki-dark:#98C379;"> 后面的信息</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	-t</span><span style="color:#98C379;--shiki-dark:#98C379;"> timeout：操作超时时间，单位是秒。只适用于</span><span style="color:#98C379;--shiki-dark:#98C379;"> list_xxx</span><span style="color:#98C379;--shiki-dark:#98C379;"> 类型的命令，默认无超时</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	-q：启用</span><span style="color:#98C379;--shiki-dark:#98C379;"> quiet</span><span style="color:#98C379;--shiki-dark:#98C379;"> 模式，可以屏蔽一些消息的输出。默认不开启</span></span></code></pre></div><p>实践练习：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 演示 -q 和 -t timeout 的效果</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Listing</span><span style="color:#98C379;--shiki-dark:#98C379;"> vhosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts -q</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				# 使用 -q 看到这里少了一列 vhosts 的输出</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts -q -t 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vhost1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@study ~]# rabbitmqctl list_vhosts -q -t 0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Error:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {timeout,0.0}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这里可以看到超时信息了</span></span></code></pre></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h2><p><a href="https://zq99299.github.io/mq-tutorial/rabbitmq-ac/05/01.html" target="_blank" rel="noopener noreferrer">多租户与权限：vhost</a></p>`,53)]))}const p=a(o,[["render",e],["__file","rabbitmq-y-manange-vhost.html.vue"]]),d=JSON.parse('{"path":"/posts/MiddleWare/MQ_Rabbitmq/rabbitmq-y-manange-vhost.html","title":"RabbitMQ管理 - 多租户与权限：vhost","lang":"zh-CN","frontmatter":{"order":410,"category":["RabbitMQ","MQ"],"created":"2024-10-26 09:41","updated":"2024-10-26 09:48","description":"RabbitMQ管理 - 多租户与权限：vhost 1. 简介 每一个 RabbitMQ 服务器都能创建 虚拟的消息服务器，称之为 虚拟主机（virtual host），简称 vhost。 vhost 本质上是一个独立的小型 RabbitMQ 服务器，拥有自己独立的队列、交换器、绑定关系等，并且 拥有自己独立的权限。 vhost 可避免队列和交换器等命...","head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/MiddleWare/MQ_Rabbitmq/rabbitmq-y-manange-vhost.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"RabbitMQ管理 - 多租户与权限：vhost"}],["meta",{"property":"og:description","content":"RabbitMQ管理 - 多租户与权限：vhost 1. 简介 每一个 RabbitMQ 服务器都能创建 虚拟的消息服务器，称之为 虚拟主机（virtual host），简称 vhost。 vhost 本质上是一个独立的小型 RabbitMQ 服务器，拥有自己独立的队列、交换器、绑定关系等，并且 拥有自己独立的权限。 vhost 可避免队列和交换器等命..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T01:58:08.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-28T01:58:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RabbitMQ管理 - 多租户与权限：vhost\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-28T01:58:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":2,"title":"1. 简介","slug":"_1-简介","link":"#_1-简介","children":[]},{"level":2,"title":"2. 创建 vhost：add_host","slug":"_2-创建-vhost-add-host","link":"#_2-创建-vhost-add-host","children":[]},{"level":2,"title":"3. vhost 查看：list_vhosts","slug":"_3-vhost-查看-list-vhosts","link":"#_3-vhost-查看-list-vhosts","children":[]},{"level":2,"title":"4. 删除 vhost：delete_host","slug":"_4-删除-vhost-delete-host","link":"#_4-删除-vhost-delete-host","children":[]},{"level":2,"title":"5. 权限授予：set_permissions","slug":"_5-权限授予-set-permissions","link":"#_5-权限授予-set-permissions","children":[]},{"level":2,"title":"6. vhost 权限查看：list_permissions","slug":"_6-vhost-权限查看-list-permissions","link":"#_6-vhost-权限查看-list-permissions","children":[]},{"level":2,"title":"7. 用户权限查看：list_user_permissions","slug":"_7-用户权限查看-list-user-permissions","link":"#_7-用户权限查看-list-user-permissions","children":[]},{"level":2,"title":"8. 清除权限：clear_permissions","slug":"_8-清除权限-clear-permissions","link":"#_8-清除权限-clear-permissions","children":[]},{"level":2,"title":"9. rabbitmqctl 标准语法","slug":"_9-rabbitmqctl-标准语法","link":"#_9-rabbitmqctl-标准语法","children":[]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"git":{"createdTime":1730080688000,"updatedTime":1730080688000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":4.48,"words":1345},"filePathRelative":"posts/MiddleWare/MQ_Rabbitmq/rabbitmq-y-manange-vhost.md","localizedDate":"2024年10月28日","excerpt":"\\n<h2>1. 简介</h2>\\n<p>每一个 RabbitMQ 服务器都能创建 <strong>虚拟的消息服务器</strong>，称之为 <strong>虚拟主机（virtual host）</strong>，简称 <strong>vhost</strong>。</p>\\n<p>vhost 本质上是一个独立的小型 RabbitMQ 服务器，拥有自己独立的队列、交换器、绑定关系等，并且 <strong>拥有自己独立的权限</strong>。</p>\\n<p>vhost 可避免队列和交换器等命名冲突，<strong>vhost 之间是绝对隔离的</strong>，无法将 vhost1 中的交换器与 vhost2 中的队列进行绑定，这样的机制既保证了安全性，又确保可移植性。</p>","autoDesc":true}');export{p as comp,d as data};
