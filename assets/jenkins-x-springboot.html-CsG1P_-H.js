import{_ as a,c as n,a as i,o as l}from"./app-W9QyTiMU.js";const p={};function e(r,s){return l(),n("div",null,s[0]||(s[0]=[i(`<h1 id="jenkins使用jenkinsfile部署springboot项目" tabindex="-1"><a class="header-anchor" href="#jenkins使用jenkinsfile部署springboot项目"><span>Jenkins使用jenkinsfile部署springboot项目</span></a></h1><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景"><span>1. 背景</span></a></h2><p>jenkinsfile的文件通用性更强，可以方便的复制到各个项目</p><h2 id="_2-创建任务" tabindex="-1"><a class="header-anchor" href="#_2-创建任务"><span>2. 创建任务</span></a></h2><p>创建的时候选择：流水线</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404231031453.png" alt="image-20210919194741168" tabindex="0" loading="lazy"><figcaption>image-20210919194741168</figcaption></figure><h2 id="_3-部署文件jenkinsfile代码" tabindex="-1"><a class="header-anchor" href="#_3-部署文件jenkinsfile代码"><span>3. 部署文件jenkinsfile代码</span></a></h2><p>在项目根目录下建：jenkinsfile文件</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!groovy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">@Library(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;jenkinslib&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> color</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> new</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.devops.color</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> build</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> new</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.devops.build</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> deploy</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> new</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.devops.deploy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> systemtime</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> new</span><span style="color:#98C379;--shiki-dark:#98C379;"> org.devops.systemtime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> String</span><span style="color:#98C379;--shiki-dark:#98C379;"> isDeploy</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">isDeploy</span><span style="color:#98C379;--shiki-dark:#98C379;">}&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//目标服务器ip和路径，根据实际情况修改</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> String</span><span style="color:#98C379;--shiki-dark:#98C379;"> serverIp</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;192.168.0.1&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> String</span><span style="color:#98C379;--shiki-dark:#98C379;"> targetPath</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/home/myproject&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//部署包的简称，根据实际情况修改</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> artifactShortName</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;MYAPP_SERVER&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> String</span><span style="color:#98C379;--shiki-dark:#98C379;"> releaseVersion</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">releaseVersion</span><span style="color:#98C379;--shiki-dark:#98C379;">}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pipeline</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    agent</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        node</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            label</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;master&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    options</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        buildDiscarder(logRotator(numToKeepStr:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;10&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        disableConcurrentBuilds</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    triggers</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        cron</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;H 22 * * *&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    parameters</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        string</span><span style="color:#98C379;--shiki-dark:#98C379;"> defaultValue:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;0.10.0&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> description:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;请输入本次构建的前三段版本号&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;releaseVersion&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> trim:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        choice</span><span style="color:#98C379;--shiki-dark:#98C379;"> choices:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;是&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;否&#39;],</span><span style="color:#98C379;--shiki-dark:#98C379;"> description:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;是否要发布到服务器，默认发布&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;isDeploy&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    stages</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        stage(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;Mvn Build&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            steps</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                script</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    color.PrintMes(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;开始打包&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;green&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    build.Build(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;mvn&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;mvn clean package&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;master&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    //默认为jdk8</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">            post</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                success</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                    wrap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">([</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;BuildUser&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]) </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                        script</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            currentTime</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> systemtime.GetSysTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;yyMMdd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            //部署包是jar还是war，以及路径要根据实际情况修改</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot;cd my-admin/target</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">//                                cp my-admin.jar \${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">artifactShortName</span><span style="color:#98C379;--shiki-dark:#98C379;">}-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">releaseVersion</span><span style="color:#98C379;--shiki-dark:#98C379;">}-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">GIT_COMMIT</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">take</span><span style="color:#98C379;--shiki-dark:#98C379;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">8</span><span style="color:#98C379;--shiki-dark:#98C379;">)}-BETA-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">currentTime</span><span style="color:#98C379;--shiki-dark:#98C379;">}.jar</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">//                            &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            //根据实际情况修改制品路径和名称，这个是用来把包提取到jenkins页面，给测试下载的</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            archiveArtifacts</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;my-admin/target/*.jar&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                            currentBuild.description</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Start By \${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">BUILD_USER</span><span style="color:#98C379;--shiki-dark:#98C379;">} And Build Success&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                        }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">                }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        stage(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;archive&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            steps</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                script</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    color.PrintMes(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;开始压缩&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;green&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    currentTime</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> systemtime.GetSysTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;yyMMdd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    //部署包是jar还是war，以及路径要根据实际情况修改</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot; rm -rf archive&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot; mkdir archive &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot; cp my-admin/target/*.jar archive &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot; cp doc/版本更新说明.md archive &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sh</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot; tar -zcvf \${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">artifactShortName</span><span style="color:#98C379;--shiki-dark:#98C379;">}-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">releaseVersion</span><span style="color:#98C379;--shiki-dark:#98C379;">}-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">GIT_COMMIT</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">take</span><span style="color:#98C379;--shiki-dark:#98C379;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">8</span><span style="color:#98C379;--shiki-dark:#98C379;">)}-BETA-\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">currentTime</span><span style="color:#98C379;--shiki-dark:#98C379;">}.tar.gz archive &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    //根据实际情况修改制品路径和名称，这个是用来把包提取到jenkins页面，给测试下载的</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    archiveArtifacts</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*.tar.gz&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    currentBuild.description</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Start By \${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">env</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">BUILD_USER</span><span style="color:#98C379;--shiki-dark:#98C379;">} And Build Success&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        stage(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;Deploy App&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            when</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                expression</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (isDeploy </span><span style="color:#98C379;--shiki-dark:#98C379;">==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;是&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            steps</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                script</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    color.PrintMes(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;自动发布&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;green&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    deployCommand</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;&quot;cd /home/myproject/ &amp;&amp; sh deploy.sh restart&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    deploy.Publish(serverIp,</span><span style="color:#98C379;--shiki-dark:#98C379;"> deployCommand,</span><span style="color:#98C379;--shiki-dark:#98C379;"> targetPath,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;my-admin/target/my-admin.jar&#39;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;my-admin/target&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-项目启动脚本" tabindex="-1"><a class="header-anchor" href="#_4-项目启动脚本"><span>4. 项目启动脚本</span></a></h2><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># author ygn</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./deploy.sh start 启动</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./deploy.sh stop 停止</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./deploy.sh restart 重启</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./deploy.sh status 状态</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">AppName</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">my-admin.jar</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># JVM参数</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">JVM_OPTS</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;-Dname=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;">  -Duser.timezone=Asia/Shanghai -Xms512M -Xmx512M -XX:PermSize=256M -XX:MaxPermSize=512M -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintGCDateStamps  -XX:+PrintGCDetails -XX:NewRatio=1 -XX:SurvivorRatio=30 -XX:+UseParallelGC -XX:+UseParallelOldGC&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">APP_HOME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">pwd</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">LOG_PATH</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$APP_HOME</span><span style="color:#98C379;--shiki-dark:#98C379;">/logs/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;">.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ];</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    echo</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;\\033[0;31m 未输入操作名 \\033[0m  \\033[0;34m {start|stop|restart|status} \\033[0m&quot;</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    exit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ];</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    echo</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;\\033[0;31m 未输入应用名 \\033[0m&quot;</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    exit</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    PID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ps</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $AppName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -v</span><span style="color:#98C379;--shiki-dark:#98C379;"> grep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">awk</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;{print $2}&#39;\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PID</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">	    echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> is running...&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	else</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">	  echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;启动完整命令： nohup java -jar  </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$JVM_OPTS</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> --spring.profiles.active=prod &gt; /dev/null 2&gt;&amp;1 &amp;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		nohup</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -jar</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  $JVM_OPTS</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $AppName</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --spring.profiles.active=prod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">/dev/null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		sleep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		status</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	fi</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> stop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">    echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Stop </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	PID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	query</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		PID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ps</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $AppName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -v</span><span style="color:#98C379;--shiki-dark:#98C379;"> grep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">awk</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;{print $2}&#39;\`</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PID</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">		kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -TERM</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $PID</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">		echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> (pid:</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PID</span><span style="color:#98C379;--shiki-dark:#98C379;">) exiting...&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PID</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> x</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		do</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">			sleep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">			query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		done</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">		echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> exited.&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	else</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">		echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> already stopped.&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	fi</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    stop</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    sleep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    start</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    PID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ps</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $AppName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -v</span><span style="color:#98C379;--shiki-dark:#98C379;"> grep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wc</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -l</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ];</span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> is running...&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    else</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$AppName</span><span style="color:#98C379;--shiki-dark:#98C379;"> is not running...&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    fi</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">case</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    stop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    stop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    *)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">esac</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11)]))}const k=a(p,[["render",e],["__file","jenkins-x-springboot.html.vue"]]),c=JSON.parse('{"path":"/posts/MiddleWare/Jenkins/jenkins-x-springboot.html","title":"Jenkins使用jenkinsfile部署springboot项目","lang":"zh-CN","frontmatter":{"description":"Jenkins使用jenkinsfile部署springboot项目 1. 背景 jenkinsfile的文件通用性更强，可以方便的复制到各个项目 2. 创建任务 创建的时候选择：流水线 image-20210919194741168image-20210919194741168 3. 部署文件jenkinsfile代码 在项目根目录下建：jenkin...","head":[["meta",{"property":"og:url","content":"https://mrjackc.github.io/posts/MiddleWare/Jenkins/jenkins-x-springboot.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"Jenkins使用jenkinsfile部署springboot项目"}],["meta",{"property":"og:description","content":"Jenkins使用jenkinsfile部署springboot项目 1. 背景 jenkinsfile的文件通用性更强，可以方便的复制到各个项目 2. 创建任务 创建的时候选择：流水线 image-20210919194741168image-20210919194741168 3. 部署文件jenkinsfile代码 在项目根目录下建：jenkin..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404231031453.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T01:58:08.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-28T01:58:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Jenkins使用jenkinsfile部署springboot项目\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404231031453.png\\"],\\"dateModified\\":\\"2024-10-28T01:58:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://mrjackc.github.io\\"}]}"]]},"headers":[{"level":2,"title":"1. 背景","slug":"_1-背景","link":"#_1-背景","children":[]},{"level":2,"title":"2. 创建任务","slug":"_2-创建任务","link":"#_2-创建任务","children":[]},{"level":2,"title":"3. 部署文件jenkinsfile代码","slug":"_3-部署文件jenkinsfile代码","link":"#_3-部署文件jenkinsfile代码","children":[]},{"level":2,"title":"4. 项目启动脚本","slug":"_4-项目启动脚本","link":"#_4-项目启动脚本","children":[]}],"git":{"createdTime":1730080688000,"updatedTime":1730080688000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":2.49,"words":746},"filePathRelative":"posts/MiddleWare/Jenkins/jenkins-x-springboot.md","localizedDate":"2024年10月28日","excerpt":"\\n<h2>1. 背景</h2>\\n<p>jenkinsfile的文件通用性更强，可以方便的复制到各个项目</p>\\n<h2>2. 创建任务</h2>\\n<p>创建的时候选择：流水线</p>\\n<figure><img src=\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404231031453.png\\" alt=\\"image-20210919194741168\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>image-20210919194741168</figcaption></figure>","autoDesc":true}');export{k as comp,c as data};
