import{_ as a,c as n,a as l,o as e}from"./app-BQBjlK2G.js";const i={};function o(r,s){return e(),n("div",null,s[0]||(s[0]=[l(`<h1 id="nginx-入门实战" tabindex="-1"><a class="header-anchor" href="#nginx-入门实战"><span>Nginx 入门实战</span></a></h1><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><blockquote><p>什么是nginx</p></blockquote><p>Nginx是一个高性能的HTTP和反向代理web服务器</p><blockquote><p>安装要求</p></blockquote><ul><li><p><code>linux</code>内核2.6及以上</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">uname</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span></span></code></pre></div></li><li><p>关闭防火墙</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 临时关闭防火墙</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span><span style="color:#98C379;--shiki-dark:#98C379;"> firewalld</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 永久关闭防火墙</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> disable</span><span style="color:#98C379;--shiki-dark:#98C379;"> firewalld</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看防火墙状态</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> status</span><span style="color:#98C379;--shiki-dark:#98C379;"> firewalld</span></span></code></pre></div></li></ul><h3 id="安装nginx" tabindex="-1"><a class="header-anchor" href="#安装nginx"><span>安装nginx</span></a></h3><h4 id="源码安装" tabindex="-1"><a class="header-anchor" href="#源码安装"><span>源码安装</span></a></h4><blockquote><p>创建文件夹</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mkdir</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">cd</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data</span></span></code></pre></div><blockquote><p>安装依赖</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> gcc</span><span style="color:#98C379;--shiki-dark:#98C379;"> pcre-devel</span><span style="color:#98C379;--shiki-dark:#98C379;"> zlib-devel</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssl-devel</span></span></code></pre></div><blockquote><p>下载nginx</p></blockquote><ul><li><p>官网下载<code>http://nginx.org/en/download.html</code></p></li><li><p>直接在服务器下载</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://nginx.org/download/nginx-1.22.0.tar.gz</span></span></code></pre></div></li></ul><blockquote><p>进行配置</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./configure</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--prefix=/usr/local/nginx </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--sbin-path=/usr/local/nginx/sbin/nginx </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--modules-path=/usr/local/nginx/modules </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--conf-path=/usr/local/nginx/conf/nginx.conf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--error-log-path=/usr/local/nginx/logs/error.log </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--http-log-path=/usr/local/nginx/logs/access.log </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">--pid-path=/usr/local/nginx/logs/nginx.pid</span></span></code></pre></div><ul><li><p>配置文件详解</p><table><thead><tr><th>--prefix=PATH</th><th>nginx安装目录，默认/uar/local/nginx</th></tr></thead><tbody><tr><td>--sbin-path=PATH</td><td>可执行文件路径，默认<code>&lt;prefix&gt;/sbin/nginx</code></td></tr><tr><td>--modules-path=PATH</td><td>动态模块的安装目录，默认<code>&lt;prefix&gt;/modules</code></td></tr><tr><td>--conf-path=PATH</td><td>配置文件路径，默认<code>&lt;prefix&gt;/conf/nginx.conf</code></td></tr><tr><td>--error-log-path=PATH</td><td>错误日志文件路径，默认<code>&lt;prefix&gt;/logs/error.log</code></td></tr><tr><td>--http-log-path=PATH</td><td>日志文件路径，默认<code>&lt;prefix&gt;/logs/access.log</code></td></tr><tr><td>--pid-path=PATH</td><td>进程id文件路径，默认<code>&lt;prefix&gt;/logs/nginx.pid</code></td></tr></tbody></table></li></ul><blockquote><p>进行安装</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span></span></code></pre></div><h4 id="yum安装" tabindex="-1"><a class="header-anchor" href="#yum安装"><span>yum安装</span></a></h4><blockquote><p>安装依赖</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum-utils</span></span></code></pre></div><blockquote><p>编辑配置文件</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/yum.repos.d/nginx.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[nginx-stable]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> stable</span><span style="color:#98C379;--shiki-dark:#98C379;"> repo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">baseurl</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">http://nginx.org/packages/centos/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$releasever</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$basearch</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gpgcheck</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">enabled</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gpgkey</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">module_hotfixes</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[nginx-mainline]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> mainline</span><span style="color:#98C379;--shiki-dark:#98C379;"> repo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">baseurl</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">http://nginx.org/packages/mainline/centos/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$releasever</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$basearch</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gpgcheck</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">enabled</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gpgkey</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">module_hotfixes</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>进行安装</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span></code></pre></div><blockquote><p>查看安装目录</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">whereis</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span></code></pre></div><h3 id="配置系统服务" tabindex="-1"><a class="header-anchor" href="#配置系统服务"><span>配置系统服务</span></a></h3><blockquote><p>编辑文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/lib/systemd/system/nginx.service</span></span></code></pre></div><blockquote><p>添加以下内容</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">Description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> web</span><span style="color:#98C379;--shiki-dark:#98C379;"> service</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">Documentation</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">http://nginx.org/en/docs/</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">After</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">Type</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">forking</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">PIDFile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/logs/nginx.pid</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ExecStartPre</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/sbin/nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> -t</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ExecStart</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/sbin/nginx</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ExecReload</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/sbin/nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> reload</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ExecStop</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/sbin/nginx</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">PrivateTmp</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">WantedBy</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">default.target</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置环境变量" tabindex="-1"><a class="header-anchor" href="#配置环境变量"><span>配置环境变量</span></a></h3><blockquote><p>编辑环境变量</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre></div><blockquote><p>最后一行添加以下内容</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> PATH</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$PATH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">usr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">local</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">nginx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">sbin</span></span></code></pre></div><blockquote><p>刷新环境变量</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">source</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre></div><h2 id="nginx操作" tabindex="-1"><a class="header-anchor" href="#nginx操作"><span>nginx操作</span></a></h2><h3 id="目录结构介绍" tabindex="-1"><a class="header-anchor" href="#目录结构介绍"><span>目录结构介绍</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> conf</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> mime.types</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> mime.types.default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx.conf</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx.conf.default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> html</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> 50x.html</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> index.html</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> logs</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> access.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> error.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx.pid</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> sbin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">│  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="kill信号操作" tabindex="-1"><a class="header-anchor" href="#kill信号操作"><span>kill信号操作</span></a></h3><blockquote><p>查看nginx进程</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ps</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span></code></pre></div><blockquote><p>立即关闭</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -term/int</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span></span></code></pre></div><blockquote><p>优雅地关闭</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -quit</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span></span></code></pre></div><blockquote><p>重新加载配置文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -hup</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span></span></code></pre></div><blockquote><p>重写日志文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -usr1</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span></span></code></pre></div><blockquote><p>平滑升级</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">kill</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -usr2</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span></span></code></pre></div><h3 id="nginx命令" tabindex="-1"><a class="header-anchor" href="#nginx命令"><span>nginx命令</span></a></h3><blockquote><p>查看帮助</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">?</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -h</span></span></code></pre></div><p>打印内容如下：</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Options:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -?,-h</span><span style="color:#98C379;--shiki-dark:#98C379;">         :</span><span style="color:#98C379;--shiki-dark:#98C379;"> this</span><span style="color:#98C379;--shiki-dark:#98C379;"> help</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -v</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> show</span><span style="color:#98C379;--shiki-dark:#98C379;"> version</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> exit</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -V</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> show</span><span style="color:#98C379;--shiki-dark:#98C379;"> version</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> configure</span><span style="color:#98C379;--shiki-dark:#98C379;"> options</span><span style="color:#98C379;--shiki-dark:#98C379;"> then</span><span style="color:#98C379;--shiki-dark:#98C379;"> exit</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -t</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> test</span><span style="color:#98C379;--shiki-dark:#98C379;"> configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> exit</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -T</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> test</span><span style="color:#98C379;--shiki-dark:#98C379;"> configuration,</span><span style="color:#98C379;--shiki-dark:#98C379;"> dump</span><span style="color:#98C379;--shiki-dark:#98C379;"> it</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> exit</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -q</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> suppress</span><span style="color:#98C379;--shiki-dark:#98C379;"> non-error</span><span style="color:#98C379;--shiki-dark:#98C379;"> messages</span><span style="color:#98C379;--shiki-dark:#98C379;"> during</span><span style="color:#98C379;--shiki-dark:#98C379;"> configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> testing</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> signal</span><span style="color:#98C379;--shiki-dark:#98C379;">     :</span><span style="color:#98C379;--shiki-dark:#98C379;"> send</span><span style="color:#98C379;--shiki-dark:#98C379;"> signal</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> a</span><span style="color:#98C379;--shiki-dark:#98C379;"> master</span><span style="color:#98C379;--shiki-dark:#98C379;"> process:</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop,</span><span style="color:#98C379;--shiki-dark:#98C379;"> quit,</span><span style="color:#98C379;--shiki-dark:#98C379;"> reopen,</span><span style="color:#98C379;--shiki-dark:#98C379;"> reload</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -p</span><span style="color:#98C379;--shiki-dark:#98C379;"> prefix</span><span style="color:#98C379;--shiki-dark:#98C379;">     :</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> prefix</span><span style="color:#98C379;--shiki-dark:#98C379;"> path</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/local/nginx/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> filename</span><span style="color:#98C379;--shiki-dark:#98C379;">   :</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> error</span><span style="color:#98C379;--shiki-dark:#98C379;"> log</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default: </span><span style="color:#98C379;--shiki-dark:#98C379;">logs/error.log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -c</span><span style="color:#98C379;--shiki-dark:#98C379;"> filename</span><span style="color:#98C379;--shiki-dark:#98C379;">   :</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default: </span><span style="color:#98C379;--shiki-dark:#98C379;">conf/nginx.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -g</span><span style="color:#98C379;--shiki-dark:#98C379;"> directives</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> global</span><span style="color:#98C379;--shiki-dark:#98C379;"> directives</span><span style="color:#98C379;--shiki-dark:#98C379;"> out</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span></span></code></pre></div><blockquote><p>查看版本号</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -v</span></span></code></pre></div><blockquote><p>查看版本号和安装时的配置信息</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -V</span></span></code></pre></div><blockquote><p>测试配置文件语法</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span></span></code></pre></div><blockquote><p>测试配置文件语法，如果成功则输出文件内容</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -T</span></span></code></pre></div><blockquote><p>发送信号</p></blockquote><ul><li><p>强制关闭，相当于<code>kill -term/int</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span></span></code></pre></div></li><li><p>优雅关闭，相当于<code>kill -quit</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> quit</span></span></code></pre></div></li><li><p>重新打开日志文件，相当于<code>kill -usr1</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> reopen</span></span></code></pre></div></li><li><p>重新加载配置文件，相当于<code>kill -hup</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> reload</span></span></code></pre></div></li></ul><h2 id="配置文件详解" tabindex="-1"><a class="header-anchor" href="#配置文件详解"><span>配置文件详解</span></a></h2><h3 id="全局块" tabindex="-1"><a class="header-anchor" href="#全局块"><span>全局块</span></a></h3><table><thead><tr><th>全局指令</th><th>可选值</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>user</td><td>用户名</td><td></td><td>指定用户</td></tr><tr><td>master_process</td><td>on/off</td><td>on</td><td>是否开启工作进程worker，配置完要重启nginx</td></tr><tr><td>worker_processes</td><td>数字</td><td></td><td>worker进程数量，建议配置成cpu的数量，master_process开启才有用</td></tr><tr><td>daemon</td><td>on/off</td><td>on</td><td>是否以守护进程方式启动</td></tr><tr><td>pid</td><td></td><td>logs/nginx.pid</td><td>pid路径</td></tr><tr><td>error_log</td><td></td><td></td><td>日志级别，debug、info、notice、warn、error、crit</td></tr><tr><td>include</td><td></td><td></td><td>引入配置文件</td></tr></tbody></table><h3 id="events块" tabindex="-1"><a class="header-anchor" href="#events块"><span>events块</span></a></h3><table><thead><tr><th>指令</th><th>可选值</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>worker_connections</td><td></td><td>512</td><td>单个worker进程最大连接数</td></tr><tr><td>accept_mutex</td><td>on/off</td><td>on</td><td>是否开启序列化，一个一个唤醒接收</td></tr><tr><td>multi_accept</td><td>on/off</td><td>off</td><td>是否允许同时接收多个网络连接</td></tr><tr><td>use</td><td>select/poll/epoll/kqueue</td><td>根据操作系统定</td><td>使用哪种事件驱动来处理网络消息</td></tr></tbody></table><h3 id="http块" tabindex="-1"><a class="header-anchor" href="#http块"><span>http块</span></a></h3><blockquote><p>default_type</p></blockquote><p>设置响应的MIME类型</p><p>语法：<code>default_type mime-type</code></p><p>默认：<code>default_type text/plain</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code></p><blockquote><p>access_log</p></blockquote><p>日志输出路径</p><p>语法：<code>access_log path [format]</code></p><p>默认：<code>logs/access.log</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code>, <code>if in location</code></p><blockquote><p>log_format</p></blockquote><p>日志格式化</p><p>语法：<code>log_format name value</code></p><p>作用域：<code>http</code></p><blockquote><p>sendfile</p></blockquote><p>底层使用<code>sendfile</code>发送文件</p><p>语法：<code>sendfile on|off</code></p><p>默认：<code>off</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code>,<code>if in location</code></p><blockquote><p>keepalive_timeout</p></blockquote><p>tcp长连接超时时间</p><p>语法：<code>keepalive_timeout timeout</code></p><p>默认：75，不写单位默认是s</p><p>作用域：<code>http</code>, <code>server</code>,<code>location</code></p><blockquote><p>keepalive_requests</p></blockquote><p>一个连接使用次数</p><p>语法：<code>keepalive_requests number</code></p><p>默认：100</p><p>作用域：<code>http</code>, <code>server</code>,<code>location</code></p><h3 id="server块" tabindex="-1"><a class="header-anchor" href="#server块"><span>server块</span></a></h3><blockquote><p>listen</p></blockquote><p>监听的端口</p><p>语法：<code>listen port</code></p><p>作用域：<code>server</code></p><blockquote><p>server_name</p></blockquote><p>监听当前的ip或域名</p><p>语法：<code>server_name name ...</code></p><p>作用域：<code>server</code></p><h3 id="location块" tabindex="-1"><a class="header-anchor" href="#location块"><span>location块</span></a></h3><h4 id="location" tabindex="-1"><a class="header-anchor" href="#location"><span>location</span></a></h4><blockquote><p>模糊匹配</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /aaa</span></span></code></pre></div><blockquote><p>精确匹配</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =/aaa</span></span></code></pre></div><blockquote><p>正则匹配（区分大小写）</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ~</span><span style="color:#E06C75;--shiki-dark:#E06C75;">^/aaa$</span></span></code></pre></div><blockquote><p>正则匹配（不区分大小写）</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ~*</span><span style="color:#E06C75;--shiki-dark:#E06C75;">^/aaa$</span></span></code></pre></div><p>注意：?后面的值不参与<code>location</code>匹配</p><h4 id="root" tabindex="-1"><a class="header-anchor" href="#root"><span>root</span></a></h4><p>资源文件目录，会拼上location的值，默认<code>root html</code></p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /aaa {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h4 id="alias" tabindex="-1"><a class="header-anchor" href="#alias"><span>alias</span></a></h4><p>资源文件目录</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        alias </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html/;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /aaa {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        alias </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>注意：如果location匹配值以/结尾，那么alias也要以/结尾</p><h4 id="index" tabindex="-1"><a class="header-anchor" href="#index"><span>index</span></a></h4><p>默认文件</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">index </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">index.htm index.html aaa.html bbb.html;</span></span></code></pre></div><h4 id="error-page" tabindex="-1"><a class="header-anchor" href="#error-page"><span>error_page</span></a></h4><p>页面发生错误时跳转的路径</p><blockquote><p>写法1</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">error_page </span><span style="color:#D19A66;--shiki-dark:#D19A66;">404</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> https://www.baidu.com</span></span></code></pre></div><blockquote><p>写法2</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">aaa;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    error_page </span><span style="color:#D19A66;--shiki-dark:#D19A66;">404</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @error;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @error {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 200</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;this is 404&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h4 id="try-files" tabindex="-1"><a class="header-anchor" href="#try-files"><span>try_files</span></a></h4><p>尝试着找文件</p><p>/1.html</p><p>/1.html/index.html</p><p>/index.html</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">try_files </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/ /index.html;</span></span></code></pre></div><p>尝试去找<code>$uri</code>这个文件，找不到<code>$uri</code>就去<code>$uri/</code>下的<code>index.html</code>文件，找不到就请求<code>/index.html</code></p><h3 id="解决跨域" tabindex="-1"><a class="header-anchor" href="#解决跨域"><span>解决跨域</span></a></h3><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">7089</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://localhost:8089;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      add_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Access-Control-Allow-Origin *;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      add_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Access-Control-Allow-Methods *;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="rewrite模块详解" tabindex="-1"><a class="header-anchor" href="#rewrite模块详解"><span>rewrite模块详解</span></a></h3><h4 id="常用全局变量" tabindex="-1"><a class="header-anchor" href="#常用全局变量"><span>常用全局变量</span></a></h4><table><thead><tr><th>变量</th><th>说明</th></tr></thead><tbody><tr><td>$args</td><td>变量中存放了请求URL中的请求参数。比如<a href="http://192.168.200.133/server?arg1=value1&amp;args2=value2%E4%B8%AD%E7%9A%84%22arg1=value1&amp;arg2=value2%22%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$query_string%E4%B8%80%E6%A0%B7" target="_blank" rel="noopener noreferrer">http://192.168.200.133/server?arg1=value1&amp;args2=value2中的&quot;arg1=value1&amp;arg2=value2&quot;，功能和$query_string一样</a></td></tr><tr><td>$http_user_agent</td><td>变量存储的是用户访问服务的代理信息(如果通过浏览器访问，记录的是浏览器的相关版本信息)</td></tr><tr><td>$host</td><td>变量存储的是访问服务器的server_name值</td></tr><tr><td>$document_uri</td><td>变量存储的是当前访问地址的URI。比如<a href="http://192.168.200.133/server?id=10&amp;name=zhangsan%E4%B8%AD%E7%9A%84%22/server%22%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$uri%E4%B8%80%E6%A0%B7" target="_blank" rel="noopener noreferrer">http://192.168.200.133/server?id=10&amp;name=zhangsan中的&quot;/server&quot;，功能和$uri一样</a></td></tr><tr><td>$document_root</td><td>变量存储的是当前请求对应location的root值，如果未设置，默认指向Nginx自带html目录所在位置</td></tr><tr><td>$content_length</td><td>变量存储的是请求头中的Content-Length的值</td></tr><tr><td>$content_type</td><td>变量存储的是请求头中的Content-Type的值</td></tr><tr><td>$http_cookie</td><td>变量存储的是客户端的cookie信息，可以通过add_header Set-Cookie &#39;cookieName=cookieValue&#39;来添加cookie数据</td></tr><tr><td>$limit_rate</td><td>变量中存储的是Nginx服务器对网络连接速率的限制，也就是Nginx配置中对limit_rate指令设置的值，默认是0，不限制。</td></tr><tr><td>$remote_addr</td><td>变量中存储的是客户端的IP地址</td></tr><tr><td>$remote_port</td><td>变量中存储了客户端与服务端建立连接的端口号</td></tr><tr><td>$remote_user</td><td>变量中存储了客户端的用户名，需要有认证模块才能获取</td></tr><tr><td>$scheme</td><td>变量中存储了访问协议</td></tr><tr><td>$server_addr</td><td>变量中存储了服务端的地址</td></tr><tr><td>$server_name</td><td>变量中存储了客户端请求到达的服务器的名称</td></tr><tr><td>$server_port</td><td>变量中存储了客户端请求到达服务器的端口号</td></tr><tr><td>$server_protocol</td><td>变量中存储了客户端请求协议的版本，比如&quot;HTTP/1.1&quot;</td></tr><tr><td>$request_body_file</td><td>变量中存储了发给后端服务器的本地文件资源的名称</td></tr><tr><td>$request_method</td><td>变量中存储了客户端的请求方式，比如&quot;GET&quot;,&quot;POST&quot;等</td></tr><tr><td>$request_filename</td><td>变量中存储了当前请求的资源文件的路径名</td></tr><tr><td>$request_uri</td><td>变量中存储了当前请求的URI，并且携带请求参数，比如<a href="http://192.168.200.133/server?id=10&amp;name=zhangsan%E4%B8%AD%E7%9A%84%22/server?id=10&amp;name=zhangsan%22" target="_blank" rel="noopener noreferrer">http://192.168.200.133/server?id=10&amp;name=zhangsan中的&quot;/server?id=10&amp;name=zhangsan&quot;</a></td></tr></tbody></table><h3 id="set" tabindex="-1"><a class="header-anchor" href="#set"><span>set</span></a></h3><p>设置变量</p><p>语法：<code>set $variable value</code></p><p>作用域：<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="if" tabindex="-1"><a class="header-anchor" href="#if"><span>if</span></a></h3><p>条件判断</p><p>语法：<code>if (condition) {}</code></p><p>作用域：<code>server</code>, <code>location</code></p><h3 id="break" tabindex="-1"><a class="header-anchor" href="#break"><span>break</span></a></h3><p>语法：<code>break</code></p><p>作用域：<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="return" tabindex="-1"><a class="header-anchor" href="#return"><span>return</span></a></h3><p>语法：<code>return code URL</code> <code>return [text]</code> <code>return URL</code></p><p>作用域：<code>server</code>, <code>location</code>, <code>if</code></p><h3 id="rewrite" tabindex="-1"><a class="header-anchor" href="#rewrite"><span>rewrite</span></a></h3><p>对请求的uri进行重写</p><p>语法：<code>rewrite regex replacement [flag]</code></p><p>作用域：<code>server</code>, <code>location</code>, <code>if</code></p><blockquote><p>flag可选值</p></blockquote><ul><li><p>last</p><p>停止当前location的执行，拿着uri重新去匹配location</p></li><li><p>break</p><p>停止当前location的执行，会在当前location去找对应的资源</p></li><li><p>redirect</p><p>临时重定向</p></li><li><p>permanent</p><p>永久重定向</p></li></ul><blockquote><p>使用示例</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        rewrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /1.html /2.html </span><span style="color:#C678DD;--shiki-dark:#C678DD;">last</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        rewrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /2.html /3.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /2.html {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        rewrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /2.html /a.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /3.html {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        rewrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /3.html /b.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="rewrite-log" tabindex="-1"><a class="header-anchor" href="#rewrite-log"><span>rewrite_log</span></a></h3><p>打印rewrite日志</p><p>语法：<code>rewrite_log on | off</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code>, <code>if</code></p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">rewrite_log </span><span style="color:#D19A66;--shiki-dark:#D19A66;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">error_log </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">logs/error.log </span><span style="color:#D19A66;--shiki-dark:#D19A66;">notice</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h2 id="反向代理" tabindex="-1"><a class="header-anchor" href="#反向代理"><span>反向代理</span></a></h2><h3 id="正向代理" tabindex="-1"><a class="header-anchor" href="#正向代理"><span>正向代理</span></a></h3><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://10.8.0.61;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="反向代理-1" tabindex="-1"><a class="header-anchor" href="#反向代理-1"><span>反向代理</span></a></h3><blockquote><p>被代理服务器</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><blockquote><p>代理服务器</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://192.168.100.128;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="proxy-set-header" tabindex="-1"><a class="header-anchor" href="#proxy-set-header"><span>proxy_set_header</span></a></h3><p>设置请求头信息</p><p>语法：<code>proxy_set_header field value</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code></p><h3 id="proxy-redirect" tabindex="-1"><a class="header-anchor" href="#proxy-redirect"><span>proxy_redirect</span></a></h3><p>将被代理服务器的重定向地址替换成代理服务器的地址</p><p>语法：<code>proxy_redirect redirect replacement</code></p><p>作用域：<code>http</code>, <code>server</code>, <code>location</code></p><blockquote><p>被代理服务器</p></blockquote><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">events</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">http</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        index </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">index.html;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (!-f $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">request_filename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                                return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 302</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> http://192.168.100.128:81;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">81</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        index </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">index.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>代理服务器</p></blockquote><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">events</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">http</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        proxy_redirect </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://192.168.100.128 http://192.168.100.3;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://192.168.100.128;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">81</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://192.168.100.128:81;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="负载均衡" tabindex="-1"><a class="header-anchor" href="#负载均衡"><span>负载均衡</span></a></h2><h3 id="upstream" tabindex="-1"><a class="header-anchor" href="#upstream"><span>upstream</span></a></h3><p>定义一组服务器</p><p>语法：<code>upstram name {}</code></p><p>作用域：<code>http</code></p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.100.128</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:81;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:82;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://myserver;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="负载均衡状态" tabindex="-1"><a class="header-anchor" href="#负载均衡状态"><span>负载均衡状态</span></a></h3><table><thead><tr><th>down</th><th>不参与负载均衡</th></tr></thead><tbody><tr><td>backup</td><td>备份服务器，当其他服务器挂掉了，才会启用备份服务器</td></tr><tr><td>max_fails</td><td>允许请求失败的次数，默认是1</td></tr><tr><td>fail_timeout</td><td>max_fails失败后，多少秒之内不访问失败的服务器，默认10秒</td></tr></tbody></table><h3 id="负载均衡策略" tabindex="-1"><a class="header-anchor" href="#负载均衡策略"><span>负载均衡策略</span></a></h3><blockquote><p>weight</p></blockquote><p>分配权重</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:80 </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    server 192.168.100.128:81 </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    server 192.168.100.128:82 </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><blockquote><p>ip_hash</p></blockquote><p>一个ip固定被分配到某一台服务器</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ip_hash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:80;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:81;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:82;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><blockquote><p>url_hash</p></blockquote><p>同一个url固定分配到某一台服务器</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    hash </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">request_uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.100.128</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:81;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:82;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><blockquote><p>least_conn</p></blockquote><p>把请求分配到连接最少的服务器上</p><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    least_conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:80;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:81;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:82;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="负载均衡之fair策略" tabindex="-1"><a class="header-anchor" href="#负载均衡之fair策略"><span>负载均衡之fair策略</span></a></h3><p>根据页面大小、加载时间等智能分配服务器</p><blockquote><p>下载fair</p></blockquote><p>下载地址：<code>https://github.com/gnosek/nginx-upstream-fair</code></p><blockquote><p>上传到服务器解压缩并重命名</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unzip</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx-upstream-fair-master.zip</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mv</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx-upstream-fair-master</span><span style="color:#98C379;--shiki-dark:#98C379;"> fair</span></span></code></pre></div><blockquote><p>编辑nginx源码文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data/nginx-1.22.0/src/http/ngx_http_upstream.h</span></span></code></pre></div><p>找到<code>struct ngx_http_upstream_srv_conf_s</code>结构体</p><p>加上<code>in_port_t default_port;</code></p><blockquote><p>进入nginx安装目录</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">cd</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data/nginx-1.22.0</span></span></code></pre></div><blockquote><p>进行配置</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./configure</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --add-module=/data/nginx-1.22.0/modules/fair</span></span></code></pre></div><blockquote><p>进行编译</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span></span></code></pre></div><blockquote><p>删除之前的nginx二进制文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -rf</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/nginx/sbin/nginx</span></span></code></pre></div><blockquote><p>复制新的二进制文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">cp</span><span style="color:#98C379;--shiki-dark:#98C379;"> objs/nginx</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/nginx/sbin</span></span></code></pre></div><blockquote><p>进行平滑升级</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span><span style="color:#98C379;--shiki-dark:#98C379;"> upgrade</span></span></code></pre></div><blockquote><p>使用fair策略</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">upstream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> myserver {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	fair;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:80;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:81;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 192.168.100.128:82;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="配置https" tabindex="-1"><a class="header-anchor" href="#配置https"><span>配置https</span></a></h2><h3 id="申请阿里云证书" tabindex="-1"><a class="header-anchor" href="#申请阿里云证书"><span>申请阿里云证书</span></a></h3><blockquote><p>到域名控制台解析域名</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>https://dc.console.aliyun.com/next/index#/domain-list/all</span></span></code></pre></div><blockquote><p>购买SSL证书</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>https://common-buy.aliyun.com/?commodityCode=cas_dv_public_cn</span></span></code></pre></div><blockquote><p>申请证书</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>https://yundunnext.console.aliyun.com/?p=casnext#/certExtend</span></span></code></pre></div><blockquote><p>下载证书，并上传到服务器</p></blockquote><h3 id="安装ssl模块" tabindex="-1"><a class="header-anchor" href="#安装ssl模块"><span>安装ssl模块</span></a></h3><blockquote><p>进入到nginx安装包目录</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">cd</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data/nginx-1.22.0</span></span></code></pre></div><blockquote><p>清除之前编译的文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span><span style="color:#98C379;--shiki-dark:#98C379;"> clean</span></span></code></pre></div><blockquote><p>重新配置</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./configure</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --with-http_ssl_module</span></span></code></pre></div><blockquote><p>重新编译</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span></span></code></pre></div><blockquote><p>删除之前的二进制文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -rf</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/nginx/sbin/nginx</span></span></code></pre></div><blockquote><p>复制二进制文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">cp</span><span style="color:#98C379;--shiki-dark:#98C379;"> objs/nginx</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/nginx/sbin</span></span></code></pre></div><blockquote><p>进行平滑升级</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">make</span><span style="color:#98C379;--shiki-dark:#98C379;"> upgrade</span></span></code></pre></div><h3 id="进行配置" tabindex="-1"><a class="header-anchor" href="#进行配置"><span>进行配置</span></a></h3><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># https默认端口是443</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">443</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ssl;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server_name </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">localhost;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 证书路径</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_certificate </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">cert/server.crt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_certificate_key </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">cert/server.key;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_session_timeout </span><span style="color:#D19A66;--shiki-dark:#D19A66;">5m</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_ciphers </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_protocols </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    ssl_prefer_server_ciphers </span><span style="color:#D19A66;--shiki-dark:#D19A66;">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 代理地址，就是实际要访问的地址</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    	proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">https://www.baidu.com;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将http://localhost重定向到https://localhost</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server_name </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">localhost;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 301</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> https://192.168.100.3$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">request_uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="部署前端项目" tabindex="-1"><a class="header-anchor" href="#部署前端项目"><span>部署前端项目</span></a></h2><h3 id="普通部署" tabindex="-1"><a class="header-anchor" href="#普通部署"><span>普通部署</span></a></h3><blockquote><p>若依官网拉取代码</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>https://gitee.com/y_project/RuoYi-Vue</span></span></code></pre></div><blockquote><p>安装依赖</p></blockquote><div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">npm install</span></span></code></pre></div><blockquote><p>打包后上传到服务器上</p></blockquote><div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">npm run build:prod</span></span></code></pre></div><p>打包完成后会生成dist文文件夹，将dist文件夹上传到服务器上</p><blockquote><p>编辑配置文件</p></blockquote><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">events</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">http</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        include </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mime.types;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/usr/local/nginx/html/dist;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        try_files </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/ /index.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                # 配置后端地址</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /prod-api {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        # 转发到后端地址</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://localhost:8081;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        # 去掉/prod-api</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        rewrite</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ^/prod-api/(.*)$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> break</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>重新加载配置文件</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nginx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> reload</span></span></code></pre></div><h3 id="整合jenkins、docker自动化部署" tabindex="-1"><a class="header-anchor" href="#整合jenkins、docker自动化部署"><span>整合Jenkins、Docker自动化部署</span></a></h3><blockquote><p>编写nginx配置文件</p></blockquote><div class="language-nginx" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">81</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        root </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/dist;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try_files </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">uri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/ /index.html;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /prod-api {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">https://www.linzhehao.cn;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        rewrite</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ^/prod-api/(.*)$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /ruoyi/$</span><span style="color:#E06C75;--shiki-dark:#E06C75;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> break</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><blockquote><p>编写dockerignore</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>node_modules</span></span>
<span class="line"><span>src</span></span>
<span class="line"><span>public</span></span></code></pre></div><blockquote><p>编写Dockerfile</p></blockquote><div class="language-dockerfile" data-ext="dockerfile" data-title="dockerfile"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> nginx:1.22.0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EXPOSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 81</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ENV</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> LC_ALL=C.UTF-8</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rm -rf /etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">COPY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> nginx.conf /etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">COPY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> dist/ /dist/</span></span></code></pre></div><blockquote><p>编写Jenkins脚本</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">npm</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">npm</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#98C379;--shiki-dark:#98C379;"> build:prod</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> rm</span><span style="color:#98C379;--shiki-dark:#98C379;"> ruoyi-ui</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -f</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> build</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#98C379;--shiki-dark:#98C379;"> ruoyi-ui</span><span style="color:#98C379;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --name</span><span style="color:#98C379;--shiki-dark:#98C379;"> ruoyi-ui</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#98C379;--shiki-dark:#98C379;"> 81:81</span><span style="color:#98C379;--shiki-dark:#98C379;"> ruoyi-ui</span></span></code></pre></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h2><ul><li>部门同事林哲豪的分享会</li></ul>`,296)]))}const d=a(i,[["render",o],["__file","nginx-x-start.html.vue"]]),t=JSON.parse('{"path":"/posts/MiddleWare/Nginx/nginx-x-start.html","title":"Nginx 入门实战","lang":"zh-CN","frontmatter":{"order":20,"category":["Nginx"],"description":"Nginx 入门实战 简介 什么是nginx Nginx是一个高性能的HTTP和反向代理web服务器 安装要求 linux内核2.6及以上 关闭防火墙 安装nginx 源码安装 创建文件夹 安装依赖 下载nginx 官网下载http://nginx.org/en/download.html 直接在服务器下载 进行配置 配置文件详解 进行安装 yum安装...","head":[["meta",{"property":"og:url","content":"https://mrjackc.github.io/posts/MiddleWare/Nginx/nginx-x-start.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"Nginx 入门实战"}],["meta",{"property":"og:description","content":"Nginx 入门实战 简介 什么是nginx Nginx是一个高性能的HTTP和反向代理web服务器 安装要求 linux内核2.6及以上 关闭防火墙 安装nginx 源码安装 创建文件夹 安装依赖 下载nginx 官网下载http://nginx.org/en/download.html 直接在服务器下载 进行配置 配置文件详解 进行安装 yum安装..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T01:58:08.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-28T01:58:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx 入门实战\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-28T01:58:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://mrjackc.github.io\\"}]}"]]},"headers":[{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[{"level":3,"title":"安装nginx","slug":"安装nginx","link":"#安装nginx","children":[]},{"level":3,"title":"配置系统服务","slug":"配置系统服务","link":"#配置系统服务","children":[]},{"level":3,"title":"配置环境变量","slug":"配置环境变量","link":"#配置环境变量","children":[]}]},{"level":2,"title":"nginx操作","slug":"nginx操作","link":"#nginx操作","children":[{"level":3,"title":"目录结构介绍","slug":"目录结构介绍","link":"#目录结构介绍","children":[]},{"level":3,"title":"kill信号操作","slug":"kill信号操作","link":"#kill信号操作","children":[]},{"level":3,"title":"nginx命令","slug":"nginx命令","link":"#nginx命令","children":[]}]},{"level":2,"title":"配置文件详解","slug":"配置文件详解","link":"#配置文件详解","children":[{"level":3,"title":"全局块","slug":"全局块","link":"#全局块","children":[]},{"level":3,"title":"events块","slug":"events块","link":"#events块","children":[]},{"level":3,"title":"http块","slug":"http块","link":"#http块","children":[]},{"level":3,"title":"server块","slug":"server块","link":"#server块","children":[]},{"level":3,"title":"location块","slug":"location块","link":"#location块","children":[]},{"level":3,"title":"解决跨域","slug":"解决跨域","link":"#解决跨域","children":[]},{"level":3,"title":"rewrite模块详解","slug":"rewrite模块详解","link":"#rewrite模块详解","children":[]},{"level":3,"title":"set","slug":"set","link":"#set","children":[]},{"level":3,"title":"if","slug":"if","link":"#if","children":[]},{"level":3,"title":"break","slug":"break","link":"#break","children":[]},{"level":3,"title":"return","slug":"return","link":"#return","children":[]},{"level":3,"title":"rewrite","slug":"rewrite","link":"#rewrite","children":[]},{"level":3,"title":"rewrite_log","slug":"rewrite-log","link":"#rewrite-log","children":[]}]},{"level":2,"title":"反向代理","slug":"反向代理","link":"#反向代理","children":[{"level":3,"title":"正向代理","slug":"正向代理","link":"#正向代理","children":[]},{"level":3,"title":"反向代理","slug":"反向代理-1","link":"#反向代理-1","children":[]},{"level":3,"title":"proxy_set_header","slug":"proxy-set-header","link":"#proxy-set-header","children":[]},{"level":3,"title":"proxy_redirect","slug":"proxy-redirect","link":"#proxy-redirect","children":[]}]},{"level":2,"title":"负载均衡","slug":"负载均衡","link":"#负载均衡","children":[{"level":3,"title":"upstream","slug":"upstream","link":"#upstream","children":[]},{"level":3,"title":"负载均衡状态","slug":"负载均衡状态","link":"#负载均衡状态","children":[]},{"level":3,"title":"负载均衡策略","slug":"负载均衡策略","link":"#负载均衡策略","children":[]},{"level":3,"title":"负载均衡之fair策略","slug":"负载均衡之fair策略","link":"#负载均衡之fair策略","children":[]}]},{"level":2,"title":"配置https","slug":"配置https","link":"#配置https","children":[{"level":3,"title":"申请阿里云证书","slug":"申请阿里云证书","link":"#申请阿里云证书","children":[]},{"level":3,"title":"安装ssl模块","slug":"安装ssl模块","link":"#安装ssl模块","children":[]},{"level":3,"title":"进行配置","slug":"进行配置","link":"#进行配置","children":[]}]},{"level":2,"title":"部署前端项目","slug":"部署前端项目","link":"#部署前端项目","children":[{"level":3,"title":"普通部署","slug":"普通部署","link":"#普通部署","children":[]},{"level":3,"title":"整合Jenkins、Docker自动化部署","slug":"整合jenkins、docker自动化部署","link":"#整合jenkins、docker自动化部署","children":[]}]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"git":{"createdTime":1730080688000,"updatedTime":1730080688000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":10.35,"words":3106},"filePathRelative":"posts/MiddleWare/Nginx/nginx-x-start.md","localizedDate":"2024年10月28日","excerpt":"\\n<h2>简介</h2>\\n<blockquote>\\n<p>什么是nginx</p>\\n</blockquote>\\n<p>Nginx是一个高性能的HTTP和反向代理web服务器</p>\\n<blockquote>\\n<p>安装要求</p>\\n</blockquote>\\n<ul>\\n<li>\\n<p><code>linux</code>内核2.6及以上</p>\\n<div class=\\"language-shell\\" data-ext=\\"shell\\" data-title=\\"shell\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\" style=\\"background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">uname</span><span style=\\"color:#D19A66;--shiki-dark:#D19A66\\"> -a</span></span></code></pre>\\n</div></li>\\n<li>\\n<p>关闭防火墙</p>\\n<div class=\\"language-shell\\" data-ext=\\"shell\\" data-title=\\"shell\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\" style=\\"background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 临时关闭防火墙</span></span>\\n<span class=\\"line\\"><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">systemctl</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> stop</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> firewalld</span></span>\\n<span class=\\"line\\"><span style=\\"color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 永久关闭防火墙</span></span>\\n<span class=\\"line\\"><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">systemctl</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> disable</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> firewalld</span></span>\\n<span class=\\"line\\"><span style=\\"color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 查看防火墙状态</span></span>\\n<span class=\\"line\\"><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">systemctl</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> status</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> firewalld</span></span></code></pre>\\n</div></li>\\n</ul>","autoDesc":true}');export{d as comp,t as data};
