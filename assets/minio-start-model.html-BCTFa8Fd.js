import{_ as a,c as n,a as i,o as l}from"./app-CZJgH_ea.js";const o={};function e(r,s){return l(),n("div",null,s[0]||(s[0]=[i(`<h1 id="minioserver启动模式" tabindex="-1"><a class="header-anchor" href="#minioserver启动模式"><span>MinioServer启动模式</span></a></h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介"><span>1. 简介</span></a></h2><p>minio支持多种server启动模式：</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417996.png" alt="image-20220715171521129.png" tabindex="0" loading="lazy"><figcaption>image-20220715171521129.png</figcaption></figure><ul><li><p>standalone模式</p><p>即要管理的磁盘都在host本地。该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为</p><ul><li><strong>non-erasure code mode</strong></li><li><strong>erasure code mode</strong>。</li></ul></li></ul><h3 id="_1-1-standalone-之-non-erasure-code-模式" tabindex="-1"><a class="header-anchor" href="#_1-1-standalone-之-non-erasure-code-模式"><span>1.1 standalone 之 non-erasure code 模式</span></a></h3><p>所谓<strong>non-erasure code mode</strong>，即minio server启动时仅传入一个本地磁盘目录参数：比如：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Endpoint:</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AccessKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SecretKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Browser</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Command-line</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://docs.min.io/docs/minio-client-quickstart-guide</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   $</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> config</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> add</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;"> ...</span></span></code></pre></div><p>在这样的启动模式下，对于每一份对象数据，minio直接在data下面存储这份数据，不会建立副本，也不会启用纠删码机制。因此，<strong>这种模式无论是服务实例还是磁盘都是“单点”，无任何高可用保障，磁盘损坏就表示数据丢失。</strong></p><h3 id="_1-2-standalone-之-non-erasure-code-模式" tabindex="-1"><a class="header-anchor" href="#_1-2-standalone-之-non-erasure-code-模式"><span>1.2 standalone 之 non-erasure code 模式</span></a></h3><p>erasure code mode即为minio server<strong>实例传入多个本地磁盘参数</strong>。一旦遇到多于一个磁盘参数，minio server会自动启用<strong>erasure code mode</strong>。<strong>erasure code</strong>对磁盘的个数是有要求的（最少4个），如不满足要求，实例启动将失败：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server data1 data2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ERROR</span><span style="color:#98C379;--shiki-dark:#98C379;"> Invalid</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#98C379;--shiki-dark:#98C379;"> line</span><span style="color:#98C379;--shiki-dark:#98C379;"> arguments:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Incorrect</span><span style="color:#98C379;--shiki-dark:#98C379;"> number</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> endpoints</span><span style="color:#98C379;--shiki-dark:#98C379;"> provided</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [data1 </span><span style="color:#98C379;--shiki-dark:#98C379;">data2]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      &gt; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Please</span><span style="color:#98C379;--shiki-dark:#98C379;"> provide</span><span style="color:#98C379;--shiki-dark:#98C379;"> an</span><span style="color:#98C379;--shiki-dark:#98C379;"> even</span><span style="color:#98C379;--shiki-dark:#98C379;"> number</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> endpoints</span><span style="color:#98C379;--shiki-dark:#98C379;"> greater</span><span style="color:#98C379;--shiki-dark:#98C379;"> or</span><span style="color:#98C379;--shiki-dark:#98C379;"> equal</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      HINT:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        For</span><span style="color:#98C379;--shiki-dark:#98C379;"> more</span><span style="color:#98C379;--shiki-dark:#98C379;"> information,</span><span style="color:#98C379;--shiki-dark:#98C379;"> please</span><span style="color:#98C379;--shiki-dark:#98C379;"> refer</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://docs.min.io/docs/minio-erasure-code-quickstart-guide</span></span></code></pre></div><p><strong>erasure code</strong>启用后，要求传给minio server的endpoint(standalone模式下，即本地磁盘上的目录)<a href="https://docs.minio.io/docs/minio-erasure-code-quickstart-guide.html" target="_blank" rel="noopener noreferrer">至少为4个</a>。minio server启用纠删码机制后，会自动将传入的disk drive划分为多个<strong>erasure coding set</strong>，每个<strong>erasure coding set</strong>中的disk drive的数量可以是：4, 6, 8, 10, 12, 14 和16。minio server会根据传入disk drive的数量自动计算set个数和每个set中的disk drive数量。比如下面例子中，我们传入四个endpoint(disk drive)给minio server：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server data1 data2 data3 data4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Formatting</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> zone,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> per</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">WARNING:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Host</span><span style="color:#98C379;--shiki-dark:#98C379;"> local</span><span style="color:#98C379;--shiki-dark:#98C379;"> has</span><span style="color:#98C379;--shiki-dark:#98C379;"> more</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span><span style="color:#98C379;--shiki-dark:#98C379;"> A</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> failure</span><span style="color:#98C379;--shiki-dark:#98C379;"> will</span><span style="color:#98C379;--shiki-dark:#98C379;"> result</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> data</span><span style="color:#98C379;--shiki-dark:#98C379;"> becoming</span><span style="color:#98C379;--shiki-dark:#98C379;"> unavailable.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Status:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">         4</span><span style="color:#98C379;--shiki-dark:#98C379;"> Online,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#98C379;--shiki-dark:#98C379;"> Offline.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Endpoint:</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AccessKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SecretKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Browser</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Command-line</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://docs.min.io/docs/minio-client-quickstart-guide</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   $</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> config</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> add</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从minio server的输出日志来看，minio server将这些drive放入了一个<strong>erasure coding set</strong>了。在输出日志中，我们还看到一行WARNING: <strong>Host local has more than 2 drives of set. A host failure will result in data becoming unavailable.</strong>，即minio server警告我们：这个<strong>erasure coding set</strong>中有多于两个的drive都在local host上，这样一旦host宕机，那么数据将无法获取。(每个set 有4个drive，根据纠删码的机制，这个set的最大允许失效的disk数量为4/2=2)。</p><h4 id="_1-2-1-语法糖-省略号" tabindex="-1"><a class="header-anchor" href="#_1-2-1-语法糖-省略号"><span>1.2.1 语法糖-省略号</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server data{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1...18}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Formatting</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> zone,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> per</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">WARNING:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Host</span><span style="color:#98C379;--shiki-dark:#98C379;"> local</span><span style="color:#98C379;--shiki-dark:#98C379;"> has</span><span style="color:#98C379;--shiki-dark:#98C379;"> more</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span><span style="color:#98C379;--shiki-dark:#98C379;"> A</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> failure</span><span style="color:#98C379;--shiki-dark:#98C379;"> will</span><span style="color:#98C379;--shiki-dark:#98C379;"> result</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> data</span><span style="color:#98C379;--shiki-dark:#98C379;"> becoming</span><span style="color:#98C379;--shiki-dark:#98C379;"> unavailable.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">WARNING:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Host</span><span style="color:#98C379;--shiki-dark:#98C379;"> local</span><span style="color:#98C379;--shiki-dark:#98C379;"> has</span><span style="color:#98C379;--shiki-dark:#98C379;"> more</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span><span style="color:#98C379;--shiki-dark:#98C379;"> A</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> failure</span><span style="color:#98C379;--shiki-dark:#98C379;"> will</span><span style="color:#98C379;--shiki-dark:#98C379;"> result</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> data</span><span style="color:#98C379;--shiki-dark:#98C379;"> becoming</span><span style="color:#98C379;--shiki-dark:#98C379;"> unavailable.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">WARNING:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Host</span><span style="color:#98C379;--shiki-dark:#98C379;"> local</span><span style="color:#98C379;--shiki-dark:#98C379;"> has</span><span style="color:#98C379;--shiki-dark:#98C379;"> more</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span><span style="color:#98C379;--shiki-dark:#98C379;"> A</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> failure</span><span style="color:#98C379;--shiki-dark:#98C379;"> will</span><span style="color:#98C379;--shiki-dark:#98C379;"> result</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> data</span><span style="color:#98C379;--shiki-dark:#98C379;"> becoming</span><span style="color:#98C379;--shiki-dark:#98C379;"> unavailable.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Status:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">         18</span><span style="color:#98C379;--shiki-dark:#98C379;"> Online,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#98C379;--shiki-dark:#98C379;"> Offline.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Endpoint:</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">AccessKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SecretKey:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Browser</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Command-line</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://docs.min.io/docs/minio-client-quickstart-guide</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   $</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> config</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> add</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://10.10.126.88:9000</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span><span style="color:#98C379;--shiki-dark:#98C379;"> minioadmin</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>minio server data{1...18}</span></span></code></pre></div><p>等价于</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>minio server data1 data2 data3 data4 data5 data6 data7 data8 data9 data10 data11 data 12 data13 data14 data15 data16 data17 data18</span></span></code></pre></div><p>minio server会自行扩展省略号代表的内容。我们看到：当我们传入18个disk drive后，minio server创建了3个<strong>erasure coding set</strong>，每个set中有6个disk drive。同样，minio server还针对每个set输出了一行WARNING：每个Set中有三个以上的disk drive都位于同一台host上。</p><p>这些WARNING我们可以通过distributed mode来解决。顾名思义，distributed mode下，minio server实例和其管理的disk drive分布在多台host上，这种模式可以避免minio server实例单点，数据也将分布在不同host上的不同disk中，实现了高可用，提升了整体的容灾能力。由于处理多个host上的disk，distribute mode默认就会启动<strong>erasure coding set</strong>机制。</p><h3 id="_1-3-distributed-mode" tabindex="-1"><a class="header-anchor" href="#_1-3-distributed-mode"><span>1.3 distributed mode</span></a></h3><p>在distributed mode下，minio server后面的远程的endpoint采用http url编码格式：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> MINIO_ACCESS_KEY</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">ACCESS_KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> MINIO_SECRET_KEY</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">SECRET_KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server http://host{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1...4}:9000/minio/data</span><span style="color:#98C379;--shiki-dark:#98C379;">{1.</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.</span><span style="color:#98C379;--shiki-dark:#98C379;">.4}</span></span></code></pre></div><p>上面例子中的minio server命令相当于4个host，每个host上启动一个minio server实例，每个实例都管理16的disk drive(包括本地和远程的)。上述命令等价于：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> server http://host1:9000/minio/data1 http://host1:9000/minio/data2 http://host1:9000/minio/data3 http://host1:9000/minio/data4 http://host2:9000/minio/data1 http://host2:9000/minio/data2 http://host2:9000/minio/data3 http://host2:9000/minio/data4 http://host3:9000/minio/data1 http://host3:9000/minio/data2 http://host3:9000/minio/data3 http://host3:9000/minio/data4 http://host4:9000/minio/data1 http://host4:9000/minio/data2 http://host4:9000/minio/data3 http://host4:9000/minio/data4</span></span></code></pre></div><p>minio同样会自动将这些disk drive划分为若干个<strong>erasure coding set</strong>。每个endpoint用<code>http://address/disk-drive-path</code>的形式编码。注意：<code>这条命令在host1、host2、host3和host4上都要执行</code></p><h2 id="_2-zone的概念" tabindex="-1"><a class="header-anchor" href="#_2-zone的概念"><span>2. <code>zone</code>的概念</span></a></h2><p>比如下面这个例子：</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>$minio server data{1...8} data{9...16}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Formatting 1 zone, 1 set(s), 8 drives per set.</span></span>
<span class="line"><span>WARNING: Host local has more than 4 drives of set. A host failure will result in data becoming unavailable.</span></span>
<span class="line"><span>Formatting 2 zone, 1 set(s), 8 drives per set.</span></span>
<span class="line"><span>WARNING: Host local has more than 4 drives of set. A host failure will result in data becoming unavailable.</span></span>
<span class="line"><span>Status:         16 Online, 0 Offline.</span></span>
<span class="line"><span>Endpoint:  http://10.10.126.88:9000  http://127.0.0.1:9000</span></span>
<span class="line"><span>AccessKey: minioadmin</span></span>
<span class="line"><span>SecretKey: minioadmin</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Browser Access:</span></span>
<span class="line"><span>   http://10.10.126.88:9000  http://127.0.0.1:9000           </span></span>
<span class="line"><span></span></span>
<span class="line"><span>Command-line Access: https://docs.min.io/docs/minio-client-quickstart-guide</span></span>
<span class="line"><span>   $ mc config host add myminio http://10.10.126.88:9000 minioadmin minioadmin</span></span>
<span class="line"><span></span></span>
<span class="line"><span>... ...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们在命令行中给minio server传入两组采用“省略号”语法的参数，minio认为<strong>每组</strong>就是一个**“zone”<strong>，这里有两组，因此minio创建了两个</strong>zone**。在每个zone内，minio创建了一个<strong>erasure coding set</strong>，每个set中有8个disk drive。对于外部的写数据请求，minio server会首先查找可用空间多的zone，然后再在zone内选择set和disk drive。</p><p>如果不用“省略号”语法，那么minio server会将后面传入的所有disk drive放入一个zone中</p><h2 id="_3-部署distributed-minio集群" tabindex="-1"><a class="header-anchor" href="#_3-部署distributed-minio集群"><span>3. 部署distributed minio集群</span></a></h2><h3 id="_3-1-单机上部署distributed-minio集群" tabindex="-1"><a class="header-anchor" href="#_3-1-单机上部署distributed-minio集群"><span>3. 1. 单机上部署distributed minio集群</span></a></h3><p>我们的验证环境采用最小的distributed minio模式：单机、one zone, one erasure coding set, 4 disk drive。下面是部署的示意图：</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417038.png" alt="image-20220715200417201" tabindex="0" loading="lazy"><figcaption>image-20220715200417201</figcaption></figure><p>我们没有使用“省略号”语法，在单机上不是很好模拟。我们通过下面脚本来启动该minio集群：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cat startup_minio.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> MINIO_ACCESS_KEY</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;minio&quot;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">export</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> MINIO_SECRET_KEY</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;minio123&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">01..04}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    nohup</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --address</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;:90\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#98C379;--shiki-dark:#98C379;">}&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9001/root/minio-install/data1</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9002/root/minio-install/data2</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9003/root/minio-install/data3</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9004/root/minio-install/data4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;/root/minio-install/90\${</span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#98C379;--shiki-dark:#98C379;">}.log&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&amp; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&amp;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">done</span></span></code></pre></div><p>启动该minio集群，并查看启动状态：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># bash startup_minio.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ps -ef|grep minio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      1218</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 11</span><span style="color:#98C379;--shiki-dark:#98C379;"> 21:58</span><span style="color:#98C379;--shiki-dark:#98C379;"> pts/5</span><span style="color:#98C379;--shiki-dark:#98C379;">    00:00:01</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --address</span><span style="color:#98C379;--shiki-dark:#98C379;"> :9001</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9001/root/minio-install/data1</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9002/root/minio-install/data2</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9003/root/minio-install/data3</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9004/root/minio-install/data4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      1219</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 11</span><span style="color:#98C379;--shiki-dark:#98C379;"> 21:58</span><span style="color:#98C379;--shiki-dark:#98C379;"> pts/5</span><span style="color:#98C379;--shiki-dark:#98C379;">    00:00:01</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --address</span><span style="color:#98C379;--shiki-dark:#98C379;"> :9002</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9001/root/minio-install/data1</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9002/root/minio-install/data2</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9003/root/minio-install/data3</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9004/root/minio-install/data4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      1220</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  3</span><span style="color:#98C379;--shiki-dark:#98C379;"> 21:58</span><span style="color:#98C379;--shiki-dark:#98C379;"> pts/5</span><span style="color:#98C379;--shiki-dark:#98C379;">    00:00:00</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --address</span><span style="color:#98C379;--shiki-dark:#98C379;"> :9003</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9001/root/minio-install/data1</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9002/root/minio-install/data2</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9003/root/minio-install/data3</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9004/root/minio-install/data4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      1221</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 11</span><span style="color:#98C379;--shiki-dark:#98C379;"> 21:58</span><span style="color:#98C379;--shiki-dark:#98C379;"> pts/5</span><span style="color:#98C379;--shiki-dark:#98C379;">    00:00:01</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --address</span><span style="color:#98C379;--shiki-dark:#98C379;"> :9004</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9001/root/minio-install/data1</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9002/root/minio-install/data2</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9003/root/minio-install/data3</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://127.0.0.1:9004/root/minio-install/data4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~/minio-install#</span><span style="color:#98C379;--shiki-dark:#98C379;"> ls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">9001.log</span><span style="color:#98C379;--shiki-dark:#98C379;">  9002.log</span><span style="color:#98C379;--shiki-dark:#98C379;">  9003.log</span><span style="color:#98C379;--shiki-dark:#98C379;">  9004.log</span><span style="color:#98C379;--shiki-dark:#98C379;">  data1</span><span style="color:#98C379;--shiki-dark:#98C379;">  data2</span><span style="color:#98C379;--shiki-dark:#98C379;">  data3</span><span style="color:#98C379;--shiki-dark:#98C379;">  data4</span><span style="color:#98C379;--shiki-dark:#98C379;">  startup_minio.sh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~/minio-install#</span><span style="color:#98C379;--shiki-dark:#98C379;"> tail</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -100f</span><span style="color:#98C379;--shiki-dark:#98C379;"> 9001.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Formatting</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> zone,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span><span style="color:#98C379;--shiki-dark:#98C379;"> drives</span><span style="color:#98C379;--shiki-dark:#98C379;"> per</span><span style="color:#98C379;--shiki-dark:#98C379;"> set.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Attempting</span><span style="color:#98C379;--shiki-dark:#98C379;"> encryption</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#98C379;--shiki-dark:#98C379;"> config,</span><span style="color:#98C379;--shiki-dark:#98C379;"> IAM</span><span style="color:#98C379;--shiki-dark:#98C379;"> users</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> policies</span><span style="color:#98C379;--shiki-dark:#98C379;"> on</span><span style="color:#98C379;--shiki-dark:#98C379;"> MinIO</span><span style="color:#98C379;--shiki-dark:#98C379;"> backend</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Status:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">         4</span><span style="color:#98C379;--shiki-dark:#98C379;"> Online,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#98C379;--shiki-dark:#98C379;"> Offline.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Endpoint:</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://192.168.16.4:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://172.17.0.1:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://172.18.0.1:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9001</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Browser</span><span style="color:#98C379;--shiki-dark:#98C379;"> Access:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   http://192.168.16.4:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://172.17.0.1:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://172.18.0.1:9001</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://127.0.0.1:9001</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">....</span><span style="color:#98C379;--shiki-dark:#98C379;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-mc配置与管理" tabindex="-1"><a class="header-anchor" href="#_3-2-mc配置与管理"><span>3.2 mc配置与管理</span></a></h3><p>minio官方提供了mc命令行工具，用于对minio server进行管理。我们首先要为mc创建一个管理本地minio server(:9001)的配置：</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span># mc config host add myminio</span></span></code></pre></div><p>这里我们使用mc添加了一个所谓”host”，指向上面创建的minio server(:9001)。上面的命令实质上是在~/.mc/config.json中写入了如下配置：</p><div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"># cat ~/.mc/config.json</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;version&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;9&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;hosts&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        &quot;myminio&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;url&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;http://localhost:9001&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;accessKey&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;minio&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;secretKey&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;minio123&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;api&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;s3v4&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;lookup&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;auto&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>接下来，我们通过mc命令在minio集群中添加三个bucket：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> mb</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/image</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Bucket</span><span style="color:#98C379;--shiki-dark:#98C379;"> created</span><span style="color:#98C379;--shiki-dark:#98C379;"> successfully</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/image</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> mb</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/video</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Bucket</span><span style="color:#98C379;--shiki-dark:#98C379;"> created</span><span style="color:#98C379;--shiki-dark:#98C379;"> successfully</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/video</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> mb</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/audio</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Bucket</span><span style="color:#98C379;--shiki-dark:#98C379;"> created</span><span style="color:#98C379;--shiki-dark:#98C379;"> successfully</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/audio</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> ls</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[2020-03-16 15:19:55 CST]      0B audio/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[2020-03-16 15:19:48 CST]      0B image/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[2020-03-16 15:19:52 CST]      0B video/</span></span></code></pre></div><p>新创建的bucket默认的访问policy是none，即外部无访问权限：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> policy</span><span style="color:#98C379;--shiki-dark:#98C379;"> get</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/image</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Access</span><span style="color:#98C379;--shiki-dark:#98C379;"> permission</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/image</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> is</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">none</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span></span></code></pre></div><p>根据我们的设计，我们需要给这三个bucket添加外部可读取权限，以image这个bucket为例：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> policy</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> download</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/image</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Access</span><span style="color:#98C379;--shiki-dark:#98C379;"> permission</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/image</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> is</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">download</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root@instance-cspzrq3u:~#</span><span style="color:#98C379;--shiki-dark:#98C379;"> mc</span><span style="color:#98C379;--shiki-dark:#98C379;"> policy</span><span style="color:#98C379;--shiki-dark:#98C379;"> get</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio/image</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Access</span><span style="color:#98C379;--shiki-dark:#98C379;"> permission</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">myminio/image</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> is</span><span style="color:#98C379;--shiki-dark:#98C379;"> \`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">download</span><span style="color:#98C379;--shiki-dark:#98C379;">\`</span></span></code></pre></div><h3 id="_3-3-load-balancer设置" tabindex="-1"><a class="header-anchor" href="#_3-3-load-balancer设置"><span>3.3. load balancer设置</span></a></h3><p>这里我们使用一个nginx前置在minio集群外部，下面是为minio创建的nginx配置文件(/etc/nginx/conf.d/minio.conf)：</p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">// /</span><span style="color:#D19A66;--shiki-dark:#D19A66;">etc/nginx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">/conf.d/minio.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> upstream minio_cluster {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    server localhost:9001;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> localhost:9002;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> localhost:9003;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> localhost:9004;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> listen </span><span style="color:#D19A66;--shiki-dark:#D19A66;">9000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> server_name </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">myminio.tonybai.com;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # To allow special characters in headers</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> ignore_invalid_headers </span><span style="color:#D19A66;--shiki-dark:#D19A66;">off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # Allow any size file to be uploaded.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # Set to a value such as 1000m; to restrict file size to a specific value</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> client_max_body_size </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # To disable buffering</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;"> proxy_buffering </span><span style="color:#D19A66;--shiki-dark:#D19A66;">off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Real-IP $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">remote_addr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Forwarded-For $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">proxy_add_x_forwarded_for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Forwarded-Proto $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">scheme</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Host $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">http_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_connect_timeout </span><span style="color:#D19A66;--shiki-dark:#D19A66;">300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # Default is HTTP/1, keepalive is only enabled in HTTP/1.1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_http_version </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1.1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Connection </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   chunked_transfer_encoding </span><span style="color:#D19A66;--shiki-dark:#D19A66;">off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://minio_cluster;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /image/ {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Real-IP $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">remote_addr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Forwarded-For $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">proxy_add_x_forwarded_for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">X-Forwarded-Proto $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">scheme</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Host $</span><span style="color:#E06C75;--shiki-dark:#E06C75;">http_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_connect_timeout </span><span style="color:#D19A66;--shiki-dark:#D19A66;">300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # Default is HTTP/1, keepalive is only enabled in HTTP/1.1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_http_version </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1.1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_set_header </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">Connection </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   chunked_transfer_encoding </span><span style="color:#D19A66;--shiki-dark:#D19A66;">off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   client_max_body_size </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000m</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_buffering </span><span style="color:#D19A66;--shiki-dark:#D19A66;">off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   proxy_pass </span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">http://minio_cluster;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启nginx（nginx -s reload)。</p><p>我们使用浏览器访问一下<code>http://myminio.tonybai.com:9000/</code>，登录后，你将看到如下页面：</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417059.png" alt="image-20220715200904574" tabindex="0" loading="lazy"><figcaption>image-20220715200904574</figcaption></figure><p>选择左侧的”image” bucket，点击右下角的”+”号，我们可以上传一张图片：gopher-daily-logo.png，上传后，我们退出登录。然后通过地址<code>http://myminio.tonybai.com:9000/image/gopher-daily-logo.png</code>访问该图片。你也可以通过wget命令下载该图片：</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">$wget</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -c http://myminio.tonybai.com:9000/image/gopher-daily-logo.png</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--2020-03-16</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:40:20--</span><span style="color:#98C379;--shiki-dark:#98C379;">  http://myminio.tonybai.com:9000/image/gopher-daily-logo.png</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">正在解析主机</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio.tonybai.com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (myminio.tonybai.com)... 106.12.69.83</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">正在连接</span><span style="color:#98C379;--shiki-dark:#98C379;"> myminio.tonybai.com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (myminio.tonybai.com)|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">106.12.69.83</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">:9000...</span><span style="color:#98C379;--shiki-dark:#98C379;"> 已连接。</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">已发出</span><span style="color:#98C379;--shiki-dark:#98C379;"> HTTP</span><span style="color:#98C379;--shiki-dark:#98C379;"> 请求，正在等待回应...</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 200</span><span style="color:#98C379;--shiki-dark:#98C379;"> OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">长度：59736</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (58K) [image/png]</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">正在保存至:</span><span style="color:#98C379;--shiki-dark:#98C379;"> “gopher-daily-logo.png”</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">gopher-daily-logo.png</span><span style="color:#98C379;--shiki-dark:#98C379;">        100%[===========================================</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">]</span><span style="color:#98C379;--shiki-dark:#98C379;">  58.34K</span><span style="color:#98C379;--shiki-dark:#98C379;">   253KB/s</span><span style="color:#98C379;--shiki-dark:#98C379;">  用时</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0.2s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2020-03-16</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:40:20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (253 </span><span style="color:#98C379;--shiki-dark:#98C379;">KB/s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) - 已保存 “gopher-daily-logo.png” [59736/59736])</span></span></code></pre></div><h2 id="_4-开启多版本控制" tabindex="-1"><a class="header-anchor" href="#_4-开启多版本控制"><span>4 开启多版本控制</span></a></h2><p>要开启多版本控制，必须开启纠删码模式</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417082.png" alt="image-20220715165955626" tabindex="0" loading="lazy"><figcaption>image-20220715165955626</figcaption></figure><p>开启纠删码模式后，我们上传的文件可以看到历史版本</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417110.png" alt="image-20220715170326538" tabindex="0" loading="lazy"><figcaption>image-20220715170326538</figcaption></figure><p>我们再存储可以看到他的多版本文件</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417140.png" alt="image-20220715170931323" tabindex="0" loading="lazy"><figcaption>image-20220715170931323</figcaption></figure><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h2><p><a href="https://tonybai.com/2020/03/16/build-high-performance-object-storage-with-minio-part1-prototype/" target="_blank" rel="noopener noreferrer">使用minio搭建高性能对象存储-第一部分：原型</a></p>`,69)]))}const t=a(o,[["render",e],["__file","minio-start-model.html.vue"]]),d=JSON.parse('{"path":"/posts/Architect/minio/minio-start-model.html","title":"MinioServer启动模式","lang":"zh-CN","frontmatter":{"description":"MinioServer启动模式 1. 简介 minio支持多种server启动模式： image-20220715171521129.pngimage-20220715171521129.png standalone模式 即要管理的磁盘都在host本地。该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为 n...","watermark":true,"head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/Architect/minio/minio-start-model.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"MinioServer启动模式"}],["meta",{"property":"og:description","content":"MinioServer启动模式 1. 简介 minio支持多种server启动模式： image-20220715171521129.pngimage-20220715171521129.png standalone模式 即要管理的磁盘都在host本地。该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为 n..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417996.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T01:58:08.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-28T01:58:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MinioServer启动模式\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417996.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417038.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417059.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417082.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417110.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417140.png\\"],\\"dateModified\\":\\"2024-10-28T01:58:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":2,"title":"1. 简介","slug":"_1-简介","link":"#_1-简介","children":[{"level":3,"title":"1.1 standalone 之 non-erasure code 模式","slug":"_1-1-standalone-之-non-erasure-code-模式","link":"#_1-1-standalone-之-non-erasure-code-模式","children":[]},{"level":3,"title":"1.2 standalone 之 non-erasure code 模式","slug":"_1-2-standalone-之-non-erasure-code-模式","link":"#_1-2-standalone-之-non-erasure-code-模式","children":[]},{"level":3,"title":"1.3 distributed mode","slug":"_1-3-distributed-mode","link":"#_1-3-distributed-mode","children":[]}]},{"level":2,"title":"2. zone的概念","slug":"_2-zone的概念","link":"#_2-zone的概念","children":[]},{"level":2,"title":"3. 部署distributed minio集群","slug":"_3-部署distributed-minio集群","link":"#_3-部署distributed-minio集群","children":[{"level":3,"title":"3. 1. 单机上部署distributed minio集群","slug":"_3-1-单机上部署distributed-minio集群","link":"#_3-1-单机上部署distributed-minio集群","children":[]},{"level":3,"title":"3.2 mc配置与管理","slug":"_3-2-mc配置与管理","link":"#_3-2-mc配置与管理","children":[]},{"level":3,"title":"3.3. load balancer设置","slug":"_3-3-load-balancer设置","link":"#_3-3-load-balancer设置","children":[]}]},{"level":2,"title":"4 开启多版本控制","slug":"_4-开启多版本控制","link":"#_4-开启多版本控制","children":[]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"git":{"createdTime":1730080688000,"updatedTime":1730080688000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":8.78,"words":2634},"filePathRelative":"posts/Architect/minio/minio-start-model.md","localizedDate":"2024年10月28日","excerpt":"\\n<h2>1. 简介</h2>\\n<p>minio支持多种server启动模式：</p>\\n<figure><img src=\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202404301417996.png\\" alt=\\"image-20220715171521129.png\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>image-20220715171521129.png</figcaption></figure>\\n<ul>\\n<li>\\n<p>standalone模式</p>\\n<p>即要管理的磁盘都在host本地。该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为</p>\\n<ul>\\n<li><strong>non-erasure code mode</strong></li>\\n<li><strong>erasure code mode</strong>。</li>\\n</ul>\\n</li>\\n</ul>","autoDesc":true}');export{t as comp,d as data};
