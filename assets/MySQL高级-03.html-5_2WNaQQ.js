import{_ as a,c as n,a as i,o as l}from"./app-tJW29Kmg.js";const e={};function p(r,s){return l(),n("div",null,s[0]||(s[0]=[i(`<h1 id="mysql高级" tabindex="-1"><a class="header-anchor" href="#mysql高级"><span>MySQL高级</span></a></h1><h3 id="一、mysql存储过程和函数" tabindex="-1"><a class="header-anchor" href="#一、mysql存储过程和函数"><span>一、MySQL存储过程和函数</span></a></h3><h4 id="_1-存储过程和函数的概念" tabindex="-1"><a class="header-anchor" href="#_1-存储过程和函数的概念"><span>1.存储过程和函数的概念</span></a></h4><ul><li>存储过程和函数是 事先经过编译并存储在数据库中的一段 SQL 语句的集合</li></ul><h4 id="_2-存储过程和函数的好处" tabindex="-1"><a class="header-anchor" href="#_2-存储过程和函数的好处"><span>2.存储过程和函数的好处</span></a></h4><ul><li>存储过程和函数可以重复使用，减轻开发人员的工作量。类似于java中方法可以多次调用</li><li>减少网络流量，存储过程和函数位于服务器上，调用的时候只需要传递名称和参数即可</li><li>减少数据在数据库和应用服务器之间的传输，可以提高数据处理的效率</li><li>将一些业务逻辑在数据库层面来实现，可以减少代码层面的业务处理</li></ul><h4 id="_3-存储过程和函数的区别" tabindex="-1"><a class="header-anchor" href="#_3-存储过程和函数的区别"><span>3.存储过程和函数的区别</span></a></h4><ul><li>函数必须有返回值</li><li>存储过程没有返回值</li></ul><h4 id="_4-创建存储过程" tabindex="-1"><a class="header-anchor" href="#_4-创建存储过程"><span>4.创建存储过程</span></a></h4><ul><li>小知识</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	该关键字用来声明sql语句的分隔符，告诉MySQL该段命令已经结束！</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	sql语句默认的分隔符是分号，但是有的时候我们需要一条功能sql语句中包含分号，但是并不作为结束标识。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	这个时候就可以使用DELIMITER来指定分隔符了！</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER 分隔符</span></span></code></pre></div><ul><li>数据准备</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建db8数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DATABASE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> db8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 使用db8数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">USE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> db8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建学生表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> student</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,	</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 学生id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	NAME</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),					</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 学生姓名</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	age </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,							</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 学生年龄</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	gender </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),					</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 学生性别</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                           -- 学生成绩</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">23</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;男&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">95</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;李四&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">24</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;男&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">98</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;王五&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;女&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;赵六&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">26</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;女&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">90</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 按照性别进行分组，查询每组学生的总成绩。按照总成绩的升序排序</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender,</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) getSum </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> getSum </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ASC</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建存储过程语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改分隔符为$</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称(参数...)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	sql语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改分隔符为分号</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li>创建存储过程</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改分隔符为$</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建存储过程，封装分组查询学生总成绩的sql语句</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_group()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender,</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) getSum </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> getSum </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ASC</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改分隔符为分号</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><h4 id="_5-调用存储过程" tabindex="-1"><a class="header-anchor" href="#_5-调用存储过程"><span>5.调用存储过程</span></a></h4><ul><li>调用存储过程语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称(实际参数);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用stu_group存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_group();</span></span></code></pre></div><h4 id="_6-查看存储过程" tabindex="-1"><a class="header-anchor" href="#_6-查看存储过程"><span>6.查看存储过程</span></a></h4><ul><li>查看存储过程语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询数据库中所有的存储过程 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">proc</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> db</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;数据库名称&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h4 id="_7-删除存储过程" tabindex="-1"><a class="header-anchor" href="#_7-删除存储过程"><span>7.删除存储过程</span></a></h4><ul><li>删除存储过程语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 删除stu_group存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_group;</span></span></code></pre></div><h4 id="_8-存储过程语法" tabindex="-1"><a class="header-anchor" href="#_8-存储过程语法"><span>8.存储过程语法</span></a></h4><h5 id="_8-1存储过程语法介绍" tabindex="-1"><a class="header-anchor" href="#_8-1存储过程语法介绍"><span>8.1存储过程语法介绍</span></a></h5><ul><li>存储过程是可以进行编程的。意味着可以使用变量、表达式、条件控制语句、循环语句等，来完成比较复杂的功能！</li></ul><h5 id="_8-2变量的使用" tabindex="-1"><a class="header-anchor" href="#_8-2变量的使用"><span>8.2变量的使用</span></a></h5><ul><li>定义变量</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 变量名 数据类型 </span><span style="color:#E06C75;--shiki-dark:#E06C75;">[DEFAULT 默认值]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 注意： DECLARE定义的是局部变量，只能用在BEGIN END范围之内</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义一个int类型变量、并赋默认值为10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test1()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num;                   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test1存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test1();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>变量的赋值1</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 变量名 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 变量值;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义字符串类型变量，并赋值</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test2()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;存储过程&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;       </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 为变量赋值</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;                </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test2存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test2();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>变量的赋值2</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 列名 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 变量名 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 表名 </span><span style="color:#E06C75;--shiki-dark:#E06C75;">[WHERE 条件]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义两个int变量，用于存储男女同学的总分数</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test3()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> men,women </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 定义变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> men </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;男&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 计算男同学总分数赋值给men</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> women </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> gender</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;女&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 计算女同学总分数赋值给women</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> men,women;           </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test3存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test3();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-3if语句的使用" tabindex="-1"><a class="header-anchor" href="#_8-3if语句的使用"><span>8.3if语句的使用</span></a></h5><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 判断条件1 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 执行的sql语句1;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ELSEIF 判断条件2 THEN 执行的sql语句2;]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ELSE 执行的sql语句n;]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	定义一个int变量，用于存储班级总成绩</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	定义一个varchar变量，用于存储分数描述</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	根据总成绩判断：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		380分及以上    学习优秀</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320 ~ 380     学习不错</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320以下       学习一般</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test4()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义总分数变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义分数描述变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 为总分数变量赋值</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 判断总分数</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习优秀&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	ELSEIF total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 320</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习不错&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	ELSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习一般&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询总成绩和描述信息</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test4存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test4();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-4参数的传递" tabindex="-1"><a class="header-anchor" href="#_8-4参数的传递"><span>8.4参数的传递</span></a></h5><ul><li>参数传递的语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[IN|OUT|INOUT]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 参数名 数据类型)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	执行的sql语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	IN:代表输入参数，需要由调用者传递实际数据。默认的</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	OUT:代表输出参数，该参数可以作为返回值</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	INOUT:代表既可以作为输入参数，也可以作为输出参数</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li><p>输入参数</p><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 参数名 数据类型)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	执行的sql语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	输入总成绩变量，代表学生总成绩</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	定义一个varchar变量，用于存储分数描述</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	根据总成绩判断：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		380分及以上  学习优秀</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320 ~ 380    学习不错</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320以下      学习一般</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test5(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义分数描述变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 判断总分数</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习优秀&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	ELSEIF total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 320</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习不错&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	ELSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习一般&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询总成绩和描述信息</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test5存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test5(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">390</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test5((</span><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student));</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>输出参数</p><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 存储过程名称(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">OUT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 参数名 数据类型)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	执行的sql语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	输入总成绩变量，代表学生总成绩</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	输出分数描述变量，代表学生总成绩的描述</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	根据总成绩判断：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		380分及以上  学习优秀</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320 ~ 380    学习不错</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320以下      学习一般</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test6(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">OUT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 判断总分数</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习优秀&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	ELSEIF total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 320</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习不错&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	ELSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习一般&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test6存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test6(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">310</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">@description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询总成绩描述</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> @description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>小知识</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">@变量名</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:  这种变量要在变量名称前面加上“@”符号，叫做用户会话变量，代表整个会话过程他都是有作用的，这个类似于全局变量一样。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@@变量名: 这种在变量前加上 </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;@@&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 符号, 叫做系统变量</span></span></code></pre></div></li></ul><h5 id="_8-5case语句的使用" tabindex="-1"><a class="header-anchor" href="#_8-5case语句的使用"><span>8.5case语句的使用</span></a></h5><ul><li>标准语法1</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CASE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 表达式</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 值1 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 执行sql语句1;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[WHEN 值2 THEN 执行sql语句2;]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ELSE 执行sql语句n;]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> CASE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>标准语法2</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CASE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 判断条件1 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">THEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 执行sql语句1;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[WHEN 判断条件2 THEN 执行sql语句2;]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[ELSE 执行sql语句n;]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> CASE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	输入总成绩变量，代表学生总成绩</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	定义一个varchar变量，用于存储分数描述</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	根据总成绩判断：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		380分及以上  学习优秀</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320 ~ 380    学习不错</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		320以下      学习一般</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test7(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用case判断</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	CASE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	WHEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习优秀&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	WHEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 320</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> total </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 380</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习不错&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	ELSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;学习一般&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> CASE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询分数描述信息</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> description</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test7存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test7(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">390</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test7((</span><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> SUM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(score) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student));</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-6while循环" tabindex="-1"><a class="header-anchor" href="#_8-6while循环"><span>8.6while循环</span></a></h5><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">初始化语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHILE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 条件判断语句 DO</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	循环体语句;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	条件控制语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHILE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	计算1~100之间的偶数和</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test8()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义求和变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义初始化变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- while循环</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	WHILE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> DO</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 偶数判断</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num%</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">			SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result + num; </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 累加</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 让num+1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;         </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHILE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询求和结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test8存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test8();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-7repeat循环" tabindex="-1"><a class="header-anchor" href="#_8-7repeat循环"><span>8.7repeat循环</span></a></h5><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">初始化语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">REPEAT</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	循环体语句;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	条件控制语句;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	UNTIL 条件判断语句</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> REPEAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 注意：repeat循环是条件满足则停止。while循环是条件满足则执行</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	计算1~10之间的和</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test9()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义求和变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义初始化变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- repeat循环</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	REPEAT</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 累加</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result + num;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 让num+1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 停止循环</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		UNTIL num</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> REPEAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询求和结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test9存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test9();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-8loop循环" tabindex="-1"><a class="header-anchor" href="#_8-8loop循环"><span>8.8loop循环</span></a></h5><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">初始化语句;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[循环名称:]</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LOOP</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	条件判断语句</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		[LEAVE 循环名称;]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	循环体语句;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	条件控制语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LOOP</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 循环名称;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 注意：loop可以实现简单的循环，但是退出循环需要使用其他的语句来定义。我们可以使用leave语句完成！</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--      如果不加退出循环的语句，那么就变成了死循环。</span></span></code></pre></div><ul><li>案例演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	计算1~10之间的和</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test10()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义求和变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义初始化变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- loop循环</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	l:</span><span style="color:#C678DD;--shiki-dark:#C678DD;">LOOP</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 条件成立，停止循环</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> THEN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">			LEAVE l;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 累加</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result + num;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 让num+1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> num + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LOOP</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> l;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询求和结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test10存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test10();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-9游标" tabindex="-1"><a class="header-anchor" href="#_8-9游标"><span>8.9游标</span></a></h5><ul><li><p>游标的概念</p><ul><li>游标可以遍历返回的多行结果，每次拿到一整行数据</li><li>在存储过程和函数中可以使用游标对结果集进行循环的处理</li><li>简单来说游标就类似于集合的迭代器遍历</li><li>MySQL中的游标只能用在存储过程和函数中</li></ul></li><li><p>游标的语法</p><ul><li>创建游标</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 游标名称 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">CURSOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 查询sql语句;</span></span></code></pre></div><ul><li>打开游标</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">OPEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 游标名称;</span></span></code></pre></div><ul><li>使用游标获取数据</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 游标名称 </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 变量名1,变量名2,...;</span></span></code></pre></div><ul><li>关闭游标</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CLOSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 游标名称;</span></span></code></pre></div></li><li><p>游标的基本使用</p></li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建stu_score表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> stu_score</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	将student表中所有的成绩保存到stu_score表中</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test11()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义成绩变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 创建游标,查询所有学生成绩数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">CURSOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 开启游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	OPEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第1行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第2行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第3行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第4行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 关闭游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	CLOSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test11存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test11();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询stu_score表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ===========================================================</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	出现的问题：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		student表中一共有4条数据，我们在游标遍历了4次，没有问题！</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		但是在游标中多遍历几次呢？就会出现问题</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test11()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义成绩变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 创建游标,查询所有学生成绩数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">CURSOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 开启游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	OPEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第1行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第2行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第3行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第4行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 使用游标，遍历结果,拿到第5行数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 关闭游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	CLOSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test11存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test11();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询stu_score表,虽然数据正确，但是在执行存储过程时会报错</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>游标的优化使用(配合循环使用)</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	当游标结束后，会触发游标结束事件。我们可以通过这一特性来完成循环操作</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	加标记思想：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		1.定义一个变量，默认值为0(意味着有数据)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		2.当游标结束后，将变量值改为1(意味着没有数据了)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1.定义一个变量，默认值为0(意味着有数据)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flag </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2.当游标结束后，将变量值改为1(意味着没有数据了)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> EXIT HANDLER </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> FOUND </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flag </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	将student表中所有的成绩保存到stu_score表中</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test12()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义成绩变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义标记变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flag </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 创建游标，查询所有学生成绩数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">CURSOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 游标结束后，将标记变量改为1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> EXIT HANDLER </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> FOUND </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> flag </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 开启游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	OPEN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 循环使用游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	REPEAT</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 使用游标，遍历结果,拿到数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		FETCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> s_score;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		-- 将数据保存到stu_score表中</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,s_score);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	UNTIL flag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	END</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> REPEAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 关闭游标</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	CLOSE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用pro_test12存储过程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CALL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pro_test12();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询stu_score表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> stu_score;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-存储过程的总结" tabindex="-1"><a class="header-anchor" href="#_9-存储过程的总结"><span>9.存储过程的总结</span></a></h4><ul><li>存储过程是 事先经过编译并存储在数据库中的一段 SQL 语句的集合。可以在数据库层面做一些业务处理</li><li>说白了存储过程其实就是将sql语句封装为方法，然后可以调用方法执行sql语句而已</li><li>存储过程的好处 <ul><li>安全</li><li>高效</li><li>复用性强</li></ul></li></ul><h4 id="_10-存储函数" tabindex="-1"><a class="header-anchor" href="#_10-存储函数"><span>10.存储函数</span></a></h4><ul><li><p>存储函数和存储过程是非常相似的。存储函数可以做的事情，存储过程也可以做到！</p></li><li><p>存储函数有返回值，存储过程没有返回值(参数的out其实也相当于是返回数据了)</p></li><li><p>标准语法</p><ul><li>创建存储函数</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FUNCTION</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 函数名称</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[参数 数据类型]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">RETURNS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 返回值类型</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	执行的sql语句;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	RETURN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 结果;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li>调用存储函数</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 函数名称(实际参数);</span></span></code></pre></div><ul><li>删除存储函数</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FUNCTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 函数名称;</span></span></code></pre></div></li><li><p>案例演示</p></li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	定义存储函数，获取学生表中成绩大于95分的学生数量</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FUNCTION</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> fun_test1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">RETURNS</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> INT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 定义统计变量</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	DECLARE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 查询成绩大于95分的学生数量，给统计变量赋值</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> student </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 95</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	-- 返回统计结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	RETURN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 调用fun_test1存储函数</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> fun_test1();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、mysql触发器" tabindex="-1"><a class="header-anchor" href="#二、mysql触发器"><span>二、MySQL触发器</span></a></h3><h4 id="_1-触发器的概念" tabindex="-1"><a class="header-anchor" href="#_1-触发器的概念"><span>1.触发器的概念</span></a></h4><ul><li>触发器是与表有关的数据库对象，可以在 insert/update/delete 之前或之后，触发并执行触发器中定义的SQL语句。触发器的这种特性可以协助应用在数据库端确保数据的完整性 、日志记录 、数据校验等操作 。</li><li>使用别名 NEW 和 OLD 来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</li></ul><table><thead><tr><th>触发器类型</th><th>OLD的含义</th><th>NEW的含义</th></tr></thead><tbody><tr><td>INSERT 型触发器</td><td>无 (因为插入前状态无数据)</td><td>NEW 表示将要或者已经新增的数据</td></tr><tr><td>UPDATE 型触发器</td><td>OLD 表示修改之前的数据</td><td>NEW 表示将要或已经修改后的数据</td></tr><tr><td>DELETE 型触发器</td><td>OLD 表示将要或者已经删除的数据</td><td>无 (因为删除后状态无数据)</td></tr></tbody></table><h4 id="_2-创建触发器" tabindex="-1"><a class="header-anchor" href="#_2-创建触发器"><span>2.创建触发器</span></a></h4><ul><li>标准语法</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> 触发器名称</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEFORE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#C678DD;--shiki-dark:#C678DD;">AFTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> INSERT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#C678DD;--shiki-dark:#C678DD;">DELETE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 表名</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">[FOR EACH ROW]</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  -- 行级触发器</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	触发器要执行的功能;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre></div><ul><li><p>触发器演示。通过触发器记录账户表的数据变更日志。包含：增加、修改、删除</p><ul><li>创建账户表</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建db9数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DATABASE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> db9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 使用db9数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">USE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> db9;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建账户表account</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,	</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 账户id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	NAME</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),					</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 姓名</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> DOUBLE						</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 余额</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;李四&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><ul><li>创建日志表</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建日志表account_log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account_log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,	</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 日志id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	operation </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),				</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 操作类型 (insert update delete)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	operation_time </span><span style="color:#C678DD;--shiki-dark:#C678DD;">DATETIME</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,			</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 操作时间</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	operation_id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,					</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 操作表的id</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	operation_params </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)       </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 操作参数</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><ul><li>创建INSERT触发器</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建INSERT触发器</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account_insert</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AFTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> INSERT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> EACH </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ROW</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;INSERT&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOW</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;插入后{id=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,name=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,money=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;}&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 向account表添加记录</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;王五&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询account表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询日志表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建UPDATE触发器</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建UPDATE触发器</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account_update</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AFTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> UPDATE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> EACH </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ROW</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;UPDATE&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOW</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;修改前{id=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,name=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,money=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;}&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;修改后{id=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,name=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,money=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;}&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改account表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询account表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询日志表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建DELETE触发器</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建DELETE触发器</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER $</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account_delete</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AFTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DELETE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> EACH </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ROW</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;DELETE&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOW</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;删除前{id=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,name=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;,money=&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">old</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;}&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">END</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 删除account表数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DELETE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询account表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询日志表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_log;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-查看触发器" tabindex="-1"><a class="header-anchor" href="#_3-查看触发器"><span>3.查看触发器</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW TRIGGERS;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看触发器</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW TRIGGERS;</span></span></code></pre></div><h4 id="_4-删除触发器" tabindex="-1"><a class="header-anchor" href="#_4-删除触发器"><span>4.删除触发器</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 触发器名称;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 删除DELETE触发器</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRIGGER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account_delete;</span></span></code></pre></div><h4 id="_5-触发器的总结" tabindex="-1"><a class="header-anchor" href="#_5-触发器的总结"><span>5.触发器的总结</span></a></h4><ul><li>触发器是与表有关的数据库对象</li><li>可以在 insert/update/delete 之前或之后，触发并执行触发器中定义的SQL语句</li><li>触发器的这种特性可以协助应用在数据库端确保数据的完整性 、日志记录 、数据校验等操作</li><li>使用别名 NEW 和 OLD 来引用触发器中发生变化的记录内容</li></ul><h3 id="三、mysql事务" tabindex="-1"><a class="header-anchor" href="#三、mysql事务"><span>三、MySQL事务</span></a></h3><h4 id="_1-事务的概念" tabindex="-1"><a class="header-anchor" href="#_1-事务的概念"><span>1.事务的概念</span></a></h4><ul><li>一条或多条 SQL 语句组成一个执行单元，其特点是这个单元要么同时成功要么同时失败，单元中的每条 SQL 语句都相互依赖，形成一个整体，如果某条 SQL 语句执行失败或者出现错误，那么整个单元就会回滚，撤回到事务最初的状态，如果单元中所有的 SQL 语句都执行成功，则事务就顺利执行。</li></ul><h4 id="_2-事务的数据准备" tabindex="-1"><a class="header-anchor" href="#_2-事务的数据准备"><span>2.事务的数据准备</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建db10数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DATABASE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> db10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 使用db10数据库</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">USE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> db10;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> account</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,	</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 账户id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	NAME</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),			</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 账户名称</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> DOUBLE				</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 账户余额</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加数据</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;李四&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><h4 id="_3-未管理事务演示" tabindex="-1"><a class="header-anchor" href="#_3-未管理事务演示"><span>3.未管理事务演示</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 张三给李四转账500元</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1.张三账户-500</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2.李四账户+500</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">出错了...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;李四&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 该场景下，这两条sql语句要么同时成功，要么同时失败。就需要被事务所管理！</span></span></code></pre></div><h4 id="_4-管理事务演示" tabindex="-1"><a class="header-anchor" href="#_4-管理事务演示"><span>4.管理事务演示</span></a></h4><ul><li>操作事务的三个步骤 <ol><li>开启事务：记录回滚点，并通知服务器，将要执行一组操作，要么同时成功、要么同时失败</li><li>执行sql语句：执行具体的一条或多条sql语句</li><li>结束事务(提交|回滚) <ul><li>提交：没出现问题，数据进行更新</li><li>回滚：出现问题，数据恢复到开启事务时的状态</li></ul></li></ol></li><li>开启事务</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>回滚事务</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ROLLBACK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>提交事务</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>管理事务演示</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 张三给李四转账500元</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1.张三账户-500</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2.李四账户+500</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 出错了...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;">money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;李四&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 回滚事务(出现问题)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ROLLBACK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务(没出现问题)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-事务的提交方式" tabindex="-1"><a class="header-anchor" href="#_5-事务的提交方式"><span>5.事务的提交方式</span></a></h4><ul><li><p>提交方式</p><ul><li>自动提交(MySQL默认为自动提交)</li><li>手动提交</li></ul></li><li><p>修改提交方式</p><ul><li>查看提交方式</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@AUTOCOMMIT;  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1代表自动提交    0代表手动提交</span></span></code></pre></div><ul><li>修改提交方式</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@AUTOCOMMIT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">数字;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改为手动提交</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@AUTOCOMMIT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看提交方式</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@AUTOCOMMIT;</span></span></code></pre></div></li></ul><h4 id="_6-事务的四大特征-acid" tabindex="-1"><a class="header-anchor" href="#_6-事务的四大特征-acid"><span>6.事务的四大特征(ACID)</span></a></h4><ul><li>原子性(atomicity) <ul><li>原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚，因此事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响</li></ul></li><li>一致性(consistency) <ul><li>一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态</li><li>拿转账来说，假设张三和李四两者的钱加起来一共是2000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是2000，这就是事务的一致性</li></ul></li><li>隔离性(isolcation) <ul><li>隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离</li></ul></li><li>持久性(durability) <ul><li>持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作</li></ul></li></ul><h4 id="_7-事务的隔离级别" tabindex="-1"><a class="header-anchor" href="#_7-事务的隔离级别"><span>7.事务的隔离级别</span></a></h4><ul><li>隔离级别的概念 <ul><li>多个客户端操作时 ,各个客户端的事务之间应该是隔离的，相互独立的 , 不受影响的。</li><li>而如果多个事务操作同一批数据时，则需要设置不同的隔离级别 , 否则就会产生问题 。</li><li>我们先来了解一下四种隔离级别的名称 , 再来看看可能出现的问题</li></ul></li><li>四种隔离级别</li></ul><table><thead><tr><th>1</th><th>读未提交</th><th>read uncommitted</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><strong>读已提交</strong></td><td><strong>read committed</strong></td></tr><tr><td><strong>3</strong></td><td><strong>可重复读</strong></td><td><strong>repeatable read</strong></td></tr><tr><td><strong>4</strong></td><td><strong>串行化</strong></td><td><strong>serializable</strong></td></tr></tbody></table><ul><li>可能引发的问题</li></ul><table><thead><tr><th>问题</th><th>现象</th></tr></thead><tbody><tr><td><strong>脏读</strong></td><td><strong>是指在一个事务处理过程中读取了另一个未提交的事务中的数据 , 导致两次查询结果不一致</strong></td></tr><tr><td><strong>不可重复读</strong></td><td><strong>是指在一个事务处理过程中读取了另一个事务中修改并已提交的数据, 导致两次查询结果不一致</strong></td></tr><tr><td><strong>幻读</strong></td><td><strong>select 某记录是否存在，不存在，准备插入此记录，但执行 insert 时发现此记录已存在，无法插入。或不存在执行delete删除，却发现删除成功</strong></td></tr></tbody></table><ul><li>查询数据库隔离级别</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@TX_ISOLATION;</span></span></code></pre></div><ul><li>修改数据库隔离级别</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 标准语法</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> GLOBAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 级别字符串;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改数据库隔离级别为read uncommitted</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> GLOBAL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> uncommitted</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@TX_ISOLATION;   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 修改后需要断开连接重新开</span></span></code></pre></div><h4 id="_8-事务隔离级别演示" tabindex="-1"><a class="header-anchor" href="#_8-事务隔离级别演示"><span>8.事务隔离级别演示</span></a></h4><ul><li><p>脏读的问题</p><ul><li>窗口1</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别为read uncommitted</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> isolation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> level</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> uncommitted</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 转账</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> - </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 窗口2查询转账结果 ,出现脏读(查询到其他事务未提交的数据)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 窗口2查看转账结果后，执行回滚</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">rollback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>窗口2</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@tx_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span></code></pre></div></li><li><p>解决脏读的问题和演示不可重复读的问题</p><ul><li>窗口1</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别为read committed</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> isolation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> level</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> committed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 转账</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> - </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 窗口2查看转账结果，并没有发生变化(脏读问题被解决了)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 执行提交事务。</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">commit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 窗口2查看转账结果，数据发生了变化(出现了不可重复读的问题，读取到其他事务已提交的数据)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>窗口2</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@tx_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span></code></pre></div></li><li><p>解决不可重复读的问题</p><ul><li>窗口1</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别为repeatable read</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> isolation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> level</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> repeatable</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 转账</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> - </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> money</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> + </span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 窗口2查看转账结果，并没有发生变化</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 执行提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">commit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 这个时候窗口2只要还在上次事务中，看到的结果都是相同的。只有窗口2结束事务，才能看到变化(不可重复读的问题被解决)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>窗口2</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@tx_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">commit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span></code></pre></div></li><li><p>幻读的问题和解决</p><ul><li>窗口1</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别为repeatable read</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> isolation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> level</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> repeatable</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加一条记录</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;王五&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1500</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表，本窗口可以查看到id为3的结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>窗口2</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@tx_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表，查询不到新添加的id为3的记录</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加id为3的一条数据，发现添加失败。出现了幻读</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;测试&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表，查询到了新添加的id为3的记录</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>解决幻读的问题</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	窗口1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别为serializable</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transaction</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> isolation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> level</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加一条记录</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;赵六&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1600</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表，本窗口可以查看到id为4的结果</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	窗口2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">*/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询隔离级别</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> @@tx_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">start transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询账户表，发现查询语句无法执行，数据表被锁住！只有窗口1提交事务后，才可以继续操作</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加id为4的一条数据，发现已经存在了，就不会再添加了！幻读的问题被解决</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> account </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;测试&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_9-隔离级别总结" tabindex="-1"><a class="header-anchor" href="#_9-隔离级别总结"><span>9.隔离级别总结</span></a></h4><table><thead><tr><th></th><th>隔离级别</th><th>名称</th><th>出现脏读</th><th>出现不可重复读</th><th>出现幻读</th><th>数据库默认隔离级别</th></tr></thead><tbody><tr><td>1</td><td><strong>read uncommitted</strong></td><td>读未提交</td><td>是</td><td>是</td><td>是</td><td></td></tr><tr><td>2</td><td><strong>read committed</strong></td><td>读已提交</td><td>否</td><td>是</td><td>是</td><td>Oracle / SQL Server</td></tr><tr><td>3</td><td><strong>repeatable read</strong></td><td>可重复读</td><td>否</td><td>否</td><td>是</td><td>MySQL</td></tr><tr><td>4</td><td>**serializable **</td><td>串行化</td><td>否</td><td>否</td><td>否</td><td></td></tr></tbody></table><blockquote><p>注意：隔离级别从小到大安全性越来越高，但是效率越来越低 , 所以不建议使用READ UNCOMMITTED 和 SERIALIZABLE 隔离级别.</p></blockquote><h4 id="_10-事务的总结" tabindex="-1"><a class="header-anchor" href="#_10-事务的总结"><span>10.事务的总结</span></a></h4><ul><li>一条或多条 SQL 语句组成一个执行单元，其特点是这个单元要么同时成功要么同时失败。例如转账操作</li><li>开启事务：start transaction;</li><li>回滚事务：rollback;</li><li>提交事务：commit;</li><li>事务四大特征 <ul><li>原子性</li><li>持久性</li><li>隔离性</li><li>一致性</li></ul></li><li>事务的隔离级别 <ul><li>read uncommitted(读未提交)</li><li>read committed (读已提交)</li><li>repeatable read (可重复读)</li><li>serializable (串行化)</li></ul></li></ul>`,128)]))}const t=a(e,[["render",p],["__file","MySQL高级-03.html.vue"]]),k=JSON.parse('{"path":"/posts/Database/MySQL/MySQL%E9%AB%98%E7%BA%A7-03.html","title":"MySQL高级","lang":"zh-CN","frontmatter":{"aliases":"MySQL高级","tags":null,"cssclass":null,"source":null,"order":3,"category":["数据库","Mysql"],"created":"2024-02-22 10:49","updated":"2024-03-13 09:40","description":"MySQL高级 一、MySQL存储过程和函数 1.存储过程和函数的概念 存储过程和函数是 事先经过编译并存储在数据库中的一段 SQL 语句的集合 2.存储过程和函数的好处 存储过程和函数可以重复使用，减轻开发人员的工作量。类似于java中方法可以多次调用 减少网络流量，存储过程和函数位于服务器上，调用的时候只需要传递名称和参数即可 减少数据在数据库和应...","head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/Database/MySQL/MySQL%E9%AB%98%E7%BA%A7-03.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"MySQL高级"}],["meta",{"property":"og:description","content":"MySQL高级 一、MySQL存储过程和函数 1.存储过程和函数的概念 存储过程和函数是 事先经过编译并存储在数据库中的一段 SQL 语句的集合 2.存储过程和函数的好处 存储过程和函数可以重复使用，减轻开发人员的工作量。类似于java中方法可以多次调用 减少网络流量，存储过程和函数位于服务器上，调用的时候只需要传递名称和参数即可 减少数据在数据库和应..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-21T07:03:09.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-21T07:03:09.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL高级\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-21T07:03:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":3,"title":"一、MySQL存储过程和函数","slug":"一、mysql存储过程和函数","link":"#一、mysql存储过程和函数","children":[]},{"level":3,"title":"二、MySQL触发器","slug":"二、mysql触发器","link":"#二、mysql触发器","children":[]},{"level":3,"title":"三、MySQL事务","slug":"三、mysql事务","link":"#三、mysql事务","children":[]}],"git":{"createdTime":1729494189000,"updatedTime":1729494189000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":23.88,"words":7163},"filePathRelative":"posts/Database/MySQL/MySQL高级-03.md","localizedDate":"2024年10月21日","excerpt":"\\n<h3>一、MySQL存储过程和函数</h3>\\n<h4>1.存储过程和函数的概念</h4>\\n<ul>\\n<li>存储过程和函数是 事先经过编译并存储在数据库中的一段 SQL 语句的集合</li>\\n</ul>\\n<h4>2.存储过程和函数的好处</h4>\\n<ul>\\n<li>存储过程和函数可以重复使用，减轻开发人员的工作量。类似于java中方法可以多次调用</li>\\n<li>减少网络流量，存储过程和函数位于服务器上，调用的时候只需要传递名称和参数即可</li>\\n<li>减少数据在数据库和应用服务器之间的传输，可以提高数据处理的效率</li>\\n<li>将一些业务逻辑在数据库层面来实现，可以减少代码层面的业务处理</li>\\n</ul>","autoDesc":true}');export{t as comp,k as data};
