import{_ as a,c as n,a as i,o as l}from"./app-tJW29Kmg.js";const o={};function p(r,s){return l(),n("div",null,s[0]||(s[0]=[i(`<h1 id="mongo入门-基本使用-索引和聚合" tabindex="-1"><a class="header-anchor" href="#mongo入门-基本使用-索引和聚合"><span>Mongo入门 - 基本使用：索引和聚合</span></a></h1><blockquote><p>在了解MongoDB的基本CRUD操作后，常用的其它操作还有对字段的索引以及对字段的聚合操作。</p></blockquote><h2 id="_1-聚合-aggregation-pipline" tabindex="-1"><a class="header-anchor" href="#_1-聚合-aggregation-pipline"><span>1. 聚合 - Aggregation Pipline</span></a></h2><blockquote><p>类似于将SQL中的group by + order by + left join ... 等操作管道化。</p></blockquote><h3 id="_1-1-常规使用" tabindex="-1"><a class="header-anchor" href="#_1-1-常规使用"><span>1.1 常规使用</span></a></h3><ul><li>图例理解</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821538.png" alt="image-20230111222615479" tabindex="0" loading="lazy"><figcaption>image-20230111222615479</figcaption></figure><ul><li>准备数据</li></ul><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.orders.insertMany( [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     { _id: 1, cust_id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;abc1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ord_date: ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2012-11-02T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, amount: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     { _id: 2, cust_id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;xyz1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ord_date: ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2013-10-01T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, amount: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     { _id: 3, cust_id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;xyz1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ord_date: ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2013-10-12T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;D&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, amount: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     { _id: 4, cust_id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;xyz1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ord_date: ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2013-10-11T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;D&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, amount: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">125</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     { _id: 5, cust_id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;abc1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ord_date: ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2013-11-12T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, amount: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... ] );</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;acknowledged&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;insertedIds&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 4,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#98C379;--shiki-dark:#98C379;"> ]</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.orders.find({})</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2012-11-02T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 50</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2013-10-01T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2013-10-12T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;D&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 25</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 4,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2013-10-11T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;D&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 125</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 5,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2013-11-12T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 25</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>聚合操作</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.orders.aggregate([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...                      { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: { status: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...                      { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$group</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: { _id: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$cust_id</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, total: { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$amount</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...                      { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: { total: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">-1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...                    ])</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;total&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;total&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 75</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span></code></pre></div><p>官网还有两个例子：</p><ul><li><a href="https://docs.mongodb.com/v3.6/tutorial/aggregation-zip-code-data-set/" target="_blank" rel="noopener noreferrer">Aggregation with the Zip Code Data Set</a></li><li><a href="https://docs.mongodb.com/v3.6/tutorial/aggregation-with-user-preference-data/" target="_blank" rel="noopener noreferrer">Aggregation with User Preference Data</a></li></ul><h3 id="_1-2-pipline操作" tabindex="-1"><a class="header-anchor" href="#_1-2-pipline操作"><span>1.2 Pipline操作</span></a></h3><p>MongoDB的聚合管道（Pipline）将MongoDB文档在一个阶段（Stage）处理完毕后将结果传递给下一个阶段（Stage）处理。<strong>阶段（Stage）操作是可以重复的</strong>。</p><p>表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。</p><p>这里我们介绍一下聚合框架中常用的几个Stages：</p><ul><li><code>$project</code>：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li><li><code>$match</code>：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li><li><code>$limit</code>：用来限制MongoDB聚合管道返回的文档数。</li><li><code>$skip</code>：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li><li><code>$unwind</code>：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li><li><code>$group</code>：将集合中的文档分组，可用于统计结果。</li><li><code>$sort</code>：将输入文档排序后输出。</li><li><code>$geoNear</code>：输出接近某一地理位置的有序文档。</li><li><code>$bucket</code>: 分组（分桶）计算。</li><li><code>$facet</code> : 多次分组计算。</li><li><code>$out</code>: 将结果集输出，必须是Pipline最后一个Stage。</li></ul><p>举几个例子</p><ul><li><p>$project</p><p>修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</p></li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.orders.aggregate(</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">     {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $project</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">         _id</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span><span style="color:#98C379;--shiki-dark:#98C379;"> //</span><span style="color:#98C379;--shiki-dark:#98C379;"> 默认不显示_id</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">         cust_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> ,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">         status</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">     }}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;D&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;xyz1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;D&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><ul><li><p>$skip</p><p>在聚合管道中跳过指定数量的文档，并返回余下的文档。</p></li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> db.orders.aggregate(</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">     {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $skip</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 5,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ord_date&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ISODate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2013-11-12T17:04:11.102Z&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 25</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><ul><li><p>$unwind</p><p>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</p></li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.inventory2.insertOne({ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC1&quot;, sizes: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] })</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;acknowledged&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;insertedId&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.inventory2.aggregate( [ { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$unwind</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sizes</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> } ] )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;item&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ABC1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;sizes&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;S&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;item&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ABC1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;sizes&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;M&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;item&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;ABC1&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;sizes&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;L&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span></code></pre></div><ul><li><p>$bucket</p><p>分组（分桶）计算</p></li></ul><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.artwork.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Pillars of Society&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Grosz&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1926,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;199.99&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 2, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Melancholy III&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Munch&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1902,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;280.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 3, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dancer&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Miro&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1925,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;76.04&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 4, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Great Wave off Kanagawa&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Hokusai&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;167.30&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 5, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Persistence of Memory&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dali&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1931,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;483.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 6, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Composition VII&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Kandinsky&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1913,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;385.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 7, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Scream&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Munch&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1893</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... { </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 8, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Blue Flower&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;artist&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;O&#39;Keefe&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> 1918,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;118.42&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... ])</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;acknowledged&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;insertedIds&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                4,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                5,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                6,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                7,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                8</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.artwork.find({})</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Pillars of Society&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Grosz&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1926,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;199.99&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Melancholy III&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Munch&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1902,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;280.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dancer&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Miro&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1925,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;76.04&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 4,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Great Wave off Kanagawa&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Hokusai&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;167.30&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 5,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Persistence of Memory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dali&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1931,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;483.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 6,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Composition VII&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Kandinsky&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1913,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;385.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 7,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Scream&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Munch&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1893</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> //</span><span style="color:#98C379;--shiki-dark:#98C379;"> 注意这里没有price，聚合结果中为Others</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 8,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Blue Flower&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;artist&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;O&#39;Keefe&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1918,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;118.42&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.artwork.aggregate( [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...   {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$bucket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...       groupBy: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$price</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...       boundaries: [ 0, 200, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">400</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ],</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...       default: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Other&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...       output: {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...         </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;count&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...         </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;titles&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="color:#E06C75;--shiki-dark:#E06C75;">$push</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$title</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...       }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...     }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...   }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">... ] )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 4,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;titles&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;The Pillars of Society&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dancer&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Great Wave off Kanagawa&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Blue Flower&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> ]</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 200,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;titles&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Melancholy III&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Composition VII&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> ]</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Other&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;titles&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;The Persistence of Memory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Scream&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> ]</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>$bucket + $facet</p><p>$bucket 分组（分桶）计算</p><p><code>$facet</code> : 多次分组计算。</p></li></ul><blockquote><p>非常常用！</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.artwork.aggregate(</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    $facet</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;price&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">          $bucket</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              groupBy:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$price</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              boundaries:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">0,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 200,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 400</span><span style="color:#98C379;--shiki-dark:#98C379;"> ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              default:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Other&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              output:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;count&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $sum</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $push</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$title</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;price&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$price</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;year&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">          $bucket</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            groupBy:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$year</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            boundaries:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">1890,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1910,</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1920,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1940</span><span style="color:#98C379;--shiki-dark:#98C379;"> ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            default:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Unknown&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            output:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              &quot;count&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $sum</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              &quot;artwork&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $push</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;title&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$title</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;year&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$year</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">//</span><span style="color:#98C379;--shiki-dark:#98C379;"> 输出</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1890,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Melancholy III&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1902</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Scream&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1893</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1910,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Composition VII&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1913</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Blue Flower&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1918</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1920,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Pillars of Society&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1926</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dancer&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1925</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Persistence of Memory&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;year&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1931</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      //</span><span style="color:#98C379;--shiki-dark:#98C379;"> Includes</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> document</span><span style="color:#98C379;--shiki-dark:#98C379;"> without</span><span style="color:#98C379;--shiki-dark:#98C379;"> a</span><span style="color:#98C379;--shiki-dark:#98C379;"> year,</span><span style="color:#98C379;--shiki-dark:#98C379;"> e.g.,</span><span style="color:#98C379;--shiki-dark:#98C379;"> _id:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Unknown&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Great Wave off Kanagawa&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 4,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Pillars of Society&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;199.99&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Dancer&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;76.04&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Great Wave off Kanagawa&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;167.30&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Blue Flower&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;118.42&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 200,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Melancholy III&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;280.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Composition VII&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;385.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      //</span><span style="color:#98C379;--shiki-dark:#98C379;"> Includes</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> document</span><span style="color:#98C379;--shiki-dark:#98C379;"> without</span><span style="color:#98C379;--shiki-dark:#98C379;"> a</span><span style="color:#98C379;--shiki-dark:#98C379;"> price,</span><span style="color:#98C379;--shiki-dark:#98C379;"> e.g.,</span><span style="color:#98C379;--shiki-dark:#98C379;"> _id:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 7</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Other&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;count&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      &quot;artwork&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Persistence of Memory&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;price&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> NumberDecimal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;483.00&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          &quot;title&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;The Scream&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>聚合操作使用的比较频繁，在实际的工作中可以参考<a href="https://docs.mongodb.com/v3.6/reference/operator/aggregation-pipeline/" target="_blank" rel="noopener noreferrer">官方文档 - Aggregation Pipeline Stages</a>。</p></blockquote><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821579.png" alt="image-20230111222821329" tabindex="0" loading="lazy"><figcaption>image-20230111222821329</figcaption></figure><h3 id="_1-3-aggregation-options参数" tabindex="-1"><a class="header-anchor" href="#_1-3-aggregation-options参数"><span>1.3 Aggregation Options参数</span></a></h3><blockquote><p>举一个explain参数为例，更多的相关Options可以参考官方文档，<a href="https://docs.mongodb.com/v3.6/reference/method/db.collection.aggregate/" target="_blank" rel="noopener noreferrer">Aggregrate相关配置在新窗口打开</a></p></blockquote><ul><li>explain</li></ul><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; db.orders.aggregate(</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                      [</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                        {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $match</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> status:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                        {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $group</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> _id:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$cust_id</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> total:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $sum</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$amount</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                        {</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $sort</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> total:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -1</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                      ],</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                      {</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                        explain:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#98C379;--shiki-dark:#98C379;">                      }</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;serverInfo&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;host&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;pdai&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;port&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 27017,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;version&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;3.6.19&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                &quot;gitVersion&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;41b289ff734a926e784d6ab42c3129f59f40d5b4&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;stages&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$cursor</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;query&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;fields&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;amount&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;cust_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;queryPlanner&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;plannerVersion&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;namespace&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;testdb.orders&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;indexFilterSet&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;parsedQuery&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                        &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$eq</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;winningPlan&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                &quot;stage&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;COLLSCAN&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                &quot;filter&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                        &quot;status&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                                &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$eq</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;A&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                                        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                                },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                                &quot;direction&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;forward&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;rejectedPlans&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$group</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;_id&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$cust_id</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;total&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sum</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$amount</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        &quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$sort</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                &quot;sortKey&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                        &quot;total&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ok&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-聚合-map-reduce" tabindex="-1"><a class="header-anchor" href="#_2-聚合-map-reduce"><span>2. 聚合 - Map Reduce</span></a></h2><ul><li>图例理解</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821611.png" alt="image-20230111223321165" tabindex="0" loading="lazy"><figcaption>image-20230111223321165</figcaption></figure><h3 id="_2-1-官网给了个例子" tabindex="-1"><a class="header-anchor" href="#_2-1-官网给了个例子"><span>2.1 官网给了个例子</span></a></h3><ul><li>准备数据</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     _id:</span><span style="color:#98C379;--shiki-dark:#98C379;"> ObjectId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;50a8240b927d5d8b5891743c&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     cust_id:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;abc123&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     ord_date:</span><span style="color:#98C379;--shiki-dark:#98C379;"> new</span><span style="color:#98C379;--shiki-dark:#98C379;"> Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;Oct 04, 2012&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     status:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;A&#39;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     price:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 25,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     items:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span><span style="color:#98C379;--shiki-dark:#98C379;"> sku:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;mmm&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> qty:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 5,</span><span style="color:#98C379;--shiki-dark:#98C379;"> price:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2.5</span><span style="color:#98C379;--shiki-dark:#98C379;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">              { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sku:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;nnn&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> qty:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 5,</span><span style="color:#98C379;--shiki-dark:#98C379;"> price:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2.5</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#98C379;--shiki-dark:#98C379;"> ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>计算每个顾客总花费：</li></ul><p>map</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> mapFunction1</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                       emit(this.cust_id,</span><span style="color:#98C379;--shiki-dark:#98C379;"> this.price</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                   };</span></span></code></pre></div><p>reduce</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> reduceFunction1</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">keyCustId,</span><span style="color:#98C379;--shiki-dark:#98C379;"> valuesPrices</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                          return</span><span style="color:#98C379;--shiki-dark:#98C379;"> Array.sum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valuesPrices</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                      };</span></span></code></pre></div><p>out</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.orders.mapReduce(</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                     mapFunction1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                     reduceFunction1,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                     { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">out:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;map_reduce_example&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                   )</span></span></code></pre></div><ul><li>计算每个订单中Items的均价</li></ul><p>map</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> mapFunction2</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                       for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> idx</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">idx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt; </span><span style="color:#98C379;--shiki-dark:#98C379;">this.items.length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">idx++</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                           var</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> this.items[idx].sku</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                           var</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                         count:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                         qty:</span><span style="color:#98C379;--shiki-dark:#98C379;"> this.items[idx].qty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                                       };</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                           emit(key,</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                       }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    };</span></span></code></pre></div><p>reduce</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> reduceFunction2</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">keySKU,</span><span style="color:#98C379;--shiki-dark:#98C379;"> countObjVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                     reducedVal</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;"> count:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0,</span><span style="color:#98C379;--shiki-dark:#98C379;"> qty:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#98C379;--shiki-dark:#98C379;"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                     for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> idx</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">idx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt; </span><span style="color:#98C379;--shiki-dark:#98C379;">countObjVals.length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">idx++</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                         reducedVal.count</span><span style="color:#98C379;--shiki-dark:#98C379;"> +=</span><span style="color:#98C379;--shiki-dark:#98C379;"> countObjVals[idx].count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                         reducedVal.qty</span><span style="color:#98C379;--shiki-dark:#98C379;"> +=</span><span style="color:#98C379;--shiki-dark:#98C379;"> countObjVals[idx].qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                     }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                     return</span><span style="color:#98C379;--shiki-dark:#98C379;"> reducedVal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                  };</span></span></code></pre></div><p>finalize</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">var</span><span style="color:#98C379;--shiki-dark:#98C379;"> finalizeFunction2</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> function</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (key, </span><span style="color:#98C379;--shiki-dark:#98C379;">reducedVal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                       reducedVal.avg</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> reducedVal.qty/reducedVal.count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                       return</span><span style="color:#98C379;--shiki-dark:#98C379;"> reducedVal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    };</span></span></code></pre></div><h2 id="_3-索引" tabindex="-1"><a class="header-anchor" href="#_3-索引"><span>3. 索引</span></a></h2><p>索引即为提升查询等的效率，默认是对_id进行索引的。</p><h3 id="_3-1-图例理解" tabindex="-1"><a class="header-anchor" href="#_3-1-图例理解"><span>3.1 图例理解</span></a></h3><p>以对users中score进行索引时查询的效果</p><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821652.png" alt="image-20230111223525442" tabindex="0" loading="lazy"><figcaption>image-20230111223525442</figcaption></figure><h3 id="_3-2-索引的类型" tabindex="-1"><a class="header-anchor" href="#_3-2-索引的类型"><span>3.2 索引的类型</span></a></h3><p>对于索引，这里简单介绍下常用的类型，其它类型和例子可以参考<a href="https://docs.mongodb.com/v3.6/indexes/" target="_blank" rel="noopener noreferrer">官网文档 - 索引</a></p><ul><li>单一索引</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821686.png" alt="image-20230111223740750" tabindex="0" loading="lazy"><figcaption>image-20230111223740750</figcaption></figure><ul><li>复合索引</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821719.png" alt="image-20230111223801994" tabindex="0" loading="lazy"><figcaption>image-20230111223801994</figcaption></figure><ul><li>多键索引</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821749.png" alt="image-20230111223838780" tabindex="0" loading="lazy"><figcaption>image-20230111223838780</figcaption></figure><h3 id="_3-3-对索引的操作" tabindex="-1"><a class="header-anchor" href="#_3-3-对索引的操作"><span>3.3 对索引的操作</span></a></h3><ul><li>查看集合索引</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.col.getIndexes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><ul><li>查看集合索引大小</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.col.totalIndexSize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><ul><li>删除集合所有索引</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.col.dropIndexes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><ul><li>删除集合指定索引</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">db.col.dropIndex(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;索引名称&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h2><p><a href="https://pdai.tech/md/db/nosql-mongo/mongo-x-usage-2.html" target="_blank" rel="noopener noreferrer">Mongo入门 - 基本使用：索引和聚合</a></p>`,80)]))}const k=a(o,[["render",p],["__file","mongo-x-usage-2.html.vue"]]),t=JSON.parse('{"path":"/posts/Database/MongoDB/mongo-x-usage-2.html","title":"Mongo入门 - 基本使用：索引和聚合","lang":"zh-CN","frontmatter":{"aliases":"Mongo入门 - 基本使用：索引和聚合","tags":null,"cssclass":null,"source":null,"order":50,"category":["mongodb"],"created":"2024-02-22 10:49","updated":"2024-03-13 08:22","description":"Mongo入门 - 基本使用：索引和聚合 在了解MongoDB的基本CRUD操作后，常用的其它操作还有对字段的索引以及对字段的聚合操作。 1. 聚合 - Aggregation Pipline 类似于将SQL中的group by + order by + left join ... 等操作管道化。 1.1 常规使用 图例理解 image-2023011...","head":[["meta",{"property":"og:url","content":"https://springg.us.kg/posts/Database/MongoDB/mongo-x-usage-2.html"}],["meta",{"property":"og:site_name","content":"mrjason’s Blog"}],["meta",{"property":"og:title","content":"Mongo入门 - 基本使用：索引和聚合"}],["meta",{"property":"og:description","content":"Mongo入门 - 基本使用：索引和聚合 在了解MongoDB的基本CRUD操作后，常用的其它操作还有对字段的索引以及对字段的聚合操作。 1. 聚合 - Aggregation Pipline 类似于将SQL中的group by + order by + left join ... 等操作管道化。 1.1 常规使用 图例理解 image-2023011..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821538.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-21T07:03:09.000Z"}],["meta",{"property":"article:author","content":"MrJason"}],["meta",{"property":"article:modified_time","content":"2024-10-21T07:03:09.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Mongo入门 - 基本使用：索引和聚合\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821538.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821579.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821611.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821652.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821686.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821719.png\\",\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821749.png\\"],\\"dateModified\\":\\"2024-10-21T07:03:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MrJason\\",\\"url\\":\\"https://springg.us.kg\\"}]}"]]},"headers":[{"level":2,"title":"1. 聚合 - Aggregation Pipline","slug":"_1-聚合-aggregation-pipline","link":"#_1-聚合-aggregation-pipline","children":[{"level":3,"title":"1.1 常规使用","slug":"_1-1-常规使用","link":"#_1-1-常规使用","children":[]},{"level":3,"title":"1.2 Pipline操作","slug":"_1-2-pipline操作","link":"#_1-2-pipline操作","children":[]},{"level":3,"title":"1.3 Aggregation Options参数","slug":"_1-3-aggregation-options参数","link":"#_1-3-aggregation-options参数","children":[]}]},{"level":2,"title":"2. 聚合 - Map Reduce","slug":"_2-聚合-map-reduce","link":"#_2-聚合-map-reduce","children":[{"level":3,"title":"2.1 官网给了个例子","slug":"_2-1-官网给了个例子","link":"#_2-1-官网给了个例子","children":[]}]},{"level":2,"title":"3. 索引","slug":"_3-索引","link":"#_3-索引","children":[{"level":3,"title":"3.1 图例理解","slug":"_3-1-图例理解","link":"#_3-1-图例理解","children":[]},{"level":3,"title":"3.2 索引的类型","slug":"_3-2-索引的类型","link":"#_3-2-索引的类型","children":[]},{"level":3,"title":"3.3 对索引的操作","slug":"_3-3-对索引的操作","link":"#_3-3-对索引的操作","children":[]}]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"git":{"createdTime":1729494189000,"updatedTime":1729494189000,"contributors":[{"name":"MrJason","email":"845886914@qq.com","commits":1}]},"readingTime":{"minutes":6.38,"words":1915},"filePathRelative":"posts/Database/MongoDB/mongo-x-usage-2.md","localizedDate":"2024年10月21日","excerpt":"\\n<blockquote>\\n<p>在了解MongoDB的基本CRUD操作后，常用的其它操作还有对字段的索引以及对字段的聚合操作。</p>\\n</blockquote>\\n<h2>1. 聚合 - Aggregation Pipline</h2>\\n<blockquote>\\n<p>类似于将SQL中的group by + order by + left join ... 等操作管道化。</p>\\n</blockquote>\\n<h3>1.1 常规使用</h3>\\n<ul>\\n<li>图例理解</li>\\n</ul>\\n<figure><img src=\\"https://cdn.jsdelivr.net/gh/MrJackC/PicGoImages/other/202403130821538.png\\" alt=\\"image-20230111222615479\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>image-20230111222615479</figcaption></figure>","autoDesc":true}');export{k as comp,t as data};
